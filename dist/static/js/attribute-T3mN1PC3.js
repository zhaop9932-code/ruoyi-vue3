import{_ as me,p as ve,r as p,g as R,i as fe,a as d,j as _e,c as G,o as m,e as v,b as e,w as l,f as n,t as f,k as B,v as j,m as T,q as O,l as H,F as J,s as W,E as _,n as ye}from"./index-a6CENfl-.js";import{listAttribute as ge,getAttribute as Ve,deleteAttribute as we,updateAttribute as Te,addAttribute as Ne}from"./product-D8MMQEHj.js";import{listAttributeGroup as Ce}from"./attributeGroup-DNxjbwZp.js";const qe={class:"cpq-page-container"},Ie={class:"cpq-card"},ke={class:"cpq-card-header"},Ue={class:"cpq-card-actions"},he={class:"cpq-card-body"},Ge={class:"cpq-card-title"},ze={key:0,class:"cpq-catalog-name"},Ae={class:"cpq-pagination"},Se={class:"cpq-dialog-footer"},xe={__name:"attribute",setup(Re){const D=ve(),z=p(D.query.catalogId||""),F=p(D.query.catalogName||""),I=p(!0),k=p(!0),A=p(0),L=p([]),S=p([]),s=p(null),x=p(""),g=p(!1),E=p([]),K=p(!1),M=async()=>{K.value=!0;try{const u=await Ce({pageNum:1,pageSize:100});E.value=u.rows||[]}catch{_.error("加载属性组列表失败")}finally{K.value=!1}},i=R({pageNum:1,pageSize:10,attributeCode:"",attributeName:"",attributeType:"",catalogId:""}),o=R({attributeId:null,attributeCode:"",attributeName:"",attributeType:"text",componentType:"input",iconUrl:"",defaultValue:"",tooltip:"",attributeGroupId:"",attributeGroupName:""}),X=R({attributeName:[{required:!0,message:"属性名称不能为空",trigger:"blur"}],attributeType:[{required:!0,message:"属性类型不能为空",trigger:"change"}],componentType:[{required:!0,message:"组件类型不能为空",trigger:"change"}]}),N=async()=>{I.value=!0;try{const u=await ge(i);L.value=u.rows,A.value=u.total,I.value=!1}catch{I.value=!1,_.error("获取属性列表失败")}},U=()=>{i.pageNum=1,N()},Y=()=>{i.attributeCode="",i.attributeName="",i.attributeType="",U()},Z=()=>{k.value=!k.value},ee=u=>{S.value=u},te=u=>{s.value=u},le=()=>{o.attributeId=null,o.attributeCode="",o.attributeName="",o.attributeType="text",o.componentType="input",o.iconUrl="",o.defaultValue="",o.tooltip="",o.attributeGroupId="",o.attributeGroupName="",x.value="新增属性",M(),g.value=!0},ae=async u=>{try{const t=await Ve(u.attributeId);o.attributeId=t.attributeId,o.attributeCode=t.attributeCode,o.attributeName=t.attributeName,o.attributeType=t.attributeType,o.componentType=t.componentType,o.iconUrl=t.iconUrl,o.defaultValue=t.defaultValue,o.tooltip=t.tooltip,o.attributeGroupId=t.attributeGroupId||"",o.attributeGroupName=t.attributeGroupName||"",x.value="修改属性",M(),g.value=!0}catch{_.error("获取属性详情失败")}},P=async u=>{const t=u.attributeId?[u.attributeId]:S.value.map(c=>c.attributeId);await ye.confirm("确定要删除选中的属性吗？","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});try{await we(t),_.success("删除成功"),N(),s.value=null}catch{_.error("删除失败")}},C=p(null),oe=async()=>{C.value&&await C.value.validate().then(async()=>{try{o.attributeId?(await Te(o),_.success("修改成功")):(await Ne(o),_.success("新增成功")),g.value=!1,N()}catch{_.error("操作失败")}}).catch(()=>{_.error("表单验证失败，请检查填写内容")})},ue=()=>{g.value=!1,C.value&&C.value.resetFields()};return fe(()=>{z.value&&(i.catalogId=z.value),N()}),(u,t)=>{const c=d("el-button"),V=d("el-input"),b=d("el-form-item"),r=d("el-option"),q=d("el-select"),Q=d("el-form"),h=d("el-card"),w=d("el-table-column"),re=d("el-tag"),ne=d("el-table"),ie=d("pagination"),$=d("el-col"),y=d("el-descriptions-item"),de=d("el-descriptions"),se=d("el-row"),pe=d("el-dialog"),ce=_e("loading");return m(),G("div",qe,[v("div",Ie,[v("div",ke,[t[14]||(t[14]=v("div",{class:"cpq-card-title"},"产品属性管理",-1)),v("div",Ue,[e(c,{type:"primary",onClick:le,icon:u.Plus},{default:l(()=>t[12]||(t[12]=[n("新增属性")])),_:1,__:[12]},8,["icon"]),e(c,{type:"danger",onClick:P,disabled:S.value.length===0,icon:u.Delete},{default:l(()=>t[13]||(t[13]=[n("批量删除")])),_:1,__:[13]},8,["disabled","icon"]),e(c,{type:"info",onClick:Z,icon:u.Search},{default:l(()=>[n(f(k.value?"收起":"展开")+"搜索 ",1)]),_:1},8,["icon"])])]),v("div",he,[B(e(h,{shadow:"never",class:"cpq-search-card"},{default:l(()=>[e(Q,{model:i,ref:"queryForm",inline:!0,"label-width":"80px"},{default:l(()=>[e(b,{label:"属性编码",prop:"attributeCode"},{default:l(()=>[e(V,{modelValue:i.attributeCode,"onUpdate:modelValue":t[0]||(t[0]=a=>i.attributeCode=a),placeholder:"请输入属性编码",clearable:"",size:"small",onKeyup:H(U,["enter"])},null,8,["modelValue"])]),_:1}),e(b,{label:"属性名称",prop:"attributeName"},{default:l(()=>[e(V,{modelValue:i.attributeName,"onUpdate:modelValue":t[1]||(t[1]=a=>i.attributeName=a),placeholder:"请输入属性名称",clearable:"",size:"small",onKeyup:H(U,["enter"])},null,8,["modelValue"])]),_:1}),e(b,{label:"属性类型",prop:"attributeType"},{default:l(()=>[e(q,{modelValue:i.attributeType,"onUpdate:modelValue":t[2]||(t[2]=a=>i.attributeType=a),placeholder:"请选择属性类型",clearable:"",size:"small"},{default:l(()=>[e(r,{label:"文本",value:"text"}),e(r,{label:"数字",value:"number"}),e(r,{label:"日期",value:"date"}),e(r,{label:"枚举",value:"enum"}),e(r,{label:"布尔",value:"boolean"})]),_:1},8,["modelValue"])]),_:1}),z.value?O("",!0):(m(),T(b,{key:0},{default:l(()=>[e(q,{modelValue:i.catalogId,"onUpdate:modelValue":t[3]||(t[3]=a=>i.catalogId=a),placeholder:"请选择目录",clearable:"",size:"small"},{default:l(()=>[(m(!0),G(J,null,W(u.catalogList,a=>(m(),T(r,{key:a.catalogId,label:a.catalogName,value:a.catalogId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})),e(b,null,{default:l(()=>[e(c,{type:"primary",size:"small",onClick:U,icon:u.Search},{default:l(()=>t[15]||(t[15]=[n("搜索")])),_:1,__:[15]},8,["icon"]),e(c,{size:"small",onClick:Y,icon:u.Refresh},{default:l(()=>t[16]||(t[16]=[n("重置")])),_:1,__:[16]},8,["icon"])]),_:1})]),_:1},8,["model"])]),_:1},512),[[j,k.value]]),e(se,{gutter:20,class:"cpq-content-row"},{default:l(()=>[e($,{span:10},{default:l(()=>[e(h,{shadow:"never",class:"cpq-sub-card"},{header:l(()=>[v("div",Ge,[t[17]||(t[17]=n(" 属性列表 ")),F.value?(m(),G("span",ze,"(目录："+f(F.value)+")",1)):O("",!0)])]),default:l(()=>[B((m(),T(ne,{data:L.value,onSelectionChange:ee,onRowClick:te,height:"600",stripe:"",class:"cpq-table"},{default:l(()=>[e(w,{type:"selection",width:"55",align:"center"}),e(w,{label:"属性编码",align:"center",prop:"attributeCode"}),e(w,{label:"属性名称",align:"center",prop:"attributeName","show-overflow-tooltip":!0}),e(w,{label:"属性类型",align:"center",prop:"attributeType"},{default:l(a=>[e(re,{size:"small"},{default:l(()=>[n(f(a.row.attributeType==="text"?"文本":a.row.attributeType==="number"?"数字":a.row.attributeType==="date"?"日期":a.row.attributeType==="enum"?"枚举":"布尔"),1)]),_:2},1024)]),_:1}),e(w,{label:"组件类型",align:"center",prop:"componentType"}),e(w,{label:"操作",align:"center","class-name":"cpq-table-action",width:"150"},{default:l(a=>[e(c,{size:"small",type:"primary",icon:u.Edit,onClick:be=>ae(a.row)},{default:l(()=>t[18]||(t[18]=[n(" 修改 ")])),_:2,__:[18]},1032,["icon","onClick"]),e(c,{size:"small",type:"danger",icon:u.Delete,onClick:be=>P(a.row)},{default:l(()=>t[19]||(t[19]=[n(" 删除 ")])),_:2,__:[19]},1032,["icon","onClick"])]),_:1})]),_:1},8,["data"])),[[ce,I.value]]),v("div",Ae,[B(e(ie,{total:A.value,page:i.pageNum,limit:i.pageSize,onPagination:N},null,8,["total","page","limit"]),[[j,A.value>0]])])]),_:1})]),_:1}),e($,{span:14},{default:l(()=>[s.value?(m(),T(h,{key:0,shadow:"never",class:"cpq-sub-card"},{header:l(()=>t[20]||(t[20]=[v("div",{class:"cpq-card-title"},"属性详情",-1)])),default:l(()=>[e(de,{column:2,border:""},{default:l(()=>[e(y,{label:"属性编码"},{default:l(()=>[n(f(s.value.attributeCode),1)]),_:1}),e(y,{label:"属性名称"},{default:l(()=>[n(f(s.value.attributeName),1)]),_:1}),e(y,{label:"属性类型"},{default:l(()=>[n(f(s.value.attributeType==="text"?"文本":s.value.attributeType==="number"?"数字":s.value.attributeType==="date"?"日期":s.value.attributeType==="enum"?"枚举":"布尔"),1)]),_:1}),e(y,{label:"组件类型"},{default:l(()=>[n(f(s.value.componentType),1)]),_:1}),e(y,{label:"默认值"},{default:l(()=>[n(f(s.value.defaultValue),1)]),_:1}),e(y,{label:"创建时间"},{default:l(()=>[n(f(s.value.createTime),1)]),_:1}),e(y,{label:"属性组"},{default:l(()=>[n(f(s.value.attributeGroupName||"-"),1)]),_:1})]),_:1})]),_:1})):(m(),T(h,{key:1,shadow:"never",class:"cpq-sub-card"},{default:l(()=>t[21]||(t[21]=[v("div",{class:"cpq-empty-tip"},"请选择一个属性查看详情",-1)])),_:1,__:[21]}))]),_:1})]),_:1})])]),e(pe,{title:x.value,modelValue:g.value,"onUpdate:modelValue":t[11]||(t[11]=a=>g.value=a),width:"600px","append-to-body":"","close-on-click-modal":!1},{footer:l(()=>[v("div",Se,[e(c,{onClick:ue},{default:l(()=>t[22]||(t[22]=[n("取消")])),_:1,__:[22]}),e(c,{type:"primary",onClick:oe},{default:l(()=>t[23]||(t[23]=[n("确定")])),_:1,__:[23]})])]),default:l(()=>[e(Q,{ref:a=>C.value=a,model:o,rules:X,"label-width":"100px",class:"cpq-form"},{default:l(()=>[e(b,{label:"属性名称",prop:"attributeName"},{default:l(()=>[e(V,{modelValue:o.attributeName,"onUpdate:modelValue":t[4]||(t[4]=a=>o.attributeName=a),placeholder:"请输入属性名称"},null,8,["modelValue"])]),_:1}),e(b,{label:"属性类型",prop:"attributeType"},{default:l(()=>[e(q,{modelValue:o.attributeType,"onUpdate:modelValue":t[5]||(t[5]=a=>o.attributeType=a),placeholder:"请选择属性类型"},{default:l(()=>[e(r,{label:"文本",value:"text"}),e(r,{label:"数字",value:"number"}),e(r,{label:"日期",value:"date"}),e(r,{label:"枚举",value:"enum"}),e(r,{label:"布尔",value:"boolean"})]),_:1},8,["modelValue"])]),_:1}),e(b,{label:"组件类型",prop:"componentType"},{default:l(()=>[e(q,{modelValue:o.componentType,"onUpdate:modelValue":t[6]||(t[6]=a=>o.componentType=a),placeholder:"请选择组件类型"},{default:l(()=>[e(r,{label:"输入框",value:"input"}),e(r,{label:"下拉框",value:"select"}),e(r,{label:"单选框",value:"radio"}),e(r,{label:"复选框",value:"checkbox"}),e(r,{label:"滑块",value:"slider"}),e(r,{label:"开关",value:"switch"}),e(r,{label:"日期选择器",value:"date-picker"})]),_:1},8,["modelValue"])]),_:1}),e(b,{label:"默认值",prop:"defaultValue"},{default:l(()=>[e(V,{modelValue:o.defaultValue,"onUpdate:modelValue":t[7]||(t[7]=a=>o.defaultValue=a),placeholder:"请输入默认值"},null,8,["modelValue"])]),_:1}),e(b,{label:"图标URL",prop:"iconUrl"},{default:l(()=>[e(V,{modelValue:o.iconUrl,"onUpdate:modelValue":t[8]||(t[8]=a=>o.iconUrl=a),placeholder:"请输入图标URL"},null,8,["modelValue"])]),_:1}),e(b,{label:"提示信息",prop:"tooltip"},{default:l(()=>[e(V,{modelValue:o.tooltip,"onUpdate:modelValue":t[9]||(t[9]=a=>o.tooltip=a),type:"textarea",placeholder:"请输入提示信息",rows:2},null,8,["modelValue"])]),_:1}),e(b,{label:"属性组",prop:"attributeGroupId"},{default:l(()=>[e(q,{modelValue:o.attributeGroupId,"onUpdate:modelValue":t[10]||(t[10]=a=>o.attributeGroupId=a),placeholder:"请选择属性组",clearable:"",filterable:"","allow-create":"","default-first-option":"",style:{width:"100%"}},{default:l(()=>[(m(!0),G(J,null,W(E.value,a=>(m(),T(r,{key:a.attributeGroupId,label:a.attributeGroupName,value:a.attributeGroupId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])])}}},Le=me(xe,[["__scopeId","data-v-168ae6a9"]]);export{Le as default};
