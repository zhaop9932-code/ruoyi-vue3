import{r as p,u as ae,g as O,i as oe,a as i,j as te,c as ne,o as q,b as e,k as N,w as a,l as I,f as m,v as R,t as k,m as re,e as ie,E as y,n as me}from"./index-a6CENfl-.js";import{l as ue,d as se,u as de,a as pe}from"./bom-DGXmvyiB.js";const be={class:"app-container"},ge={class:"dialog-footer"},_e={__name:"index",setup(ce){const _=p(!0),v=p(!0),C=p(0),E=p([]),V=p([]),S=p(""),c=p(!1),M=p(null),D=p(null),F=ae(),o=O({bomId:null,bomCode:"",bomName:"",bomType:"template",bomRules:"",validationStrategy:"strict",configTemplate:"",ruleEngineType:"built-in"}),r=O({pageNum:1,pageSize:10,bomCode:"",bomName:"",bomType:""}),K=O({bomCode:[{required:!0,message:"BOM编码不能为空",trigger:"blur"}],bomName:[{required:!0,message:"BOM名称不能为空",trigger:"blur"}],bomType:[{required:!0,message:"BOM类型不能为空",trigger:"change"}],validationStrategy:[{required:!0,message:"验证策略不能为空",trigger:"change"}],ruleEngineType:[{required:!0,message:"规则引擎类型不能为空",trigger:"change"}]}),f=async()=>{_.value=!0;try{const n=await ue(r);E.value=n.rows,C.value=n.total,_.value=!1}catch{_.value=!1,y.error("获取超级BOM列表失败")}},T=()=>{r.pageNum=1,f()},P=()=>{r.bomCode="",r.bomName="",r.bomType="",T()},$=()=>{v.value=!v.value},L=n=>{V.value=n},Q=()=>{o.bomId=null,o.bomCode="",o.bomName="",o.bomType="template",o.bomRules="",o.validationStrategy="strict",o.configTemplate="",o.ruleEngineType="built-in",S.value="新增超级BOM",c.value=!0},j=n=>{o.bomId=n.bomId,o.bomCode=n.bomCode,o.bomName=n.bomName,o.bomType=n.bomType,o.bomRules=n.bomRules,o.validationStrategy=n.validationStrategy,o.configTemplate=n.configTemplate,o.ruleEngineType=n.ruleEngineType,S.value="修改超级BOM",c.value=!0},z=async n=>{const l=n.bomId?[n.bomId]:V.value.map(b=>b.bomId);await me.confirm("确定要删除选中的超级BOM吗？","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});try{await se(l),y.success("删除成功"),f()}catch{y.error("删除失败")}},A=n=>{F.push({path:"/cpq/bom/manage",query:{bomId:n.bomId,bomName:n.bomName}})},J=async()=>{await M.value.validate();try{o.bomRules=JSON.stringify({validationStrategy:o.validationStrategy,ruleEngineType:o.ruleEngineType}),o.bomId?(await de(o),y.success("修改成功")):(await pe(o),y.success("新增成功")),c.value=!1,f()}catch{y.error("操作失败")}},G=()=>{var n;(n=M.value)==null||n.resetFields()},H=()=>{c.value=!1,G()};return oe(()=>{f()}),(n,l)=>{const b=i("el-input"),d=i("el-form-item"),u=i("el-option"),w=i("el-select"),s=i("el-button"),x=i("el-form"),W=i("el-card"),B=i("el-col"),X=i("el-row"),g=i("el-table-column"),h=i("el-tag"),Y=i("el-table"),Z=i("pagination"),ee=i("el-dialog"),le=te("loading");return q(),ne("div",be,[e(W,{shadow:"never",class:"search-card"},{default:a(()=>[N(e(x,{model:r,ref_key:"queryForm",ref:D,inline:!0,"label-width":"80px"},{default:a(()=>[e(d,{label:"BOM编码",prop:"bomCode"},{default:a(()=>[e(b,{modelValue:r.bomCode,"onUpdate:modelValue":l[0]||(l[0]=t=>r.bomCode=t),placeholder:"请输入BOM编码",clearable:"",size:"small",onKeyup:I(T,["enter"])},null,8,["modelValue"])]),_:1}),e(d,{label:"BOM名称",prop:"bomName"},{default:a(()=>[e(b,{modelValue:r.bomName,"onUpdate:modelValue":l[1]||(l[1]=t=>r.bomName=t),placeholder:"请输入BOM名称",clearable:"",size:"small",onKeyup:I(T,["enter"])},null,8,["modelValue"])]),_:1}),e(d,{label:"BOM类型",prop:"bomType"},{default:a(()=>[e(w,{modelValue:r.bomType,"onUpdate:modelValue":l[2]||(l[2]=t=>r.bomType=t),placeholder:"请选择BOM类型",clearable:"",size:"small"},{default:a(()=>[e(u,{label:"模板",value:"template"}),e(u,{label:"实例",value:"instance"}),e(u,{label:"版本",value:"version"})]),_:1},8,["modelValue"])]),_:1}),e(d,null,{default:a(()=>[e(s,{type:"primary",icon:"Search",size:"small",onClick:T},{default:a(()=>l[10]||(l[10]=[m("搜索")])),_:1,__:[10]}),e(s,{icon:"RefreshRight",size:"small",onClick:P},{default:a(()=>l[11]||(l[11]=[m("重置")])),_:1,__:[11]})]),_:1})]),_:1},8,["model"]),[[R,v.value]])]),_:1}),e(X,{gutter:10,class:"mb8"},{default:a(()=>[e(B,{span:1.5},{default:a(()=>[e(s,{type:"primary",icon:"Plus",size:"small",onClick:Q},{default:a(()=>l[12]||(l[12]=[m(" 新增 ")])),_:1,__:[12]})]),_:1}),e(B,{span:1.5},{default:a(()=>[e(s,{type:"danger",icon:"Delete",size:"small",disabled:V.value.length===0,onClick:z},{default:a(()=>l[13]||(l[13]=[m(" 批量删除 ")])),_:1,__:[13]},8,["disabled"])]),_:1}),e(B,{span:1.5},{default:a(()=>[e(s,{type:"warning",icon:"Download",size:"small",onClick:n.handleExport},{default:a(()=>l[14]||(l[14]=[m(" 导出 ")])),_:1,__:[14]},8,["onClick"])]),_:1}),e(B,{span:20.5},{default:a(()=>[e(s,{type:"info",icon:"Search",size:"small",onClick:$,style:{float:"right"}},{default:a(()=>[m(k(v.value?"收起":"展开")+"搜索 ",1)]),_:1})]),_:1})]),_:1}),N((q(),re(Y,{data:E.value,onSelectionChange:L},{default:a(()=>[e(g,{type:"selection",width:"55",align:"center"}),e(g,{label:"BOM编码",align:"center",prop:"bomCode"}),e(g,{label:"BOM名称",align:"center",prop:"bomName","show-overflow-tooltip":!0}),e(g,{label:"BOM类型",align:"center",prop:"bomType"},{default:a(t=>[e(h,{type:t.row.bomType==="template"?"primary":t.row.bomType==="instance"?"success":"warning",size:"small"},{default:a(()=>[m(k(t.row.bomType==="template"?"模板":t.row.bomType==="instance"?"实例":"版本"),1)]),_:2},1032,["type"])]),_:1}),e(g,{label:"验证策略",align:"center",prop:"validationStrategy"},{default:a(t=>[e(h,{type:t.row.validationStrategy==="strict"?"danger":t.row.validationStrategy==="warning"?"warning":"success",size:"small"},{default:a(()=>[m(k(t.row.validationStrategy==="strict"?"严格验证":t.row.validationStrategy==="warning"?"警告验证":"无验证"),1)]),_:2},1032,["type"])]),_:1}),e(g,{label:"规则引擎",align:"center",prop:"ruleEngineType"}),e(g,{label:"创建时间",align:"center",prop:"createTime",width:"180"}),e(g,{label:"操作",align:"center","class-name":"small-padding fixed-width",width:"200"},{default:a(t=>[e(s,{size:"small",type:"primary",icon:"Edit",onClick:U=>j(t.row)},{default:a(()=>l[15]||(l[15]=[m(" 修改 ")])),_:2,__:[15]},1032,["onClick"]),e(s,{size:"small",type:"danger",icon:"Delete",onClick:U=>z(t.row)},{default:a(()=>l[16]||(l[16]=[m(" 删除 ")])),_:2,__:[16]},1032,["onClick"]),e(s,{size:"small",type:"info",icon:"SetUp",onClick:U=>A(t.row)},{default:a(()=>l[17]||(l[17]=[m(" BOM管理 ")])),_:2,__:[17]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[le,_.value]]),N(e(Z,{total:C.value,page:r.pageNum,limit:r.pageSize,onPagination:f},null,8,["total","page","limit"]),[[R,C.value>0]]),e(ee,{title:S.value,modelValue:c.value,"onUpdate:modelValue":l[9]||(l[9]=t=>c.value=t),width:"600px","append-to-body":""},{footer:a(()=>[ie("span",ge,[e(s,{onClick:H},{default:a(()=>l[18]||(l[18]=[m("取消")])),_:1,__:[18]}),e(s,{type:"primary",onClick:J},{default:a(()=>l[19]||(l[19]=[m("确定")])),_:1,__:[19]})])]),default:a(()=>[e(x,{ref_key:"formRef",ref:M,model:o,rules:K,"label-width":"120px"},{default:a(()=>[e(d,{label:"BOM编码",prop:"bomCode"},{default:a(()=>[e(b,{modelValue:o.bomCode,"onUpdate:modelValue":l[3]||(l[3]=t=>o.bomCode=t),placeholder:"请输入BOM编码"},null,8,["modelValue"])]),_:1}),e(d,{label:"BOM名称",prop:"bomName"},{default:a(()=>[e(b,{modelValue:o.bomName,"onUpdate:modelValue":l[4]||(l[4]=t=>o.bomName=t),placeholder:"请输入BOM名称"},null,8,["modelValue"])]),_:1}),e(d,{label:"BOM类型",prop:"bomType"},{default:a(()=>[e(w,{modelValue:o.bomType,"onUpdate:modelValue":l[5]||(l[5]=t=>o.bomType=t),placeholder:"请选择BOM类型"},{default:a(()=>[e(u,{label:"模板",value:"template"}),e(u,{label:"实例",value:"instance"}),e(u,{label:"版本",value:"version"})]),_:1},8,["modelValue"])]),_:1}),e(d,{label:"验证策略",prop:"validationStrategy"},{default:a(()=>[e(w,{modelValue:o.validationStrategy,"onUpdate:modelValue":l[6]||(l[6]=t=>o.validationStrategy=t),placeholder:"请选择验证策略"},{default:a(()=>[e(u,{label:"严格验证",value:"strict"}),e(u,{label:"警告验证",value:"warning"}),e(u,{label:"无验证",value:"none"})]),_:1},8,["modelValue"])]),_:1}),e(d,{label:"规则引擎类型",prop:"ruleEngineType"},{default:a(()=>[e(w,{modelValue:o.ruleEngineType,"onUpdate:modelValue":l[7]||(l[7]=t=>o.ruleEngineType=t),placeholder:"请选择规则引擎类型"},{default:a(()=>[e(u,{label:"内置规则引擎",value:"built-in"}),e(u,{label:"Drools规则引擎",value:"drools"}),e(u,{label:"自定义规则引擎",value:"custom"})]),_:1},8,["modelValue"])]),_:1}),e(d,{label:"配置模板",prop:"configTemplate"},{default:a(()=>[e(b,{modelValue:o.configTemplate,"onUpdate:modelValue":l[8]||(l[8]=t=>o.configTemplate=t),type:"textarea",placeholder:"请输入配置模板",rows:3},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])])}}};export{_e as default};
