import{_ as Be,a as Ee,f as H,r as p,C as V,b as J,o as Re,h as i,G as $e,d as Me,e as W,j as g,H as E,i as l,k as t,q as u,I as X,p as Le,l as Pe,t as Y,n as je,at as Ae,V as c,E as Oe}from"./index-CwdKQqOf.js";import{l as Z,g as ee,d as Ge,u as Ke,a as Qe}from"./catalog-CV4btQTA.js";const He={class:"app-container"},Je={class:"page-header"},We={class:"header-actions"},Xe={class:"pagination-container",style:{"margin-top":"10px"}},Ye={class:"dialog-footer"},Ze={class:"el-upload__tip text-center"},el={class:"el-upload__tip"},ll={class:"dialog-footer"},tl={__name:"catalog",setup(al){const le=Ee(),{proxy:te}=H(),w=p(null),R=p(null),$=p([]),z=p([]),N=p([]),_=p(!1),S=p(!0),k=p(!0),x=p(""),ae=p(!0),oe=p(!0),U=p([]),d=V({open:!1,title:"导入产品目录",url:"/prod-api/cpq/catalog/import",headers:{Authorization:"Bearer "+localStorage.getItem("token")},isUploading:!1,isUpdateSupport:0,updateSupport:0,fileList:[],successMsg:""}),I=p(),ne=()=>{te.download("cpq/catalog/importTemplate",{},`catalog_import_template_${new Date().getTime()}.xlsx`)};J();const M=p(0),h=p(1),C=p(100),m=V({parentId:void 0,catalogName:void 0,status:void 0,pageNum:1,pageSize:100}),n=V({catalogId:void 0,parentId:0,catalogName:void 0,catalogDesc:void 0,catalogSort:0,status:"1"}),se=V({catalogName:[{required:!0,message:"目录名称不能为空",trigger:"blur"}],catalogSort:[{required:!0,message:"显示排序不能为空",trigger:"blur"}]});function v(){S.value=!0,$.value=[],z.value=[];const a={...m,pageNum:h.value,pageSize:C.value};Z(a).then(e=>{$.value=e.rows,z.value=L(e.rows),M.value=e.total,S.value=!1}).catch(e=>{S.value=!1,c.error("获取目录列表失败")})}function L(a){const e=[],s={};a.forEach(r=>{s[r.catalogId]={...r,children:[]}}),a.forEach(r=>{const f=r.parentId||0;f===0?e.push(s[r.catalogId]):s[f]&&s[f].children.push(s[r.catalogId])});function b(r){r.children&&r.children.length>0&&(r.children.sort((f,q)=>(f.catalogSort||0)-(q.catalogSort||0)),r.children.forEach(f=>b(f)))}return e.forEach(r=>b(r)),e}function D(){Z({parentId:void 0,pageNum:1,pageSize:1e4}).then(a=>{N.value=[],N.value=L(a.rows)}).catch(a=>{c.error("获取目录列表失败")})}function F(){v()}function re(){R.value&&R.value.resetFields(),m.parentId=void 0,m.catalogName=void 0,m.status=void 0,h.value=1,C.value=100,F()}function ie(a){C.value=a,h.value=1,v()}function ue(a){h.value=a,v()}function P(){k.value=!k.value}function de(a){U.value=a.map(e=>e.catalogId),ae.value=a.length!==1,oe.value=!a.length}function j(a){T(),D(),a&&a.catalogId?(n.parentId=a.catalogId,x.value="添加子目录"):(n.parentId=0,x.value="添加目录"),_.value=!0}function pe(a){if(T(),D(),a)ee(a.catalogId).then(e=>{Object.assign(n,e.data),x.value="修改目录",_.value=!0}).catch(e=>{c.error("获取目录详情失败")});else{const e=U.value[0];ee(e).then(s=>{Object.assign(n,s.data),x.value="修改目录",_.value=!0}).catch(s=>{c.error("获取目录详情失败")})}}function ce(){w.value&&w.value.validate().then(async()=>{try{const a=J(),e=new Date().toISOString().slice(0,19).replace("T"," ");n.catalogId?(n.updateBy=a.name,n.updateTime=e,await Ke(n),c.success("修改成功")):(n.createBy=a.name,n.createTime=e,n.updateBy=a.name,n.updateTime=e,await Qe(n),c.success("新增成功")),_.value=!1,v()}catch{c.error("操作失败")}}).catch(()=>{c.error("表单验证失败，请检查填写内容")})}function ge(a){le.push({path:"/cpq/attributeGroupAttribute",query:{catalogId:a.catalogId,catalogName:a.catalogName,testMode:!0}})}function me(a){const e=a.catalogId||U.value;Oe.confirm("是否确认删除所选目录？","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await Ge(e),c.success("删除成功"),v()}catch{c.error("删除失败")}}).catch(()=>{})}function fe(){_.value=!1,T()}function T(){n.catalogId=void 0,n.parentId=0,n.catalogName=void 0,n.catalogDesc=void 0,n.catalogSort=0,n.status="1",w.value&&w.value.resetFields()}const _e=()=>{const{proxy:a}=H();a.download("cpq/catalog/export",{...m},`catalog_${new Date().getTime()}.xlsx`)},ve=()=>{d.title="导入产品目录",d.open=!0},ye=()=>{I.value&&I.value.uploadFiles.length>0?I.value.submit():c.warning("请选择要上传的文件")},he=(a,e,s)=>{d.isUploading=!0},be=(a,e,s)=>{d.isUploading=!1,a.code===200?(d.successMsg=a.msg,c.success(a.msg),d.open=!1,v()):c.error(a.msg)},we=(a,e)=>{d.updateSupport=e.length>0},xe=(a,e)=>{d.updateSupport=e.length>0};return Re(()=>{v(),D()}),(a,e)=>{const s=i("el-button"),b=i("el-input"),r=i("el-form-item"),f=i("el-option"),q=i("el-select"),A=i("el-form"),O=i("el-card"),y=i("el-table-column"),Ce=i("el-tag"),Se=i("el-table"),ke=i("el-pagination"),Ie=i("el-tree-select"),Ve=i("el-input-number"),G=i("el-col"),K=i("el-radio"),ze=i("el-radio-group"),Ne=i("el-row"),Q=i("el-dialog"),Ue=i("el-icon"),De=i("el-checkbox"),Fe=i("el-link"),Te=i("el-upload"),qe=$e("loading");return W(),Me("div",He,[g("div",Je,[e[17]||(e[17]=g("h3",null,"产品目录管理",-1)),g("div",We,[l(s,{type:"primary",icon:"Plus",size:"small",onClick:e[0]||(e[0]=o=>j()),style:{"margin-right":"8px"}},{default:t(()=>e[14]||(e[14]=[u(" 新增目录 ")])),_:1,__:[14]}),l(s,{type:"warning",icon:"Download",size:"small",onClick:_e,style:{"margin-right":"8px"}},{default:t(()=>e[15]||(e[15]=[u(" 导出 ")])),_:1,__:[15]}),l(s,{type:"success",icon:"Upload",size:"small",onClick:ve},{default:t(()=>e[16]||(e[16]=[u(" 导入 ")])),_:1,__:[16]})])]),E(l(O,{shadow:"never",class:"search-card"},{default:t(()=>[l(A,{model:m,ref:"queryForm",inline:!0,"label-width":"80px"},{default:t(()=>[l(r,{label:"目录名称",prop:"catalogName"},{default:t(()=>[l(b,{modelValue:m.catalogName,"onUpdate:modelValue":e[1]||(e[1]=o=>m.catalogName=o),placeholder:"请输入目录名称",clearable:"",size:"small",onKeyup:Le(F,["enter"])},null,8,["modelValue"])]),_:1}),l(r,{label:"目录状态",prop:"status"},{default:t(()=>[l(q,{modelValue:m.status,"onUpdate:modelValue":e[2]||(e[2]=o=>m.status=o),placeholder:"请选择目录状态",clearable:"",size:"small"},{default:t(()=>[l(f,{label:"启用",value:"1"}),l(f,{label:"禁用",value:"0"})]),_:1},8,["modelValue"])]),_:1}),l(r,null,{default:t(()=>[l(s,{type:"primary",icon:"Search",size:"small",onClick:F},{default:t(()=>e[18]||(e[18]=[u("搜索")])),_:1,__:[18]}),l(s,{icon:"RefreshRight",size:"small",onClick:re},{default:t(()=>e[19]||(e[19]=[u("重置")])),_:1,__:[19]}),l(s,{type:"info",icon:"Search",size:"small",onClick:P},{default:t(()=>e[20]||(e[20]=[u(" 收起搜索 ")])),_:1,__:[20]})]),_:1})]),_:1},8,["model"])]),_:1},512),[[X,k.value]]),E(l(s,{type:"info",icon:"Search",size:"small",onClick:P,style:{"margin-bottom":"10px"}},{default:t(()=>e[21]||(e[21]=[u(" 展开搜索 ")])),_:1,__:[21]},512),[[X,!k.value]]),l(O,{shadow:"never",class:"table-card"},{default:t(()=>[E((W(),Pe(Se,{data:z.value,"row-key":"catalogId",onSelectionChange:de,"tree-props":{children:"children",hasChildren:"hasChildren"},fit:"",style:{width:"100%"}},{default:t(()=>[l(y,{type:"selection",width:"55",align:"center"}),l(y,{label:"目录名称",align:"left",prop:"catalogName","show-overflow-tooltip":!0,"min-width":"200","flex-grow":"1"},{default:t(o=>[g("span",null,Y(o.row.catalogName),1)]),_:1}),l(y,{label:"目录描述",align:"left",prop:"catalogDesc","show-overflow-tooltip":!0,"min-width":"150","flex-grow":"1"}),l(y,{label:"排序",align:"center",prop:"catalogSort",width:"80"}),l(y,{label:"目录状态",align:"center",prop:"status",width:"100"},{default:t(o=>[l(Ce,{type:o.row.status==="1"?"success":"danger",size:"small"},{default:t(()=>[u(Y(o.row.status==="1"?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),l(y,{label:"创建时间",align:"center",prop:"createTime",width:"180"}),l(y,{label:"操作",align:"center","class-name":"small-padding fixed-width",width:"280"},{default:t(o=>[l(s,{size:"small",type:"primary",link:"",icon:"Edit",onClick:B=>pe(o.row),style:{"margin-right":"5px"}},{default:t(()=>e[22]||(e[22]=[u(" 修改 ")])),_:2,__:[22]},1032,["onClick"]),l(s,{size:"small",type:"success",link:"",icon:"Plus",onClick:B=>j(o.row),style:{"margin-right":"5px"}},{default:t(()=>e[23]||(e[23]=[u(" 新增子目录 ")])),_:2,__:[23]},1032,["onClick"]),l(s,{size:"small",type:"info",link:"",icon:"SetUp",onClick:B=>ge(o.row),style:{"margin-right":"5px"}},{default:t(()=>e[24]||(e[24]=[u(" 属性管理 ")])),_:2,__:[24]},1032,["onClick"]),l(s,{size:"small",type:"danger",link:"",icon:"Delete",onClick:B=>me(o.row)},{default:t(()=>e[25]||(e[25]=[u(" 删除 ")])),_:2,__:[25]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[qe,S.value]]),g("div",Xe,[l(ke,{"current-page":h.value,"onUpdate:currentPage":e[3]||(e[3]=o=>h.value=o),"page-size":C.value,"onUpdate:pageSize":e[4]||(e[4]=o=>C.value=o),"page-sizes":[100,200,500,1e3],layout:"total, sizes, prev, pager, next, jumper",total:M.value,onSizeChange:ie,onCurrentChange:ue},null,8,["current-page","page-size","total"])])]),_:1}),l(Q,{title:x.value,modelValue:_.value,"onUpdate:modelValue":e[10]||(e[10]=o=>_.value=o),width:"600px","append-to-body":""},{footer:t(()=>[g("span",Ye,[l(s,{onClick:fe},{default:t(()=>e[28]||(e[28]=[u("取消")])),_:1,__:[28]}),l(s,{type:"primary",onClick:ce},{default:t(()=>e[29]||(e[29]=[u("确定")])),_:1,__:[29]})])]),default:t(()=>[l(A,{ref_key:"catalogFormRef",ref:w,model:n,rules:se,"label-width":"100px"},{default:t(()=>[l(r,{label:"上级目录",prop:"parentId"},{default:t(()=>[l(Ie,{modelValue:n.parentId,"onUpdate:modelValue":e[5]||(e[5]=o=>n.parentId=o),data:N.value,props:{value:"catalogId",label:"catalogName",children:"children"},placeholder:"选择上级目录",clearable:"",style:{width:"100%"},"check-strictly":!1,"default-expand-all":!1,"node-key":"catalogId","check-on-click-node":""},null,8,["modelValue","data"])]),_:1}),l(r,{label:"目录名称",prop:"catalogName"},{default:t(()=>[l(b,{modelValue:n.catalogName,"onUpdate:modelValue":e[6]||(e[6]=o=>n.catalogName=o),placeholder:"请输入目录名称"},null,8,["modelValue"])]),_:1}),l(r,{label:"目录描述",prop:"catalogDesc"},{default:t(()=>[l(b,{modelValue:n.catalogDesc,"onUpdate:modelValue":e[7]||(e[7]=o=>n.catalogDesc=o),type:"textarea",placeholder:"请输入目录描述",rows:3},null,8,["modelValue"])]),_:1}),l(Ne,{gutter:20},{default:t(()=>[l(G,{span:12},{default:t(()=>[l(r,{label:"显示排序",prop:"catalogSort"},{default:t(()=>[l(Ve,{modelValue:n.catalogSort,"onUpdate:modelValue":e[8]||(e[8]=o=>n.catalogSort=o),"controls-position":"right",min:0},null,8,["modelValue"])]),_:1})]),_:1}),l(G,{span:12},{default:t(()=>[l(r,{label:"目录状态",prop:"status"},{default:t(()=>[l(ze,{modelValue:n.status,"onUpdate:modelValue":e[9]||(e[9]=o=>n.status=o)},{default:t(()=>[l(K,{label:"1"},{default:t(()=>e[26]||(e[26]=[u("启用")])),_:1,__:[26]}),l(K,{label:"0"},{default:t(()=>e[27]||(e[27]=[u("禁用")])),_:1,__:[27]})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"]),l(Q,{title:d.title,modelValue:d.open,"onUpdate:modelValue":e[13]||(e[13]=o=>d.open=o),width:"400px","append-to-body":""},{footer:t(()=>[g("div",ll,[l(s,{type:"primary",loading:d.isUploading,onClick:ye},{default:t(()=>e[34]||(e[34]=[u("确 定")])),_:1,__:[34]},8,["loading"]),l(s,{onClick:e[12]||(e[12]=o=>d.open=!1)},{default:t(()=>e[35]||(e[35]=[u("取 消")])),_:1,__:[35]})])]),default:t(()=>[l(Te,{ref_key:"uploadRef",ref:I,limit:1,accept:".xlsx, .xls",headers:d.headers,action:d.url+"?updateSupport="+d.updateSupport,disabled:d.isUploading,"on-progress":he,"on-success":be,"on-change":we,"on-remove":xe,"auto-upload":!1,drag:""},{tip:t(()=>[g("div",Ze,[g("div",el,[l(De,{modelValue:d.updateSupport,"onUpdate:modelValue":e[11]||(e[11]=o=>d.updateSupport=o)},null,8,["modelValue"]),e[30]||(e[30]=u("是否更新已经存在的目录数据 "))]),e[32]||(e[32]=g("span",null,"仅允许导入xls、xlsx格式文件。",-1)),l(Fe,{type:"primary",underline:!1,style:{"font-size":"12px","vertical-align":"baseline"},onClick:ne},{default:t(()=>e[31]||(e[31]=[u("下载模板")])),_:1,__:[31]})])]),default:t(()=>[l(Ue,{class:"el-icon--upload"},{default:t(()=>[l(je(Ae))]),_:1}),e[33]||(e[33]=g("div",{class:"el-upload__text"},[u("将文件拖到此处，或"),g("em",null,"点击上传")],-1))]),_:1,__:[33]},8,["headers","action","disabled"])]),_:1},8,["title","modelValue"])])}}},sl=Be(tl,[["__scopeId","data-v-fad449c1"]]);export{sl as default};
