import{f as j,r as c,C as h,o as Ne,h as i,G as Se,d as B,e as v,j as m,H as I,i as l,k as t,q as s,t as E,I as R,p as $,l as q,m as G,n as Le,at as Be,V as u,E as A}from"./index-CwdKQqOf.js";import{l as Ie,d as K,u as qe,a as ze}from"./brand-DsHCj4TR.js";const De={class:"cpq-container"},Fe={class:"cpq-action-bar"},Te={class:"cpq-actions"},Me={class:"cpq-search-card"},Oe={class:"cpq-table",style:{width:"100%"}},Pe={key:1},je={key:0,class:"el-form-item__help",style:{color:"#909399"}},Ee={class:"dialog-footer"},Re={class:"el-upload__tip text-center"},$e={class:"el-upload__tip"},Ge={class:"dialog-footer"},Qe={__name:"index",setup(Ae){const{proxy:J}=j(),y=c(!0),w=c(!0),N=c(0),z=c([]),x=c([]),S=c(""),b=c(!1),d=h({open:!1,title:"导入品牌",url:"/prod-api/cpq/brand/import",headers:{Authorization:"Bearer "+localStorage.getItem("token")},isUploading:!1,isUpdateSupport:0,updateSupport:0,fileList:[],successMsg:""}),C=c(),Q=()=>{J.download("cpq/brand/importTemplate",{},`brand_import_template_${new Date().getTime()}.xlsx`)},H=c("/prod-api/common/upload"),V=c([]),n=h({brandId:null,brandCode:"",brandName:"",brandLogo:"",status:"0",sortOrder:0}),p=h({pageNum:1,pageSize:10,brandCode:"",brandName:"",status:""}),W=h({brandName:[{required:!0,message:"品牌名称不能为空",trigger:"blur"},{min:2,max:128,message:"品牌名称长度在 2 到 128 个字符",trigger:"blur"}],status:[{required:!0,message:"品牌状态不能为空",trigger:"change"}]}),_=async()=>{y.value=!0;try{const a=await Ie(p);z.value=a.rows,N.value=a.total,y.value=!1}catch{y.value=!1,u.error("获取品牌列表失败")}},k=()=>{p.pageNum=1,_()},X=()=>{p.brandCode="",p.brandName="",p.status="",k()},Y=()=>{w.value=!w.value},Z=a=>{x.value=a},ee=()=>{n.brandId=null,n.brandCode="",n.brandName="",n.brandLogo="",n.status="0",n.sortOrder=0,V.value=[],S.value="新增品牌",b.value=!0},le=a=>{n.brandId=a.brandId,n.brandCode=a.brandCode,n.brandName=a.brandName,n.brandLogo=a.brandLogo||"",n.status=a.status,n.sortOrder=a.sortOrder,V.value=[],S.value="修改品牌",b.value=!0},te=async a=>{await A.confirm("确定要删除该品牌吗？","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});try{await K(a.brandId),u.success("删除成功"),_()}catch{u.error("删除失败")}},ae=async()=>{if(x.value.length===0){u.warning("请选择要删除的品牌");return}await A.confirm("确定要删除选中的品牌吗？","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});try{const a=x.value.map(e=>e.brandId).join(",");await K(a),u.success("删除成功"),_()}catch{u.error("删除失败")}},oe=()=>{const{proxy:a}=j();a.download("cpq/brand/export",{...p},`brand_${new Date().getTime()}.xlsx`)},ne=()=>{d.title="导入品牌",d.open=!0},re=()=>{C.value&&C.value.uploadFiles.length>0?C.value.submit():u.warning("请选择要上传的文件")},se=(a,e,r)=>{d.isUploading=!0},de=(a,e,r)=>{d.isUploading=!1,a.code===200?(d.successMsg=a.msg,u.success(a.msg),d.open=!1,_()):u.error(a.msg)},ie=(a,e)=>{d.updateSupport=e.length>0},ue=(a,e)=>{d.updateSupport=e.length>0},pe=(a,e,r)=>{a.code===200?(n.brandLogo=a.data.url,r.value=r,u.success("上传成功")):u.error("上传失败："+a.msg)},me=(a,e,r)=>{u.error("上传失败，请重试")},ce=a=>{const e=a.type==="image/jpeg"||a.type==="image/png",r=a.size/1024/1024<2;return e?r?!0:(u.error("上传图片大小不能超过 2MB!"),!1):(u.error("上传图片只能是 JPG/PNG 格式!"),!1)},fe=async()=>{const a=L.value.form;a&&await a.validate().then(async()=>{try{n.brandId?(await qe(n),u.success("修改成功")):(await ze(n),u.success("新增成功")),b.value=!1,_()}catch{u.error("操作失败")}}).catch(()=>{u.error("表单验证失败，请检查填写内容")})},ge=()=>{b.value=!1;const a=L.value.form;a&&a.resetFields(),V.value=[]},L=c({form:null});return Ne(()=>{_()}),(a,e)=>{const r=i("el-button"),U=i("el-input"),f=i("el-form-item"),D=i("el-option"),_e=i("el-select"),F=i("el-form"),g=i("el-table-column"),T=i("el-image"),be=i("el-tag"),ve=i("el-table"),ye=i("pagination"),M=i("el-upload"),O=i("el-radio"),we=i("el-radio-group"),xe=i("el-input-number"),P=i("el-dialog"),Ce=i("el-icon"),Ve=i("el-checkbox"),ke=i("el-link"),Ue=Se("loading");return v(),B("div",De,[e[33]||(e[33]=m("div",{class:"cpq-page-title"}," 品牌管理 ",-1)),m("div",Fe,[m("div",Te,[l(r,{type:"primary",icon:"Plus",onClick:ee},{default:t(()=>e[13]||(e[13]=[s(" 新增品牌 ")])),_:1,__:[13]}),l(r,{type:"danger",icon:"Delete",disabled:x.value.length===0,onClick:ae},{default:t(()=>e[14]||(e[14]=[s(" 批量删除 ")])),_:1,__:[14]},8,["disabled"]),l(r,{type:"warning",icon:"Download",onClick:oe},{default:t(()=>e[15]||(e[15]=[s(" 导出 ")])),_:1,__:[15]}),l(r,{type:"success",icon:"Upload",onClick:ne},{default:t(()=>e[16]||(e[16]=[s(" 导入 ")])),_:1,__:[16]})]),l(r,{type:"info",icon:"Search",onClick:Y},{default:t(()=>[s(E(w.value?"收起":"展开")+"搜索 ",1)]),_:1})]),I(m("div",Me,[l(F,{model:p,ref:"queryForm",inline:!0,"label-width":"80px"},{default:t(()=>[l(f,{label:"品牌编码",prop:"brandCode"},{default:t(()=>[l(U,{modelValue:p.brandCode,"onUpdate:modelValue":e[0]||(e[0]=o=>p.brandCode=o),placeholder:"请输入品牌编码",clearable:"",size:"small",onKeyup:$(k,["enter"])},null,8,["modelValue"])]),_:1}),l(f,{label:"品牌名称",prop:"brandName"},{default:t(()=>[l(U,{modelValue:p.brandName,"onUpdate:modelValue":e[1]||(e[1]=o=>p.brandName=o),placeholder:"请输入品牌名称",clearable:"",size:"small",onKeyup:$(k,["enter"])},null,8,["modelValue"])]),_:1}),l(f,{label:"品牌状态",prop:"status"},{default:t(()=>[l(_e,{modelValue:p.status,"onUpdate:modelValue":e[2]||(e[2]=o=>p.status=o),placeholder:"请选择品牌状态",clearable:"",size:"small"},{default:t(()=>[l(D,{label:"启用",value:"0"}),l(D,{label:"禁用",value:"1"})]),_:1},8,["modelValue"])]),_:1}),l(f,null,{default:t(()=>[l(r,{type:"primary",icon:"Search",size:"small",onClick:k},{default:t(()=>e[17]||(e[17]=[s("搜索")])),_:1,__:[17]}),l(r,{icon:"RefreshRight",size:"small",onClick:X},{default:t(()=>e[18]||(e[18]=[s("重置")])),_:1,__:[18]})]),_:1})]),_:1},8,["model"])],512),[[R,w.value]]),m("div",Oe,[I((v(),q(ve,{data:z.value,onSelectionChange:Z,border:"",style:{width:"100%"}},{default:t(()=>[l(g,{type:"selection",width:"55",align:"center"}),l(g,{label:"品牌编码",align:"center",prop:"brandCode","min-width":"120"}),l(g,{label:"品牌名称",align:"center",prop:"brandName","min-width":"150","show-overflow-tooltip":!0}),l(g,{label:"品牌Logo",align:"center",width:"120"},{default:t(o=>[o.row.brandLogo?(v(),q(T,{key:0,src:o.row.brandLogo,fit:"cover",style:{width:"60px",height:"60px"}},null,8,["src"])):(v(),B("span",Pe,"-"))]),_:1}),l(g,{label:"品牌状态",align:"center",prop:"status",width:"100"},{default:t(o=>[l(be,{type:o.row.status==="0"?"success":"danger",size:"small"},{default:t(()=>[s(E(o.row.status==="0"?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),l(g,{label:"排序",align:"center",prop:"sortOrder",width:"80"}),l(g,{label:"创建时间",align:"center",prop:"createTime","min-width":"180"}),l(g,{label:"操作",align:"center","class-name":"small-padding fixed-width","min-width":"180"},{default:t(o=>[l(r,{size:"small",type:"primary",icon:"Edit",onClick:he=>le(o.row)},{default:t(()=>e[19]||(e[19]=[s(" 修改 ")])),_:2,__:[19]},1032,["onClick"]),l(r,{size:"small",type:"danger",icon:"Delete",onClick:he=>te(o.row)},{default:t(()=>e[20]||(e[20]=[s(" 删除 ")])),_:2,__:[20]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[Ue,y.value]]),I(l(ye,{total:N.value,page:p.pageNum,"onUpdate:page":e[3]||(e[3]=o=>p.pageNum=o),limit:p.pageSize,"onUpdate:limit":e[4]||(e[4]=o=>p.pageSize=o),onPagination:_},null,8,["total","page","limit"]),[[R,N.value>0]])]),l(P,{title:S.value,modelValue:b.value,"onUpdate:modelValue":e[9]||(e[9]=o=>b.value=o),width:"600px","append-to-body":""},{footer:t(()=>[m("span",Ee,[l(r,{onClick:ge},{default:t(()=>e[25]||(e[25]=[s("取消")])),_:1,__:[25]}),l(r,{type:"primary",onClick:fe},{default:t(()=>e[26]||(e[26]=[s("确定")])),_:1,__:[26]})])]),default:t(()=>[l(F,{ref:o=>L.value.form=o,model:n,rules:W,"label-width":"100px"},{default:t(()=>[l(f,{label:"品牌编码",prop:"brandCode"},{default:t(()=>[l(U,{modelValue:n.brandCode,"onUpdate:modelValue":e[5]||(e[5]=o=>n.brandCode=o),placeholder:"由系统自动生成",readonly:!n.brandId,disabled:!n.brandId},null,8,["modelValue","readonly","disabled"]),n.brandId?G("",!0):(v(),B("div",je," 品牌编码由系统自动生成，无需手动输入 "))]),_:1}),l(f,{label:"品牌名称",prop:"brandName"},{default:t(()=>[l(U,{modelValue:n.brandName,"onUpdate:modelValue":e[6]||(e[6]=o=>n.brandName=o),placeholder:"请输入品牌名称"},null,8,["modelValue"])]),_:1}),l(f,{label:"品牌Logo"},{default:t(()=>[l(M,{class:"upload-demo",action:H.value,"on-success":pe,"on-error":me,"before-upload":ce,limit:1,"file-list":V.value,"auto-upload":!0,accept:".jpg,.jpeg,.png"},{tip:t(()=>e[22]||(e[22]=[m("div",{class:"el-upload__tip"}," 只能上传jpg/jpeg/png文件，且不超过2MB ",-1)])),default:t(()=>[l(r,{type:"primary",icon:"Plus"},{default:t(()=>e[21]||(e[21]=[s("点击上传")])),_:1,__:[21]})]),_:1},8,["action","file-list"]),n.brandLogo?(v(),q(T,{key:0,src:n.brandLogo,fit:"cover",style:{width:"100px",height:"100px","margin-top":"10px"}},null,8,["src"])):G("",!0)]),_:1}),l(f,{label:"品牌状态",prop:"status"},{default:t(()=>[l(we,{modelValue:n.status,"onUpdate:modelValue":e[7]||(e[7]=o=>n.status=o)},{default:t(()=>[l(O,{label:"0"},{default:t(()=>e[23]||(e[23]=[s("启用")])),_:1,__:[23]}),l(O,{label:"1"},{default:t(()=>e[24]||(e[24]=[s("禁用")])),_:1,__:[24]})]),_:1},8,["modelValue"])]),_:1}),l(f,{label:"排序",prop:"sortOrder"},{default:t(()=>[l(xe,{modelValue:n.sortOrder,"onUpdate:modelValue":e[8]||(e[8]=o=>n.sortOrder=o),min:0,placeholder:"请输入排序值"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"]),l(P,{title:d.title,modelValue:d.open,"onUpdate:modelValue":e[12]||(e[12]=o=>d.open=o),width:"400px","append-to-body":""},{footer:t(()=>[m("div",Ge,[l(r,{type:"primary",loading:d.isUploading,onClick:re},{default:t(()=>e[31]||(e[31]=[s("确 定")])),_:1,__:[31]},8,["loading"]),l(r,{onClick:e[11]||(e[11]=o=>d.open=!1)},{default:t(()=>e[32]||(e[32]=[s("取 消")])),_:1,__:[32]})])]),default:t(()=>[l(M,{ref_key:"uploadRef",ref:C,limit:1,accept:".xlsx, .xls",headers:d.headers,action:d.url+"?updateSupport="+d.updateSupport,disabled:d.isUploading,"on-progress":se,"on-success":de,"on-change":ie,"on-remove":ue,"auto-upload":!1,drag:""},{tip:t(()=>[m("div",Re,[m("div",$e,[l(Ve,{modelValue:d.updateSupport,"onUpdate:modelValue":e[10]||(e[10]=o=>d.updateSupport=o)},null,8,["modelValue"]),e[27]||(e[27]=s("是否更新已经存在的品牌数据 "))]),e[29]||(e[29]=m("span",null,"仅允许导入xls、xlsx格式文件。",-1)),l(ke,{type:"primary",underline:!1,style:{"font-size":"12px","vertical-align":"baseline"},onClick:Q},{default:t(()=>e[28]||(e[28]=[s("下载模板")])),_:1,__:[28]})])]),default:t(()=>[l(Ce,{class:"el-icon--upload"},{default:t(()=>[l(Le(Be))]),_:1}),e[30]||(e[30]=m("div",{class:"el-upload__text"},[s("将文件拖到此处，或"),m("em",null,"点击上传")],-1))]),_:1,__:[30]},8,["headers","action","disabled"])]),_:1},8,["title","modelValue"])])}}};export{Qe as default};
