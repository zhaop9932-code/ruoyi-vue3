import{_ as te,r as g,H as oe,a as y,c,o as p,b as o,w as t,f as u,e as b,m as E,k as F,F as ae,n as re,l as ie,aD as se,t as M,E as r}from"./index-DgigFOm-.js";import{updateProduct as C}from"./product-C-f__cve.js";const de={class:"material-info-container"},ue={key:0,class:"main-image-preview",style:{display:"inline-block","margin-right":"20px"}},ne={key:1,class:"main-image-placeholder",style:{display:"inline-block","margin-right":"20px"}},me={key:0,style:{"margin-top":"15px",display:"flex",gap:"15px","flex-wrap":"wrap"}},pe={key:0,style:{"margin-top":"10px"}},fe={key:0,style:{"margin-top":"10px"}},ce={key:0,style:{"margin-top":"10px"}},ge={key:0,style:{"margin-top":"10px"}},ve={key:0,style:{"margin-top":"10px"}},ye={__name:"ProductMaterialInfo",props:{form:{type:Object,required:!0}},emits:["update:form"],setup(m,{emit:N}){const s=m,d=N,_=g("/prod-api/common/upload"),P=g([]),x=g([]),n=g([]),k=g(0),h=g([]),I=g([]),B=g([]),S=g([]),z=g([]);if(s.form.imageUrls)try{n.value=JSON.parse(s.form.imageUrls)}catch{n.value=[]}const J=async(e,l,a)=>{if(e.code===200)if(e.url){const i={...s.form,mainImageUrl:e.url};d("update:form",i),P.value=a;try{await C(i),r.success("上传成功，已保存到后台"),k.value++}catch(f){r.error("保存到后台失败："+(f.message||"未知错误")),d("update:form",s.form),P.value=[]}}else r.error("上传失败：返回数据格式错误");else r.error("上传失败："+(e.msg||"未知错误"))},V=async(e,l,a)=>{if(e.code===200)if(e.url){n.value.push(e.url),x.value=a;const i={...s.form,imageUrls:JSON.stringify(n.value)};d("update:form",i);try{await C(i),r.success("上传成功，已保存到后台"),k.value++}catch(f){r.error("保存到后台失败："+(f.message||"未知错误")),n.value.pop(),x.value=a.slice(0,-1),d("update:form",s.form)}}else r.error("上传失败：返回数据格式错误");else r.error("上传失败："+(e.msg||"未知错误"))},O=(e,l,a)=>{if(e.code===200)if(e.url){const i={...s.form,detailPageUrl:e.url};d("update:form",i),h.value=a,r.success("上传成功")}else r.error("上传失败：返回数据格式错误");else r.error("上传失败："+(e.msg||"未知错误"))},R=(e,l,a)=>{if(e.code===200)if(e.url){const i={...s.form,model3DUrl:e.url};d("update:form",i),I.value=a,r.success("上传成功")}else r.error("上传失败：返回数据格式错误");else r.error("上传失败："+(e.msg||"未知错误"))},$=(e,l,a)=>{if(e.code===200)if(e.url){const i={...s.form,manualUrl:e.url};d("update:form",i),B.value=a,r.success("上传成功")}else r.error("上传失败：返回数据格式错误");else r.error("上传失败："+(e.msg||"未知错误"))},q=(e,l,a)=>{if(e.code===200)if(e.url){const i={...s.form,installationGuideUrl:e.url};d("update:form",i),S.value=a,r.success("上传成功")}else r.error("上传失败：返回数据格式错误");else r.error("上传失败："+(e.msg||"未知错误"))},H=(e,l,a)=>{if(e.code===200)if(e.url){const i={...s.form,videoUrl:e.url};d("update:form",i),z.value=a,r.success("上传成功")}else r.error("上传失败：返回数据格式错误");else r.error("上传失败："+(e.msg||"未知错误"))},U=(e,l,a)=>{r.error("上传失败，请重试")},K=async e=>{n.value[e],x.value[e];const l=[...n.value],a=[...x.value],i={...s.form};n.value.splice(e,1),x.value.splice(e,1);const f={...s.form,imageUrls:JSON.stringify(n.value)};d("update:form",f);try{await C(f),r.success("图片已移除，已保存到后台"),k.value++}catch(v){r.error("保存到后台失败："+(v.message||"未知错误")),n.value=l,x.value=a,d("update:form",i)}},T=()=>{const e={...s.form,detailPageUrl:""};d("update:form",e),h.value=[]},A=()=>{const e={...s.form,model3DUrl:""};d("update:form",e),I.value=[]},Q=()=>{const e={...s.form,manualUrl:""};d("update:form",e),B.value=[]},W=()=>{const e={...s.form,installationGuideUrl:""};d("update:form",e),S.value=[]},X=()=>{const e={...s.form,videoUrl:""};d("update:form",e),z.value=[]},Y=async()=>{const e={...s.form,mainImageUrl:""};d("update:form",e),P.value=[];try{await C(e),r.success("主图已移除，已保存到后台"),k.value++}catch(l){r.error("保存到后台失败："+(l.message||"未知错误")),d("update:form",s.form)}},j=e=>{const l=e.type==="image/jpeg"||e.type==="image/png",a=e.size/1024/1024<2;return l?a?!0:(r.error("上传图片大小不能超过 2MB!"),!1):(r.error("上传图片只能是 JPG/PNG 格式!"),!1)},w=e=>{let l=10485760;const a=e.name.split(".").pop().toLowerCase();if(["glb","gltf","obj","fbx"].includes(a)?l=50*1024*1024:["mp4","avi","mov","wmv"].includes(a)?l=100*1024*1024:["pdf","doc","docx"].includes(a)&&(l=20*1024*1024),!(e.size<l)){const f=l/1024/1024;return r.error(`上传文件大小不能超过 ${f}MB!`),!1}return!0};return oe(()=>s.form.imageUrls,e=>{if(e)try{n.value=JSON.parse(e)}catch{n.value=[]}else n.value=[]}),(e,l)=>{const a=y("el-button"),i=y("el-upload"),f=y("el-image"),v=y("el-form-item"),Z=y("el-icon"),L=y("el-tag"),G=y("el-col"),ee=y("el-row");return p(),c("div",de,[o(v,{label:"产品主图",prop:"mainImageUrl"},{default:t(()=>[o(i,{class:"upload-demo",action:_.value,"on-success":J,"on-error":U,"before-upload":j,limit:1,"file-list":P.value,"auto-upload":!0,accept:".jpg,.jpeg,.png","show-file-list":!1},{tip:t(()=>l[1]||(l[1]=[b("div",{class:"el-upload__tip"}," 只能上传jpg/png文件，且不超过2MB ",-1)])),default:t(()=>[o(a,{type:"primary",icon:"Plus"},{default:t(()=>l[0]||(l[0]=[u("点击上传")])),_:1,__:[0]})]),_:1},8,["action","file-list"]),(p(),c("div",{class:"main-image-container",style:{"margin-top":"10px"},key:k.value},[m.form.mainImageUrl?(p(),c("div",ue,[(p(),E(f,{src:m.form.mainImageUrl,key:m.form.mainImageUrl,style:{width:"200px",height:"200px","object-fit":"contain",border:"1px solid #e4e7ed","border-radius":"8px"},fit:"contain"},null,8,["src"])),o(a,{type:"danger",size:"small",onClick:Y,style:{"margin-top":"10px"}},{default:t(()=>l[2]||(l[2]=[u(" 移除主图 ")])),_:1,__:[2]})])):(p(),c("div",ne,[o(f,{src:"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='200' height='200' viewBox='0 0 200 200'%3E%3Crect width='200' height='200' fill='%23f5f7fa' stroke='%23e4e7ed' stroke-width='1' rx='8'/%3E%3Ctext x='50%25' y='50%25' font-size='20' fill='%23909399' text-anchor='middle' dominant-baseline='middle'%3E主图%3C/text%3E%3C/svg%3E",style:{width:"200px",height:"200px",border:"1px solid #e4e7ed","border-radius":"8px"}})]))]))]),_:1}),o(v,{label:"产品图片列表",prop:"imageUrls"},{default:t(()=>[o(i,{class:"upload-demo",action:_.value,"on-success":V,"on-error":U,"before-upload":j,limit:5,"file-list":x.value,"auto-upload":!0,accept:".jpg,.jpeg,.png"},{tip:t(()=>l[4]||(l[4]=[b("div",{class:"el-upload__tip"}," 只能上传jpg/png文件，且不超过2MB，最多上传5张 ",-1)])),default:t(()=>[o(a,{type:"primary",icon:"Plus"},{default:t(()=>l[3]||(l[3]=[u("点击上传")])),_:1,__:[3]})]),_:1},8,["action","file-list"]),n.value.length>0?(p(),c("div",me,[(p(!0),c(ae,null,re(n.value,(D,le)=>(p(),c("div",{key:D,style:{position:"relative",border:"1px solid #e4e7ed","border-radius":"8px",padding:"5px","background-color":"#f5f7fa"}},[(p(),E(f,{src:D,key:D,style:{width:"120px",height:"120px"},fit:"cover"},null,8,["src"])),o(a,{type:"danger",size:"small",circle:"",style:{position:"absolute",top:"-10px",right:"-10px","z-index":"10","background-color":"#fff",border:"1px solid #f56c6c"},onClick:_e=>K(le)},{default:t(()=>[o(Z,null,{default:t(()=>[o(ie(se))]),_:1})]),_:2},1032,["onClick"])]))),128))])):F("",!0)]),_:1}),o(ee,{gutter:20},{default:t(()=>[o(G,{span:12},{default:t(()=>[o(v,{label:"产品详情页URL",prop:"detailPageUrl"},{default:t(()=>[o(i,{class:"upload-demo",action:_.value,"on-success":O,"on-error":U,"before-upload":w,limit:1,"file-list":h.value,"auto-upload":!0,accept:".pdf,.doc,.docx,.html,.htm"},{tip:t(()=>l[6]||(l[6]=[b("div",{class:"el-upload__tip"}," 只能上传pdf/doc/docx/html/htm文件，且不超过10MB ",-1)])),default:t(()=>[o(a,{type:"primary",icon:"Plus"},{default:t(()=>l[5]||(l[5]=[u("点击上传")])),_:1,__:[5]})]),_:1},8,["action","file-list"]),m.form.detailPageUrl?(p(),c("div",pe,[o(L,null,{default:t(()=>[u(M(m.form.detailPageUrl),1)]),_:1}),o(a,{type:"danger",size:"small",onClick:T,style:{"margin-left":"10px"}},{default:t(()=>l[7]||(l[7]=[u("移除")])),_:1,__:[7]})])):F("",!0)]),_:1}),o(v,{label:"产品3D模型URL",prop:"model3DUrl"},{default:t(()=>[o(i,{class:"upload-demo",action:_.value,"on-success":R,"on-error":U,"before-upload":w,limit:1,"file-list":I.value,"auto-upload":!0,accept:".glb,.gltf,.obj,.fbx"},{tip:t(()=>l[9]||(l[9]=[b("div",{class:"el-upload__tip"}," 只能上传glb/gltf/obj/fbx文件，且不超过50MB ",-1)])),default:t(()=>[o(a,{type:"primary",icon:"Plus"},{default:t(()=>l[8]||(l[8]=[u("点击上传")])),_:1,__:[8]})]),_:1},8,["action","file-list"]),m.form.model3DUrl?(p(),c("div",fe,[o(L,null,{default:t(()=>[u(M(m.form.model3DUrl),1)]),_:1}),o(a,{type:"danger",size:"small",onClick:A,style:{"margin-left":"10px"}},{default:t(()=>l[10]||(l[10]=[u("移除")])),_:1,__:[10]})])):F("",!0)]),_:1})]),_:1}),o(G,{span:12},{default:t(()=>[o(v,{label:"产品手册URL",prop:"manualUrl"},{default:t(()=>[o(i,{class:"upload-demo",action:_.value,"on-success":$,"on-error":U,"before-upload":w,limit:1,"file-list":B.value,"auto-upload":!0,accept:".pdf,.doc,.docx"},{tip:t(()=>l[12]||(l[12]=[b("div",{class:"el-upload__tip"}," 只能上传pdf/doc/docx文件，且不超过20MB ",-1)])),default:t(()=>[o(a,{type:"primary",icon:"Plus"},{default:t(()=>l[11]||(l[11]=[u("点击上传")])),_:1,__:[11]})]),_:1},8,["action","file-list"]),m.form.manualUrl?(p(),c("div",ce,[o(L,null,{default:t(()=>[u(M(m.form.manualUrl),1)]),_:1}),o(a,{type:"danger",size:"small",onClick:Q,style:{"margin-left":"10px"}},{default:t(()=>l[13]||(l[13]=[u("移除")])),_:1,__:[13]})])):F("",!0)]),_:1}),o(v,{label:"安装指南URL",prop:"installationGuideUrl"},{default:t(()=>[o(i,{class:"upload-demo",action:_.value,"on-success":q,"on-error":U,"before-upload":w,limit:1,"file-list":S.value,"auto-upload":!0,accept:".pdf,.doc,.docx"},{tip:t(()=>l[15]||(l[15]=[b("div",{class:"el-upload__tip"}," 只能上传pdf/doc/docx文件，且不超过20MB ",-1)])),default:t(()=>[o(a,{type:"primary",icon:"Plus"},{default:t(()=>l[14]||(l[14]=[u("点击上传")])),_:1,__:[14]})]),_:1},8,["action","file-list"]),m.form.installationGuideUrl?(p(),c("div",ge,[o(L,null,{default:t(()=>[u(M(m.form.installationGuideUrl),1)]),_:1}),o(a,{type:"danger",size:"small",onClick:W,style:{"margin-left":"10px"}},{default:t(()=>l[16]||(l[16]=[u("移除")])),_:1,__:[16]})])):F("",!0)]),_:1}),o(v,{label:"视频介绍URL",prop:"videoUrl"},{default:t(()=>[o(i,{class:"upload-demo",action:_.value,"on-success":H,"on-error":U,"before-upload":w,limit:1,"file-list":z.value,"auto-upload":!0,accept:".mp4,.avi,.mov,.wmv"},{tip:t(()=>l[18]||(l[18]=[b("div",{class:"el-upload__tip"}," 只能上传mp4/avi/mov/wmv文件，且不超过100MB ",-1)])),default:t(()=>[o(a,{type:"primary",icon:"Plus"},{default:t(()=>l[17]||(l[17]=[u("点击上传")])),_:1,__:[17]})]),_:1},8,["action","file-list"]),m.form.videoUrl?(p(),c("div",ve,[o(L,null,{default:t(()=>[u(M(m.form.videoUrl),1)]),_:1}),o(a,{type:"danger",size:"small",onClick:X,style:{"margin-left":"10px"}},{default:t(()=>l[19]||(l[19]=[u("移除")])),_:1,__:[19]})])):F("",!0)]),_:1})]),_:1})]),_:1})])}}},be=te(ye,[["__scopeId","data-v-781d9d64"]]);export{be as default};
