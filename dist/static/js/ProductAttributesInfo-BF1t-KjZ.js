import{listProductAttributeRelation as j}from"./product-C-f__cve.js";import{listAttributeGroupByCatalog as z}from"./attributeGroup-dZVme5vU.js";import{l as F,g as L}from"./attributeGroupAttributeValue-C1lKcUwc.js";import{_ as M,r as h,H as E,h as O,a as i,c as p,o as u,e as $,m as y,b as m,w as _,F as w,n as N,E as x}from"./index-DgigFOm-.js";const q={class:"attributes-info-container"},H={class:"attributes-management",style:{"margin-bottom":"20px"}},W={key:1,class:"loading-container"},D={key:2,class:"empty-container"},J={key:3,class:"attribute-forms"},K={__name:"ProductAttributesInfo",props:{form:{type:Object,required:!0}},emits:[],setup(B,{expose:P,emit:Q}){const c=B,d=h([]),l=h([]),A=h(!1),G=h([]),g=async()=>{A.value=!0;try{if(c.form.productId){const t=await j(c.form.productId);if(t.code===200){const o=t.data||[],r={};o.forEach(s=>{var a;const e=((a=s.attributeGroup)==null?void 0:a.attributeGroupId)||"default";r[e]||(r[e]={attributeGroup:s.attributeGroup||{attributeGroupId:"default",attributeGroupName:"默认属性组"},attributes:[]}),r[e].attributes.push(s)}),l.value=Object.values(r),d.value=o,console.log("attributeGroups",l.value),G.value=l.value.map(s=>s.attributeGroup.attributeGroupId)}else d.value=[],l.value=[],x.error("获取产品属性失败："+t.msg)}else if(c.form.catalogId){const t=await z(c.form.catalogId);if(t.code!==200){d.value=[],l.value=[],x.error("获取属性组失败："+t.msg);return}const o=t.data||[],r=[];for(const e of o){const a=await F(e.attributeGroupId);if(a.code===200){const I=[];for(const f of a.data||[]){const V=await L(f.attributeGroupAttributeId),k=V.code===200?V.data||[]:[];I.push({...f,attributeValues:k,attributeValue:f.defaultValue||""})}r.push({attributeGroup:e,attributes:I})}}l.value=r,console.log("organizedGroups",r);const s=[];r.forEach(e=>{e.attributes.forEach(a=>{s.push({relationId:a.attributeGroupAttributeId,attribute:a.attribute,attributeValue:a.attributeValue||"",attributeValues:a.attributeValues||[],attributeGroup:e.attributeGroup})})}),d.value=s,G.value=l.value.map(e=>e.attributeGroup.attributeGroupId)}}catch(t){d.value=[],l.value=[],x.error("获取产品属性失败："+(t.message||"未知错误"))}finally{A.value=!1}};return P({refresh:g,getProductAttributes:()=>d.value}),E(()=>c.form.catalogId,(t,o)=>{t!==o&&g()}),E(()=>c.form.productId,(t,o)=>{t!==o&&t&&g()}),O(()=>{(c.form.productId||c.form.catalogId)&&g()}),(t,o)=>{const r=i("el-alert"),s=i("el-skeleton"),e=i("el-empty"),a=i("el-option"),I=i("el-select"),f=i("el-form-item"),V=i("el-col"),k=i("el-row"),C=i("el-collapse-item"),U=i("el-collapse");return u(),p("div",q,[$("div",H,[B.form.catalogId?A.value?(u(),p("div",W,[m(s,{rows:10,animated:""})])):l.value.length===0?(u(),p("div",D,[m(e,{description:"暂无产品属性"})])):(u(),p("div",J,[m(U,{modelValue:G.value,"onUpdate:modelValue":o[0]||(o[0]=b=>G.value=b)},{default:_(()=>[(u(!0),p(w,null,N(l.value,b=>(u(),y(C,{key:b.attributeGroup.attributeGroupId,name:b.attributeGroup.attributeGroupId,title:b.attributeGroup.attributeGroupName},{default:_(()=>[m(k,{gutter:20},{default:_(()=>[(u(!0),p(w,null,N(b.attributes,n=>(u(),y(V,{span:12,key:n.relationId},{default:_(()=>[m(f,{label:n.attribute.attributeName,prop:`attribute_${n.relationId}`},{default:_(()=>[m(I,{modelValue:n.attributeValue,"onUpdate:modelValue":v=>n.attributeValue=v,placeholder:`请选择${n.attribute.attributeName}`,filterable:"","allow-create":"","default-first-option":""},{default:_(()=>[(u(!0),p(w,null,N(n.attributeValues,v=>(u(),y(a,{key:v.id,label:v.valueName,value:v.valueName},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"])]),_:2},1032,["label","prop"])]),_:2},1024))),128))]),_:2},1024)]),_:2},1032,["name","title"]))),128))]),_:1},8,["modelValue"])])):(u(),y(r,{key:0,title:"请先选择产品目录",type:"warning",closable:!1}))])])}}},Z=M(K,[["__scopeId","data-v-a3c065db"]]);export{Z as default};
