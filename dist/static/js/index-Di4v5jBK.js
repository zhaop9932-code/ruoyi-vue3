import{_ as xe,B as Ce,T as Ue,r as b,$ as N,h as Ie,S as O,aB as Ne,a as p,i as he,c as h,o as _,e as m,b as t,w as a,f as s,t as z,j as F,a0 as H,m as S,k as J,U as W,F as X,n as Y,l as Se,aC as qe,E as f,Q as Ge}from"./index-DgigFOm-.js";import{listAttribute as Ae,deleteAttribute as ze,getAttribute as Fe,updateAttribute as Le,addAttribute as Be}from"./product-C-f__cve.js";import{listAttributeGroup as De}from"./attributeGroup-dZVme5vU.js";const Re={class:"cpq-page-container"},Me={class:"cpq-card"},Ee={class:"cpq-card-header"},$e={class:"cpq-card-actions"},Pe={class:"cpq-card-body"},Ke={class:"cpq-card-title"},Qe={key:0,class:"cpq-catalog-name"},je={class:"cpq-pagination"},Oe={class:"cpq-dialog-footer"},He={class:"el-upload__tip text-center"},Je={class:"el-upload__tip"},We={class:"dialog-footer"},Xe={__name:"index",setup(Ye){const L=Ce(),{proxy:B}=Ue(),k=b(L.query.catalogId||""),D=b(L.query.catalogName||""),x=b(!0),C=b(!0),q=b(0),R=b([]),G=b([]),A=b(""),V=b(!1),M=b([]),E=b(!1),d=N({open:!1,title:"导入产品属性",url:"/prod-api/cpq/product/importAttribute",headers:{Authorization:"Bearer "+localStorage.getItem("token")},isUploading:!1,isUpdateSupport:0,updateSupport:0,fileList:[],successMsg:""}),U=b(),$=async()=>{E.value=!0;try{const u=await De({pageNum:1,pageSize:100});M.value=u.rows||[]}catch{f.error("加载属性组列表失败")}finally{E.value=!1}},i=N({pageNum:1,pageSize:10,attributeCode:"",attributeName:"",attributeType:"",catalogId:""}),o=N({attributeId:null,attributeCode:"",attributeName:"",attributeType:"text",componentType:"input",iconUrl:"",defaultValue:"",tooltip:"",attributeGroupId:"",attributeGroupName:""}),Z=N({attributeName:[{required:!0,message:"属性名称不能为空",trigger:"blur"}],attributeType:[{required:!0,message:"属性类型不能为空",trigger:"change"}],componentType:[{required:!0,message:"组件类型不能为空",trigger:"change"}]}),y=async()=>{x.value=!0;try{const u=await Ae(i);R.value=u.rows,q.value=u.total,x.value=!1}catch{x.value=!1,f.error("获取属性列表失败")}},I=()=>{i.pageNum=1,y()},ee=()=>{i.attributeCode="",i.attributeName="",i.attributeType="",I()},te=()=>{C.value=!C.value},le=u=>{G.value=u},ae=()=>{o.attributeId=null,o.attributeCode="",o.attributeName="",o.attributeType="text",o.componentType="input",o.iconUrl="",o.defaultValue="",o.tooltip="",o.attributeGroupId="",o.attributeGroupName="",A.value="新增属性",$(),V.value=!0},oe=async u=>{try{const r=(await Fe(u.attributeId)).data;o.attributeId=r.attributeId,o.attributeCode=r.attributeCode,o.attributeName=r.attributeName;const g={1:"text",2:"number",3:"date",4:"enum",5:"boolean",text:"text",number:"number",date:"date",enum:"enum",boolean:"boolean"},c=String(r.attributeType).toLowerCase();o.attributeType=g[c]||"text";const n={1:"input",2:"select",3:"radio",4:"checkbox",5:"slider",6:"switch",7:"date-picker",input:"input",select:"select",radio:"radio",checkbox:"checkbox",slider:"slider",switch:"switch","date-picker":"date-picker"},w=String(r.componentType).toLowerCase();o.componentType=n[w]||"input",o.iconUrl=r.iconUrl,o.defaultValue=r.defaultValue,o.tooltip=r.tooltip,o.attributeGroupId=r.attributeGroupId||"",o.attributeGroupName=r.attributeGroupName||"",A.value="修改属性",$(),V.value=!0}catch{f.error("获取属性详情失败")}},P=async u=>{const e=u.attributeId?[u.attributeId]:G.value.map(r=>r.attributeId);await Ge.confirm("确定要删除选中的属性吗？","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});try{await ze(e),f.success("删除成功"),y()}catch{f.error("删除失败")}},T=b(null),ue=async()=>{T.value&&await T.value.validate().then(async()=>{try{o.attributeId?(await Le(o),f.success("修改成功")):(await Be(o),f.success("新增成功")),V.value=!1,y()}catch{f.error("操作失败")}}).catch(()=>{f.error("表单验证失败，请检查填写内容")})},re=()=>{V.value=!1,T.value&&T.value.resetFields()},ie=()=>{B.download("cpq/product/exportAttribute",{...i},`attribute_${new Date().getTime()}.xlsx`)},ne=()=>{B.download("cpq/product/downloadAttributeImportTemplate",{},`attribute_import_template_${new Date().getTime()}.xlsx`)},de=()=>{d.title="导入产品属性",d.open=!0},se=()=>{U.value&&U.value.uploadFiles.length>0?U.value.submit():f.warning("请选择要上传的文件")},pe=(u,e,r)=>{d.isUploading=!0},ce=(u,e,r)=>{d.isUploading=!1,u.code===200?(d.successMsg=u.msg,f.success(u.msg),d.open=!1,y()):f.error(u.msg)},me=(u,e)=>{d.updateSupport=e.length>0},be=(u,e)=>{d.updateSupport=e.length>0};return Ie(()=>{O(),k.value&&(i.catalogId=k.value),y()}),Ne(()=>{O(),k.value&&(i.catalogId=k.value),y()}),(u,e)=>{const r=p("el-button"),g=p("el-input"),c=p("el-form-item"),n=p("el-option"),w=p("el-select"),K=p("el-form"),Q=p("el-card"),v=p("el-table-column"),fe=p("el-tag"),ge=p("el-table"),ve=p("pagination"),j=p("el-dialog"),_e=p("el-icon"),ye=p("el-checkbox"),we=p("el-link"),Ve=p("el-upload"),ke=he("loading");return _(),h("div",Re,[m("div",Me,[m("div",Ee,[e[21]||(e[21]=m("div",{class:"cpq-card-title"},"产品属性管理",-1)),m("div",$e,[t(r,{type:"primary",onClick:ae,icon:u.Plus},{default:a(()=>e[17]||(e[17]=[s("新增属性")])),_:1,__:[17]},8,["icon"]),t(r,{type:"danger",onClick:P,disabled:G.value.length===0,icon:u.Delete},{default:a(()=>e[18]||(e[18]=[s("批量删除")])),_:1,__:[18]},8,["disabled","icon"]),t(r,{type:"warning",onClick:ie,icon:u.Download},{default:a(()=>e[19]||(e[19]=[s("导出")])),_:1,__:[19]},8,["icon"]),t(r,{type:"success",onClick:de,icon:u.Upload},{default:a(()=>e[20]||(e[20]=[s("导入")])),_:1,__:[20]},8,["icon"]),t(r,{type:"info",onClick:te,icon:u.Search},{default:a(()=>[s(z(C.value?"收起":"展开")+"搜索 ",1)]),_:1},8,["icon"])])]),m("div",Pe,[F(t(Q,{shadow:"never",class:"cpq-search-card"},{default:a(()=>[t(K,{model:i,ref:"queryForm",inline:!0,"label-width":"80px"},{default:a(()=>[t(c,{label:"属性编码",prop:"attributeCode"},{default:a(()=>[t(g,{modelValue:i.attributeCode,"onUpdate:modelValue":e[0]||(e[0]=l=>i.attributeCode=l),placeholder:"请输入属性编码",clearable:"",size:"small",onKeyup:W(I,["enter"])},null,8,["modelValue"])]),_:1}),t(c,{label:"属性名称",prop:"attributeName"},{default:a(()=>[t(g,{modelValue:i.attributeName,"onUpdate:modelValue":e[1]||(e[1]=l=>i.attributeName=l),placeholder:"请输入属性名称",clearable:"",size:"small",onKeyup:W(I,["enter"])},null,8,["modelValue"])]),_:1}),t(c,{label:"属性类型",prop:"attributeType"},{default:a(()=>[t(w,{modelValue:i.attributeType,"onUpdate:modelValue":e[2]||(e[2]=l=>i.attributeType=l),placeholder:"请选择属性类型",clearable:"",size:"small"},{default:a(()=>[t(n,{label:"文本",value:"text"}),t(n,{label:"数字",value:"number"}),t(n,{label:"日期",value:"date"}),t(n,{label:"枚举",value:"enum"}),t(n,{label:"布尔",value:"boolean"})]),_:1},8,["modelValue"])]),_:1}),k.value?J("",!0):(_(),S(c,{key:0},{default:a(()=>[t(w,{modelValue:i.catalogId,"onUpdate:modelValue":e[3]||(e[3]=l=>i.catalogId=l),placeholder:"请选择目录",clearable:"",size:"small"},{default:a(()=>[(_(!0),h(X,null,Y(u.catalogList,l=>(_(),S(n,{key:l.catalogId,label:l.catalogName,value:l.catalogId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})),t(c,null,{default:a(()=>[t(r,{type:"primary",size:"small",onClick:I,icon:u.Search},{default:a(()=>e[22]||(e[22]=[s("搜索")])),_:1,__:[22]},8,["icon"]),t(r,{size:"small",onClick:ee,icon:u.Refresh},{default:a(()=>e[23]||(e[23]=[s("重置")])),_:1,__:[23]},8,["icon"])]),_:1})]),_:1},8,["model"])]),_:1},512),[[H,C.value]]),t(Q,{shadow:"never",class:"cpq-sub-card"},{header:a(()=>[m("div",Ke,[e[24]||(e[24]=s(" 属性列表 ")),D.value?(_(),h("span",Qe,"(目录："+z(D.value)+")",1)):J("",!0)])]),default:a(()=>[F((_(),S(ge,{data:R.value,onSelectionChange:le,stripe:"",fit:"",style:{width:"100%"},class:"cpq-table"},{default:a(()=>[t(v,{type:"selection",width:"55",align:"center"}),t(v,{label:"属性编码",align:"left",prop:"attributeCode","min-width":"150"}),t(v,{label:"属性名称",align:"left",prop:"attributeName","show-overflow-tooltip":!0,"min-width":"200"}),t(v,{label:"属性类型",align:"center",prop:"attributeType",width:"120"},{default:a(l=>[t(fe,{size:"small"},{default:a(()=>[s(z(l.row.attributeType==="text"?"文本":l.row.attributeType==="number"?"数字":l.row.attributeType==="date"?"日期":l.row.attributeType==="enum"?"枚举":"布尔"),1)]),_:2},1024)]),_:1}),t(v,{label:"组件类型",align:"center",prop:"componentType",width:"120"}),t(v,{label:"默认值",align:"left",prop:"defaultValue","show-overflow-tooltip":!0,"min-width":"150"}),t(v,{label:"创建时间",align:"center",prop:"createTime",width:"180"}),t(v,{label:"操作",align:"center","class-name":"cpq-table-action",width:"150"},{default:a(l=>[t(r,{size:"small",type:"primary",icon:u.Edit,onClick:Te=>oe(l.row)},{default:a(()=>e[25]||(e[25]=[s(" 修改 ")])),_:2,__:[25]},1032,["icon","onClick"]),t(r,{size:"small",type:"danger",icon:u.Delete,onClick:Te=>P(l.row)},{default:a(()=>e[26]||(e[26]=[s(" 删除 ")])),_:2,__:[26]},1032,["icon","onClick"])]),_:1})]),_:1},8,["data"])),[[ke,x.value]]),m("div",je,[F(t(ve,{total:q.value,page:i.pageNum,"onUpdate:page":e[4]||(e[4]=l=>i.pageNum=l),limit:i.pageSize,"onUpdate:limit":e[5]||(e[5]=l=>i.pageSize=l),onPagination:y},null,8,["total","page","limit"]),[[H,q.value>0]])])]),_:1})])]),t(j,{title:A.value,modelValue:V.value,"onUpdate:modelValue":e[13]||(e[13]=l=>V.value=l),width:"600px","append-to-body":"","close-on-click-modal":!1},{footer:a(()=>[m("div",Oe,[t(r,{onClick:re},{default:a(()=>e[27]||(e[27]=[s("取消")])),_:1,__:[27]}),t(r,{type:"primary",onClick:ue},{default:a(()=>e[28]||(e[28]=[s("确定")])),_:1,__:[28]})])]),default:a(()=>[t(K,{ref:l=>T.value=l,model:o,rules:Z,"label-width":"100px",class:"cpq-form"},{default:a(()=>[t(c,{label:"属性名称",prop:"attributeName"},{default:a(()=>[t(g,{modelValue:o.attributeName,"onUpdate:modelValue":e[6]||(e[6]=l=>o.attributeName=l),placeholder:"请输入属性名称"},null,8,["modelValue"])]),_:1}),t(c,{label:"属性类型",prop:"attributeType"},{default:a(()=>[t(w,{modelValue:o.attributeType,"onUpdate:modelValue":e[7]||(e[7]=l=>o.attributeType=l),placeholder:"请选择属性类型"},{default:a(()=>[t(n,{label:"文本",value:"text"}),t(n,{label:"数字",value:"number"}),t(n,{label:"日期",value:"date"}),t(n,{label:"枚举",value:"enum"}),t(n,{label:"布尔",value:"boolean"})]),_:1},8,["modelValue"])]),_:1}),t(c,{label:"组件类型",prop:"componentType"},{default:a(()=>[t(w,{modelValue:o.componentType,"onUpdate:modelValue":e[8]||(e[8]=l=>o.componentType=l),placeholder:"请选择组件类型"},{default:a(()=>[t(n,{label:"输入框",value:"input"}),t(n,{label:"下拉框",value:"select"}),t(n,{label:"单选框",value:"radio"}),t(n,{label:"复选框",value:"checkbox"}),t(n,{label:"滑块",value:"slider"}),t(n,{label:"开关",value:"switch"}),t(n,{label:"日期选择器",value:"date-picker"})]),_:1},8,["modelValue"])]),_:1}),t(c,{label:"默认值",prop:"defaultValue"},{default:a(()=>[t(g,{modelValue:o.defaultValue,"onUpdate:modelValue":e[9]||(e[9]=l=>o.defaultValue=l),placeholder:"请输入默认值"},null,8,["modelValue"])]),_:1}),t(c,{label:"图标URL",prop:"iconUrl"},{default:a(()=>[t(g,{modelValue:o.iconUrl,"onUpdate:modelValue":e[10]||(e[10]=l=>o.iconUrl=l),placeholder:"请输入图标URL"},null,8,["modelValue"])]),_:1}),t(c,{label:"提示信息",prop:"tooltip"},{default:a(()=>[t(g,{modelValue:o.tooltip,"onUpdate:modelValue":e[11]||(e[11]=l=>o.tooltip=l),type:"textarea",placeholder:"请输入提示信息",rows:2},null,8,["modelValue"])]),_:1}),t(c,{label:"属性组",prop:"attributeGroupId"},{default:a(()=>[t(w,{modelValue:o.attributeGroupId,"onUpdate:modelValue":e[12]||(e[12]=l=>o.attributeGroupId=l),placeholder:"请选择属性组",clearable:"",filterable:"","allow-create":"","default-first-option":"",style:{width:"100%"}},{default:a(()=>[(_(!0),h(X,null,Y(M.value,l=>(_(),S(n,{key:l.attributeGroupId,label:l.attributeGroupName,value:l.attributeGroupId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"]),t(j,{title:d.title,modelValue:d.open,"onUpdate:modelValue":e[16]||(e[16]=l=>d.open=l),width:"400px","append-to-body":""},{footer:a(()=>[m("div",We,[t(r,{type:"primary",loading:d.isUploading,onClick:se},{default:a(()=>e[33]||(e[33]=[s("确 定")])),_:1,__:[33]},8,["loading"]),t(r,{onClick:e[15]||(e[15]=l=>d.open=!1)},{default:a(()=>e[34]||(e[34]=[s("取 消")])),_:1,__:[34]})])]),default:a(()=>[t(Ve,{ref_key:"uploadRef",ref:U,limit:1,accept:".xlsx, .xls",headers:d.headers,action:d.url+"?updateSupport="+d.updateSupport,disabled:d.isUploading,"on-progress":pe,"on-success":ce,"on-change":me,"on-remove":be,"auto-upload":!1,drag:""},{tip:a(()=>[m("div",He,[m("div",Je,[t(ye,{modelValue:d.updateSupport,"onUpdate:modelValue":e[14]||(e[14]=l=>d.updateSupport=l)},null,8,["modelValue"]),e[29]||(e[29]=s("是否更新已经存在的属性数据 "))]),e[31]||(e[31]=m("span",null,"仅允许导入xls、xlsx格式文件。",-1)),t(we,{type:"primary",underline:!1,style:{"font-size":"12px","vertical-align":"baseline"},onClick:ne},{default:a(()=>e[30]||(e[30]=[s("下载模板")])),_:1,__:[30]})])]),default:a(()=>[t(_e,{class:"el-icon--upload"},{default:a(()=>[t(Se(qe))]),_:1}),e[32]||(e[32]=m("div",{class:"el-upload__text"},[s("将文件拖到此处，或"),m("em",null,"点击上传")],-1))]),_:1,__:[32]},8,["headers","action","disabled"])]),_:1},8,["title","modelValue"])])}}},lt=xe(Xe,[["__scopeId","data-v-2dc60c51"]]);export{lt as default};
