import{x as N,_ as ge,r as b,g as F,B as h,i as ye,a as r,j as Ve,c as we,o as J,b as e,k as $,w as o,l as W,f as n,v as X,t as g,m as Ne,e as E,E as f}from"./index-kbfDsxmo.js";function Se(p){return N({url:"/cpq/quote/list",method:"get",params:p})}function Ae(p){return N({url:"/cpq/quote",method:"post",data:p})}function xe(p){return N({url:"/cpq/quote",method:"put",data:p})}function ke(p){return N({url:`/cpq/quote/${p}`,method:"delete"})}function Y(p){return N({url:`/cpq/quote/submit/${p}`,method:"post"})}const Pe={class:"app-container"},Ue={class:"quote-items-container"},he={class:"price-details"},Ce={class:"dialog-footer"},Ie={__name:"index",setup(p){const S=b(!0),A=b(!0),C=b(0),T=b([]),I=b([]),z=b(""),y=b(!1),x=b("basic"),i=F({pageNum:1,pageSize:10,quoteNumber:"",customerName:"",quoteStatus:""}),l=F({quoteId:null,quoteNumber:"",customerName:"",contactPerson:"",contactPhone:"",quoteDate:"",validUntil:"",quoteStatus:"draft",totalAmount:0,discountAmount:0,freightAmount:0,taxAmount:0,finalAmount:0,remark:"",quoteItems:[]}),j=F({quoteNumber:[{required:!0,message:"报价单号不能为空",trigger:"blur"}],customerName:[{required:!0,message:"客户名称不能为空",trigger:"blur"}],quoteDate:[{required:!0,message:"报价日期不能为空",trigger:"change"}],validUntil:[{required:!0,message:"有效期至不能为空",trigger:"change"}]}),v=b([]),k=h(()=>v.value.reduce((u,t)=>u+(t.quantity*t.unitPrice||0),0)),P=h(()=>v.value.reduce((u,t)=>u+(t.quantity*t.unitPrice*(t.discount/100)||0),0)),D=h(()=>(k.value-P.value)*.13),R=h(()=>k.value-P.value+l.freightAmount+D.value),V=async()=>{S.value=!0;try{const u=await Se(i);T.value=u.rows,C.value=u.total,S.value=!1}catch{S.value=!1,f.error("获取报价单列表失败")}},U=()=>{i.pageNum=1,V()},Z=()=>{i.quoteNumber="",i.customerName="",i.quoteStatus="",U()},ee=()=>{A.value=!A.value},te=u=>{I.value=u},le=()=>{l.quoteId=null,l.quoteNumber="",l.customerName="",l.contactPerson="",l.contactPhone="",l.quoteDate="",l.validUntil="",l.quoteStatus="draft",l.totalAmount=0,l.discountAmount=0,l.freightAmount=0,l.taxAmount=0,l.finalAmount=0,l.remark="",v.value=[],z.value="新增报价单",x.value="basic",y.value=!0},ae=u=>{l.quoteId=u.quoteId,l.quoteNumber=u.quoteNumber,l.customerName=u.customerName,l.contactPerson=u.contactPerson,l.contactPhone=u.contactPhone,l.quoteDate=u.quoteDate,l.validUntil=u.validUntil,l.quoteStatus=u.quoteStatus,l.totalAmount=u.totalAmount,l.discountAmount=u.discountAmount,l.freightAmount=u.freightAmount,l.taxAmount=u.taxAmount,l.finalAmount=u.finalAmount,l.remark=u.remark,v.value=[{itemId:1,productName:"产品1",productCode:"PROD001",quantity:2,unitPrice:1e3,discount:10},{itemId:2,productName:"产品2",productCode:"PROD002",quantity:1,unitPrice:2e3,discount:5}],z.value="修改报价单",x.value="basic",y.value=!0},K=async u=>{const t=u.quoteId?[u.quoteId]:I.value.map(m=>m.quoteId);await ElMessageBox.confirm("确定要删除选中的报价单吗？","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});try{await ke(t),f.success("删除成功"),V()}catch{f.error("删除失败")}},oe=u=>{router.push({path:"/cpq/quote/detail",query:{quoteId:u.quoteId}})},ue=u=>{Y(u.quoteId).then(()=>{f.success("提交成功"),V()}).catch(t=>{f.error("提交失败")})},ne=()=>{v.value.push({itemId:null,productName:"",productCode:"",quantity:1,unitPrice:0,discount:0})},re=u=>{const t=v.value.findIndex(m=>m.itemId===u.itemId);t!==-1&&v.value.splice(t,1)},de=async()=>{await validate(l,j);try{l.totalAmount=k.value,l.discountAmount=P.value,l.taxAmount=D.value,l.finalAmount=R.value,l.quoteId?(await xe(l),f.success("修改成功")):(await Ae(l),f.success("新增成功")),y.value=!1,V()}catch{f.error("操作失败")}},ie=async()=>{try{await Y(l.quoteId),f.success("提交审批成功"),y.value=!1,V()}catch{f.error("提交审批失败")}},se=()=>{y.value=!1,resetForm()};return ye(()=>{V()}),(u,t)=>{const m=r("el-input"),c=r("el-form-item"),q=r("el-option"),M=r("el-select"),s=r("el-button"),L=r("el-form"),me=r("el-card"),Q=r("el-col"),ce=r("el-row"),d=r("el-table-column"),pe=r("el-tag"),O=r("el-table"),_e=r("pagination"),G=r("el-date-picker"),B=r("el-tab-pane"),H=r("el-input-number"),w=r("el-descriptions-item"),fe=r("el-descriptions"),be=r("el-tabs"),ve=r("el-dialog"),qe=Ve("loading");return J(),we("div",Pe,[e(me,{shadow:"never",class:"search-card"},{default:o(()=>[$(e(L,{model:i,ref:"queryForm",inline:!0,"label-width":"80px"},{default:o(()=>[e(c,{label:"报价单号",prop:"quoteNumber"},{default:o(()=>[e(m,{modelValue:i.quoteNumber,"onUpdate:modelValue":t[0]||(t[0]=a=>i.quoteNumber=a),placeholder:"请输入报价单号",clearable:"",size:"small",onKeyup:W(U,["enter"])},null,8,["modelValue"])]),_:1}),e(c,{label:"客户名称",prop:"customerName"},{default:o(()=>[e(m,{modelValue:i.customerName,"onUpdate:modelValue":t[1]||(t[1]=a=>i.customerName=a),placeholder:"请输入客户名称",clearable:"",size:"small",onKeyup:W(U,["enter"])},null,8,["modelValue"])]),_:1}),e(c,{label:"报价状态",prop:"quoteStatus"},{default:o(()=>[e(M,{modelValue:i.quoteStatus,"onUpdate:modelValue":t[2]||(t[2]=a=>i.quoteStatus=a),placeholder:"请选择报价状态",clearable:"",size:"small"},{default:o(()=>[e(q,{label:"草稿",value:"draft"}),e(q,{label:"已提交",value:"submitted"}),e(q,{label:"审批中",value:"approving"}),e(q,{label:"已通过",value:"approved"}),e(q,{label:"已拒绝",value:"rejected"}),e(q,{label:"已失效",value:"expired"})]),_:1},8,["modelValue"])]),_:1}),e(c,null,{default:o(()=>[e(s,{type:"primary",icon:"Search",size:"small",onClick:U},{default:o(()=>t[13]||(t[13]=[n("搜索")])),_:1,__:[13]}),e(s,{icon:"RefreshRight",size:"small",onClick:Z},{default:o(()=>t[14]||(t[14]=[n("重置")])),_:1,__:[14]})]),_:1})]),_:1},8,["model"]),[[X,A.value]])]),_:1}),e(ce,{gutter:10,class:"mb8"},{default:o(()=>[e(Q,{span:1.5},{default:o(()=>[e(s,{type:"primary",icon:"Plus",size:"small",onClick:le},{default:o(()=>t[15]||(t[15]=[n(" 新增报价单 ")])),_:1,__:[15]})]),_:1}),e(Q,{span:1.5},{default:o(()=>[e(s,{type:"danger",icon:"Delete",size:"small",disabled:I.value.length===0,onClick:K},{default:o(()=>t[16]||(t[16]=[n(" 批量删除 ")])),_:1,__:[16]},8,["disabled"])]),_:1}),e(Q,{span:21},{default:o(()=>[e(s,{type:"info",icon:"Search",size:"small",onClick:ee,style:{float:"right"}},{default:o(()=>[n(g(A.value?"收起":"展开")+"搜索 ",1)]),_:1})]),_:1})]),_:1}),$((J(),Ne(O,{data:T.value,onSelectionChange:te},{default:o(()=>[e(d,{type:"selection",width:"55",align:"center"}),e(d,{label:"报价单号",align:"center",prop:"quoteNumber"}),e(d,{label:"客户名称",align:"center",prop:"customerName"}),e(d,{label:"报价金额",align:"center",prop:"totalAmount"}),e(d,{label:"报价状态",align:"center",prop:"quoteStatus"},{default:o(a=>[e(pe,{type:a.row.quoteStatus==="draft"?"info":a.row.quoteStatus==="submitted"?"warning":a.row.quoteStatus==="approving"?"primary":a.row.quoteStatus==="approved"?"success":a.row.quoteStatus==="rejected"?"danger":"warning",size:"small"},{default:o(()=>[n(g(a.row.quoteStatus==="draft"?"草稿":a.row.quoteStatus==="submitted"?"已提交":a.row.quoteStatus==="approving"?"审批中":a.row.quoteStatus==="approved"?"已通过":a.row.quoteStatus==="rejected"?"已拒绝":"已失效"),1)]),_:2},1032,["type"])]),_:1}),e(d,{label:"创建人",align:"center",prop:"createBy"}),e(d,{label:"创建时间",align:"center",prop:"createTime",width:"180"}),e(d,{label:"操作",align:"center","class-name":"small-padding fixed-width",width:"250"},{default:o(a=>[e(s,{size:"small",type:"primary",icon:"Edit",onClick:_=>ae(a.row)},{default:o(()=>t[17]||(t[17]=[n(" 编辑 ")])),_:2,__:[17]},1032,["onClick"]),e(s,{size:"small",type:"success",icon:"Document",onClick:_=>oe(a.row)},{default:o(()=>t[18]||(t[18]=[n(" 查看 ")])),_:2,__:[18]},1032,["onClick"]),e(s,{size:"small",type:"warning",icon:"Upload",onClick:_=>ue(a.row),disabled:a.row.quoteStatus!=="draft"},{default:o(()=>t[19]||(t[19]=[n(" 提交审批 ")])),_:2,__:[19]},1032,["onClick","disabled"]),e(s,{size:"small",type:"danger",icon:"Delete",onClick:_=>K(a.row)},{default:o(()=>t[20]||(t[20]=[n(" 删除 ")])),_:2,__:[20]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[qe,S.value]]),$(e(_e,{total:C.value,page:i.pageNum,limit:i.pageSize,onPagination:V},null,8,["total","page","limit"]),[[X,C.value>0]]),e(ve,{title:z.value,modelValue:y.value,"onUpdate:modelValue":t[12]||(t[12]=a=>y.value=a),width:"800px","append-to-body":""},{footer:o(()=>[E("span",Ce,[e(s,{onClick:se},{default:o(()=>t[23]||(t[23]=[n("取消")])),_:1,__:[23]}),e(s,{type:"primary",onClick:de},{default:o(()=>t[24]||(t[24]=[n("保存")])),_:1,__:[24]}),e(s,{type:"success",onClick:ie,disabled:!l.quoteId},{default:o(()=>t[25]||(t[25]=[n("提交审批")])),_:1,__:[25]},8,["disabled"])])]),default:o(()=>[e(be,{modelValue:x.value,"onUpdate:modelValue":t[11]||(t[11]=a=>x.value=a)},{default:o(()=>[e(B,{label:"基本信息",name:"basic"},{default:o(()=>[e(L,{ref:"form",model:l,rules:j,"label-width":"120px"},{default:o(()=>[e(c,{label:"报价单号",prop:"quoteNumber"},{default:o(()=>[e(m,{modelValue:l.quoteNumber,"onUpdate:modelValue":t[3]||(t[3]=a=>l.quoteNumber=a),placeholder:"请输入报价单号",disabled:l.quoteId},null,8,["modelValue","disabled"])]),_:1}),e(c,{label:"客户名称",prop:"customerName"},{default:o(()=>[e(m,{modelValue:l.customerName,"onUpdate:modelValue":t[4]||(t[4]=a=>l.customerName=a),placeholder:"请输入客户名称"},null,8,["modelValue"])]),_:1}),e(c,{label:"联系人",prop:"contactPerson"},{default:o(()=>[e(m,{modelValue:l.contactPerson,"onUpdate:modelValue":t[5]||(t[5]=a=>l.contactPerson=a),placeholder:"请输入联系人"},null,8,["modelValue"])]),_:1}),e(c,{label:"联系电话",prop:"contactPhone"},{default:o(()=>[e(m,{modelValue:l.contactPhone,"onUpdate:modelValue":t[6]||(t[6]=a=>l.contactPhone=a),placeholder:"请输入联系电话"},null,8,["modelValue"])]),_:1}),e(c,{label:"报价日期",prop:"quoteDate"},{default:o(()=>[e(G,{modelValue:l.quoteDate,"onUpdate:modelValue":t[7]||(t[7]=a=>l.quoteDate=a),type:"date",placeholder:"请选择报价日期"},null,8,["modelValue"])]),_:1}),e(c,{label:"有效期至",prop:"validUntil"},{default:o(()=>[e(G,{modelValue:l.validUntil,"onUpdate:modelValue":t[8]||(t[8]=a=>l.validUntil=a),type:"date",placeholder:"请选择有效期至"},null,8,["modelValue"])]),_:1}),e(c,{label:"报价状态",prop:"quoteStatus"},{default:o(()=>[e(M,{modelValue:l.quoteStatus,"onUpdate:modelValue":t[9]||(t[9]=a=>l.quoteStatus=a),placeholder:"请选择报价状态"},{default:o(()=>[e(q,{label:"草稿",value:"draft"}),e(q,{label:"已提交",value:"submitted"})]),_:1},8,["modelValue"])]),_:1}),e(c,{label:"报价备注",prop:"remark"},{default:o(()=>[e(m,{modelValue:l.remark,"onUpdate:modelValue":t[10]||(t[10]=a=>l.remark=a),type:"textarea",placeholder:"请输入报价备注",rows:3},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1}),e(B,{label:"报价项",name:"items"},{default:o(()=>[E("div",Ue,[e(s,{type:"primary",icon:"Plus",size:"small",onClick:ne,style:{"margin-bottom":"10px"}},{default:o(()=>t[21]||(t[21]=[n(" 新增报价项 ")])),_:1,__:[21]}),e(O,{data:v.value,border:""},{default:o(()=>[e(d,{label:"产品名称",align:"center",prop:"productName"}),e(d,{label:"产品编码",align:"center",prop:"productCode"}),e(d,{label:"数量",align:"center",prop:"quantity"},{default:o(a=>[e(H,{modelValue:a.row.quantity,"onUpdate:modelValue":_=>a.row.quantity=_,min:1,size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(d,{label:"单价",align:"center",prop:"unitPrice"},{default:o(a=>[e(m,{modelValue:a.row.unitPrice,"onUpdate:modelValue":_=>a.row.unitPrice=_,type:"number",size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(d,{label:"折扣",align:"center",prop:"discount"},{default:o(a=>[e(H,{modelValue:a.row.discount,"onUpdate:modelValue":_=>a.row.discount=_,min:0,max:100,size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(d,{label:"金额",align:"center",prop:"itemAmount"},{default:o(a=>[n(g((a.row.quantity*a.row.unitPrice*(1-a.row.discount/100)).toFixed(2)),1)]),_:1}),e(d,{label:"操作",align:"center",width:"100"},{default:o(a=>[e(s,{size:"small",type:"danger",icon:"Delete",onClick:_=>re(a.row)},{default:o(()=>t[22]||(t[22]=[n(" 删除 ")])),_:2,__:[22]},1032,["onClick"])]),_:1})]),_:1},8,["data"])])]),_:1}),e(B,{label:"价格明细",name:"price"},{default:o(()=>[E("div",he,[e(fe,{column:1,border:""},{default:o(()=>[e(w,{label:"商品总价"},{default:o(()=>[n(g(k.value.toFixed(2)),1)]),_:1}),e(w,{label:"折扣金额"},{default:o(()=>[n(g(P.value.toFixed(2)),1)]),_:1}),e(w,{label:"运费"},{default:o(()=>[n(g(l.freightAmount.toFixed(2)),1)]),_:1}),e(w,{label:"税费"},{default:o(()=>[n(g(D.value.toFixed(2)),1)]),_:1}),e(w,{label:"最终总价"},{default:o(()=>[n(g(R.value.toFixed(2)),1)]),_:1})]),_:1})])]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["title","modelValue"])])}}},De=ge(Ie,[["__scopeId","data-v-e9e7b68e"]]);export{De as default};
