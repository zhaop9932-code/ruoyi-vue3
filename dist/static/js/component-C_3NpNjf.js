import{_ as ae,r as s,u as ue,C as x,w as re,o as de,h as u,G as ie,d as L,e as V,i as t,H as U,k as o,p as R,q as d,I as $,t as b,l as F,K as se,L as pe,j as K,V as f,E as ce}from"./index-CwdKQqOf.js";import{a as me,d as _e,u as fe,b as ge}from"./solution-D52F0zTE.js";import{listProduct as ve}from"./product-CtyH2BmW.js";const ye={class:"app-container"},be={class:"dialog-footer"},we={__name:"component",setup(Ie){const w=s(!0),I=s(!0),k=s(0),B=s([]),q=s([]),S=s(""),g=s(!1),v=s(null),M=ue(),r=x({pageNum:1,pageSize:10,componentCode:"",componentName:"",solutionId:M.query.solutionId||null}),n=x({componentId:null,solutionId:M.query.solutionId||null,productId:null,quantity:1,unitPrice:0,amount:0}),h=s([]),N=s(!1);s("");const T=x({productId:[{required:!0,message:"产品不能为空",trigger:"change"}],quantity:[{required:!0,message:"数量不能为空",trigger:"blur"}],unitPrice:[{required:!0,message:"单价不能为空",trigger:"blur"}]});re(()=>[n.quantity,n.unitPrice],([a,e])=>{n.amount=a*e});const Q=async(a="")=>{if(!a){h.value=[];return}N.value=!0;try{const e=await ve({productModel:a,pageNum:1,pageSize:10});h.value=e.rows.map(i=>({productId:i.productId,label:`${i.productCode} / ${i.productName} / ${i.productModel}`,value:i.productId}))}catch{f.error("获取产品列表失败")}finally{N.value=!1}},y=async()=>{w.value=!0;try{const a=await me(r);B.value=a.rows,k.value=a.total,w.value=!1}catch{w.value=!1,f.error("获取组件列表失败")}},C=()=>{r.pageNum=1,y()},j=()=>{r.componentCode="",r.componentName="",C()},A=()=>{I.value=!I.value},G=a=>{q.value=a},H=()=>{n.componentId=null,n.productId=null,n.quantity=1,n.unitPrice=0,n.amount=0,S.value="新增组件",g.value=!0},O=a=>{n.componentId=a.componentId,n.solutionId=a.solutionId,n.productId=a.productId,n.quantity=a.quantity,n.unitPrice=a.unitPrice,n.amount=a.amount,S.value="修改组件",g.value=!0},D=async a=>{const e=a.componentId?[a.componentId]:q.value.map(i=>i.componentId);await ce.confirm("确定要删除选中的组件吗？","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});try{await _e(e),f.success("删除成功"),y()}catch{f.error("删除失败")}},J=async()=>{if(v.value){await v.value.validate();try{n.componentId?(await fe(n),f.success("修改成功")):(await ge(n),f.success("新增成功")),g.value=!1,y()}catch(a){console.error("操作失败:",a),f.error("操作失败")}}},W=()=>{g.value=!1,v.value&&v.value.resetFields()};return de(()=>{y()}),(a,e)=>{const i=u("el-input"),_=u("el-form-item"),m=u("el-button"),E=u("el-form"),X=u("el-card"),P=u("el-col"),Y=u("el-row"),p=u("el-table-column"),Z=u("el-table"),ee=u("pagination"),te=u("el-option"),le=u("el-select"),z=u("el-input-number"),oe=u("el-dialog"),ne=ie("loading");return V(),L("div",ye,[t(X,{shadow:"never",class:"search-card"},{default:o(()=>[U(t(E,{model:r,ref:"queryForm",inline:!0,"label-width":"80px"},{default:o(()=>[t(_,{label:"组件编码",prop:"componentCode"},{default:o(()=>[t(i,{modelValue:r.componentCode,"onUpdate:modelValue":e[0]||(e[0]=l=>r.componentCode=l),placeholder:"请输入组件编码",clearable:"",size:"small",onKeyup:R(C,["enter"])},null,8,["modelValue"])]),_:1}),t(_,{label:"组件名称",prop:"componentName"},{default:o(()=>[t(i,{modelValue:r.componentName,"onUpdate:modelValue":e[1]||(e[1]=l=>r.componentName=l),placeholder:"请输入组件名称",clearable:"",size:"small",onKeyup:R(C,["enter"])},null,8,["modelValue"])]),_:1}),t(_,null,{default:o(()=>[t(m,{type:"primary",icon:"Search",size:"small",onClick:C},{default:o(()=>e[9]||(e[9]=[d("搜索")])),_:1,__:[9]}),t(m,{icon:"RefreshRight",size:"small",onClick:j},{default:o(()=>e[10]||(e[10]=[d("重置")])),_:1,__:[10]})]),_:1})]),_:1},8,["model"]),[[$,I.value]])]),_:1}),t(Y,{gutter:10,class:"mb8"},{default:o(()=>[t(P,{span:1.5},{default:o(()=>[t(m,{type:"primary",icon:"Plus",size:"small",onClick:H},{default:o(()=>e[11]||(e[11]=[d(" 新增组件 ")])),_:1,__:[11]})]),_:1}),t(P,{span:1.5},{default:o(()=>[t(m,{type:"danger",icon:"Delete",size:"small",disabled:q.value.length===0,onClick:D},{default:o(()=>e[12]||(e[12]=[d(" 批量删除 ")])),_:1,__:[12]},8,["disabled"])]),_:1}),t(P,{span:21},{default:o(()=>[t(m,{type:"info",icon:"Search",size:"small",onClick:A,style:{float:"right"}},{default:o(()=>[d(b(I.value?"收起":"展开")+"搜索 ",1)]),_:1})]),_:1})]),_:1}),U((V(),F(Z,{data:B.value,onSelectionChange:G,fit:""},{default:o(()=>[t(p,{type:"selection",width:"55",align:"center"}),t(p,{label:"产品编码",align:"center","show-overflow-tooltip":!0},{default:o(l=>{var c;return[d(b(((c=l.row.product)==null?void 0:c.productCode)||l.row.componentCode),1)]}),_:1}),t(p,{label:"产品名称",align:"center","show-overflow-tooltip":!0},{default:o(l=>{var c;return[d(b(((c=l.row.product)==null?void 0:c.productName)||l.row.componentName),1)]}),_:1}),t(p,{label:"Model",align:"center","show-overflow-tooltip":!0},{default:o(l=>{var c;return[d(b(((c=l.row.product)==null?void 0:c.productModel)||"-"),1)]}),_:1}),t(p,{label:"数量",align:"center",prop:"quantity"}),t(p,{label:"单价",align:"center",prop:"unitPrice"}),t(p,{label:"金额",align:"center",prop:"amount"}),t(p,{label:"创建人",align:"center",prop:"createBy"}),t(p,{label:"创建时间",align:"center",prop:"createTime",width:"180"}),t(p,{label:"操作",align:"center","class-name":"small-padding fixed-width",width:"150"},{default:o(l=>[t(m,{size:"small",type:"primary",icon:"Edit",onClick:c=>O(l.row)},{default:o(()=>e[13]||(e[13]=[d(" 编辑 ")])),_:2,__:[13]},1032,["onClick"]),t(m,{size:"small",type:"danger",icon:"Delete",onClick:c=>D(l.row)},{default:o(()=>e[14]||(e[14]=[d(" 删除 ")])),_:2,__:[14]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[ne,w.value]]),U(t(ee,{total:k.value,page:r.pageNum,"onUpdate:page":e[2]||(e[2]=l=>r.pageNum=l),limit:r.pageSize,"onUpdate:limit":e[3]||(e[3]=l=>r.pageSize=l),onPagination:y},null,8,["total","page","limit"]),[[$,k.value>0]]),t(oe,{title:S.value,modelValue:g.value,"onUpdate:modelValue":e[8]||(e[8]=l=>g.value=l),width:"600px","append-to-body":""},{footer:o(()=>[K("span",be,[t(m,{onClick:W},{default:o(()=>e[15]||(e[15]=[d("取消")])),_:1,__:[15]}),t(m,{type:"primary",onClick:J},{default:o(()=>e[16]||(e[16]=[d("确定")])),_:1,__:[16]})])]),default:o(()=>[t(E,{ref_key:"formRef",ref:v,model:n,rules:T,"label-width":"120px"},{default:o(()=>[t(_,{label:"型号选择",prop:"productId"},{default:o(()=>[t(le,{modelValue:n.productId,"onUpdate:modelValue":e[4]||(e[4]=l=>n.productId=l),placeholder:"请选择型号",filterable:"",remote:"","reserve-keyword":"","remote-method":Q,loading:N.value},{default:o(()=>[(V(!0),L(se,null,pe(h.value,l=>(V(),F(te,{key:l.productId,label:l.label,value:l.productId},{default:o(()=>[K("div",null,b(l.label),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1}),t(_,{label:"数量",prop:"quantity"},{default:o(()=>[t(z,{modelValue:n.quantity,"onUpdate:modelValue":e[5]||(e[5]=l=>n.quantity=l),min:.01,step:.01,placeholder:"请输入数量"},null,8,["modelValue"])]),_:1}),t(_,{label:"单价",prop:"unitPrice"},{default:o(()=>[t(z,{modelValue:n.unitPrice,"onUpdate:modelValue":e[6]||(e[6]=l=>n.unitPrice=l),min:.01,step:.01,placeholder:"请输入单价"},null,8,["modelValue"])]),_:1}),t(_,{label:"金额",prop:"amount"},{default:o(()=>[t(z,{modelValue:n.amount,"onUpdate:modelValue":e[7]||(e[7]=l=>n.amount=l),min:.01,step:.01,placeholder:"请输入金额",disabled:""},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])])}}},qe=ae(we,[["__scopeId","data-v-75fb69d1"]]);export{qe as default};
