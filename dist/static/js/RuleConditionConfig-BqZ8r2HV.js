import{_ as ve,r as j,h as X,a as f,c,o as n,b as e,w as a,q as z,N as U,e as p,z as _e,am as Y,t as k,f as A,F as g,s as h,G as N,ag as Z,m as _,an as be}from"./index-kbfDsxmo.js";import{d as L}from"./vuedraggable.umd-CWWwxWVR.js";import"./sortable.esm-DysyInFf.js";const me={class:"condition-config"},fe={class:"card-header"},ye={class:"header-actions"},Ve={class:"condition-count"},ge={class:"condition-config-type-buttons"},he={key:0,class:"empty-conditions"},ke=["onClick"],Ue={class:"condition-item-header"},Ce={class:"condition-index"},Te={class:"condition-config-type-tag"},xe={key:0,class:"condition-type-selector"},we={key:1,class:"complex-condition-actions"},Ae={key:0,class:"condition-item-content"},De={key:1,class:"complex-condition-content"},$e={class:"complex-condition-header"},Ne={class:"nested-conditions"},Se={class:"nested-condition-item"},je={class:"condition-item-header"},ze={class:"condition-index"},Oe={class:"condition-type-selector"},Re={class:"condition-item-content"},Pe={class:"ai-assist-content"},Be={key:0,class:"ai-suggestion"},Ie={class:"preview-content"},Fe={key:0},Je={__name:"RuleConditionConfig",props:{modelValue:{type:Array,default:()=>[]},ruleType:{type:String,default:"validation"}},emits:["update:modelValue","update:conditions"],setup(E,{emit:ee}){const J=E,q=ee,r=j([...J.modelValue]),G=j("number"),O=j(null),D=j(""),R=[{label:"数值条件",value:"number"},{label:"文本条件",value:"text"},{label:"选择条件",value:"select"},{label:"日期条件",value:"date"},{label:"布尔条件",value:"boolean"}],le=[{label:"简单条件",value:"simple"},{label:"复杂条件",value:"complex"}],P=[{label:"变量",value:"variable"},{label:"节点静态属性",value:"nodeStaticAttr"},{label:"节点动态属性",value:"nodeDynamicAttr"},{label:"节点产品",value:"nodeProduct"}],B=[{label:"节点1",value:"node1"},{label:"节点2",value:"node2"},{label:"节点3",value:"node3"},{label:"节点4",value:"node4"}],ae=[{label:"变量1",value:"var1"},{label:"变量2",value:"var2"},{label:"变量3",value:"var3"}],oe={node1:[{label:"属性1",value:"attr1"},{label:"属性2",value:"attr2"}],node2:[{label:"属性3",value:"attr3"},{label:"属性4",value:"attr4"}]},te={node1:[{label:"动态属性1",value:"dynAttr1"},{label:"动态属性2",value:"dynAttr2"}],node2:[{label:"动态属性3",value:"dynAttr3"},{label:"动态属性4",value:"dynAttr4"}]},ue={node1:[{label:"产品1",value:"prod1"},{label:"产品2",value:"prod2"}],node2:[{label:"产品3",value:"prod3"},{label:"产品4",value:"prod4"}]},M=s=>({number:[{label:"等于",value:"="},{label:"不等于",value:"!="},{label:"大于",value:">"},{label:"大于等于",value:">="},{label:"小于",value:"<"},{label:"小于等于",value:"<="},{label:"为空",value:"is_empty"},{label:"不为空",value:"is_not_empty"}],text:[{label:"等于",value:"="},{label:"不等于",value:"!="},{label:"包含",value:"contains"},{label:"不包含",value:"not_contains"},{label:"为空",value:"is_empty"},{label:"不为空",value:"is_not_empty"},{label:"开始于",value:"starts_with"},{label:"结束于",value:"ends_with"}],select:[{label:"等于",value:"="},{label:"不等于",value:"!="},{label:"在列表中",value:"in"},{label:"不在列表中",value:"not_in"}],date:[{label:"等于",value:"="},{label:"不等于",value:"!="},{label:"大于",value:">"},{label:"小于",value:"<"}],boolean:[{label:"等于",value:"="},{label:"不等于",value:"!="}]})[s]||[],H=(s,u)=>{switch(s){case"variable":return ae;case"nodeStaticAttr":return oe[u]||[];case"nodeDynamicAttr":return te[u]||[];case"nodeProduct":return ue[u]||[];default:return[]}},ne=(s,u)=>{O.value=s,G.value=u.type},de=(s,u)=>{r.value[s].type=u,O.value=s},se=(s=null,u=null)=>{const d=s||r.value,y={id:Date.now(),configType:"simple",type:G.value,judgeType:"variable",node:"",field:"",operator:"",value:"",logic:d.length>0?"AND":"",children:[]};u!==null?d.splice(u+1,0,y):d.push(y),C()},ie=()=>{const s={id:Date.now(),configType:"complex",logic:r.value.length>0?"AND":"",children:[{id:Date.now()+1,configType:"simple",type:"number",judgeType:"variable",node:"",field:"",operator:"",value:"",logic:""}]};r.value.push(s),C()},pe=s=>{s.children||(s.children=[]);const u={id:Date.now(),configType:"simple",type:"number",judgeType:"variable",node:"",field:"",operator:"",value:"",logic:s.children.length>0?"AND":""};s.children.push(u),C()},re=(s,u=null)=>{const d=u||r.value;d.splice(s,1),d.length>0&&(d[0].logic=""),C()},K=()=>{const s=u=>!u||u.length===0?"":u.map(d=>{var $,S;const y=d.logic?`${d.logic} `:"";if(d.configType==="complex"){const i=s(d.children);return`${y}(${i})`}else{const i=(($=P.find(T=>T.value===d.judgeType))==null?void 0:$.label)||d.judgeType,v=d.field||"field",b=d.operator||"=",m=typeof d.value=="string"?`"${d.value}"`:d.value;let V=v;if(d.judgeType!=="variable"){const T=((S=B.find(x=>x.value===d.node))==null?void 0:S.label)||d.node;V=`${i}[${T}].${v}`}else V=`${i}[${v}]`;return`${y}${V} ${b} ${m}`}}).join(" ");return s(r.value)},ce=async()=>{var s;if(r.value.length===0){D.value="请先添加条件，然后使用AI辅助配置";return}try{const u=K();await new Promise(d=>setTimeout(d,1e3)),D.value=`
# DeepSeek智能建议

## 当前条件分析
- 条件数量：${r.value.length}
- 条件表达式：${u}

## 优化建议
1. **字段选择优化**：建议根据业务需求选择更精确的字段
2. **操作符优化**：对于数值类型，建议使用更精确的操作符
3. **值范围优化**：建议设置合理的值范围
4. **逻辑关系优化**：建议优化逻辑关系，提高条件执行效率

## 推荐配置
- 推荐使用：${(s=R.find(d=>d.value===r.value[0].type))==null?void 0:s.label}
- 推荐字段：根据业务需求选择
- 推荐操作符：根据条件类型选择
- 推荐值：根据业务规则设置
    `}catch(u){console.error("DeepSeek API调用失败:",u),D.value="DeepSeek API调用失败，请稍后重试"}},C=()=>{q("update:modelValue",r.value),q("update:conditions",r.value)};return X(r,()=>{C()},{deep:!0}),X(()=>J.modelValue,s=>{JSON.stringify(s)!==JSON.stringify(r.value)&&(r.value=[...s])},{deep:!0}),(s,u)=>{const d=f("el-icon"),y=f("el-button"),$=f("el-empty"),S=f("el-tag"),i=f("el-option"),v=f("el-select"),b=f("el-form-item"),m=f("el-col"),V=f("el-row"),T=f("el-input-number"),x=f("el-input"),Q=f("el-date-picker"),W=f("el-form"),I=f("el-card");return n(),c("div",me,[e(I,{class:"condition-list",shadow:"hover"},{header:a(()=>[p("div",fe,[u[1]||(u[1]=p("span",null,"条件列表",-1)),p("div",ye,[p("span",Ve,k(r.value.length)+" 个条件",1),p("div",ge,[(n(),c(g,null,h(le,o=>e(y,{key:o.value,type:o.value==="simple"?"primary":"default",onClick:w=>o.value==="simple"?se():ie(),size:"small"},{default:a(()=>[e(d,null,{default:a(()=>[e(U(Z))]),_:1}),A(" "+k(o.label),1)]),_:2},1032,["type","onClick"])),64))])])])]),default:a(()=>[r.value.length===0?(n(),c("div",he,[e($,{description:"暂无条件"})])):z("",!0),e(U(L),{modelValue:r.value,"onUpdate:modelValue":u[0]||(u[0]=o=>r.value=o),"item-key":"id",handle:".drag-handle","ghost-class":"ghost"},{item:a(({element:o,index:w})=>[p("div",{class:_e(["condition-item",{"condition-item-selected":O.value===w,"complex-condition":o.configType==="complex"}]),onClick:l=>ne(w,o)},[p("div",Ue,[e(d,{class:"drag-handle"},{default:a(()=>[e(U(Y))]),_:1}),p("span",Ce,k(w+1),1),p("div",Te,[e(S,{type:o.configType==="complex"?"warning":"success"},{default:a(()=>[A(k(o.configType==="complex"?"复杂条件":"简单条件"),1)]),_:2},1032,["type"])]),o.configType==="simple"?(n(),c("div",xe,[(n(),c(g,null,h(R,l=>e(y,{key:l.value,type:o.type===l.value?"primary":"default",onClick:N(F=>de(w,l.value),["stop"]),size:"small"},{default:a(()=>[A(k(l.label),1)]),_:2},1032,["type","onClick"])),64))])):(n(),c("div",we,[e(y,{type:"success",size:"small",onClick:N(l=>pe(o),["stop"])},{default:a(()=>[e(d,null,{default:a(()=>[e(U(Z))]),_:1}),u[2]||(u[2]=A(" 添加子条件 "))]),_:2,__:[2]},1032,["onClick"])])),e(y,{type:"danger",size:"small",icon:"Delete",onClick:N(l=>re(w),["stop"])},null,8,["onClick"])]),o.configType==="simple"?(n(),c("div",Ae,[e(W,{model:o,"label-position":"top","label-width":"100px"},{default:a(()=>[e(V,{gutter:20},{default:a(()=>[e(m,{span:12},{default:a(()=>[e(b,{label:"判断类型"},{default:a(()=>[e(v,{modelValue:o.judgeType,"onUpdate:modelValue":l=>o.judgeType=l,placeholder:"请选择判断类型"},{default:a(()=>[(n(),c(g,null,h(P,l=>e(i,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),o.judgeType!=="variable"?(n(),_(m,{key:0,span:12},{default:a(()=>[e(b,{label:"节点"},{default:a(()=>[e(v,{modelValue:o.node,"onUpdate:modelValue":l=>o.node=l,placeholder:"请选择节点"},{default:a(()=>[(n(),c(g,null,h(B,l=>e(i,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)):z("",!0)]),_:2},1024),e(V,{gutter:20},{default:a(()=>[e(m,{span:12},{default:a(()=>[e(b,{label:"字段"},{default:a(()=>[e(v,{modelValue:o.field,"onUpdate:modelValue":l=>o.field=l,placeholder:"请选择字段"},{default:a(()=>[(n(!0),c(g,null,h(H(o.judgeType,o.node),l=>(n(),_(i,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),e(m,{span:12},{default:a(()=>[e(b,{label:"操作符"},{default:a(()=>[e(v,{modelValue:o.operator,"onUpdate:modelValue":l=>o.operator=l,placeholder:"请选择操作符"},{default:a(()=>[(n(!0),c(g,null,h(M(o.type),l=>(n(),_(i,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1024),e(V,{gutter:20},{default:a(()=>[e(m,{span:24},{default:a(()=>[e(b,{label:"值"},{default:a(()=>[o.type==="number"?(n(),_(T,{key:0,modelValue:o.value,"onUpdate:modelValue":l=>o.value=l,min:0,max:999999,step:1,placeholder:"请输入数值"},null,8,["modelValue","onUpdate:modelValue"])):o.type==="text"?(n(),_(x,{key:1,modelValue:o.value,"onUpdate:modelValue":l=>o.value=l,placeholder:"请输入文本"},null,8,["modelValue","onUpdate:modelValue"])):o.type==="select"?(n(),_(v,{key:2,modelValue:o.value,"onUpdate:modelValue":l=>o.value=l,placeholder:"请选择值"},{default:a(()=>[e(i,{label:"选项1",value:"option1"}),e(i,{label:"选项2",value:"option2"}),e(i,{label:"选项3",value:"option3"})]),_:2},1032,["modelValue","onUpdate:modelValue"])):o.type==="date"?(n(),_(Q,{key:3,modelValue:o.value,"onUpdate:modelValue":l=>o.value=l,type:"datetime",placeholder:"选择日期时间"},null,8,["modelValue","onUpdate:modelValue"])):(n(),_(x,{key:4,modelValue:o.value,"onUpdate:modelValue":l=>o.value=l,placeholder:"请输入值"},null,8,["modelValue","onUpdate:modelValue"]))]),_:2},1024)]),_:2},1024)]),_:2},1024),e(V,{gutter:20},{default:a(()=>[e(m,{span:24},{default:a(()=>[e(b,{label:"逻辑关系"},{default:a(()=>[e(v,{modelValue:o.logic,"onUpdate:modelValue":l=>o.logic=l,placeholder:"请选择逻辑关系"},{default:a(()=>[e(i,{label:"并且 (AND)",value:"AND"}),e(i,{label:"或者 (OR)",value:"OR"})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["model"])])):(n(),c("div",De,[p("div",$e,[u[3]||(u[3]=p("span",{class:"complex-condition-title"},"嵌套条件组",-1)),e(b,{label:"组逻辑关系",inline:""},{default:a(()=>[e(v,{modelValue:o.logic,"onUpdate:modelValue":l=>o.logic=l,placeholder:"请选择逻辑关系"},{default:a(()=>[e(i,{label:"并且 (AND)",value:"AND"}),e(i,{label:"或者 (OR)",value:"OR"})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),p("div",Ne,[e(U(L),{modelValue:o.children,"onUpdate:modelValue":l=>o.children=l,"item-key":"id",handle:".drag-handle","ghost-class":"ghost"},{item:a(({element:l,index:F})=>[p("div",Se,[p("div",je,[e(d,{class:"drag-handle"},{default:a(()=>[e(U(Y))]),_:1}),p("span",ze,k(F+1),1),p("div",Oe,[(n(),c(g,null,h(R,t=>e(y,{key:t.value,type:l.type===t.value?"primary":"default",onClick:N(qe=>l.type=t.value,["stop"]),size:"small"},{default:a(()=>[A(k(t.label),1)]),_:2},1032,["type","onClick"])),64))]),e(y,{type:"danger",size:"small",icon:"Delete",onClick:N(t=>{o.children.splice(F,1),C()},["stop"])},null,8,["onClick"])]),p("div",Re,[e(W,{model:l,"label-position":"top","label-width":"100px"},{default:a(()=>[e(V,{gutter:20},{default:a(()=>[e(m,{span:12},{default:a(()=>[e(b,{label:"判断类型"},{default:a(()=>[e(v,{modelValue:l.judgeType,"onUpdate:modelValue":t=>l.judgeType=t,placeholder:"请选择判断类型"},{default:a(()=>[(n(),c(g,null,h(P,t=>e(i,{key:t.value,label:t.label,value:t.value},null,8,["label","value"])),64))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),l.judgeType!=="variable"?(n(),_(m,{key:0,span:12},{default:a(()=>[e(b,{label:"节点"},{default:a(()=>[e(v,{modelValue:l.node,"onUpdate:modelValue":t=>l.node=t,placeholder:"请选择节点"},{default:a(()=>[(n(),c(g,null,h(B,t=>e(i,{key:t.value,label:t.label,value:t.value},null,8,["label","value"])),64))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)):z("",!0)]),_:2},1024),e(V,{gutter:20},{default:a(()=>[e(m,{span:12},{default:a(()=>[e(b,{label:"字段"},{default:a(()=>[e(v,{modelValue:l.field,"onUpdate:modelValue":t=>l.field=t,placeholder:"请选择字段"},{default:a(()=>[(n(!0),c(g,null,h(H(l.judgeType,l.node),t=>(n(),_(i,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),e(m,{span:12},{default:a(()=>[e(b,{label:"操作符"},{default:a(()=>[e(v,{modelValue:l.operator,"onUpdate:modelValue":t=>l.operator=t,placeholder:"请选择操作符"},{default:a(()=>[(n(!0),c(g,null,h(M(l.type),t=>(n(),_(i,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1024),e(V,{gutter:20},{default:a(()=>[e(m,{span:24},{default:a(()=>[e(b,{label:"值"},{default:a(()=>[l.type==="number"?(n(),_(T,{key:0,modelValue:l.value,"onUpdate:modelValue":t=>l.value=t,min:0,max:999999,step:1,placeholder:"请输入数值"},null,8,["modelValue","onUpdate:modelValue"])):l.type==="text"?(n(),_(x,{key:1,modelValue:l.value,"onUpdate:modelValue":t=>l.value=t,placeholder:"请输入文本"},null,8,["modelValue","onUpdate:modelValue"])):l.type==="select"?(n(),_(v,{key:2,modelValue:l.value,"onUpdate:modelValue":t=>l.value=t,placeholder:"请选择值"},{default:a(()=>[e(i,{label:"选项1",value:"option1"}),e(i,{label:"选项2",value:"option2"}),e(i,{label:"选项3",value:"option3"})]),_:2},1032,["modelValue","onUpdate:modelValue"])):l.type==="date"?(n(),_(Q,{key:3,modelValue:l.value,"onUpdate:modelValue":t=>l.value=t,type:"datetime",placeholder:"选择日期时间"},null,8,["modelValue","onUpdate:modelValue"])):(n(),_(x,{key:4,modelValue:l.value,"onUpdate:modelValue":t=>l.value=t,placeholder:"请输入值"},null,8,["modelValue","onUpdate:modelValue"]))]),_:2},1024)]),_:2},1024)]),_:2},1024),e(V,{gutter:20},{default:a(()=>[e(m,{span:24},{default:a(()=>[e(b,{label:"逻辑关系"},{default:a(()=>[e(v,{modelValue:l.logic,"onUpdate:modelValue":t=>l.logic=t,placeholder:"请选择逻辑关系"},{default:a(()=>[e(i,{label:"并且 (AND)",value:"AND"}),e(i,{label:"或者 (OR)",value:"OR"})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["model"])])])]),_:2},1032,["modelValue","onUpdate:modelValue"])])]))],10,ke)]),_:1},8,["modelValue"])]),_:1}),e(I,{class:"ai-assist",shadow:"hover"},{header:a(()=>u[4]||(u[4]=[p("div",{class:"card-header"},[p("span",null,"AI辅助配置")],-1)])),default:a(()=>[p("div",Pe,[e(y,{type:"primary",size:"small",onClick:ce},{default:a(()=>[e(d,null,{default:a(()=>[e(U(be))]),_:1}),u[5]||(u[5]=A(" 使用DeepSeek智能调整条件 "))]),_:1,__:[5]}),D.value?(n(),c("div",Be,[u[6]||(u[6]=p("h4",null,"DeepSeek建议：",-1)),p("pre",null,k(D.value),1)])):z("",!0)])]),_:1}),e(I,{class:"condition-preview",shadow:"hover"},{header:a(()=>u[7]||(u[7]=[p("div",{class:"card-header"},[p("span",null,"条件预览")],-1)])),default:a(()=>[p("div",Ie,[r.value.length>0?(n(),c("pre",Fe,k(K()),1)):(n(),_($,{key:1,description:"暂无条件预览"}))])]),_:1})])}}},Ke=ve(Je,[["__scopeId","data-v-b87bc058"]]);export{Ke as default};
