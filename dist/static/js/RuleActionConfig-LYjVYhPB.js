import{_ as U,r as f,H as x,E as u,h as q,a as m,c as E,o as V,b as l,w as d,k as P,l as y,e as h,f as N,D as z,K as J}from"./index-DgigFOm-.js";import{d as M}from"./vuedraggable.umd-B409vRHe.js";import O from"./RuleActionItem-DhAQO5kb.js";import{l as $,s as H}from"./ruleAction-CXds5VRx.js";import"./sortable.esm-CAlIhjx7.js";import"./ActionHeader-0K2-qy4i.js";import"./ActionContent-BOqNEGN_.js";import"./ActionTypeSelector-DMQg9yzW.js";import"./actionConfig-C-hhf0v-.js";import"./TargetTypeSelector-CLltoMlE.js";import"./TargetObjectSelector-Bt4flkLc.js";import"./NodeSelector-DEupmx4h.js";import"./superBomStructure-C2O6seWy.js";import"./AttributeSelector-CyYPhvVA.js";import"./bom-CjuVRwkz.js";import"./superBomDynamicAttribute-6n4Uab6m.js";import"./superBomProductRelation-c5nmns4w.js";import"./index-DAib79Lj.js";import"./superBomVariable-_jqz_F6y.js";import"./ActionParamsConfig-Dhc9pdhZ.js";import"./BasicInfoSection-Cpw6sxwq.js";const K={class:"rule-action-config"},j={class:"card-header"},F={class:"header-buttons"},G={key:0,class:"empty-actions"},L={__name:"RuleActionConfig",props:{modelValue:{type:Array,default:()=>[]},ruleType:{type:String,default:"validation"},ruleId:{type:[String,Number],default:null},bomId:{type:[String,Number],required:!0}},emits:["update:modelValue","update:actions"],setup(I,{emit:C}){const s=I,b=C,a=f([...s.modelValue]),c=f(null),v=f(null);x(()=>s.modelValue,e=>{JSON.stringify(e)!==JSON.stringify(a.value)&&(a.value=[...e])},{deep:!0}),x(()=>s.ruleId,e=>{e&&A(e)});const A=async e=>{var t,n;try{const o=await $(e);a.value=o.data||[],a.value.forEach(r=>{r.structure=r.structure||null,r.attribute=r.attribute||null,r.dynamicAttribute=r.dynamicAttribute||null}),i()}catch(o){console.error("加载动作失败:",o),u.error("加载动作失败："+(((n=(t=o.response)==null?void 0:t.data)==null?void 0:n.message)||o.message||"未知错误"))}};q(()=>{s.ruleId&&A(s.ruleId)});const S=(e,t)=>{a.value[e]=t,i()},k=async e=>{var t,n;try{const o=a.value[e];o.actionId&&console.log("删除动作:",o.actionId),a.value.splice(e,1),u.success("动作删除成功"),i()}catch(o){console.error("删除动作失败:",o),u.error("删除动作失败："+(((n=(t=o.response)==null?void 0:t.data)==null?void 0:n.message)||o.message||"未知错误"))}},T=e=>{e.actionId===c.value?c.value=null:(c.value=e.actionId,v.value=null)},w=()=>{const e={actionId:null,ruleId:s.ruleId,actionType:"",actionName:"",actionCode:"",targetType:"",targetId:"",actionParams:"",actionPriority:1,parentActionId:null,actionSequence:a.value.length+1,executeCondition:'{"type": "always"}',actionStatus:"0",description:""};a.value.push(e),c.value=null,v.value=a.value.length-1,i()},R=async()=>{var e,t;try{await H(Number(s.ruleId),a.value),u.success("动作列表保存成功"),i()}catch(n){console.error("保存动作列表失败:",n),u.error("保存动作列表失败："+(((t=(e=n.response)==null?void 0:e.data)==null?void 0:t.message)||n.message||"未知错误"))}},i=()=>{b("update:modelValue",a.value),b("update:actions",a.value)},B=()=>{a.value.forEach((e,t)=>{e.actionSequence=t+1}),i()};return(e,t)=>{const n=m("el-icon"),o=m("el-button"),r=m("el-empty"),D=m("el-card");return V(),E("div",K,[l(D,{class:"action-chain",shadow:"hover"},{header:d(()=>[h("div",j,[t[3]||(t[3]=h("span",null,"动作执行链",-1)),h("div",F,[l(o,{type:"success",size:"small",onClick:R,disabled:!s.ruleId},{default:d(()=>[l(n,null,{default:d(()=>[l(y(z))]),_:1}),t[1]||(t[1]=N(" 保存动作列表 "))]),_:1,__:[1]},8,["disabled"]),l(o,{type:"primary",size:"small",onClick:w},{default:d(()=>[l(n,null,{default:d(()=>[l(y(J))]),_:1}),t[2]||(t[2]=N(" 添加动作 "))]),_:1,__:[2]})])])]),default:d(()=>[a.value.length===0?(V(),E("div",G,[l(r,{description:"暂无动作"})])):P("",!0),l(y(M),{modelValue:a.value,"onUpdate:modelValue":t[0]||(t[0]=p=>a.value=p),"item-key":"actionId",handle:".drag-handle","ghost-class":"ghost",onEnd:B},{item:d(({element:p,index:g})=>[l(O,{element:p,index:g,"expanded-action-id":c.value,"expanded-action-index":v.value,"bom-id":I.bomId,"onUpdate:element":_=>S(g,_),onDeleteAction:_=>k(g),onToggleExpand:_=>T(p)},null,8,["element","index","expanded-action-id","expanded-action-index","bom-id","onUpdate:element","onDeleteAction","onToggleExpand"])]),_:1},8,["modelValue"])]),_:1})])}}},_e=U(L,[["__scopeId","data-v-b82051d7"]]);export{_e as default};
