import{g as ae,u as le}from"./superBomDynamicAttribute-6n4Uab6m.js";import{_ as re,r as g,$ as x,H as B,h as oe,a as n,i as ue,c as z,o as f,e as V,b as e,w as r,f as d,j as ne,m as P,t as S,k as se,F as M,n as R,E as b}from"./index-DgigFOm-.js";const ie={class:"bom-node-dynamic-props"},de={class:"dynamic-props-header"},pe={class:"dynamic-props-content"},me={class:"table-footer"},ce={class:"dialog-footer"},be={__name:"BomNodeDynamicProps",props:{bomId:{type:[String,Number],required:!0},bomStructureId:{type:[String,Number],default:null}},setup(D){const p=D,_=g(!1),y=g([]),h=g([]),v=g(!1),U=g("编辑动态属性"),q=g(null),o=x({id:null,bomStructureId:p.bomStructureId,attributeId:null,attributeCode:"",attributeName:"",attributeType:"",componentType:"",sourceType:null,sourceId:null,attributeValues:[],isRequired:"0",defaultValue:"",sortOrder:100}),A=x({attributeName:[{required:!0,message:"属性名称不能为空",trigger:"blur"}],attributeType:[{required:!0,message:"请选择属性类型",trigger:"change"}],componentType:[{required:!0,message:"请选择组件类型",trigger:"change"}],sortOrder:[{required:!0,message:"请输入排序",trigger:"blur"},{type:"number",min:0,message:"排序必须大于等于0",trigger:"blur"}]}),s=x({currentPage:1,pageSize:10,total:0}),O=t=>({0:"文本",1:"数值",2:"下拉",3:"单选",4:"多选"})[t]||t,E=t=>({0:"primary",1:"success",2:"warning",3:"info",4:"danger"})[t]||"primary",F=t=>({1:"产品",2:"系列",3:"分类"})[t]||t,j=t=>({1:"primary",2:"success",3:"warning"})[t]||"primary",L=t=>{if(!t)return[];if(typeof t=="string")try{const a=JSON.parse(t);return Array.isArray(a)?a:[a]}catch{return[t]}return[t]},$=t=>{h.value=t},m=async()=>{if(!p.bomStructureId){y.value=[];return}_.value=!0;try{const t=await ae(p.bomStructureId);t&&Array.isArray(t.data)?(y.value=t.data,s.total=t.data.length):t&&t.rows?(y.value=t.rows,s.total=t.total||t.rows.length):(y.value=[],s.total=0)}catch(t){console.error("加载动态属性失败:",t),b.error("加载动态属性失败"),y.value=[],s.total=0}finally{_.value=!1}};B(()=>p.bomStructureId,t=>{m()});const H=t=>{s.pageSize=t,m()},J=t=>{s.currentPage=t,m()},G=async()=>{if(!p.bomStructureId){b.warning("请先选择BOM节点");return}try{_.value=!0,await m(),b.success("动态属性刷新成功")}catch(t){console.error("刷新动态属性失败:",t),b.error("刷新动态属性失败")}finally{_.value=!1}},K=()=>{if(h.value.length!==1){b.warning("请选择一个动态属性进行编辑");return}const t=h.value[0];Object.assign(o,{...t,bomStructureId:p.bomStructureId}),v.value=!0},Q=async()=>{try{await q.value.validate(),await le(o),await m(),b.success("动态属性更新成功"),v.value=!1}catch(t){t!==!1&&(b.error("操作失败，请检查表单数据"),console.error("提交动态属性表单失败:",t))}};return B(()=>p.bomStructureId,t=>{o.bomStructureId=t,m()}),oe(()=>{m()}),(t,a)=>{const T=n("el-button"),i=n("el-table-column"),w=n("el-tag"),W=n("el-table"),X=n("el-pagination"),I=n("el-input"),c=n("el-form-item"),u=n("el-option"),N=n("el-select"),Y=n("el-input-number"),Z=n("el-form"),ee=n("el-dialog"),te=ue("loading");return f(),z("div",ie,[V("div",de,[a[13]||(a[13]=V("h4",null,"动态属性管理",-1)),e(T,{type:"primary",icon:"Edit",onClick:K,disabled:h.value.length!==1},{default:r(()=>a[11]||(a[11]=[d("编辑")])),_:1,__:[11]},8,["disabled"]),e(T,{type:"primary",icon:"Refresh",onClick:G},{default:r(()=>a[12]||(a[12]=[d("刷新")])),_:1,__:[12]})]),V("div",pe,[ne((f(),P(W,{data:y.value,border:"",style:{width:"100%"},onSelectionChange:$},{default:r(()=>[e(i,{type:"selection",width:"55"}),e(i,{prop:"attributeId",label:"属性ID",width:"120"}),e(i,{prop:"attributeName",label:"属性名称",width:"180"}),e(i,{prop:"attributeCode",label:"属性编码",width:"180"}),e(i,{prop:"attributeType",label:"属性类型",width:"120"},{default:r(l=>[e(w,{type:E(l.row.attributeType)},{default:r(()=>[d(S(O(l.row.attributeType)),1)]),_:2},1032,["type"])]),_:1}),e(i,{prop:"componentType",label:"组件类型",width:"120"}),e(i,{prop:"attributeValues",label:"属性值",width:"250"},{default:r(l=>[Array.isArray(l.row.attributeValues)?(f(!0),z(M,{key:0},R(l.row.attributeValues,(C,k)=>(f(),P(w,{key:k,type:"info",size:"small",style:{"margin-right":"4px","margin-bottom":"4px"}},{default:r(()=>[d(S(C.valueName||C),1)]),_:2},1024))),128)):l.row.attributeValues?(f(!0),z(M,{key:1},R(L(l.row.attributeValues),(C,k)=>(f(),P(w,{key:k,type:"info",size:"small",style:{"margin-right":"4px","margin-bottom":"4px"}},{default:r(()=>[d(S(C),1)]),_:2},1024))),128)):se("",!0)]),_:1}),e(i,{prop:"sourceType",label:"来源类型",width:"100"},{default:r(l=>[e(w,{type:j(l.row.sourceType)},{default:r(()=>[d(S(F(l.row.sourceType)),1)]),_:2},1032,["type"])]),_:1}),e(i,{prop:"isRequired",label:"是否必填",width:"100"},{default:r(l=>[e(w,{type:l.row.isRequired==="1"?"success":"warning"},{default:r(()=>[d(S(l.row.isRequired==="1"?"必填":"可选"),1)]),_:2},1032,["type"])]),_:1}),e(i,{prop:"defaultValue",label:"默认值",width:"120"}),e(i,{prop:"sortOrder",label:"排序",width:"100"})]),_:1},8,["data"])),[[te,_.value]]),V("div",me,[e(X,{"current-page":s.currentPage,"onUpdate:currentPage":a[0]||(a[0]=l=>s.currentPage=l),"page-size":s.pageSize,"onUpdate:pageSize":a[1]||(a[1]=l=>s.pageSize=l),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:s.total,onSizeChange:H,onCurrentChange:J},null,8,["current-page","page-size","total"])])]),e(ee,{title:U.value,modelValue:v.value,"onUpdate:modelValue":a[10]||(a[10]=l=>v.value=l),width:"600px","append-to-body":""},{footer:r(()=>[V("span",ce,[e(T,{onClick:a[9]||(a[9]=l=>v.value=!1)},{default:r(()=>a[14]||(a[14]=[d("取消")])),_:1,__:[14]}),e(T,{type:"primary",onClick:Q},{default:r(()=>a[15]||(a[15]=[d("确定")])),_:1,__:[15]})])]),default:r(()=>[e(Z,{ref_key:"propFormRef",ref:q,model:o,rules:A,"label-width":"120px"},{default:r(()=>[e(c,{label:"属性名称",prop:"attributeName"},{default:r(()=>[e(I,{modelValue:o.attributeName,"onUpdate:modelValue":a[2]||(a[2]=l=>o.attributeName=l),placeholder:"请输入属性名称",disabled:""},null,8,["modelValue"])]),_:1}),e(c,{label:"属性编码",prop:"attributeCode"},{default:r(()=>[e(I,{modelValue:o.attributeCode,"onUpdate:modelValue":a[3]||(a[3]=l=>o.attributeCode=l),placeholder:"请输入属性编码",disabled:""},null,8,["modelValue"])]),_:1}),e(c,{label:"属性类型",prop:"attributeType"},{default:r(()=>[e(N,{modelValue:o.attributeType,"onUpdate:modelValue":a[4]||(a[4]=l=>o.attributeType=l),placeholder:"请选择属性类型",disabled:""},{default:r(()=>[e(u,{label:"文本",value:"0"}),e(u,{label:"数值",value:"1"}),e(u,{label:"下拉",value:"2"}),e(u,{label:"单选",value:"3"}),e(u,{label:"多选",value:"4"})]),_:1},8,["modelValue"])]),_:1}),e(c,{label:"组件类型",prop:"componentType"},{default:r(()=>[e(N,{modelValue:o.componentType,"onUpdate:modelValue":a[5]||(a[5]=l=>o.componentType=l),placeholder:"请选择组件类型"},{default:r(()=>[e(u,{label:"单行文本输入框",value:"input"}),e(u,{label:"多行文本输入框",value:"textarea"}),e(u,{label:"下拉单选",value:"select"}),e(u,{label:"下拉多选",value:"multiple-select"}),e(u,{label:"单选框组",value:"radio"}),e(u,{label:"多选框组",value:"checkbox"}),e(u,{label:"滑块",value:"slider"}),e(u,{label:"开关",value:"switch"})]),_:1},8,["modelValue"])]),_:1}),e(c,{label:"是否必填",prop:"isRequired"},{default:r(()=>[e(N,{modelValue:o.isRequired,"onUpdate:modelValue":a[6]||(a[6]=l=>o.isRequired=l),placeholder:"请选择是否必填"},{default:r(()=>[e(u,{label:"可选",value:"0"}),e(u,{label:"必填",value:"1"})]),_:1},8,["modelValue"])]),_:1}),e(c,{label:"默认值",prop:"defaultValue"},{default:r(()=>[e(I,{modelValue:o.defaultValue,"onUpdate:modelValue":a[7]||(a[7]=l=>o.defaultValue=l),placeholder:"请输入默认值"},null,8,["modelValue"])]),_:1}),e(c,{label:"排序",prop:"sortOrder"},{default:r(()=>[e(Y,{modelValue:o.sortOrder,"onUpdate:modelValue":a[8]||(a[8]=l=>o.sortOrder=l),min:0,step:1,placeholder:"请输入排序"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])])}}},fe=re(be,[["__scopeId","data-v-fefbdbcf"]]);export{fe as default};
