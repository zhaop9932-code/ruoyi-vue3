import{x as W,_ as xe,r as I,h as Q,i as De,E as w,a as A,c as V,o as c,b as o,w as n,q as $,N as S,e as y,z as Oe,am as ge,t as B,f as D,F as T,s as N,G as J,ag as be,m as b,an as Pe,ao as Re}from"./index-a6CENfl-.js";import{d as _e}from"./vuedraggable.umd-Bj5WI46O.js";import{q as Me,i as Fe}from"./bom-DGXmvyiB.js";import{getSuperBomVariableByBomId as Le}from"./superBomVariable-Ceo8RH4L.js";import{g as ze}from"./superBomDynamicAttribute-DgrCBxow.js";import{g as qe}from"./superBomProductRelation-MzD24d2B.js";import"./sortable.esm-FPj9zfT8.js";function Je(U){return W({url:`/cpq/superBomStructure/listByBomId/${U}`,method:"get"})}function Ge(U){return W({url:"/cpq/ruleCondition",method:"post",data:U})}function He(U){return W({url:`/cpq/ruleCondition/listByRuleId/${U}`,method:"get"})}function Ke(U){return W({url:"/cpq/ruleCondition",method:"put",data:U})}const Qe={class:"condition-config"},We={class:"card-header"},Xe={class:"header-actions"},Ye={class:"condition-count"},Ze={class:"condition-config-type-buttons"},Ee={key:0,class:"empty-conditions"},el=["onClick"],ll={class:"condition-item-header"},al={class:"condition-index"},tl={class:"condition-config-type-tag"},ol={key:0,class:"condition-type-selector"},nl={key:1,class:"complex-condition-actions"},rl={key:0,class:"condition-item-content"},ul={key:1,class:"complex-condition-content"},dl={class:"complex-condition-header"},sl={class:"nested-conditions"},il={class:"nested-condition-item"},cl={class:"condition-item-header"},pl={class:"condition-index"},vl={class:"condition-type-selector"},fl={class:"condition-item-content"},yl={class:"ai-assist-content"},gl={key:0,class:"ai-suggestion"},bl={class:"preview-content"},_l={key:0},ml={__name:"RuleConditionConfig",props:{modelValue:{type:Array,default:()=>[]},ruleType:{type:String,default:"validation"},bomId:{type:[String,Number],default:null},ruleId:{type:[String,Number],default:null}},emits:["update:modelValue","update:conditions"],setup(U,{emit:me}){const m=U,ne=me,g=I([...m.modelValue]),re=I("number"),X=I(null),F=I(""),Y=[{label:"数值条件",value:"number"},{label:"文本条件",value:"text"},{label:"选择条件",value:"select"},{label:"布尔条件",value:"boolean"}],he=[{label:"简单条件",value:"simple"},{label:"复杂条件",value:"complex"}],Z=[{label:"变量",value:"variable"},{label:"节点静态属性",value:"nodeStaticAttr"},{label:"节点动态属性",value:"nodeDynamicAttr"},{label:"节点产品",value:"nodeProduct"}],G=I([]),L=I([]),z=I([]),H=I(!1),ue={value:"bomStructureId",label:"nodeName",children:"children",multiple:!1,checkStrictly:!1,emitPath:!1},de=async()=>{if(!m.bomId){console.warn("BOM ID为空，无法加载节点");return}H.value=!0;try{console.log("开始加载BOM节点，bomId:",m.bomId);const e=await Je(m.bomId);console.log("API响应:",e);let l=[];if(Array.isArray(e))l=e;else if(e.data&&Array.isArray(e.data))l=e.data;else if(e.rows&&Array.isArray(e.rows))l=e.rows;else{console.warn("未知的响应格式:",e),w.warning("BOM节点数据格式错误");return}console.log("处理后的数据:",l),L.value=Ve(l),console.log("树形结构:",L.value);const r=(d,t="")=>{let p=[];return d.forEach(i=>{const v=t?`${t} > ${i.nodeName}`:i.nodeName;console.log("处理节点:",i,"标签:",v),p.push({label:v,value:i.bomStructureId}),i.children&&i.children.length>0&&(p=p.concat(r(i.children,v)))}),p};G.value=r(L.value),z.value=L.value,console.log("下拉选项:",G.value),console.log("级联选项:",z.value),G.value.length===0&&(console.warn("没有找到BOM节点数据"),w.info("当前BOM没有节点数据"))}catch(e){console.error("加载BOM节点失败:",e),w.error("加载BOM节点失败")}finally{H.value=!1}},Ve=e=>{if(!Array.isArray(e)||e.length===0)return[];const l=[],r=new Map;return e.forEach(d=>{r.set(d.bomStructureId,{...d,children:[]})}),e.forEach(d=>{const t=r.get(d.bomStructureId),p=d.parentNodeId||0;p===0||!r.has(p)?l.push(t):r.get(p).children.push(t)}),l};Q(()=>m.bomId,e=>{e?(de(),ce()):(G.value=[],L.value=[],j.value=[])}),Q(()=>m.ruleId,e=>{e?se(e):g.value=[...m.modelValue]});const se=async e=>{if(e)try{const l=await He(e);l.code===200?g.value=l.data||[]:w.error("加载条件失败："+l.message)}catch(l){console.error("加载条件失败:",l),w.error("加载条件失败")}},ie=e=>{console.log("节点选择变化:",e.node),e.field="",e.value="",e.node&&(_.value.staticAttrs.delete(e.node),_.value.dynamicAttrs.delete(e.node),_.value.products.delete(e.node)),e.judgeType!=="variable"&&e.node&&E(e.judgeType,e.node)},E=async(e,l,r)=>{if(l){K.value=!0;try{switch(e){case"nodeStaticAttr":await Ae(l);break;case"nodeDynamicAttr":await Ce(l);break;case"nodeProduct":await ke(l);break}}catch(d){console.error("加载字段数据失败:",d),w.error("加载字段数据失败")}finally{K.value=!1,console.log("字段数据加载完成，当前节点字段数:",le(e,l).length)}}},Ae=async e=>{if(!_.value.staticAttrs.has(e))try{const l=await Fe(e);let r=[];Array.isArray(l)?r=l:l.data&&(Array.isArray(l.data)?r=l.data:l.data.rows&&Array.isArray(l.data.rows)&&(r=l.data.rows)),console.log("加载静态属性成功，数量:",r.length);const d=r.map(t=>({label:t.attributeName,value:t.attributeCode||t.attributeName,...t}));_.value.staticAttrs.set(e,d)}catch(l){console.error("加载静态属性失败:",l),_.value.staticAttrs.set(e,[])}},Ce=async e=>{if(!_.value.dynamicAttrs.has(e))try{const l=await ze(e);let r=[];Array.isArray(l)?r=l:l.data&&(Array.isArray(l.data)?r=l.data:l.data.rows&&Array.isArray(l.data.rows)&&(r=l.data.rows)),console.log("加载动态属性成功，数量:",r.length);const d=r.map(t=>({label:t.attributeName,value:t.attributeCode||t.attributeName,...t}));_.value.dynamicAttrs.set(e,d)}catch(l){console.error("加载动态属性失败:",l),_.value.dynamicAttrs.set(e,[])}},ke=async e=>{if(!_.value.products.has(e))try{const l=await qe({bomId:m.bomId,bomStructureId:e});let r=[];Array.isArray(l)?r=l:l.data&&(Array.isArray(l.data)?r=l.data:l.data.rows&&Array.isArray(l.data.rows)&&(r=l.data.rows)),console.log("加载产品字段成功，数量:",r.length);const d=[];r.forEach(t=>{d.push({label:t.relationObjectName,value:t.relationObjectId})}),_.value.products.set(e,d)}catch(l){console.error("加载产品字段失败:",l),_.value.products.set(e,[])}};De(()=>{m.bomId&&(de(),ce()),m.ruleId&&se(m.ruleId)});const _=I({staticAttrs:new Map,dynamicAttrs:new Map,products:new Map}),K=I(!1),j=I([]),ce=async()=>{if(!m.bomId){j.value=[];return}try{const e=await Le(m.bomId);e.data&&Array.isArray(e.data)?j.value=e.data.map(l=>({label:l.variableName,value:l.variableCode})):j.value=[]}catch(e){console.error("加载变量列表失败:",e),j.value=[],w.error("加载变量列表失败")}},ee=e=>({number:[{label:"等于",value:"="},{label:"不等于",value:"!="},{label:"大于",value:">"},{label:"大于等于",value:">="},{label:"小于",value:"<"},{label:"小于等于",value:"<="},{label:"为空",value:"is_empty"},{label:"不为空",value:"is_not_empty"}],text:[{label:"等于",value:"="},{label:"不等于",value:"!="},{label:"包含",value:"contains"},{label:"不包含",value:"not_contains"},{label:"为空",value:"is_empty"},{label:"不为空",value:"is_not_empty"},{label:"开始于",value:"starts_with"},{label:"结束于",value:"ends_with"}],select:[{label:"等于",value:"="},{label:"不等于",value:"!="},{label:"在列表中",value:"in"},{label:"不在列表中",value:"not_in"}],date:[{label:"等于",value:"="},{label:"不等于",value:"!="},{label:"大于",value:">"},{label:"小于",value:"<"}],boolean:[{label:"等于",value:"="},{label:"不等于",value:"!="}]})[e]||[],pe=e=>{e.judgeType!=="variable"&&e.node&&!e.field&&E(e.judgeType,e.node)},ve=e=>{e.field="",e.value="",e.judgeType!=="variable"&&e.node&&E(e.judgeType,e.node)},Ie=async e=>{if(e.type==="select"&&e.node&&e.field&&(console.log("字段选择变化:",e.field),e.judgeType==="nodeStaticAttr")){const r=(_.value.staticAttrs.get(e.node)||[]).find(d=>d.value===e.field);if(r){const d=r.attributeId||r.id;if(d)try{const t=await Me(e.node,d);r.attributeValueList=t.data||[],console.log("属性值加载成功:",r.attributeValueList)}catch(t){console.error("加载属性值失败:",t),w.error("加载属性值失败")}}}},fe=e=>{(e.operator==="is_empty"||e.operator==="is_not_empty")&&(e.value="")},le=(e,l)=>{switch(e){case"variable":return j.value;case"nodeStaticAttr":return l?_.value.staticAttrs.get(l)||[]:[];case"nodeDynamicAttr":return l?_.value.dynamicAttrs.get(l)||[]:[];case"nodeProduct":return l?_.value.products.get(l)||[]:[];default:return[]}},ae=e=>{if(e.type!=="select"||!e.node)return[];if(e.judgeType==="nodeProduct")return _.value.products.get(e.node)||[];if(!e.field)return[];let l=[];e.judgeType==="nodeStaticAttr"?l=_.value.staticAttrs.get(e.node)||[]:e.judgeType==="nodeDynamicAttr"&&(l=_.value.dynamicAttrs.get(e.node)||[]);const r=l.find(t=>t.value===e.field);if(!r)return[];let d=[];if(e.judgeType==="nodeStaticAttr"?d=r.attributeValueList||r.attributeValues||r.values||[]:d=r.attributeValues||[],typeof d=="string")try{d=JSON.parse(d)}catch(t){return console.error("解析属性值失败:",t),[]}return Array.isArray(d)?d.map(t=>typeof t=="object"&&t!==null?{label:t.valueName||t.label||t.attributeValue||t.value||"",value:t.valueCode||t.code||t.attributeValue||t.value||""}:{label:String(t),value:String(t)}):[]},we=(e,l)=>{X.value=e,re.value=l.type},Te=(e,l)=>{g.value[e].type=l,X.value=e},Ne=(e=null,l=null)=>{const r=e||g.value,d={conditionId:null,ruleId:m.ruleId,configType:"simple",type:re.value,judgeType:"variable",node:"",field:"",operator:"",value:"",logic:r.length>0?"AND":"",parentConditionId:null,children:[]};e?(d.parentConditionId=e.conditionId,e.children.push(d)):r.push(d),x()},Ue=()=>{const e={conditionId:null,ruleId:m.ruleId,configType:"complex",logic:g.value.length>0?"AND":"",parentConditionId:null,children:[{conditionId:null,ruleId:m.ruleId,configType:"simple",type:"number",judgeType:"variable",node:"",field:"",operator:"",value:"",logic:"",parentConditionId:null}]};g.value.push(e),x()},Be=e=>{e.children||(e.children=[]);const l={conditionId:null,ruleId:m.ruleId,configType:"simple",type:"number",judgeType:"variable",node:"",field:"",operator:"",value:"",logic:e.children.length>0?"AND":"",parentConditionId:e.conditionId};e.children.push(l),x()},$e=(e,l=null)=>{const r=l||g.value;r.splice(e,1),r.length>0&&(r[0].logic=""),x()},Se=async()=>{var e,l;try{if(!m.ruleId){w.warning("规则ID不能为空，无法保存条件。请先选择或创建规则，再配置条件。");return}const r=(t,p=null)=>t.map(i=>{const v={...i,ruleId:m.ruleId,parentConditionId:p};return v.children&&v.children.length>0&&(v.children=r(v.children,v.conditionId)),v}),d=r(g.value);for(const t of d)if(t.conditionId)await Ke(t);else{const p=await Ge(t);if(t.conditionId=p.data.conditionId,t.children&&t.children.length>0){const i=(v,h)=>{v.forEach(f=>{f.parentConditionId=h,f.children&&f.children.length>0&&i(f.children,h)})};i(t.children,t.conditionId)}}x(),w.success("条件保存成功")}catch(r){console.error("保存条件失败:",r),w.error("保存条件失败："+(((l=(e=r.response)==null?void 0:e.data)==null?void 0:l.message)||r.message||"未知错误"))}},ye=()=>{const e=(t,p)=>{for(const i of t){if(i.bomStructureId===p||i.bomStructureId===Number(p))return i.nodeName;if(i.children&&i.children.length>0){const v=e(i.children,p);if(v)return v}}return null},l=t=>{if(!t.field)return"field";switch(t.judgeType){case"variable":const p=j.value.find(k=>k.value===t.field);return p?p.label:t.field;case"nodeStaticAttr":const v=(_.value.staticAttrs.get(t.node)||[]).find(k=>k.value===t.field);return v?v.label:t.field;case"nodeDynamicAttr":const f=(_.value.dynamicAttrs.get(t.node)||[]).find(k=>k.value===t.field);return f?f.label:t.field;case"nodeProduct":const C=(_.value.products.get(t.node)||[]).find(k=>k.value===t.field);return C?C.label:t.field;default:return t.field}},r=t=>{if(t.value===void 0||t.value===null||t.value==="")return"";if(t.type==="select"){const i=ae(t).find(v=>v.value===t.value);if(i)return typeof i.label=="string"?`"${i.label}"`:i.label}return typeof t.value=="string"?`"${t.value}"`:t.value},d=t=>!t||t.length===0?"":t.map(p=>{var v,h;const i=p.logic?`${p.logic} `:"";if(p.configType==="complex"){const f=d(p.children);return`${i}(${f})`}else{const f=((v=Z.find(R=>R.value===p.judgeType))==null?void 0:v.label)||p.judgeType,q=((h=ee(p.type).find(R=>R.value===p.operator))==null?void 0:h.label)||p.operator;p.operator;let C="",k=l(p),O=r(p);p.judgeType!=="variable"&&p.node&&(C=e(z.value,p.node)||p.node);let P="";return p.judgeType!=="variable"?P=`${f}[${C}].${k}`:P=`${f}[${k}]`,`${i}${P} ${q} ${O}`}}).join(" ");return d(g.value)},je=async()=>{var e;if(g.value.length===0){F.value="请先添加条件，然后使用AI辅助配置";return}try{const l=ye();await new Promise(r=>setTimeout(r,1e3)),F.value=`
# DeepSeek智能建议

## 当前条件分析
- 条件数量：${g.value.length}
- 条件表达式：${l}

## 优化建议
1. **字段选择优化**：建议根据业务需求选择更精确的字段
2. **操作符优化**：对于数值类型，建议使用更精确的操作符
3. **值范围优化**：建议设置合理的值范围
4. **逻辑关系优化**：建议优化逻辑关系，提高条件执行效率

## 推荐配置
- 推荐使用：${(e=Y.find(r=>r.value===g.value[0].type))==null?void 0:e.label}
- 推荐字段：根据业务需求选择
- 推荐操作符：根据条件类型选择
- 推荐值：根据业务规则设置
    `}catch(l){console.error("DeepSeek API调用失败:",l),F.value="DeepSeek API调用失败，请稍后重试"}},x=()=>{console.log("更新父组件条件:",g.value),ne("update:modelValue",g.value),ne("update:conditions",g.value)};return Q(g,()=>{x()},{deep:!0}),Q(()=>m.modelValue,e=>{JSON.stringify(e)!==JSON.stringify(g.value)&&(g.value=[...e])},{deep:!0}),(e,l)=>{const r=A("el-icon"),d=A("el-button"),t=A("el-empty"),p=A("el-tag"),i=A("el-option"),v=A("el-select"),h=A("el-form-item"),f=A("el-col"),q=A("el-cascader"),C=A("el-row"),k=A("el-input-number"),O=A("el-input"),P=A("el-date-picker"),R=A("el-form"),te=A("el-card");return c(),V("div",Qe,[o(te,{class:"condition-list",shadow:"hover"},{header:n(()=>[y("div",We,[l[2]||(l[2]=y("span",null,"条件列表",-1)),y("div",Xe,[y("span",Ye,B(g.value.length)+" 个条件",1),y("div",Ze,[(c(),V(T,null,N(he,u=>o(d,{key:u.value,type:u.value==="simple"?"primary":"default",onClick:M=>u.value==="simple"?Ne():Ue(),size:"small"},{default:n(()=>[o(r,null,{default:n(()=>[o(S(be))]),_:1}),D(" "+B(u.label),1)]),_:2},1032,["type","onClick"])),64))]),o(d,{type:"primary",size:"small",onClick:Se},{default:n(()=>[o(r,null,{default:n(()=>[o(S(Pe))]),_:1}),l[1]||(l[1]=D(" 保存条件 "))]),_:1,__:[1]})])])]),default:n(()=>[g.value.length===0?(c(),V("div",Ee,[o(t,{description:"暂无条件"})])):$("",!0),o(S(_e),{modelValue:g.value,"onUpdate:modelValue":l[0]||(l[0]=u=>g.value=u),"item-key":"conditionId",handle:".drag-handle","ghost-class":"ghost"},{item:n(({element:u,index:M})=>[y("div",{class:Oe(["condition-item",{"condition-item-selected":X.value===M,"complex-condition":u.configType==="complex"}]),onClick:a=>we(M,u)},[y("div",ll,[o(r,{class:"drag-handle"},{default:n(()=>[o(S(ge))]),_:1}),y("span",al,B(M+1),1),y("div",tl,[o(p,{type:u.configType==="complex"?"warning":"success"},{default:n(()=>[D(B(u.configType==="complex"?"复杂条件":"简单条件"),1)]),_:2},1032,["type"])]),u.configType==="simple"?(c(),V("div",ol,[(c(),V(T,null,N(Y,a=>o(d,{key:a.value,type:u.type===a.value?"primary":"default",onClick:J(oe=>Te(M,a.value),["stop"]),size:"small"},{default:n(()=>[D(B(a.label),1)]),_:2},1032,["type","onClick"])),64))])):(c(),V("div",nl,[o(d,{type:"success",size:"small",onClick:J(a=>Be(u),["stop"])},{default:n(()=>[o(r,null,{default:n(()=>[o(S(be))]),_:1}),l[3]||(l[3]=D(" 添加子条件 "))]),_:2,__:[3]},1032,["onClick"])])),o(d,{type:"danger",size:"small",icon:"Delete",onClick:J(a=>$e(M),["stop"])},null,8,["onClick"])]),u.configType==="simple"?(c(),V("div",rl,[o(R,{model:u,"label-position":"top","label-width":"100px"},{default:n(()=>[o(C,{gutter:20},{default:n(()=>[o(f,{span:12},{default:n(()=>[o(h,{label:"判断类型"},{default:n(()=>[o(v,{modelValue:u.judgeType,"onUpdate:modelValue":a=>u.judgeType=a,placeholder:"请选择判断类型",onChange:a=>ve(u)},{default:n(()=>[(c(),V(T,null,N(Z,a=>o(i,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])),64))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1024)]),_:2},1024),u.judgeType!=="variable"?(c(),b(f,{key:0,span:12},{default:n(()=>[o(h,{label:"节点"},{default:n(()=>[o(q,{modelValue:u.node,"onUpdate:modelValue":a=>u.node=a,options:z.value,props:ue,placeholder:"请选择节点",loading:H.value,filterable:"",clearable:"",onChange:a=>ie(u),"collapse-tags":!0},null,8,["modelValue","onUpdate:modelValue","options","loading","onChange"])]),_:2},1024)]),_:2},1024)):$("",!0)]),_:2},1024),o(C,{gutter:20},{default:n(()=>[u.judgeType!=="nodeProduct"?(c(),b(f,{key:0,span:12},{default:n(()=>[o(h,{label:"字段"},{default:n(()=>[o(v,{modelValue:u.field,"onUpdate:modelValue":a=>u.field=a,placeholder:"请选择字段",loading:K.value,onVisibleChange:a=>pe(u),onChange:a=>Ie(u)},{default:n(()=>[(c(!0),V(T,null,N(le(u.judgeType,u.node),a=>(c(),b(i,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","loading","onVisibleChange","onChange"])]),_:2},1024)]),_:2},1024)):$("",!0),o(f,{span:12},{default:n(()=>[o(h,{label:"操作符"},{default:n(()=>[o(v,{modelValue:u.operator,"onUpdate:modelValue":a=>u.operator=a,placeholder:"请选择操作符",onChange:a=>fe(u)},{default:n(()=>[(c(!0),V(T,null,N(ee(u.type),a=>(c(),b(i,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1024)]),_:2},1024)]),_:2},1024),u.operator&&u.operator!=="is_empty"&&u.operator!=="is_not_empty"?(c(),b(C,{key:0,gutter:20},{default:n(()=>[o(f,{span:24},{default:n(()=>[o(h,{label:"值"},{default:n(()=>[u.type==="number"?(c(),b(k,{key:0,modelValue:u.value,"onUpdate:modelValue":a=>u.value=a,min:0,max:999999,step:1,placeholder:"请输入数值"},null,8,["modelValue","onUpdate:modelValue"])):u.type==="text"?(c(),b(O,{key:1,modelValue:u.value,"onUpdate:modelValue":a=>u.value=a,placeholder:"请输入文本"},null,8,["modelValue","onUpdate:modelValue"])):u.type==="select"?(c(),b(v,{key:2,modelValue:u.value,"onUpdate:modelValue":a=>u.value=a,placeholder:"请选择值"},{default:n(()=>[(c(!0),V(T,null,N(ae(u),a=>(c(),b(i,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):u.type==="date"?(c(),b(P,{key:3,modelValue:u.value,"onUpdate:modelValue":a=>u.value=a,type:"datetime",placeholder:"选择日期时间"},null,8,["modelValue","onUpdate:modelValue"])):(c(),b(O,{key:4,modelValue:u.value,"onUpdate:modelValue":a=>u.value=a,placeholder:"请输入值"},null,8,["modelValue","onUpdate:modelValue"]))]),_:2},1024)]),_:2},1024)]),_:2},1024)):$("",!0),o(C,{gutter:20},{default:n(()=>[o(f,{span:24},{default:n(()=>[o(h,{label:"逻辑关系"},{default:n(()=>[o(v,{modelValue:u.logic,"onUpdate:modelValue":a=>u.logic=a,placeholder:"请选择逻辑关系"},{default:n(()=>[o(i,{label:"并且 (AND)",value:"AND"}),o(i,{label:"或者 (OR)",value:"OR"})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["model"])])):(c(),V("div",ul,[y("div",dl,[l[4]||(l[4]=y("span",{class:"complex-condition-title"},"嵌套条件组",-1)),o(h,{label:"组逻辑关系",inline:""},{default:n(()=>[o(v,{modelValue:u.logic,"onUpdate:modelValue":a=>u.logic=a,placeholder:"请选择逻辑关系"},{default:n(()=>[o(i,{label:"并且 (AND)",value:"AND"}),o(i,{label:"或者 (OR)",value:"OR"})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),y("div",sl,[o(S(_e),{modelValue:u.children,"onUpdate:modelValue":a=>u.children=a,"item-key":"conditionId",handle:".drag-handle","ghost-class":"ghost"},{item:n(({element:a,index:oe})=>[y("div",il,[y("div",cl,[o(r,{class:"drag-handle"},{default:n(()=>[o(S(ge))]),_:1}),y("span",pl,B(oe+1),1),y("div",vl,[(c(),V(T,null,N(Y,s=>o(d,{key:s.value,type:a.type===s.value?"primary":"default",onClick:J(hl=>a.type=s.value,["stop"]),size:"small"},{default:n(()=>[D(B(s.label),1)]),_:2},1032,["type","onClick"])),64))]),o(d,{type:"danger",size:"small",icon:"Delete",onClick:J(s=>{u.children.splice(oe,1),x()},["stop"])},null,8,["onClick"])]),y("div",fl,[o(R,{model:a,"label-position":"top","label-width":"100px"},{default:n(()=>[o(C,{gutter:20},{default:n(()=>[o(f,{span:12},{default:n(()=>[o(h,{label:"判断类型"},{default:n(()=>[o(v,{modelValue:a.judgeType,"onUpdate:modelValue":s=>a.judgeType=s,placeholder:"请选择判断类型",onChange:s=>ve(a)},{default:n(()=>[(c(),V(T,null,N(Z,s=>o(i,{key:s.value,label:s.label,value:s.value},null,8,["label","value"])),64))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1024)]),_:2},1024),a.judgeType!=="variable"?(c(),b(f,{key:0,span:12},{default:n(()=>[o(h,{label:"节点"},{default:n(()=>[o(q,{modelValue:a.node,"onUpdate:modelValue":s=>a.node=s,options:z.value,props:ue,placeholder:"请选择节点",loading:H.value,filterable:"",clearable:"",onChange:s=>ie(a),"collapse-tags":!0},null,8,["modelValue","onUpdate:modelValue","options","loading","onChange"])]),_:2},1024)]),_:2},1024)):$("",!0)]),_:2},1024),o(C,{gutter:20},{default:n(()=>[a.judgeType!=="nodeProduct"?(c(),b(f,{key:0,span:12},{default:n(()=>[o(h,{label:"字段"},{default:n(()=>[o(v,{modelValue:a.field,"onUpdate:modelValue":s=>a.field=s,placeholder:"请选择字段",loading:K.value,onVisibleChange:s=>pe(a)},{default:n(()=>[(c(!0),V(T,null,N(le(a.judgeType,a.node),s=>(c(),b(i,{key:s.value,label:s.label,value:s.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","loading","onVisibleChange"])]),_:2},1024)]),_:2},1024)):$("",!0),o(f,{span:12},{default:n(()=>[o(h,{label:"操作符"},{default:n(()=>[o(v,{modelValue:a.operator,"onUpdate:modelValue":s=>a.operator=s,placeholder:"请选择操作符",onChange:s=>fe(a)},{default:n(()=>[(c(!0),V(T,null,N(ee(a.type),s=>(c(),b(i,{key:s.value,label:s.label,value:s.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1024)]),_:2},1024)]),_:2},1024),a.operator&&a.operator!=="is_empty"&&a.operator!=="is_not_empty"?(c(),b(C,{key:0,gutter:20},{default:n(()=>[o(f,{span:24},{default:n(()=>[o(h,{label:"值"},{default:n(()=>[a.type==="number"?(c(),b(k,{key:0,modelValue:a.value,"onUpdate:modelValue":s=>a.value=s,min:0,max:999999,step:1,placeholder:"请输入数值"},null,8,["modelValue","onUpdate:modelValue"])):a.type==="text"?(c(),b(O,{key:1,modelValue:a.value,"onUpdate:modelValue":s=>a.value=s,placeholder:"请输入文本"},null,8,["modelValue","onUpdate:modelValue"])):a.type==="select"?(c(),b(v,{key:2,modelValue:a.value,"onUpdate:modelValue":s=>a.value=s,placeholder:"请选择值"},{default:n(()=>[(c(!0),V(T,null,N(ae(a),s=>(c(),b(i,{key:s.value,label:s.label,value:s.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):a.type==="date"?(c(),b(P,{key:3,modelValue:a.value,"onUpdate:modelValue":s=>a.value=s,type:"datetime",placeholder:"选择日期时间"},null,8,["modelValue","onUpdate:modelValue"])):(c(),b(O,{key:4,modelValue:a.value,"onUpdate:modelValue":s=>a.value=s,placeholder:"请输入值"},null,8,["modelValue","onUpdate:modelValue"]))]),_:2},1024)]),_:2},1024)]),_:2},1024)):$("",!0),o(C,{gutter:20},{default:n(()=>[o(f,{span:24},{default:n(()=>[o(h,{label:"逻辑关系"},{default:n(()=>[o(v,{modelValue:a.logic,"onUpdate:modelValue":s=>a.logic=s,placeholder:"请选择逻辑关系"},{default:n(()=>[o(i,{label:"并且 (AND)",value:"AND"}),o(i,{label:"或者 (OR)",value:"OR"})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["model"])])])]),_:2},1032,["modelValue","onUpdate:modelValue"])])]))],10,el)]),_:1},8,["modelValue"])]),_:1}),o(te,{class:"ai-assist",shadow:"hover"},{header:n(()=>l[5]||(l[5]=[y("div",{class:"card-header"},[y("span",null,"AI辅助配置")],-1)])),default:n(()=>[y("div",yl,[o(d,{type:"primary",size:"small",onClick:je},{default:n(()=>[o(r,null,{default:n(()=>[o(S(Re))]),_:1}),l[6]||(l[6]=D(" 使用DeepSeek智能调整条件 "))]),_:1,__:[6]}),F.value?(c(),V("div",gl,[l[7]||(l[7]=y("h4",null,"DeepSeek建议：",-1)),y("pre",null,B(F.value),1)])):$("",!0)])]),_:1}),o(te,{class:"condition-preview",shadow:"hover"},{header:n(()=>l[8]||(l[8]=[y("div",{class:"card-header"},[y("span",null,"条件预览")],-1)])),default:n(()=>[y("div",bl,[g.value.length>0?(c(),V("pre",_l,B(ye()),1)):(c(),b(t,{key:1,description:"暂无条件预览"}))])]),_:1})])}}},Nl=xe(ml,[["__scopeId","data-v-8d3d38b8"]]);export{Nl as default};
