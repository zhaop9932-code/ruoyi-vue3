import{r as ie,s as q,t as re,v as de}from"./bom-DdrUuB8x.js";import{l as ue}from"./solution-D52F0zTE.js";import{_ as ce,r as f,C as O,o as _e,h as r,d as b,e as _,j as a,i as l,k as o,q as n,m as I,K as j,L as A,l as k,t as i,V as d,E as me}from"./index-CwdKQqOf.js";const pe={class:"solution-relation-container"},fe={class:"page-header"},ve={class:"action-buttons"},ye={class:"card-list"},be={class:"card-header"},ge={class:"solution-info"},Ie={class:"solution-code"},De={class:"header-tags"},ke={class:"card-content"},Ve={key:0,class:"content-item"},Ce={class:"value"},we={class:"content-item"},Se={class:"value"},Be={class:"content-item"},Re={class:"value"},he={class:"card-footer"},xe={key:0,class:"empty-state"},Ne={class:"option-content"},$e={class:"option-name"},Me={class:"option-code"},Te={class:"dialog-footer"},ze={key:0,class:"detail-content"},Ue={class:"dialog-footer"},Ee={__name:"BomSolutionRelation",props:{bomId:{type:String,required:!0}},setup(F){const V=F,C=f([]),x=f([]),w=f(!1),u=f(null),g=f(!1),D=f(!1),S=f(null),c=O({bomId:V.bomId,solutionId:"",isDefault:"0",relationDesc:""}),K=O({solutionId:[{required:!0,message:"请选择解决方案",trigger:"change"}]}),B=s=>s?new Date(s).toLocaleString():"",N=s=>({0:"草稿",1:"生效",2:"失效"})[s]||"未知状态",$=s=>({0:"info",1:"success",2:"danger"})[s]||"info",v=async()=>{try{const s=await ie({bomId:V.bomId});C.value=s.rows||[]}catch(s){d.error("加载关联列表失败"),console.error("加载关联列表失败:",s)}},G=async s=>{w.value=!0;try{const e=await ue({solutionName:s,pageNum:1,pageSize:20});x.value=e.rows||[]}catch(e){d.error("搜索解决方案失败"),console.error("搜索解决方案失败:",e)}finally{w.value=!1}},H=()=>{Object.assign(c,{bomId:V.bomId,solutionId:"",isDefault:"0",relationDesc:""}),g.value=!0},J=async()=>{S.value&&await S.value.validate(async s=>{if(s)try{const e=await de({bomId:c.bomId,solutionId:c.solutionId,isDefault:c.isDefault,relationDesc:c.relationDesc});e.code===200?(d.success("关联成功"),g.value=!1,v()):d.error(e.msg||"关联失败")}catch(e){d.error("关联失败"),console.error("关联失败:",e)}})},P=async s=>{try{const e=await q({relationId:s.relationId,isDefault:"1"});e.code===200?(d.success("已设置为默认方案"),v()):d.error(e.msg||"设置失败")}catch(e){d.error("设置失败"),console.error("设置失败:",e)}},Q=async s=>{try{const e=await q({relationId:s.relationId,isDefault:"0"});e.code===200?(d.success("已取消默认方案"),v()):d.error(e.msg||"取消失败")}catch(e){d.error("取消失败"),console.error("取消失败:",e)}},W=s=>{u.value=s.solution,D.value=!0},X=s=>{me.confirm("确定要移除该解决方案关联吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const e=await re({bomId:s.bomId,solutionId:s.solutionId});e.code===200?(d.success("移除成功"),v()):d.error(e.msg||"移除失败")}catch(e){d.error("移除失败"),console.error("移除失败:",e)}}).catch(()=>{})},Y=()=>{v()};return _e(()=>{v()}),(s,e)=>{var z;const m=r("el-button"),R=r("el-tag"),Z=r("el-card"),ee=r("el-empty"),te=r("el-option"),oe=r("el-select"),h=r("el-form-item"),M=r("el-radio"),le=r("el-radio-group"),se=r("el-input"),ae=r("el-form"),T=r("el-dialog"),p=r("el-descriptions-item"),ne=r("el-descriptions");return _(),b("div",pe,[a("div",fe,[e[9]||(e[9]=a("h3",null,"BOM方案关联",-1)),a("div",ve,[l(m,{type:"primary",onClick:H},{default:o(()=>e[7]||(e[7]=[n("关联解决方案")])),_:1,__:[7]}),l(m,{onClick:Y},{default:o(()=>e[8]||(e[8]=[n("刷新")])),_:1,__:[8]})])]),a("div",ye,[(_(!0),b(j,null,A(C.value,t=>(_(),k(Z,{key:t.relationId,class:"solution-card",shadow:"hover"},{default:o(()=>{var U,E,L;return[a("div",be,[a("div",ge,[a("h4",null,i((U=t.solution)==null?void 0:U.solutionName),1),a("div",Ie,i((E=t.solution)==null?void 0:E.solutionCode),1)]),a("div",De,[t.isDefault==="1"?(_(),k(R,{key:0,type:"primary"},{default:o(()=>e[10]||(e[10]=[n("默认方案")])),_:1,__:[10]})):I("",!0),l(R,{type:$((L=t.solution)==null?void 0:L.status)},{default:o(()=>{var y;return[n(i(N((y=t.solution)==null?void 0:y.status)),1)]}),_:2},1032,["type"])])]),a("div",ke,[t.relationDesc?(_(),b("div",Ve,[e[11]||(e[11]=a("span",{class:"label"},"关联描述：",-1)),a("span",Ce,i(t.relationDesc),1)])):I("",!0),a("div",we,[e[12]||(e[12]=a("span",{class:"label"},"关联时间：",-1)),a("span",Se,i(B(t.createTime)),1)]),a("div",Be,[e[13]||(e[13]=a("span",{class:"label"},"关联人：",-1)),a("span",Re,i(t.createBy),1)])]),a("div",he,[l(m,{size:"small",disabled:t.isDefault==="1",onClick:y=>P(t)},{default:o(()=>e[14]||(e[14]=[n(" 设为默认 ")])),_:2,__:[14]},1032,["disabled","onClick"]),t.isDefault==="1"?(_(),k(m,{key:0,size:"small",type:"warning",onClick:y=>Q(t)},{default:o(()=>e[15]||(e[15]=[n(" 取消默认 ")])),_:2,__:[15]},1032,["onClick"])):I("",!0),l(m,{size:"small",onClick:y=>W(t)},{default:o(()=>e[16]||(e[16]=[n("查看详情")])),_:2,__:[16]},1032,["onClick"]),l(m,{size:"small",type:"danger",onClick:y=>X(t)},{default:o(()=>e[17]||(e[17]=[n("移除关联")])),_:2,__:[17]},1032,["onClick"])])]}),_:2},1024))),128)),C.value.length===0?(_(),b("div",xe,[l(ee,{description:"暂无关联的解决方案"})])):I("",!0)]),l(T,{modelValue:g.value,"onUpdate:modelValue":e[4]||(e[4]=t=>g.value=t),title:"关联解决方案",width:"600px"},{footer:o(()=>[a("span",Te,[l(m,{onClick:e[3]||(e[3]=t=>g.value=!1)},{default:o(()=>e[20]||(e[20]=[n("取消")])),_:1,__:[20]}),l(m,{type:"primary",onClick:J},{default:o(()=>e[21]||(e[21]=[n("确定")])),_:1,__:[21]})])]),default:o(()=>[l(ae,{ref_key:"formRef",ref:S,model:c,rules:K,"label-width":"100px"},{default:o(()=>[l(h,{label:"解决方案",prop:"solutionId"},{default:o(()=>[l(oe,{modelValue:c.solutionId,"onUpdate:modelValue":e[0]||(e[0]=t=>c.solutionId=t),placeholder:"请选择或搜索解决方案",filterable:"",remote:"","remote-method":G,loading:w.value,style:{width:"100%"}},{default:o(()=>[(_(!0),b(j,null,A(x.value,t=>(_(),k(te,{key:t.solutionId,label:`${t.solutionCode} - ${t.solutionName}`,value:t.solutionId},{default:o(()=>[a("div",Ne,[a("div",$e,i(t.solutionName),1),a("div",Me,i(t.solutionCode),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1}),l(h,{label:"是否默认"},{default:o(()=>[l(le,{modelValue:c.isDefault,"onUpdate:modelValue":e[1]||(e[1]=t=>c.isDefault=t)},{default:o(()=>[l(M,{label:"1"},{default:o(()=>e[18]||(e[18]=[n("是")])),_:1,__:[18]}),l(M,{label:"0"},{default:o(()=>e[19]||(e[19]=[n("否")])),_:1,__:[19]})]),_:1},8,["modelValue"])]),_:1}),l(h,{label:"关联描述"},{default:o(()=>[l(se,{modelValue:c.relationDesc,"onUpdate:modelValue":e[2]||(e[2]=t=>c.relationDesc=t),type:"textarea",rows:"3",placeholder:"请输入关联描述（可选）"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),l(T,{modelValue:D.value,"onUpdate:modelValue":e[6]||(e[6]=t=>D.value=t),title:`解决方案详情 - ${(z=u.value)==null?void 0:z.solutionName}`,width:"700px"},{footer:o(()=>[a("span",Ue,[l(m,{onClick:e[5]||(e[5]=t=>D.value=!1)},{default:o(()=>e[22]||(e[22]=[n("关闭")])),_:1,__:[22]})])]),default:o(()=>[u.value?(_(),b("div",ze,[l(ne,{border:"",column:2},{default:o(()=>[l(p,{label:"解决方案编码"},{default:o(()=>[n(i(u.value.solutionCode),1)]),_:1}),l(p,{label:"解决方案名称"},{default:o(()=>[n(i(u.value.solutionName),1)]),_:1}),l(p,{label:"状态"},{default:o(()=>[l(R,{type:$(u.value.status)},{default:o(()=>[n(i(N(u.value.status)),1)]),_:1},8,["type"])]),_:1}),l(p,{label:"创建时间"},{default:o(()=>[n(i(B(u.value.createTime)),1)]),_:1}),l(p,{label:"创建人"},{default:o(()=>[n(i(u.value.createBy),1)]),_:1}),l(p,{label:"更新时间"},{default:o(()=>[n(i(B(u.value.updateTime)),1)]),_:1}),l(p,{label:"更新人"},{default:o(()=>[n(i(u.value.updateBy),1)]),_:1}),l(p,{label:"描述",span:2},{default:o(()=>[n(i(u.value.description||"无"),1)]),_:1})]),_:1})])):I("",!0)]),_:1},8,["modelValue","title"])])}}},je=ce(Ee,[["__scopeId","data-v-dae95b41"]]);export{je as default};
