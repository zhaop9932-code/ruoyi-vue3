const I={BASIC:"basic",MUTUAL:"mutual",PRICE:"price",MESSAGE:"message",DATA:"data"},e={IS_ENABLE:"isEnable",IS_RECOMMEND:"isRecommend",IS_SHOW:"isShow",IS_REQUIRED:"isRequired",RESET:"reset",LINK_SELECT:"linkSelect",EXCLUDE:"exclude",MUTUAL_SELECT:"mutualSelect",MUTUAL_EXCLUDE:"mutualExclude",MULTIPLE_SELECT:"multipleSelect",APPLY_DISCOUNT:"applyDiscount",APPLY_FULL_REDUCTION:"applyFullReduction",SET_PRICE:"setPrice",SHOW_MESSAGE:"showMessage",SEND_NOTIFICATION:"sendNotification",TRIGGER_WARNING:"triggerWarning",CALCULATION:"calculation",CALL_API:"callApi",TRIGGER_RULE:"triggerRule"},u=[{label:"基础动作",category:I.BASIC,options:[{label:"是否启用",value:e.IS_ENABLE},{label:"是否推荐",value:e.IS_RECOMMEND},{label:"是否显示",value:e.IS_SHOW},{label:"是否必选",value:e.IS_REQUIRED},{label:"是否重置",value:e.RESET}]},{label:"相互联动",category:I.MUTUAL,options:[{label:"联动选中",value:e.LINK_SELECT},{label:"联动排除",value:e.EXCLUDE},{label:"相互选中",value:e.MUTUAL_SELECT},{label:"相互排斥",value:e.MUTUAL_EXCLUDE},{label:"多选",value:e.MULTIPLE_SELECT}]},{label:"价格动作",category:I.PRICE,options:[{label:"应用折扣",value:e.APPLY_DISCOUNT},{label:"应用满减",value:e.APPLY_FULL_REDUCTION},{label:"设置单价",value:e.SET_PRICE}]},{label:"消息通知",category:I.MESSAGE,options:[{label:"显示消息",value:e.SHOW_MESSAGE},{label:"发送通知",value:e.SEND_NOTIFICATION},{label:"触发警告",value:e.TRIGGER_WARNING}]},{label:"数据处理",category:I.DATA,options:[{label:"参数计算",value:e.CALCULATION},{label:"调用API",value:e.CALL_API},{label:"触发规则",value:e.TRIGGER_RULE}]}],T={NODE:"node",NODE_STATIC_ATTR:"nodeStaticAttr",NODE_STATIC_ATTR_VALUE:"nodeStaticAttrValue",NODE_DYNAMIC_ATTR:"nodeDynamicAttr",NODE_DYNAMIC_ATTR_VALUE:"nodeDynamicAttrValue",NODE_PRODUCT:"nodeProduct",DYNAMIC_ATTR:"dynamicAttr",DYNAMIC_ATTR_VALUE:"dynamicAttrValue",RULE:"rule",VARIABLE:"variable"},c={[T.NODE]:"节点",[T.NODE_STATIC_ATTR]:"节点静态属性",[T.NODE_STATIC_ATTR_VALUE]:"节点静态属性值",[T.NODE_DYNAMIC_ATTR]:"节点动态属性",[T.NODE_DYNAMIC_ATTR_VALUE]:"节点动态属性值",[T.NODE_PRODUCT]:"节点产品",[T.DYNAMIC_ATTR]:"动态属性",[T.DYNAMIC_ATTR_VALUE]:"动态属性值",[T.RULE]:"规则",[T.VARIABLE]:"变量信息"},U={[T.NODE]:"选择BOM树中的节点，动作将应用于整个节点",[T.NODE_STATIC_ATTR]:"选择节点的静态属性，如颜色、尺寸等固定属性",[T.NODE_STATIC_ATTR_VALUE]:'选择节点静态属性的具体值，如颜色中的"红色"',[T.NODE_DYNAMIC_ATTR]:"选择节点的动态属性，如用户可配置的参数",[T.NODE_DYNAMIC_ATTR_VALUE]:"选择节点动态属性的具体值",[T.NODE_PRODUCT]:"选择节点关联的产品，如某个SKU",[T.DYNAMIC_ATTR]:"选择动态属性（全局）",[T.DYNAMIC_ATTR_VALUE]:"选择动态属性的具体值",[T.RULE]:"选择其他规则，可以触发规则执行",[T.VARIABLE]:"选择变量，用于存储计算结果"},L={[e.IS_ENABLE]:[T.NODE,T.NODE_STATIC_ATTR,T.NODE_STATIC_ATTR_VALUE,T.NODE_DYNAMIC_ATTR,T.NODE_DYNAMIC_ATTR_VALUE,T.NODE_PRODUCT,T.RULE],[e.IS_RECOMMEND]:[T.NODE,T.NODE_STATIC_ATTR,T.NODE_DYNAMIC_ATTR,T.NODE_PRODUCT],[e.IS_SHOW]:[T.NODE,T.NODE_STATIC_ATTR,T.NODE_STATIC_ATTR_VALUE,T.NODE_DYNAMIC_ATTR,T.NODE_DYNAMIC_ATTR_VALUE,T.NODE_PRODUCT,T.RULE],[e.IS_REQUIRED]:[T.NODE,T.NODE_STATIC_ATTR,T.NODE_DYNAMIC_ATTR],[e.RESET]:[T.NODE,T.NODE_STATIC_ATTR,T.NODE_DYNAMIC_ATTR],[e.LINK_SELECT]:[T.NODE_STATIC_ATTR_VALUE,T.NODE_DYNAMIC_ATTR_VALUE,T.NODE_PRODUCT],[e.EXCLUDE]:[T.NODE,T.NODE_STATIC_ATTR,T.NODE_STATIC_ATTR_VALUE,T.NODE_DYNAMIC_ATTR,T.NODE_DYNAMIC_ATTR_VALUE],[e.MUTUAL_SELECT]:[T.NODE_STATIC_ATTR_VALUE,T.NODE_DYNAMIC_ATTR_VALUE,T.NODE_PRODUCT],[e.MUTUAL_EXCLUDE]:[T.NODE_STATIC_ATTR,T.NODE_STATIC_ATTR_VALUE,T.NODE_DYNAMIC_ATTR,T.NODE_DYNAMIC_ATTR_VALUE,T.NODE_PRODUCT],[e.MULTIPLE_SELECT]:[T.NODE,T.NODE_STATIC_ATTR,T.NODE_STATIC_ATTR_VALUE,T.NODE_DYNAMIC_ATTR,T.NODE_DYNAMIC_ATTR_VALUE,T.NODE_PRODUCT],[e.APPLY_DISCOUNT]:[T.NODE,T.NODE_STATIC_ATTR,T.NODE_STATIC_ATTR_VALUE,T.NODE_PRODUCT],[e.APPLY_FULL_REDUCTION]:[T.NODE],[e.SET_PRICE]:[T.NODE,T.NODE_STATIC_ATTR,T.NODE_STATIC_ATTR_VALUE,T.NODE_DYNAMIC_ATTR,T.NODE_DYNAMIC_ATTR_VALUE,T.NODE_PRODUCT],[e.CALCULATION]:[T.VARIABLE,T.NODE_STATIC_ATTR],[e.TRIGGER_RULE]:[T.RULE],[e.CALL_API]:[]},R=E=>![e.SHOW_MESSAGE,e.SEND_NOTIFICATION,e.TRIGGER_WARNING,e.CALL_API].includes(E),O=(E,A)=>!([e.SHOW_MESSAGE,e.SEND_NOTIFICATION,e.TRIGGER_WARNING,e.CALL_API].includes(E)||E===e.EXCLUDE&&A===T.NODE),P=(E,A)=>!(E===e.APPLY_FULL_REDUCTION&&A===T.NODE||E===e.SET_PRICE&&A===T.NODE||E===e.CALCULATION&&A===T.VARIABLE||[T.NODE_STATIC_ATTR,T.NODE_DYNAMIC_ATTR].includes(A)||E===e.LINK_SELECT&&(A===T.NODE_STATIC_ATTR_VALUE||A===T.NODE_DYNAMIC_ATTR_VALUE)),S=(E,A)=>[e.EXCLUDE,e.MUTUAL_SELECT,e.MUTUAL_EXCLUDE,e.TRIGGER_RULE,e.LINK_SELECT].includes(E),M=(E,A)=>({[e.IS_ENABLE]:{value:!0},[e.IS_RECOMMEND]:{value:!0},[e.IS_SHOW]:{value:!0},[e.IS_REQUIRED]:{value:!0},[e.RESET]:{value:!0},[e.LINK_SELECT]:A===T.NODE_PRODUCT?{value:!0}:{value:[]},[e.MULTIPLE_SELECT]:{minSelect:1,maxSelect:10},[e.APPLY_DISCOUNT]:{type:"percentage",value:.9,isStackable:!1},[e.APPLY_FULL_REDUCTION]:{conditionType:"amount",conditionValue:1e3,reduceType:"fixed",reduceValue:100,isLoop:!1},[e.SET_PRICE]:{settingType:"fixed",value:0},[e.SHOW_MESSAGE]:{level:"info",title:"提示",content:""},[e.SEND_NOTIFICATION]:{type:"email",recipient:"",content:""},[e.TRIGGER_WARNING]:{level:"warning",message:""},[e.CALCULATION]:{formula:"",resultStorage:""},[e.CALL_API]:{apiParams:""}})[E]||{},f=E=>{const A=[e.IS_ENABLE,e.IS_RECOMMEND,e.IS_SHOW,e.IS_REQUIRED,e.RESET],n=[e.LINK_SELECT,e.EXCLUDE,e.MUTUAL_SELECT,e.MUTUAL_EXCLUDE,e.MULTIPLE_SELECT],i=[e.APPLY_DISCOUNT,e.APPLY_FULL_REDUCTION,e.SET_PRICE],a=[e.SHOW_MESSAGE,e.SEND_NOTIFICATION,e.TRIGGER_WARNING],_=[e.CALCULATION,e.CALL_API,e.TRIGGER_RULE];return A.includes(E)?I.BASIC:n.includes(E)?I.MUTUAL:i.includes(E)?I.PRICE:a.includes(E)?I.MESSAGE:_.includes(E)?I.DATA:null},d=E=>(L[E]||[]).map(n=>({label:c[n],value:n})),p=E=>{const A=[];return E.actionType||A.push("请选择动作类型"),R(E.actionType)&&!E.targetType&&A.push("请选择目标类型"),E.targetType&&([T.NODE_STATIC_ATTR,T.NODE_STATIC_ATTR_VALUE,T.NODE_DYNAMIC_ATTR,T.NODE_DYNAMIC_ATTR_VALUE,T.NODE_PRODUCT].includes(E.targetType)&&!E.structureId&&A.push("请选择节点"),[T.NODE_STATIC_ATTR_VALUE,T.NODE_DYNAMIC_ATTR_VALUE].includes(E.targetType)&&!E.attributeId&&A.push("请选择属性")),O(E.actionType,E.targetType)&&!E.targetId&&A.push("请选择目标对象"),S(E.actionType,E.targetType)||E.actionParams||A.push("请配置动作参数"),{valid:A.length===0,errors:A}},Y=E=>{const A=[],n={};E.forEach((a,_)=>{const l=`${a.targetType}_${a.targetId}`;n[l]||(n[l]=[]),n[l].push({action:a,index:_})}),Object.entries(n).forEach(([a,_])=>{if(_.length<2)return;const l=_.filter(t=>t.action.actionType===e.IS_ENABLE);if(l.length>1){const t=l.map(s=>{try{return JSON.parse(s.action.actionParams).value}catch{return null}});t.includes(!0)&&t.includes(!1)&&A.push({type:"enable_conflict",message:"同一目标对象存在冲突的启用/禁用动作",actions:l.map(s=>s.index),level:"error"})}const C=_.filter(t=>t.action.actionType===e.IS_SHOW);if(C.length>1){const t=C.map(s=>{try{return JSON.parse(s.action.actionParams).value}catch{return null}});t.includes(!0)&&t.includes(!1)&&A.push({type:"show_conflict",message:"同一目标对象存在冲突的显示/隐藏动作",actions:C.map(s=>s.index),level:"error"})}const r=_.filter(t=>[e.APPLY_DISCOUNT,e.SET_PRICE].includes(t.action.actionType));r.length>1&&r.some(s=>{try{return JSON.parse(s.action.actionParams).isStackable===!1}catch{return!1}})&&A.push({type:"price_conflict",message:"同一目标对象存在多个价格动作，且包含不可叠加的折扣",actions:r.map(s=>s.index),level:"warning"});const N=_.filter(t=>t.action.actionType===e.MUTUAL_EXCLUDE),D=_.filter(t=>t.action.actionType===e.MUTUAL_SELECT);N.length>0&&D.length>0&&A.push({type:"mutual_conflict",message:"同一目标对象同时存在相互排斥和相互选中动作",actions:[...N,...D].map(t=>t.index),level:"error"})});const i={};return E.forEach((a,_)=>{const l=a.actionPriority||1;i[l]||(i[l]=[]),i[l].push({action:a,index:_})}),Object.entries(i).forEach(([a,_])=>{if(_.length<2)return;const l=_.some(N=>N.action.actionType===e.IS_ENABLE),C=_.some(N=>N.action.actionType===e.IS_SHOW),r=_.some(N=>[e.APPLY_DISCOUNT,e.APPLY_FULL_REDUCTION,e.SET_PRICE].includes(N.action.actionType));(l||C||r)&&_.length>3&&A.push({type:"priority_conflict",message:`优先级${a}包含过多动作(${_.length}个)，可能影响执行顺序`,actions:_.map(N=>N.index),level:"info"})}),A},m=E=>({error:"danger",warning:"warning",info:"info"})[E]||"info";export{u as A,T,O as a,S as b,d as c,U as d,e,m as f,M as g,Y as h,P as i,f as j,c as k,I as l,R as s,p as v};
