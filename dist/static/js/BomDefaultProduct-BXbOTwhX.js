import{l as Y,a as Z,u as B,d as ee,b as te}from"./bom-DdrUuB8x.js";import{listProduct as oe}from"./product-CtyH2BmW.js";import{_ as se,r as p,C as q,o as le,h as d,d as g,e as _,j as l,i as s,k as r,q as i,m as re,K as O,L as x,l as S,t as u,V as n,E as ae}from"./index-CwdKQqOf.js";const ne={class:"default-product-container"},de={class:"page-header"},ie={class:"action-buttons"},ce={class:"card-list"},ue={class:"card-header"},me={class:"product-info"},pe={class:"product-model"},_e={class:"card-content"},fe={class:"content-item"},ve={class:"value"},ye={class:"content-item"},ge={class:"value"},be={class:"content-item"},Ie={class:"value"},Ve={class:"card-footer"},ke={key:0,class:"empty-state"},we={class:"dialog-footer"},he={__name:"BomDefaultProduct",props:{bomId:{type:String,required:!0}},setup(N){const f=N,b=p([]),w=p([]),I=p(!1),m=p(!1),V=p("添加默认产品"),k=p(null),a=q({id:"",bomId:f.bomId,productId:"",sortOrder:0,isActive:"1",qty:1}),T=q({productId:[{required:!0,message:"请选择产品",trigger:"change"}]}),$=o=>o?new Date(o).toLocaleString():"",v=async()=>{try{const o=await Y({bomId:f.bomId});b.value=o.rows||[]}catch(o){n.error("加载默认产品失败"),console.error("加载默认产品失败:",o)}},E=async o=>{I.value=!0;try{const e=await oe({productName:o,pageNum:1,pageSize:20});w.value=e.rows||[]}catch(e){n.error("搜索产品失败"),console.error("搜索产品失败:",e)}finally{I.value=!1}},U=()=>{V.value="添加默认产品",Object.assign(a,{id:"",bomId:f.bomId,productId:"",sortOrder:0,isActive:"1",qty:1}),m.value=!0},z=o=>{V.value="编辑默认产品",Object.assign(a,{id:o.id,bomId:o.bomId,productId:o.productId,sortOrder:o.sortOrder,isActive:o.isActive,qty:o.qty||1}),m.value=!0},L=async()=>{k.value&&await k.value.validate(async o=>{if(o)try{let e;a.id?e=await B(a):e=await te(a),e.code===200?(n.success(e.msg||"操作成功"),m.value=!1,v()):n.error(e.msg||"操作失败")}catch(e){n.error("操作失败"),console.error("操作失败:",e)}})},M=async o=>{try{const e=await B({id:o.id,isActive:o.isActive==="1"?"0":"1"});e.code===200?(n.success("状态更新成功"),v()):n.error(e.msg||"状态更新失败")}catch(e){n.error("状态更新失败"),console.error("状态更新失败:",e)}},j=o=>{ae.confirm("确定要删除该默认产品吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const e=await ee([o.id]);e.code===200?(n.success("删除成功"),v()):n.error(e.msg||"删除失败")}catch(e){n.error("删除失败"),console.error("删除失败:",e)}}).catch(()=>{})},R=async()=>{try{const o=await Z(f.bomId);o.code===200?n.success("应用成功"):n.error(o.msg||"应用失败")}catch(o){n.error("应用失败"),console.error("应用失败:",o)}};return le(()=>{v()}),(o,e)=>{const c=d("el-button"),F=d("el-tag"),K=d("el-card"),G=d("el-empty"),H=d("el-option"),J=d("el-select"),y=d("el-form-item"),h=d("el-input-number"),C=d("el-radio"),Q=d("el-radio-group"),W=d("el-form"),X=d("el-dialog");return _(),g("div",ne,[l("div",de,[e[8]||(e[8]=l("h3",null,"默认产品配置",-1)),l("div",ie,[s(c,{type:"primary",onClick:U},{default:r(()=>e[6]||(e[6]=[i("添加默认产品")])),_:1,__:[6]}),s(c,{onClick:R},{default:r(()=>e[7]||(e[7]=[i("应用默认配置")])),_:1,__:[7]})])]),l("div",ce,[(_(!0),g(O,null,x(b.value,t=>(_(),S(K,{key:t.id,class:"product-card",shadow:"hover"},{default:r(()=>{var A,D;return[l("div",ue,[l("div",me,[l("h4",null,u((A=t.product)==null?void 0:A.productName),1),l("div",pe,u((D=t.product)==null?void 0:D.productModel),1)]),s(F,{type:t.isActive==="1"?"success":"info"},{default:r(()=>[i(u(t.isActive==="1"?"已激活":"未激活"),1)]),_:2},1032,["type"])]),l("div",_e,[l("div",fe,[e[9]||(e[9]=l("span",{class:"label"},"数量：",-1)),l("span",ve,u(t.qty||1),1)]),l("div",ye,[e[10]||(e[10]=l("span",{class:"label"},"排序：",-1)),l("span",ge,u(t.sortOrder),1)]),l("div",be,[e[11]||(e[11]=l("span",{class:"label"},"创建时间：",-1)),l("span",Ie,u($(t.createTime)),1)])]),l("div",Ve,[s(c,{size:"small",onClick:P=>z(t)},{default:r(()=>e[12]||(e[12]=[i("编辑")])),_:2,__:[12]},1032,["onClick"]),s(c,{size:"small",type:t.isActive==="1"?"warning":"success",onClick:P=>M(t)},{default:r(()=>[i(u(t.isActive==="1"?"停用":"激活"),1)]),_:2},1032,["type","onClick"]),s(c,{size:"small",type:"danger",onClick:P=>j(t)},{default:r(()=>e[13]||(e[13]=[i("删除")])),_:2,__:[13]},1032,["onClick"])])]}),_:2},1024))),128)),b.value.length===0?(_(),g("div",ke,[s(G,{description:"暂无默认产品配置"})])):re("",!0)]),s(X,{modelValue:m.value,"onUpdate:modelValue":e[5]||(e[5]=t=>m.value=t),title:V.value,width:"500px"},{footer:r(()=>[l("span",we,[s(c,{onClick:e[4]||(e[4]=t=>m.value=!1)},{default:r(()=>e[16]||(e[16]=[i("取消")])),_:1,__:[16]}),s(c,{type:"primary",onClick:L},{default:r(()=>e[17]||(e[17]=[i("确定")])),_:1,__:[17]})])]),default:r(()=>[s(W,{ref_key:"formRef",ref:k,model:a,rules:T,"label-width":"100px"},{default:r(()=>[s(y,{label:"产品",prop:"productId"},{default:r(()=>[s(J,{modelValue:a.productId,"onUpdate:modelValue":e[0]||(e[0]=t=>a.productId=t),placeholder:"请选择产品",filterable:"",remote:"","remote-method":E,loading:I.value,style:{width:"100%"}},{default:r(()=>[(_(!0),g(O,null,x(w.value,t=>(_(),S(H,{key:t.productId,label:`${t.productCode} - ${t.productName}`,value:t.productId},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1}),s(y,{label:"排序",prop:"sortOrder"},{default:r(()=>[s(h,{modelValue:a.sortOrder,"onUpdate:modelValue":e[1]||(e[1]=t=>a.sortOrder=t),min:0,step:1,placeholder:"请输入排序"},null,8,["modelValue"])]),_:1}),s(y,{label:"数量",prop:"qty"},{default:r(()=>[s(h,{modelValue:a.qty,"onUpdate:modelValue":e[2]||(e[2]=t=>a.qty=t),min:1,step:1,placeholder:"请输入数量"},null,8,["modelValue"])]),_:1}),s(y,{label:"状态"},{default:r(()=>[s(Q,{modelValue:a.isActive,"onUpdate:modelValue":e[3]||(e[3]=t=>a.isActive=t)},{default:r(()=>[s(C,{label:"1"},{default:r(()=>e[14]||(e[14]=[i("已激活")])),_:1,__:[14]}),s(C,{label:"0"},{default:r(()=>e[15]||(e[15]=[i("未激活")])),_:1,__:[15]})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}},Pe=se(he,[["__scopeId","data-v-330dc2b2"]]);export{Pe as default};
