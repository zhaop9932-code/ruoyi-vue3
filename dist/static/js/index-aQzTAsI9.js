import{_ as V,u as R,a as j,r as d,z as m,o as A,V as C,h as s,G as z,d as b,e as y,j as i,H as G,i as e,k as o,q as c,n as S,aD as H,t as _,aE as P,E as F}from"./index-CwdKQqOf.js";import{u as J}from"./configurator-DAu3_4Je.js";import K from"./ProductTree-CKbgoMlX.js";import L from"./AttributeConfig-DYSzH2eB.js";import Q from"./ConfigurationSummary-B2C_Ynqj.js";import"./bom-DdrUuB8x.js";import"./superBomRuleRelation-Cz_bCmLL.js";import"./rule-nChVW3Ks.js";import"./superBomVariable-gMrvMuGl.js";import"./superBomProductRelation-e2EKVMIZ.js";const U={class:"product-configurator"},W={class:"configurator-header"},X={class:"header-left"},Y={class:"header-info"},Z={class:"header-right"},$={class:"configurator-content"},ee={__name:"index",setup(te){const f=R(),r=j(),a=J(),l=d(f.params.bomId),p=d(f.query.bomName||""),u=d(null),x=m(()=>a.loading.bom||a.loading.rules),B=m(()=>{const t=a.configSession.status;return{draft:"配置中",saved:"已保存",completed:"已完成"}[t]||"未知"}),w=m(()=>{const t=a.configSession.status;return{draft:"info",saved:"warning",completed:"success"}[t]||"info"}),M=t=>{u.value=t},q=()=>{u.value=null},N=async()=>{if(a.configSession.status==="draft"&&Object.keys(a.configSession.configuration).length>0)try{await F.confirm("当前配置尚未保存，确定要返回吗？","提示",{confirmButtonText:"保存并返回",cancelButtonText:"直接返回",distinguishCancelAndClose:!0,type:"warning"}),await a.saveConfigSession(),r.push({name:"CpqConfigurator"})}catch(t){t==="cancel"&&r.push({name:"CpqConfigurator"})}else r.push({name:"CpqConfigurator"})},k=async()=>{await a.loadBomStructure(l.value),u.value=null};return A(async()=>{if(!l.value){C.error("缺少BOM ID参数"),r.push({name:"CpqConfigurator"});return}try{await a.loadBomStructure(l.value)}catch(t){console.error("加载BOM结构失败:",t),C.error("加载BOM结构失败"),setTimeout(()=>{r.push({name:"CpqConfigurator"})},2e3)}}),(t,n)=>{const g=s("el-button"),v=s("el-breadcrumb-item"),T=s("el-breadcrumb"),D=s("el-tag"),h=s("el-aside"),E=s("el-main"),I=s("el-container"),O=z("loading");return y(),b("div",U,[i("div",W,[i("div",X,[e(g,{icon:S(H),onClick:N},{default:o(()=>n[0]||(n[0]=[c("返回列表")])),_:1,__:[0]},8,["icon"]),i("div",Y,[i("h2",null,_(p.value||"产品配置器"),1),e(T,{separator:"/"},{default:o(()=>[e(v,{to:{path:"/cpq/configurator"}},{default:o(()=>n[1]||(n[1]=[c("产品配置器")])),_:1,__:[1]}),e(v,null,{default:o(()=>[c(_(p.value||"配置详情"),1)]),_:1})]),_:1})])]),i("div",Z,[e(D,{type:w.value},{default:o(()=>[c(_(B.value),1)]),_:1},8,["type"]),e(g,{icon:S(P),onClick:k},{default:o(()=>n[2]||(n[2]=[c("刷新")])),_:1,__:[2]},8,["icon"])])]),G((y(),b("div",$,[e(I,null,{default:o(()=>[e(h,{width:"320px",class:"tree-panel"},{default:o(()=>[e(K,{"bom-id":l.value,onNodeSelect:M},null,8,["bom-id"])]),_:1}),e(E,{class:"config-panel"},{default:o(()=>[e(L,{"current-node":u.value,onConfigConfirm:q},null,8,["current-node"])]),_:1}),e(h,{width:"360px",class:"summary-panel"},{default:o(()=>[e(Q)]),_:1})]),_:1})])),[[O,x.value]])])}}},me=V(ee,[["__scopeId","data-v-9b7efa47"]]);export{me as default};
