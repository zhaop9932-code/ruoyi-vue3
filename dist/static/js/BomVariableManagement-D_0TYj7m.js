const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["static/js/superBomVariable-_jqz_F6y.js","static/js/index-DgigFOm-.js","static/css/index-m-ApgcvE.css"])))=>i.map(i=>d[i]);
import{_ as oe,r as y,$ as h,h as ie,a as m,i as ne,c as de,o as C,e as T,b as l,j as se,w as o,f as V,m as x,t as ue,a2 as N,E as p,Q as k}from"./index-DgigFOm-.js";const be={class:"bom-variable-management"},pe={class:"management-header"},ce={class:"header-buttons"},me={class:"pagination-container"},ve={class:"dialog-footer"},ge={__name:"BomVariableManagement",props:{bomId:{type:[String,Number],required:!0}},setup(M){const I=M,w=y(!1),n=y([]),g=y([]),v=y(!1),S=y("新增变量"),R=y(null),c=h({bomId:I.bomId,variableCode:"",variableName:"",variableType:"",isRequired:""}),s=h({currentPage:1,pageSize:10,total:0}),i=h({variableId:null,bomId:I.bomId,variableCode:"",variableName:"",variableType:"string",defaultValue:"",isRequired:"0",sortOrder:1,description:""}),E=h({variableCode:[{pattern:/^[A-Z0-9_]+$/,message:"变量编码只能包含大写字母、数字和下划线",trigger:"blur"}],variableName:[{required:!0,message:"变量名称不能为空",trigger:"blur"}],variableType:[{required:!0,message:"请选择变量类型",trigger:"change"}]}),z=a=>({string:"字符串",number:"数字",boolean:"布尔值",date:"日期"})[a]||a,U=a=>({string:"primary",number:"success",boolean:"warning",date:"info"})[a]||"primary",f=()=>{w.value=!0;const a={...c,bomId:I.bomId,pageNum:s.currentPage,pageSize:s.pageSize};N(async()=>{const{listSuperBomVariable:e}=await import("./superBomVariable-_jqz_F6y.js");return{listSuperBomVariable:e}},__vite__mapDeps([0,1,2])).then(({listSuperBomVariable:e})=>{e(a).then(t=>{n.value=t.rows,s.total=t.total,w.value=!1}).catch(t=>{console.error("API调用失败，使用模拟数据:",t),D(a)})}).catch(e=>{console.error("API模块加载失败，使用模拟数据:",e),D(a)})},D=a=>{setTimeout(()=>{let e=[{variableId:1,bomId:I.bomId,bomName:"产品A超级BOM",variableCode:"COLOR",variableName:"颜色",defaultValue:"红色",description:"产品颜色变量",variableType:"string",isRequired:"1",sortOrder:1,createTime:"2025-12-12 10:00:00",updateTime:"2025-12-12 10:00:00"},{variableId:2,bomId:I.bomId,bomName:"产品A超级BOM",variableCode:"SIZE",variableName:"尺寸",defaultValue:"M",description:"产品尺寸变量",variableType:"string",isRequired:"1",sortOrder:2,createTime:"2025-12-12 10:00:00",updateTime:"2025-12-12 10:00:00"},{variableId:3,bomId:I.bomId,bomName:"产品A超级BOM",variableCode:"WEIGHT",variableName:"重量",defaultValue:"100",description:"产品重量变量",variableType:"number",isRequired:"0",sortOrder:3,createTime:"2025-12-12 10:00:00",updateTime:"2025-12-12 10:00:00"},{variableId:4,bomId:I.bomId,bomName:"产品A超级BOM",variableCode:"IS_ACTIVE",variableName:"是否激活",defaultValue:"true",description:"产品是否激活",variableType:"boolean",isRequired:"0",sortOrder:4,createTime:"2025-12-12 10:00:00",updateTime:"2025-12-12 10:00:00"},{variableId:5,bomId:I.bomId,bomName:"产品A超级BOM",variableCode:"PRODUCTION_DATE",variableName:"生产日期",defaultValue:"2025-01-01",description:"产品生产日期",variableType:"date",isRequired:"1",sortOrder:5,createTime:"2025-12-12 10:00:00",updateTime:"2025-12-12 10:00:00"}];a.variableCode&&(e=e.filter(b=>b.variableCode.toLowerCase().includes(a.variableCode.toLowerCase()))),a.variableName&&(e=e.filter(b=>b.variableName.toLowerCase().includes(a.variableName.toLowerCase()))),a.variableType&&(e=e.filter(b=>b.variableType===a.variableType)),a.isRequired&&(e=e.filter(b=>b.isRequired===a.isRequired));const t=(a.pageNum-1)*a.pageSize,u=t+a.pageSize,d=e.slice(t,u);n.value=d,s.total=e.length,w.value=!1},500)},L=()=>{A(),S.value="新增变量",v.value=!0},$=a=>{Object.assign(i,{...a}),S.value="编辑变量",v.value=!0},F=async a=>{try{await k.confirm(`确定要删除变量 "${a.variableName}" 吗？`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),N(async()=>{const{removeSuperBomVariable:e}=await import("./superBomVariable-_jqz_F6y.js");return{removeSuperBomVariable:e}},__vite__mapDeps([0,1,2])).then(({removeSuperBomVariable:e})=>{e([a.variableId]).then(t=>{p.success("变量删除成功"),f()}).catch(t=>{console.error("API调用失败，使用模拟数据:",t),n.value=n.value.filter(u=>u.variableId!==a.variableId),s.total=n.value.length,p.success("变量删除成功")})}).catch(e=>{console.error("API模块加载失败，使用模拟数据:",e),n.value=n.value.filter(t=>t.variableId!==a.variableId),s.total=n.value.length,p.success("变量删除成功")})}catch(e){e!=="cancel"&&(p.error("删除失败"),console.error("删除变量失败:",e))}},Y=async()=>{if(g.value.length===0){p.warning("请选择要删除的变量");return}try{await k.confirm(`确定要删除选中的 ${g.value.length} 个变量吗？`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),N(async()=>{const{removeSuperBomVariable:a}=await import("./superBomVariable-_jqz_F6y.js");return{removeSuperBomVariable:a}},__vite__mapDeps([0,1,2])).then(({removeSuperBomVariable:a})=>{const e=g.value.map(t=>t.variableId);a(e).then(t=>{p.success("变量批量删除成功"),f(),g.value=[]}).catch(t=>{console.error("API调用失败，使用模拟数据:",t);const u=g.value.map(d=>d.variableId);n.value=n.value.filter(d=>!u.includes(d.variableId)),s.total=n.value.length,g.value=[],p.success("变量批量删除成功")})}).catch(a=>{console.error("API模块加载失败，使用模拟数据:",a);const e=g.value.map(t=>t.variableId);n.value=n.value.filter(t=>!e.includes(t.variableId)),s.total=n.value.length,g.value=[],p.success("变量批量删除成功")})}catch(a){a!=="cancel"&&(p.error("批量删除失败"),console.error("批量删除变量失败:",a))}},j=async()=>{try{await R.value.validate();const a={...i};N(async()=>{const{addSuperBomVariable:e,updateSuperBomVariable:t}=await import("./superBomVariable-_jqz_F6y.js");return{addSuperBomVariable:e,updateSuperBomVariable:t}},__vite__mapDeps([0,1,2])).then(({addSuperBomVariable:e,updateSuperBomVariable:t})=>{a.variableId?t(a).then(u=>{p.success("变量更新成功"),v.value=!1,f()}).catch(u=>{console.error("API调用失败，使用模拟数据:",u);const d=n.value.findIndex(b=>b.variableId===a.variableId);d!==-1&&(n.value[d]={...a}),p.success("变量更新成功"),v.value=!1}):(delete a.variableCode,e(a).then(u=>{p.success("变量新增成功"),v.value=!1,f()}).catch(u=>{console.error("API调用失败，使用模拟数据:",u);const d={...a,variableId:Date.now(),variableCode:`VAR_${Date.now()}`,bomName:"产品A超级BOM",createTime:new Date().toISOString().slice(0,19).replace("T"," "),updateTime:new Date().toISOString().slice(0,19).replace("T"," ")};n.value.unshift(d),s.total=n.value.length,p.success("变量新增成功"),v.value=!1}))}).catch(e=>{if(console.error("API模块加载失败，使用模拟数据:",e),a.variableId){const t=n.value.findIndex(u=>u.variableId===a.variableId);t!==-1&&(n.value[t]={...a}),p.success("变量更新成功"),v.value=!1}else{const t={...a,variableId:Date.now(),variableCode:`VAR_${Date.now()}`,bomName:"产品A超级BOM",createTime:new Date().toISOString().slice(0,19).replace("T"," "),updateTime:new Date().toISOString().slice(0,19).replace("T"," ")};n.value.unshift(t),s.total=n.value.length,p.success("变量新增成功"),v.value=!1}})}catch(a){a!==!1&&(p.error("操作失败，请检查表单数据"),console.error("提交变量表单失败:",a))}},A=()=>{var a;i.variableId=null,i.variableCode="",i.variableName="",i.variableType="string",i.defaultValue="",i.isRequired="0",i.sortOrder=1,i.description="",(a=R.value)==null||a.resetFields()},Z=()=>{v.value=!1,A()},G=()=>{s.currentPage=1,f()},H=()=>{c.variableCode="",c.variableName="",c.variableType="",c.isRequired="",s.currentPage=1,f()},Q=a=>{s.pageSize=a,s.currentPage=1,f()},W=a=>{s.currentPage=a,f()},J=a=>{g.value=a};return ie(()=>{f()}),(a,e)=>{const t=m("el-button"),u=m("el-input"),d=m("el-form-item"),b=m("el-option"),P=m("el-select"),B=m("el-form"),_=m("el-table-column"),K=m("el-tag"),q=m("el-switch"),X=m("el-table"),ee=m("el-pagination"),ae=m("el-date-picker"),le=m("el-input-number"),te=m("el-dialog"),re=ne("loading");return C(),de("div",be,[T("div",pe,[e[16]||(e[16]=T("h3",null,"变量管理",-1)),T("div",ce,[l(t,{type:"primary",icon:"Plus",onClick:L},{default:o(()=>e[14]||(e[14]=[V("新增变量")])),_:1,__:[14]}),l(t,{type:"danger",icon:"Delete",onClick:Y,disabled:g.value.length===0},{default:o(()=>e[15]||(e[15]=[V(" 批量删除 ")])),_:1,__:[15]},8,["disabled"])])]),l(B,{inline:!0,model:c,class:"search-form","label-width":"100px"},{default:o(()=>[l(d,{label:"变量编码"},{default:o(()=>[l(u,{modelValue:c.variableCode,"onUpdate:modelValue":e[0]||(e[0]=r=>c.variableCode=r),placeholder:"请输入变量编码",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),l(d,{label:"变量名称"},{default:o(()=>[l(u,{modelValue:c.variableName,"onUpdate:modelValue":e[1]||(e[1]=r=>c.variableName=r),placeholder:"请输入变量名称",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),l(d,{label:"变量类型"},{default:o(()=>[l(P,{modelValue:c.variableType,"onUpdate:modelValue":e[2]||(e[2]=r=>c.variableType=r),placeholder:"请选择变量类型",clearable:"",style:{width:"150px"}},{default:o(()=>[l(b,{label:"字符串",value:"string"}),l(b,{label:"数字",value:"number"}),l(b,{label:"布尔值",value:"boolean"}),l(b,{label:"日期",value:"date"})]),_:1},8,["modelValue"])]),_:1}),l(d,{label:"是否必填"},{default:o(()=>[l(P,{modelValue:c.isRequired,"onUpdate:modelValue":e[3]||(e[3]=r=>c.isRequired=r),placeholder:"请选择是否必填",clearable:"",style:{width:"150px"}},{default:o(()=>[l(b,{label:"是",value:"1"}),l(b,{label:"否",value:"0"})]),_:1},8,["modelValue"])]),_:1}),l(d,null,{default:o(()=>[l(t,{type:"primary",icon:"Search",onClick:G},{default:o(()=>e[17]||(e[17]=[V("搜索")])),_:1,__:[17]}),l(t,{icon:"RefreshRight",onClick:H},{default:o(()=>e[18]||(e[18]=[V("重置")])),_:1,__:[18]})]),_:1})]),_:1},8,["model"]),se((C(),x(X,{data:n.value,stripe:"",style:{width:"100%"},onSelectionChange:J},{default:o(()=>[l(_,{type:"selection",width:"55",align:"center"}),l(_,{label:"变量编码",align:"center",prop:"variableCode","min-width":"150"}),l(_,{label:"变量名称",align:"center",prop:"variableName","min-width":"150"}),l(_,{label:"变量类型",align:"center",prop:"variableType",width:"120"},{default:o(r=>[l(K,{type:U(r.row.variableType)},{default:o(()=>[V(ue(z(r.row.variableType)),1)]),_:2},1032,["type"])]),_:1}),l(_,{label:"默认值",align:"center",prop:"defaultValue","min-width":"150"}),l(_,{label:"是否必填",align:"center",prop:"isRequired",width:"100"},{default:o(r=>[l(q,{modelValue:r.row.isRequired,"onUpdate:modelValue":O=>r.row.isRequired=O,"active-value":"1","inactive-value":"0",disabled:""},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(_,{label:"排序",align:"center",prop:"sortOrder",width:"100"}),l(_,{label:"描述",align:"center",prop:"description","min-width":"200","show-overflow-tooltip":""}),l(_,{label:"操作",align:"center",width:"150",fixed:"right"},{default:o(r=>[l(t,{size:"small",type:"primary",icon:"Edit",onClick:O=>$(r.row)},{default:o(()=>e[19]||(e[19]=[V(" 编辑 ")])),_:2,__:[19]},1032,["onClick"]),l(t,{size:"small",type:"danger",icon:"Delete",onClick:O=>F(r.row)},{default:o(()=>e[20]||(e[20]=[V(" 删除 ")])),_:2,__:[20]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[re,w.value]]),T("div",me,[l(ee,{"current-page":s.currentPage,"onUpdate:currentPage":e[4]||(e[4]=r=>s.currentPage=r),"page-size":s.pageSize,"onUpdate:pageSize":e[5]||(e[5]=r=>s.pageSize=r),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:s.total,onSizeChange:Q,onCurrentChange:W},null,8,["current-page","page-size","total"])]),l(te,{title:S.value,modelValue:v.value,"onUpdate:modelValue":e[13]||(e[13]=r=>v.value=r),width:"600px","append-to-body":""},{footer:o(()=>[T("span",ve,[l(t,{onClick:Z},{default:o(()=>e[22]||(e[22]=[V("取消")])),_:1,__:[22]}),l(t,{type:"primary",onClick:j},{default:o(()=>e[23]||(e[23]=[V("确定")])),_:1,__:[23]})])]),default:o(()=>[l(B,{ref_key:"variableFormRef",ref:R,model:i,rules:E,"label-width":"120px"},{default:o(()=>[l(d,{label:"变量编码",prop:"variableCode"},{default:o(()=>[l(u,{modelValue:i.variableCode,"onUpdate:modelValue":e[6]||(e[6]=r=>i.variableCode=r),placeholder:"请输入变量编码",disabled:!i.variableId},null,8,["modelValue","disabled"]),e[21]||(e[21]=T("div",{class:"form-tip"},"新增时自动生成，编辑时可修改",-1))]),_:1,__:[21]}),l(d,{label:"变量名称",prop:"variableName"},{default:o(()=>[l(u,{modelValue:i.variableName,"onUpdate:modelValue":e[7]||(e[7]=r=>i.variableName=r),placeholder:"请输入变量名称"},null,8,["modelValue"])]),_:1}),l(d,{label:"默认值",prop:"defaultValue"},{default:o(()=>[i.variableType!=="date"?(C(),x(u,{key:0,modelValue:i.defaultValue,"onUpdate:modelValue":e[8]||(e[8]=r=>i.defaultValue=r),placeholder:"请输入默认值",type:i.variableType==="number"?"number":"text"},null,8,["modelValue","type"])):(C(),x(ae,{key:1,modelValue:i.defaultValue,"onUpdate:modelValue":e[9]||(e[9]=r=>i.defaultValue=r),type:"date",placeholder:"请选择默认日期",style:{width:"100%"},"value-format":"YYYY-MM-DD"},null,8,["modelValue"]))]),_:1}),l(d,{label:"是否必填",prop:"isRequired"},{default:o(()=>[l(q,{modelValue:i.isRequired,"onUpdate:modelValue":e[10]||(e[10]=r=>i.isRequired=r),"active-value":"1","inactive-value":"0"},null,8,["modelValue"])]),_:1}),l(d,{label:"排序",prop:"sortOrder"},{default:o(()=>[l(le,{modelValue:i.sortOrder,"onUpdate:modelValue":e[11]||(e[11]=r=>i.sortOrder=r),min:1,max:999,placeholder:"请输入排序"},null,8,["modelValue"])]),_:1}),l(d,{label:"描述",prop:"description"},{default:o(()=>[l(u,{modelValue:i.description,"onUpdate:modelValue":e[12]||(e[12]=r=>i.description=r),type:"textarea",placeholder:"请输入变量描述",rows:3},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])])}}},_e=oe(ge,[["__scopeId","data-v-6b5b4255"]]);export{_e as default};
