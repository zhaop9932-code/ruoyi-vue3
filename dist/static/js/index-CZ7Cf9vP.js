import{r as f,C as x,o as ae,h as u,G as ne,d as re,e as E,i as e,H as z,k as o,p as F,q as d,I as K,t as U,l as ue,j as ie,V as g,E as de}from"./index-CwdKQqOf.js";import{l as se,d as pe,u as me,e as ce}from"./rule-nChVW3Ks.js";const fe={class:"app-container"},ge={class:"dialog-footer"},ve={__name:"index",setup(ye){const v=f(!0),C=f(!0),w=f(0),D=f([]),S=f([]),N=f(""),y=f(!1),k=f(null),M=f(null),r=x({pageNum:1,pageSize:10,ruleCode:"",ruleName:"",ruleType:"",ruleStatus:""}),t=x({ruleId:null,ruleCode:"",ruleName:"",ruleType:"condition",conditionType:"simple",conditionConfig:"",actionType:"simple",actionConfig:"",rulePriority:1,effectiveDate:"",expireDate:"",ruleStatus:"1",description:""}),$=x({ruleCode:[{required:!0,message:"规则编码不能为空",trigger:"blur"}],ruleName:[{required:!0,message:"规则名称不能为空",trigger:"blur"}],ruleType:[{required:!0,message:"规则类型不能为空",trigger:"change"}],conditionType:[{required:!0,message:"条件类型不能为空",trigger:"change"}],conditionConfig:[{required:!0,message:"条件配置不能为空",trigger:"blur"}],actionType:[{required:!0,message:"动作类型不能为空",trigger:"change"}],actionConfig:[{required:!0,message:"动作配置不能为空",trigger:"blur"}],rulePriority:[{required:!0,message:"规则优先级不能为空",trigger:"blur"}]}),_=async()=>{v.value=!0;try{const n=await se(r);D.value=n.rows,w.value=n.total,v.value=!1}catch{v.value=!1,g.error("获取规则列表失败")}},V=()=>{r.pageNum=1,_()},J=()=>{r.ruleCode="",r.ruleName="",r.ruleType="",r.ruleStatus="",V()},L=()=>{C.value=!C.value},O=n=>{S.value=n},Q=()=>{t.ruleId=null,t.ruleCode="",t.ruleName="",t.ruleType="condition",t.conditionType="simple",t.conditionConfig="",t.actionType="simple",t.actionConfig="",t.rulePriority=1,t.effectiveDate="",t.expireDate="",t.ruleStatus="1",t.description="",N.value="新增配置规则",y.value=!0},j=n=>{t.ruleId=n.ruleId,t.ruleCode=n.ruleCode,t.ruleName=n.ruleName,t.ruleType=n.ruleType,t.conditionType=n.conditionType,t.conditionConfig=n.conditionConfig,t.actionType=n.actionType,t.actionConfig=n.actionConfig,t.rulePriority=n.rulePriority,t.effectiveDate=n.effectiveDate,t.expireDate=n.expireDate,t.ruleStatus=n.ruleStatus,t.description=n.description,N.value="修改配置规则",y.value=!0},P=async n=>{const l=n.ruleId?[n.ruleId]:S.value.map(m=>m.ruleId);await de.confirm("确定要删除选中的规则吗？","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});try{await pe(l),g.success("删除成功"),_()}catch{g.error("删除失败")}},A=n=>{g.info("规则测试功能待实现")},G=async()=>{await k.value.validate();try{t.ruleId?(await me(t),g.success("修改成功")):(await ce(t),g.success("新增成功")),y.value=!1,_()}catch{g.error("操作失败")}},H=()=>{var n;(n=k.value)==null||n.resetFields()},W=()=>{y.value=!1,H()};return ae(()=>{_()}),(n,l)=>{const m=u("el-input"),i=u("el-form-item"),s=u("el-option"),b=u("el-select"),p=u("el-button"),q=u("el-form"),X=u("el-card"),T=u("el-col"),Y=u("el-row"),c=u("el-table-column"),I=u("el-tag"),Z=u("el-table"),h=u("pagination"),ee=u("el-input-number"),R=u("el-radio"),le=u("el-radio-group"),te=u("el-dialog"),oe=ne("loading");return E(),re("div",fe,[e(X,{shadow:"never",class:"search-card"},{default:o(()=>[z(e(q,{model:r,ref_key:"queryForm",ref:M,inline:!0,"label-width":"80px"},{default:o(()=>[e(i,{label:"规则编码",prop:"ruleCode"},{default:o(()=>[e(m,{modelValue:r.ruleCode,"onUpdate:modelValue":l[0]||(l[0]=a=>r.ruleCode=a),placeholder:"请输入规则编码",clearable:"",size:"small",onKeyup:F(V,["enter"])},null,8,["modelValue"])]),_:1}),e(i,{label:"规则名称",prop:"ruleName"},{default:o(()=>[e(m,{modelValue:r.ruleName,"onUpdate:modelValue":l[1]||(l[1]=a=>r.ruleName=a),placeholder:"请输入规则名称",clearable:"",size:"small",onKeyup:F(V,["enter"])},null,8,["modelValue"])]),_:1}),e(i,{label:"规则类型",prop:"ruleType"},{default:o(()=>[e(b,{modelValue:r.ruleType,"onUpdate:modelValue":l[2]||(l[2]=a=>r.ruleType=a),placeholder:"请选择规则类型",clearable:"",size:"small"},{default:o(()=>[e(s,{label:"条件规则",value:"condition"}),e(s,{label:"动作规则",value:"action"}),e(s,{label:"验证规则",value:"validation"}),e(s,{label:"计算规则",value:"calculation"})]),_:1},8,["modelValue"])]),_:1}),e(i,{label:"规则状态",prop:"ruleStatus"},{default:o(()=>[e(b,{modelValue:r.ruleStatus,"onUpdate:modelValue":l[3]||(l[3]=a=>r.ruleStatus=a),placeholder:"请选择规则状态",clearable:"",size:"small"},{default:o(()=>[e(s,{label:"启用",value:"1"}),e(s,{label:"禁用",value:"0"})]),_:1},8,["modelValue"])]),_:1}),e(i,null,{default:o(()=>[e(p,{type:"primary",icon:"Search",size:"small",onClick:V},{default:o(()=>l[17]||(l[17]=[d("搜索")])),_:1,__:[17]}),e(p,{icon:"RefreshRight",size:"small",onClick:J},{default:o(()=>l[18]||(l[18]=[d("重置")])),_:1,__:[18]})]),_:1})]),_:1},8,["model"]),[[K,C.value]])]),_:1}),e(Y,{gutter:10,class:"mb8"},{default:o(()=>[e(T,{span:1.5},{default:o(()=>[e(p,{type:"primary",icon:"Plus",size:"small",onClick:Q},{default:o(()=>l[19]||(l[19]=[d(" 新增 ")])),_:1,__:[19]})]),_:1}),e(T,{span:1.5},{default:o(()=>[e(p,{type:"danger",icon:"Delete",size:"small",disabled:S.value.length===0,onClick:P},{default:o(()=>l[20]||(l[20]=[d(" 批量删除 ")])),_:1,__:[20]},8,["disabled"])]),_:1}),e(T,{span:1.5},{default:o(()=>[e(p,{type:"warning",icon:"Download",size:"small",onClick:n.handleExport},{default:o(()=>l[21]||(l[21]=[d(" 导出 ")])),_:1,__:[21]},8,["onClick"])]),_:1}),e(T,{span:20.5},{default:o(()=>[e(p,{type:"info",icon:"Search",size:"small",onClick:L,style:{float:"right"}},{default:o(()=>[d(U(C.value?"收起":"展开")+"搜索 ",1)]),_:1})]),_:1})]),_:1}),z((E(),ue(Z,{data:D.value,onSelectionChange:O},{default:o(()=>[e(c,{type:"selection",width:"55",align:"center"}),e(c,{label:"规则编码",align:"center",prop:"ruleCode"}),e(c,{label:"规则名称",align:"center",prop:"ruleName","show-overflow-tooltip":!0}),e(c,{label:"规则类型",align:"center",prop:"ruleType"},{default:o(a=>[e(I,{type:a.row.ruleType==="condition"?"primary":a.row.ruleType==="action"?"success":a.row.ruleType==="validation"?"warning":"info",size:"small"},{default:o(()=>[d(U(a.row.ruleType==="condition"?"条件规则":a.row.ruleType==="action"?"动作规则":a.row.ruleType==="validation"?"验证规则":"计算规则"),1)]),_:2},1032,["type"])]),_:1}),e(c,{label:"条件类型",align:"center",prop:"conditionType"}),e(c,{label:"动作类型",align:"center",prop:"actionType"}),e(c,{label:"优先级",align:"center",prop:"rulePriority"}),e(c,{label:"规则状态",align:"center",prop:"ruleStatus"},{default:o(a=>[e(I,{type:a.row.ruleStatus==="1"?"success":"danger",size:"small"},{default:o(()=>[d(U(a.row.ruleStatus==="1"?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),e(c,{label:"创建时间",align:"center",prop:"createTime",width:"180"}),e(c,{label:"操作",align:"center","class-name":"small-padding fixed-width",width:"200"},{default:o(a=>[e(p,{size:"small",type:"primary",icon:"Edit",onClick:B=>j(a.row)},{default:o(()=>l[22]||(l[22]=[d(" 修改 ")])),_:2,__:[22]},1032,["onClick"]),e(p,{size:"small",type:"danger",icon:"Delete",onClick:B=>P(a.row)},{default:o(()=>l[23]||(l[23]=[d(" 删除 ")])),_:2,__:[23]},1032,["onClick"]),e(p,{size:"small",type:"success",icon:"PlayCircle",onClick:B=>A(a.row)},{default:o(()=>l[24]||(l[24]=[d(" 测试 ")])),_:2,__:[24]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[oe,v.value]]),z(e(h,{total:w.value,page:r.pageNum,"onUpdate:page":l[4]||(l[4]=a=>r.pageNum=a),limit:r.pageSize,"onUpdate:limit":l[5]||(l[5]=a=>r.pageSize=a),onPagination:_},null,8,["total","page","limit"]),[[K,w.value>0]]),e(te,{title:N.value,modelValue:y.value,"onUpdate:modelValue":l[16]||(l[16]=a=>y.value=a),width:"800px","append-to-body":""},{footer:o(()=>[ie("span",ge,[e(p,{onClick:W},{default:o(()=>l[27]||(l[27]=[d("取消")])),_:1,__:[27]}),e(p,{type:"primary",onClick:G},{default:o(()=>l[28]||(l[28]=[d("确定")])),_:1,__:[28]})])]),default:o(()=>[e(q,{ref_key:"formRef",ref:k,model:t,rules:$,"label-width":"120px"},{default:o(()=>[e(i,{label:"规则编码",prop:"ruleCode"},{default:o(()=>[e(m,{modelValue:t.ruleCode,"onUpdate:modelValue":l[6]||(l[6]=a=>t.ruleCode=a),placeholder:"请输入规则编码"},null,8,["modelValue"])]),_:1}),e(i,{label:"规则名称",prop:"ruleName"},{default:o(()=>[e(m,{modelValue:t.ruleName,"onUpdate:modelValue":l[7]||(l[7]=a=>t.ruleName=a),placeholder:"请输入规则名称"},null,8,["modelValue"])]),_:1}),e(i,{label:"规则类型",prop:"ruleType"},{default:o(()=>[e(b,{modelValue:t.ruleType,"onUpdate:modelValue":l[8]||(l[8]=a=>t.ruleType=a),placeholder:"请选择规则类型"},{default:o(()=>[e(s,{label:"条件规则",value:"condition"}),e(s,{label:"动作规则",value:"action"}),e(s,{label:"验证规则",value:"validation"}),e(s,{label:"计算规则",value:"calculation"})]),_:1},8,["modelValue"])]),_:1}),e(i,{label:"条件类型",prop:"conditionType"},{default:o(()=>[e(b,{modelValue:t.conditionType,"onUpdate:modelValue":l[9]||(l[9]=a=>t.conditionType=a),placeholder:"请选择条件类型"},{default:o(()=>[e(s,{label:"简单条件",value:"simple"}),e(s,{label:"复杂条件",value:"complex"})]),_:1},8,["modelValue"])]),_:1}),e(i,{label:"条件配置",prop:"conditionConfig"},{default:o(()=>[e(m,{modelValue:t.conditionConfig,"onUpdate:modelValue":l[10]||(l[10]=a=>t.conditionConfig=a),type:"textarea",placeholder:"请输入条件配置（JSON格式）",rows:4},null,8,["modelValue"])]),_:1}),e(i,{label:"动作类型",prop:"actionType"},{default:o(()=>[e(b,{modelValue:t.actionType,"onUpdate:modelValue":l[11]||(l[11]=a=>t.actionType=a),placeholder:"请选择动作类型"},{default:o(()=>[e(s,{label:"简单动作",value:"simple"}),e(s,{label:"复杂动作",value:"complex"})]),_:1},8,["modelValue"])]),_:1}),e(i,{label:"动作配置",prop:"actionConfig"},{default:o(()=>[e(m,{modelValue:t.actionConfig,"onUpdate:modelValue":l[12]||(l[12]=a=>t.actionConfig=a),type:"textarea",placeholder:"请输入动作配置（JSON格式）",rows:4},null,8,["modelValue"])]),_:1}),e(i,{label:"规则优先级",prop:"rulePriority"},{default:o(()=>[e(ee,{modelValue:t.rulePriority,"onUpdate:modelValue":l[13]||(l[13]=a=>t.rulePriority=a),min:1,step:1},null,8,["modelValue"])]),_:1}),e(i,{label:"规则状态",prop:"ruleStatus"},{default:o(()=>[e(le,{modelValue:t.ruleStatus,"onUpdate:modelValue":l[14]||(l[14]=a=>t.ruleStatus=a)},{default:o(()=>[e(R,{label:"1"},{default:o(()=>l[25]||(l[25]=[d("启用")])),_:1,__:[25]}),e(R,{label:"0"},{default:o(()=>l[26]||(l[26]=[d("禁用")])),_:1,__:[26]})]),_:1},8,["modelValue"])]),_:1}),e(i,{label:"规则描述",prop:"description"},{default:o(()=>[e(m,{modelValue:t.description,"onUpdate:modelValue":l[15]||(l[15]=a=>t.description=a),type:"textarea",placeholder:"请输入规则描述",rows:3},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])])}}};export{ve as default};
