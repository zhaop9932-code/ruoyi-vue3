import{_ as D,r as f,w as x,V as c,o as U,h as m,d as V,e as E,i as l,k as d,m as P,n as y,j as h,q as N,a1 as z,ad as J}from"./index-CwdKQqOf.js";import{d as M}from"./vuedraggable.umd--7ZlTSKc.js";import O from"./RuleActionItem-B640NeOR.js";import{l as $,s as j}from"./ruleAction-pCoBry9w.js";import"./sortable.esm-DM_MqmTE.js";import"./ActionHeader-DshL1bXx.js";import"./ActionContent-Dw0ch5ry.js";import"./ActionTypeSelector-D6XzvoPv.js";import"./actionConfig-C-hhf0v-.js";import"./TargetTypeSelector-DMvPq2hV.js";import"./TargetObjectSelector-D57w5mnf.js";import"./NodeSelector-Ct-lJUlq.js";import"./superBomStructure-BzSqI57Q.js";import"./AttributeSelector-D3T3OJek.js";import"./bom-DdrUuB8x.js";import"./superBomDynamicAttribute-BGTx_QxK.js";import"./superBomProductRelation-e2EKVMIZ.js";import"./superBomRuleRelation-Cz_bCmLL.js";import"./superBomVariable-gMrvMuGl.js";import"./ActionParamsConfig-D_MeBCNX.js";import"./BasicInfoSection-BjcOnwIf.js";const F={class:"rule-action-config"},G={class:"card-header"},H={class:"header-buttons"},K={key:0,class:"empty-actions"},L={__name:"RuleActionConfig",props:{modelValue:{type:Array,default:()=>[]},ruleType:{type:String,default:"validation"},ruleId:{type:[String,Number],default:null},bomId:{type:[String,Number],required:!0}},emits:["update:modelValue","update:actions"],setup(I,{emit:C}){const s=I,A=C,a=f([...s.modelValue]),u=f(null),v=f(null);x(()=>s.modelValue,e=>{JSON.stringify(e)!==JSON.stringify(a.value)&&(a.value=[...e])},{deep:!0}),x(()=>s.ruleId,e=>{e&&b(e)});const b=async e=>{var t,n;try{const o=await $(e);a.value=o.data||[],a.value.forEach(r=>{r.structure=r.structure||null,r.attribute=r.attribute||null,r.dynamicAttribute=r.dynamicAttribute||null}),i()}catch(o){console.error("加载动作失败:",o),c.error("加载动作失败："+(((n=(t=o.response)==null?void 0:t.data)==null?void 0:n.message)||o.message||"未知错误"))}};U(()=>{s.ruleId&&b(s.ruleId)});const S=(e,t)=>{a.value[e]=t,i()},k=async e=>{var t,n;try{const o=a.value[e];o.actionId&&console.log("删除动作:",o.actionId),a.value.splice(e,1),c.success("动作删除成功"),i()}catch(o){console.error("删除动作失败:",o),c.error("删除动作失败："+(((n=(t=o.response)==null?void 0:t.data)==null?void 0:n.message)||o.message||"未知错误"))}},T=e=>{e.actionId===u.value?u.value=null:(u.value=e.actionId,v.value=null)},w=()=>{const e={actionId:null,ruleId:s.ruleId,actionType:"",actionName:"",actionCode:"",targetType:"",targetId:"",actionParams:"",actionPriority:1,parentActionId:null,actionSequence:a.value.length+1,executeCondition:'{"type": "always"}',actionStatus:"0",description:""};a.value.push(e),u.value=null,v.value=a.value.length-1,i()},R=async()=>{var e,t;try{await j(Number(s.ruleId),a.value),c.success("动作列表保存成功"),i()}catch(n){console.error("保存动作列表失败:",n),c.error("保存动作列表失败："+(((t=(e=n.response)==null?void 0:e.data)==null?void 0:t.message)||n.message||"未知错误"))}},i=()=>{A("update:modelValue",a.value),A("update:actions",a.value)},B=()=>{a.value.forEach((e,t)=>{e.actionSequence=t+1}),i()};return(e,t)=>{const n=m("el-icon"),o=m("el-button"),r=m("el-empty"),q=m("el-card");return E(),V("div",F,[l(q,{class:"action-chain",shadow:"hover"},{header:d(()=>[h("div",G,[t[3]||(t[3]=h("span",null,"动作执行链",-1)),h("div",H,[l(o,{type:"success",size:"small",onClick:R,disabled:!s.ruleId},{default:d(()=>[l(n,null,{default:d(()=>[l(y(z))]),_:1}),t[1]||(t[1]=N(" 保存动作列表 "))]),_:1,__:[1]},8,["disabled"]),l(o,{type:"primary",size:"small",onClick:w},{default:d(()=>[l(n,null,{default:d(()=>[l(y(J))]),_:1}),t[2]||(t[2]=N(" 添加动作 "))]),_:1,__:[2]})])])]),default:d(()=>[a.value.length===0?(E(),V("div",K,[l(r,{description:"暂无动作"})])):P("",!0),l(y(M),{modelValue:a.value,"onUpdate:modelValue":t[0]||(t[0]=p=>a.value=p),"item-key":"actionId",handle:".drag-handle","ghost-class":"ghost",onEnd:B},{item:d(({element:p,index:g})=>[l(O,{element:p,index:g,"expanded-action-id":u.value,"expanded-action-index":v.value,"bom-id":I.bomId,"onUpdate:element":_=>S(g,_),onDeleteAction:_=>k(g),onToggleExpand:_=>T(p)},null,8,["element","index","expanded-action-id","expanded-action-index","bom-id","onUpdate:element","onDeleteAction","onToggleExpand"])]),_:1},8,["modelValue"])]),_:1})])}}},_e=D(L,[["__scopeId","data-v-b82051d7"]]);export{_e as default};
