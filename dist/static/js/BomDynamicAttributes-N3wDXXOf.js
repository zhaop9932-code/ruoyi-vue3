import{_ as Y,r as b,C as U,o as ee,h as n,G as te,d as O,e as u,j as I,H as le,i as a,k as o,q as f,l as c,t as ae,m as re,K as oe,L as ne,E as A,V}from"./index-CwdKQqOf.js";const de={class:"bom-dynamic-attributes"},ue={class:"management-header"},se={class:"header-buttons"},ie={class:"dialog-footer"},pe={__name:"BomDynamicAttributes",props:{bomId:{type:[String,Number],required:!0}},setup(B){const g=B,C=b(!1),v=b([]),y=b(!1),k=b("新增属性"),x=b(null),s=b([]),p=b(""),t=U({attrId:null,bomId:g.bomId,attrCode:"",attrName:"",attrType:"string",attrValue:"",required:!1,sortOrder:0,description:"",options:[]}),D=U({attrCode:[{required:!0,message:"属性编码不能为空",trigger:"blur"},{pattern:/^[a-zA-Z0-9_]+$/,message:"属性编码只能包含字母、数字和下划线",trigger:"blur"}],attrName:[{required:!0,message:"属性名称不能为空",trigger:"blur"}],attrType:[{required:!0,message:"请选择属性类型",trigger:"change"}]}),$=r=>({string:"文本",number:"数字",boolean:"布尔值",date:"日期",select:"下拉选择"})[r]||r,F=r=>({string:"primary",number:"success",boolean:"warning",date:"info",select:"danger"})[r]||"default",M=()=>{C.value=!0,setTimeout(()=>{s.value=[{attrId:1,bomId:g.bomId,attrCode:"color",attrName:"颜色",attrType:"select",attrValue:"red",required:!0,sortOrder:1,description:"产品颜色",options:[{value:"red",label:"红色"},{value:"blue",label:"蓝色"},{value:"green",label:"绿色"}]},{attrId:2,bomId:g.bomId,attrCode:"weight",attrName:"重量",attrType:"number",attrValue:100,required:!1,sortOrder:2,description:"产品重量（g）"},{attrId:3,bomId:g.bomId,attrCode:"is_active",attrName:"是否激活",attrType:"boolean",attrValue:!0,required:!1,sortOrder:3,description:"产品是否激活"},{attrId:4,bomId:g.bomId,attrCode:"release_date",attrName:"发布日期",attrType:"date",attrValue:"2023-01-01",required:!0,sortOrder:4,description:"产品发布日期"},{attrId:5,bomId:g.bomId,attrCode:"description",attrName:"产品描述",attrType:"string",attrValue:"这是一个测试产品",required:!1,sortOrder:5,description:"产品详细描述"}],C.value=!1},500)},E=()=>{t.attrValue="",t.options=[],p.value="",t.attrType==="boolean"&&(t.attrValue=!1)},S=()=>{if(!p.value){t.options=[];return}const r=p.value.split(`
`).map(e=>e.trim()).filter(e=>e).map(e=>{const d=e.split("=");return d.length===2?{value:d[0].trim(),label:d[1].trim()}:{value:e,label:e}});t.options=r},z=r=>{v.value=r},L=()=>{K(),k.value="新增属性",y.value=!0},j=r=>{Object.assign(t,{...r}),r.attrType==="select"&&r.options&&r.options.length>0?p.value=r.options.map(e=>`${e.value}=${e.label}`).join(`
`):p.value="",k.value="编辑属性",y.value=!0},R=async r=>{try{await A.confirm(`确定要删除属性 "${r.attrName}" 吗？`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),s.value=s.value.filter(e=>e.attrId!==r.attrId),V.success("属性删除成功")}catch(e){e!=="cancel"&&(V.error("删除失败"),console.error("删除属性失败:",e))}},G=async()=>{if(v.value.length!==0)try{await A.confirm(`确定要删除选中的 ${v.value.length} 个属性吗？`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const r=v.value.map(e=>e.attrId);s.value=s.value.filter(e=>!r.includes(e.attrId)),v.value=[],V.success("批量删除成功")}catch(r){r!=="cancel"&&(V.error("批量删除失败"),console.error("批量删除属性失败:",r))}},H=async()=>{try{if(t.attrType==="select"&&S(),await x.value.validate(),t.attrId){const r=s.value.findIndex(e=>e.attrId===t.attrId);r!==-1&&(s.value[r]={...t}),V.success("属性更新成功")}else{const r={...t,attrId:Date.now()};s.value.push(r),V.success("属性新增成功")}y.value=!1}catch(r){r!==!1&&(V.error("操作失败，请检查表单数据"),console.error("提交属性表单失败:",r))}},K=()=>{var r;t.attrId=null,t.attrCode="",t.attrName="",t.attrType="string",t.attrValue="",t.required=!1,t.sortOrder=0,t.description="",t.options=[],p.value="",(r=x.value)==null||r.resetFields()};return ee(()=>{M()}),(r,e)=>{const d=n("el-button"),i=n("el-table-column"),P=n("el-tag"),N=n("el-switch"),h=n("el-input-number"),Z=n("el-table"),T=n("el-input"),m=n("el-form-item"),_=n("el-option"),q=n("el-select"),J=n("el-date-picker"),Q=n("el-form"),W=n("el-dialog"),X=te("loading");return u(),O("div",de,[I("div",ue,[e[16]||(e[16]=I("h3",null,"动态属性管理",-1)),I("div",se,[a(d,{type:"primary",icon:"Plus",onClick:L},{default:o(()=>e[14]||(e[14]=[f("新增属性")])),_:1,__:[14]}),a(d,{type:"danger",icon:"Delete",onClick:G,disabled:v.value.length===0},{default:o(()=>e[15]||(e[15]=[f("批量删除")])),_:1,__:[15]},8,["disabled"])])]),le((u(),c(Z,{data:s.value,stripe:"",style:{width:"100%"}},{default:o(()=>[a(i,{type:"selection",width:"55",align:"center",onSelectionChange:z}),a(i,{label:"属性编码",align:"center",prop:"attrCode","min-width":"150"}),a(i,{label:"属性名称",align:"center",prop:"attrName","min-width":"150"}),a(i,{label:"属性类型",align:"center",prop:"attrType",width:"120"},{default:o(l=>[a(P,{type:F(l.row.attrType)},{default:o(()=>[f(ae($(l.row.attrType)),1)]),_:2},1032,["type"])]),_:1}),a(i,{label:"属性值",align:"center",prop:"attrValue","min-width":"150"}),a(i,{label:"是否必填",align:"center",prop:"required",width:"100"},{default:o(l=>[a(N,{modelValue:l.row.required,"onUpdate:modelValue":w=>l.row.required=w,disabled:""},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(i,{label:"排序",align:"center",prop:"sortOrder",width:"80"},{default:o(l=>[a(h,{modelValue:l.row.sortOrder,"onUpdate:modelValue":w=>l.row.sortOrder=w,min:0,step:1,disabled:!0,size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(i,{label:"描述",align:"center",prop:"description","min-width":"200","show-overflow-tooltip":""}),a(i,{label:"操作",align:"center",width:"150",fixed:"right"},{default:o(l=>[a(d,{size:"small",type:"primary",icon:"Edit",onClick:w=>j(l.row)},{default:o(()=>e[17]||(e[17]=[f(" 编辑 ")])),_:2,__:[17]},1032,["onClick"]),a(d,{size:"small",type:"danger",icon:"Delete",onClick:w=>R(l.row)},{default:o(()=>e[18]||(e[18]=[f(" 删除 ")])),_:2,__:[18]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[X,C.value]]),a(W,{title:k.value,modelValue:y.value,"onUpdate:modelValue":e[13]||(e[13]=l=>y.value=l),width:"600px","append-to-body":""},{footer:o(()=>[I("span",ie,[a(d,{onClick:e[12]||(e[12]=l=>y.value=!1)},{default:o(()=>e[20]||(e[20]=[f("取消")])),_:1,__:[20]}),a(d,{type:"primary",onClick:H},{default:o(()=>e[21]||(e[21]=[f("确定")])),_:1,__:[21]})])]),default:o(()=>[a(Q,{ref_key:"attributeFormRef",ref:x,model:t,rules:D,"label-width":"120px"},{default:o(()=>[a(m,{label:"属性编码",prop:"attrCode"},{default:o(()=>[a(T,{modelValue:t.attrCode,"onUpdate:modelValue":e[0]||(e[0]=l=>t.attrCode=l),placeholder:"请输入属性编码"},null,8,["modelValue"])]),_:1}),a(m,{label:"属性名称",prop:"attrName"},{default:o(()=>[a(T,{modelValue:t.attrName,"onUpdate:modelValue":e[1]||(e[1]=l=>t.attrName=l),placeholder:"请输入属性名称"},null,8,["modelValue"])]),_:1}),a(m,{label:"属性类型",prop:"attrType"},{default:o(()=>[a(q,{modelValue:t.attrType,"onUpdate:modelValue":e[2]||(e[2]=l=>t.attrType=l),placeholder:"请选择属性类型",onChange:E},{default:o(()=>[a(_,{label:"文本",value:"string"}),a(_,{label:"数字",value:"number"}),a(_,{label:"布尔值",value:"boolean"}),a(_,{label:"日期",value:"date"}),a(_,{label:"下拉选择",value:"select"})]),_:1},8,["modelValue"])]),_:1}),t.attrType==="select"?(u(),c(m,{key:0,label:"选项列表",prop:"options"},{default:o(()=>[a(T,{modelValue:p.value,"onUpdate:modelValue":e[3]||(e[3]=l=>p.value=l),type:"textarea",placeholder:"请输入选项，每行一个，格式：值=显示文本",rows:4},null,8,["modelValue"]),e[19]||(e[19]=I("div",{class:"form-tip"},"示例：red=红色 blue=蓝色 green=绿色",-1))]),_:1,__:[19]})):re("",!0),a(m,{label:"默认值",prop:"attrValue"},{default:o(()=>[t.attrType==="boolean"?(u(),c(N,{key:0,modelValue:t.attrValue,"onUpdate:modelValue":e[4]||(e[4]=l=>t.attrValue=l)},null,8,["modelValue"])):t.attrType==="date"?(u(),c(J,{key:1,modelValue:t.attrValue,"onUpdate:modelValue":e[5]||(e[5]=l=>t.attrValue=l),type:"date",placeholder:"选择日期",style:{width:"100%"}},null,8,["modelValue"])):t.attrType==="select"&&t.options&&t.options.length>0?(u(),c(q,{key:2,modelValue:t.attrValue,"onUpdate:modelValue":e[6]||(e[6]=l=>t.attrValue=l),placeholder:"请选择属性值"},{default:o(()=>[(u(!0),O(oe,null,ne(t.options,l=>(u(),c(_,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):t.attrType==="number"?(u(),c(h,{key:3,modelValue:t.attrValue,"onUpdate:modelValue":e[7]||(e[7]=l=>t.attrValue=l),min:0,step:1,placeholder:"请输入数值"},null,8,["modelValue"])):(u(),c(T,{key:4,modelValue:t.attrValue,"onUpdate:modelValue":e[8]||(e[8]=l=>t.attrValue=l),placeholder:"请输入属性值"},null,8,["modelValue"]))]),_:1}),a(m,{label:"是否必填",prop:"required"},{default:o(()=>[a(N,{modelValue:t.required,"onUpdate:modelValue":e[9]||(e[9]=l=>t.required=l)},null,8,["modelValue"])]),_:1}),a(m,{label:"排序",prop:"sortOrder"},{default:o(()=>[a(h,{modelValue:t.sortOrder,"onUpdate:modelValue":e[10]||(e[10]=l=>t.sortOrder=l),min:0,step:1,placeholder:"请输入排序号"},null,8,["modelValue"])]),_:1}),a(m,{label:"描述",prop:"description"},{default:o(()=>[a(T,{modelValue:t.description,"onUpdate:modelValue":e[11]||(e[11]=l=>t.description=l),type:"textarea",placeholder:"请输入属性描述",rows:3},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])])}}},ce=Y(pe,[["__scopeId","data-v-57dab210"]]);export{ce as default};
