import{a9 as V,r as y,$ as z,h as Z,a as n,i as ee,c as te,o as P,b as e,j as x,w as a,U as D,f as i,a0 as E,t as $,m as ae,e as le,E as _}from"./index-DgigFOm-.js";function oe(g){return V({url:"/cpq/pricingStrategy/list",method:"get",params:g})}function re(g){return V({url:"/cpq/pricingStrategy",method:"post",data:g})}function se(g){return V({url:"/cpq/pricingStrategy",method:"put",data:g})}function ne(g){return V({url:`/cpq/pricingStrategy/${g}`,method:"delete"})}const ie={class:"app-container"},de={class:"dialog-footer"},pe={__name:"strategy",setup(g){const b=y(!0),C=y(!0),T=y(0),U=y([]),N=y([]),S=y(""),c=y(!1),s=z({pageNum:1,pageSize:10,strategyCode:"",strategyName:"",strategyType:""}),o=z({strategyId:null,strategyCode:"",strategyName:"",strategyType:"cost_plus",strategyConfig:"",description:""}),h=z({strategyCode:[{required:!0,message:"策略编码不能为空",trigger:"blur"}],strategyName:[{required:!0,message:"策略名称不能为空",trigger:"blur"}],strategyType:[{required:!0,message:"策略类型不能为空",trigger:"change"}],strategyConfig:[{required:!0,message:"策略配置不能为空",trigger:"blur"}]}),v=async()=>{b.value=!0;try{const r=await oe(s);U.value=r.rows,T.value=r.total,b.value=!1}catch{b.value=!1,_.error("获取定价策略列表失败")}},w=()=>{s.pageNum=1,v()},F=()=>{s.strategyCode="",s.strategyName="",s.strategyType="",w()},K=()=>{C.value=!C.value},M=r=>{N.value=r},L=()=>{o.strategyId=null,o.strategyCode="",o.strategyName="",o.strategyType="cost_plus",o.strategyConfig="",o.description="",S.value="新增定价策略",c.value=!0},Q=r=>{o.strategyId=r.strategyId,o.strategyCode=r.strategyCode,o.strategyName=r.strategyName,o.strategyType=r.strategyType,o.strategyConfig=r.strategyConfig,o.description=r.description,S.value="修改定价策略",c.value=!0},q=async r=>{const t=r.strategyId?[r.strategyId]:N.value.map(d=>d.strategyId);await ElMessageBox.confirm("确定要删除选中的定价策略吗？","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});try{await ne(t),_.success("删除成功"),v()}catch{_.error("删除失败")}},R=async()=>{await validate(o,h);try{o.strategyId?(await se(o),_.success("修改成功")):(await re(o),_.success("新增成功")),c.value=!1,v()}catch{_.error("操作失败")}},j=()=>{c.value=!1,resetForm()};return Z(()=>{v()}),(r,t)=>{const d=n("el-input"),u=n("el-form-item"),m=n("el-option"),I=n("el-select"),p=n("el-button"),B=n("el-form"),A=n("el-card"),k=n("el-col"),J=n("el-row"),f=n("el-table-column"),O=n("el-tag"),G=n("el-table"),H=n("pagination"),W=n("el-dialog"),X=ee("loading");return P(),te("div",ie,[e(A,{shadow:"never",class:"search-card"},{default:a(()=>[x(e(B,{model:s,ref:"queryForm",inline:!0,"label-width":"80px"},{default:a(()=>[e(u,{label:"策略编码",prop:"strategyCode"},{default:a(()=>[e(d,{modelValue:s.strategyCode,"onUpdate:modelValue":t[0]||(t[0]=l=>s.strategyCode=l),placeholder:"请输入策略编码",clearable:"",size:"small",onKeyup:D(w,["enter"])},null,8,["modelValue"])]),_:1}),e(u,{label:"策略名称",prop:"strategyName"},{default:a(()=>[e(d,{modelValue:s.strategyName,"onUpdate:modelValue":t[1]||(t[1]=l=>s.strategyName=l),placeholder:"请输入策略名称",clearable:"",size:"small",onKeyup:D(w,["enter"])},null,8,["modelValue"])]),_:1}),e(u,{label:"策略类型",prop:"strategyType"},{default:a(()=>[e(I,{modelValue:s.strategyType,"onUpdate:modelValue":t[2]||(t[2]=l=>s.strategyType=l),placeholder:"请选择策略类型",clearable:"",size:"small"},{default:a(()=>[e(m,{label:"成本加成",value:"cost_plus"}),e(m,{label:"市场定价",value:"market"}),e(m,{label:"需求定价",value:"demand"}),e(m,{label:"竞争定价",value:"competition"})]),_:1},8,["modelValue"])]),_:1}),e(u,null,{default:a(()=>[e(p,{type:"primary",icon:"Search",size:"small",onClick:w},{default:a(()=>t[11]||(t[11]=[i("搜索")])),_:1,__:[11]}),e(p,{icon:"RefreshRight",size:"small",onClick:F},{default:a(()=>t[12]||(t[12]=[i("重置")])),_:1,__:[12]})]),_:1})]),_:1},8,["model"]),[[E,C.value]])]),_:1}),e(J,{gutter:10,class:"mb8"},{default:a(()=>[e(k,{span:1.5},{default:a(()=>[e(p,{type:"primary",icon:"Plus",size:"small",onClick:L},{default:a(()=>t[13]||(t[13]=[i(" 新增 ")])),_:1,__:[13]})]),_:1}),e(k,{span:1.5},{default:a(()=>[e(p,{type:"danger",icon:"Delete",size:"small",disabled:N.value.length===0,onClick:q},{default:a(()=>t[14]||(t[14]=[i(" 批量删除 ")])),_:1,__:[14]},8,["disabled"])]),_:1}),e(k,{span:21},{default:a(()=>[e(p,{type:"info",icon:"Search",size:"small",onClick:K,style:{float:"right"}},{default:a(()=>[i($(C.value?"收起":"展开")+"搜索 ",1)]),_:1})]),_:1})]),_:1}),x((P(),ae(G,{data:U.value,onSelectionChange:M},{default:a(()=>[e(f,{type:"selection",width:"55",align:"center"}),e(f,{label:"策略编码",align:"center",prop:"strategyCode"}),e(f,{label:"策略名称",align:"center",prop:"strategyName","show-overflow-tooltip":!0}),e(f,{label:"策略类型",align:"center",prop:"strategyType"},{default:a(l=>[e(O,{type:l.row.strategyType==="cost_plus"?"primary":l.row.strategyType==="market"?"success":l.row.strategyType==="demand"?"warning":"info",size:"small"},{default:a(()=>[i($(l.row.strategyType==="cost_plus"?"成本加成":l.row.strategyType==="market"?"市场定价":l.row.strategyType==="demand"?"需求定价":"竞争定价"),1)]),_:2},1032,["type"])]),_:1}),e(f,{label:"创建时间",align:"center",prop:"createTime",width:"180"}),e(f,{label:"操作",align:"center","class-name":"small-padding fixed-width",width:"150"},{default:a(l=>[e(p,{size:"small",type:"primary",icon:"Edit",onClick:Y=>Q(l.row)},{default:a(()=>t[15]||(t[15]=[i(" 修改 ")])),_:2,__:[15]},1032,["onClick"]),e(p,{size:"small",type:"danger",icon:"Delete",onClick:Y=>q(l.row)},{default:a(()=>t[16]||(t[16]=[i(" 删除 ")])),_:2,__:[16]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[X,b.value]]),x(e(H,{total:T.value,page:s.pageNum,"onUpdate:page":t[3]||(t[3]=l=>s.pageNum=l),limit:s.pageSize,"onUpdate:limit":t[4]||(t[4]=l=>s.pageSize=l),onPagination:v},null,8,["total","page","limit"]),[[E,T.value>0]]),e(W,{title:S.value,modelValue:c.value,"onUpdate:modelValue":t[10]||(t[10]=l=>c.value=l),width:"600px","append-to-body":""},{footer:a(()=>[le("span",de,[e(p,{onClick:j},{default:a(()=>t[17]||(t[17]=[i("取消")])),_:1,__:[17]}),e(p,{type:"primary",onClick:R},{default:a(()=>t[18]||(t[18]=[i("确定")])),_:1,__:[18]})])]),default:a(()=>[e(B,{ref:"form",model:o,rules:h,"label-width":"120px"},{default:a(()=>[e(u,{label:"策略编码",prop:"strategyCode"},{default:a(()=>[e(d,{modelValue:o.strategyCode,"onUpdate:modelValue":t[5]||(t[5]=l=>o.strategyCode=l),placeholder:"请输入策略编码"},null,8,["modelValue"])]),_:1}),e(u,{label:"策略名称",prop:"strategyName"},{default:a(()=>[e(d,{modelValue:o.strategyName,"onUpdate:modelValue":t[6]||(t[6]=l=>o.strategyName=l),placeholder:"请输入策略名称"},null,8,["modelValue"])]),_:1}),e(u,{label:"策略类型",prop:"strategyType"},{default:a(()=>[e(I,{modelValue:o.strategyType,"onUpdate:modelValue":t[7]||(t[7]=l=>o.strategyType=l),placeholder:"请选择策略类型"},{default:a(()=>[e(m,{label:"成本加成",value:"cost_plus"}),e(m,{label:"市场定价",value:"market"}),e(m,{label:"需求定价",value:"demand"}),e(m,{label:"竞争定价",value:"competition"})]),_:1},8,["modelValue"])]),_:1}),e(u,{label:"策略配置",prop:"strategyConfig"},{default:a(()=>[e(d,{modelValue:o.strategyConfig,"onUpdate:modelValue":t[8]||(t[8]=l=>o.strategyConfig=l),type:"textarea",placeholder:"请输入策略配置（JSON格式）",rows:4},null,8,["modelValue"])]),_:1}),e(u,{label:"策略描述",prop:"description"},{default:a(()=>[e(d,{modelValue:o.description,"onUpdate:modelValue":t[9]||(t[9]=l=>o.description=l),type:"textarea",placeholder:"请输入策略描述",rows:3},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])])}}};export{pe as default};
