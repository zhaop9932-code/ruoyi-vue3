import{_ as pe,u as me,r as i,g as U,i as fe,a as u,j as ge,c as _e,o as P,e as I,k as E,b as l,w as t,f as d,v as K,l as ve,m as he,t as L,E as p,n as be}from"./index-kbfDsxmo.js";import{l as O,g as Q,d as we,u as ye,a as Ie}from"./catalog-BurGbDor.js";const Ce={class:"app-container"},Ve={class:"page-header"},ke={class:"dialog-footer"},xe={__name:"catalog",setup(Se){const G=me(),v=i(null),F=i(null),q=i([]),C=i([]),V=i([]),f=i(!1),b=i(!0),w=i(!0),h=i(""),H=i(!0),J=i(!0),k=i([]),m=U({parentId:void 0,catalogName:void 0,status:void 0}),n=U({catalogId:void 0,parentId:0,catalogName:void 0,catalogDesc:void 0,catalogSort:0,status:"1"}),W=U({catalogName:[{required:!0,message:"目录名称不能为空",trigger:"blur"}],catalogSort:[{required:!0,message:"显示排序不能为空",trigger:"blur"}]});function y(){b.value=!0,q.value=[],C.value=[],O(m).then(a=>{q.value=a.rows,C.value=B(a.rows),b.value=!1}).catch(a=>{b.value=!1,p.error("获取目录列表失败")})}function B(a){const e=[],s={};a.forEach(r=>{s[r.catalogId]={...r,children:[]}}),a.forEach(r=>{const c=r.parentId||0;c===0?e.push(s[r.catalogId]):s[c]&&s[c].children.push(s[r.catalogId])});function _(r){r.children&&r.children.length>0&&(r.children.sort((c,D)=>(c.catalogSort||0)-(D.catalogSort||0)),r.children.forEach(c=>_(c)))}return e.forEach(r=>_(r)),e}function x(){O({parentId:void 0}).then(a=>{V.value=[],V.value=B(a.rows)}).catch(a=>{p.error("获取目录列表失败")})}function S(){y()}function X(){F.value&&F.value.resetFields(),m.parentId=void 0,m.catalogName=void 0,m.status=void 0,S()}function T(){w.value=!w.value}function Y(a){k.value=a.map(e=>e.catalogId),H.value=a.length!==1,J.value=!a.length}function R(a){N(),x(),a&&a.catalogId?(n.parentId=a.catalogId,h.value="添加子目录"):(n.parentId=0,h.value="添加目录"),f.value=!0}function Z(a){if(N(),x(),a)Q(a.catalogId).then(e=>{Object.assign(n,e.data),h.value="修改目录",f.value=!0}).catch(e=>{p.error("获取目录详情失败")});else{const e=k.value[0];Q(e).then(s=>{Object.assign(n,s.data),h.value="修改目录",f.value=!0}).catch(s=>{p.error("获取目录详情失败")})}}function ee(){v.value&&v.value.validate().then(async()=>{try{n.catalogId?(await ye(n),p.success("修改成功")):(await Ie(n),p.success("新增成功")),f.value=!1,y()}catch{p.error("操作失败")}}).catch(()=>{p.error("表单验证失败，请检查填写内容")})}function le(a){G.push({path:"/cpq/attributeGroupAttribute",query:{catalogId:a.catalogId,catalogName:a.catalogName,testMode:!0}})}function te(a){const e=a.catalogId||k.value;be.confirm("是否确认删除所选目录？","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await we(e),p.success("删除成功"),y()}catch{p.error("删除失败")}}).catch(()=>{})}function ae(){f.value=!1,N()}function N(){n.catalogId=void 0,n.parentId=0,n.catalogName=void 0,n.catalogDesc=void 0,n.catalogSort=0,n.status="1",v.value&&v.value.resetFields()}return fe(()=>{y(),x()}),(a,e)=>{const s=u("el-button"),_=u("el-input"),r=u("el-form-item"),c=u("el-option"),D=u("el-select"),M=u("el-form"),$=u("el-card"),g=u("el-table-column"),oe=u("el-tag"),ne=u("el-table"),re=u("el-tree-select"),se=u("el-input-number"),j=u("el-col"),A=u("el-radio"),ue=u("el-radio-group"),de=u("el-row"),ie=u("el-dialog"),ce=ge("loading");return P(),_e("div",Ce,[I("div",Ve,[e[10]||(e[10]=I("h3",null,"产品目录管理",-1)),l(s,{type:"primary",icon:"Plus",size:"small",onClick:e[0]||(e[0]=o=>R())},{default:t(()=>e[9]||(e[9]=[d(" 新增目录 ")])),_:1,__:[9]})]),E(l($,{shadow:"never",class:"search-card"},{default:t(()=>[l(M,{model:m,ref:"queryForm",inline:!0,"label-width":"80px"},{default:t(()=>[l(r,{label:"目录名称",prop:"catalogName"},{default:t(()=>[l(_,{modelValue:m.catalogName,"onUpdate:modelValue":e[1]||(e[1]=o=>m.catalogName=o),placeholder:"请输入目录名称",clearable:"",size:"small",onKeyup:ve(S,["enter"])},null,8,["modelValue"])]),_:1}),l(r,{label:"目录状态",prop:"status"},{default:t(()=>[l(D,{modelValue:m.status,"onUpdate:modelValue":e[2]||(e[2]=o=>m.status=o),placeholder:"请选择目录状态",clearable:"",size:"small"},{default:t(()=>[l(c,{label:"启用",value:"1"}),l(c,{label:"禁用",value:"0"})]),_:1},8,["modelValue"])]),_:1}),l(r,null,{default:t(()=>[l(s,{type:"primary",icon:"Search",size:"small",onClick:S},{default:t(()=>e[11]||(e[11]=[d("搜索")])),_:1,__:[11]}),l(s,{icon:"RefreshRight",size:"small",onClick:X},{default:t(()=>e[12]||(e[12]=[d("重置")])),_:1,__:[12]}),l(s,{type:"info",icon:"Search",size:"small",onClick:T},{default:t(()=>e[13]||(e[13]=[d(" 收起搜索 ")])),_:1,__:[13]})]),_:1})]),_:1},8,["model"])]),_:1},512),[[K,w.value]]),E(l(s,{type:"info",icon:"Search",size:"small",onClick:T,style:{"margin-bottom":"10px"}},{default:t(()=>e[14]||(e[14]=[d(" 展开搜索 ")])),_:1,__:[14]},512),[[K,!w.value]]),l($,{shadow:"never",class:"table-card"},{default:t(()=>[E((P(),he(ne,{data:C.value,"row-key":"catalogId",onSelectionChange:Y,"tree-props":{children:"children",hasChildren:"hasChildren"},"default-expand-all":"",fit:"",style:{width:"100%"}},{default:t(()=>[l(g,{type:"selection",width:"55",align:"center"}),l(g,{label:"目录名称",align:"left",prop:"catalogName","show-overflow-tooltip":!0,"min-width":"200","flex-grow":"1"},{default:t(o=>[I("span",null,L(o.row.catalogName),1)]),_:1}),l(g,{label:"目录描述",align:"left",prop:"catalogDesc","show-overflow-tooltip":!0,"min-width":"150","flex-grow":"1"}),l(g,{label:"排序",align:"center",prop:"catalogSort",width:"80"}),l(g,{label:"目录状态",align:"center",prop:"status",width:"100"},{default:t(o=>[l(oe,{type:o.row.status==="1"?"success":"danger",size:"small"},{default:t(()=>[d(L(o.row.status==="1"?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),l(g,{label:"创建时间",align:"center",prop:"createTime",width:"180"}),l(g,{label:"操作",align:"center","class-name":"small-padding fixed-width",width:"280"},{default:t(o=>[l(s,{size:"small",type:"primary",link:"",icon:"Edit",onClick:z=>Z(o.row),style:{"margin-right":"5px"}},{default:t(()=>e[15]||(e[15]=[d(" 修改 ")])),_:2,__:[15]},1032,["onClick"]),l(s,{size:"small",type:"success",link:"",icon:"Plus",onClick:z=>R(o.row),style:{"margin-right":"5px"}},{default:t(()=>e[16]||(e[16]=[d(" 新增子目录 ")])),_:2,__:[16]},1032,["onClick"]),l(s,{size:"small",type:"info",link:"",icon:"SetUp",onClick:z=>le(o.row),style:{"margin-right":"5px"}},{default:t(()=>e[17]||(e[17]=[d(" 属性管理 ")])),_:2,__:[17]},1032,["onClick"]),l(s,{size:"small",type:"danger",link:"",icon:"Delete",onClick:z=>te(o.row)},{default:t(()=>e[18]||(e[18]=[d(" 删除 ")])),_:2,__:[18]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[ce,b.value]])]),_:1}),l(ie,{title:h.value,modelValue:f.value,"onUpdate:modelValue":e[8]||(e[8]=o=>f.value=o),width:"600px","append-to-body":""},{footer:t(()=>[I("span",ke,[l(s,{onClick:ae},{default:t(()=>e[21]||(e[21]=[d("取消")])),_:1,__:[21]}),l(s,{type:"primary",onClick:ee},{default:t(()=>e[22]||(e[22]=[d("确定")])),_:1,__:[22]})])]),default:t(()=>[l(M,{ref_key:"catalogFormRef",ref:v,model:n,rules:W,"label-width":"100px"},{default:t(()=>[l(r,{label:"上级目录",prop:"parentId"},{default:t(()=>[l(re,{modelValue:n.parentId,"onUpdate:modelValue":e[3]||(e[3]=o=>n.parentId=o),data:V.value,props:{value:"catalogId",label:"catalogName",children:"children"},placeholder:"选择上级目录",clearable:"",style:{width:"100%"}},null,8,["modelValue","data"])]),_:1}),l(r,{label:"目录名称",prop:"catalogName"},{default:t(()=>[l(_,{modelValue:n.catalogName,"onUpdate:modelValue":e[4]||(e[4]=o=>n.catalogName=o),placeholder:"请输入目录名称"},null,8,["modelValue"])]),_:1}),l(r,{label:"目录描述",prop:"catalogDesc"},{default:t(()=>[l(_,{modelValue:n.catalogDesc,"onUpdate:modelValue":e[5]||(e[5]=o=>n.catalogDesc=o),type:"textarea",placeholder:"请输入目录描述",rows:3},null,8,["modelValue"])]),_:1}),l(de,{gutter:20},{default:t(()=>[l(j,{span:12},{default:t(()=>[l(r,{label:"显示排序",prop:"catalogSort"},{default:t(()=>[l(se,{modelValue:n.catalogSort,"onUpdate:modelValue":e[6]||(e[6]=o=>n.catalogSort=o),"controls-position":"right",min:0},null,8,["modelValue"])]),_:1})]),_:1}),l(j,{span:12},{default:t(()=>[l(r,{label:"目录状态",prop:"status"},{default:t(()=>[l(ue,{modelValue:n.status,"onUpdate:modelValue":e[7]||(e[7]=o=>n.status=o)},{default:t(()=>[l(A,{label:"1"},{default:t(()=>e[19]||(e[19]=[d("启用")])),_:1,__:[19]}),l(A,{label:"0"},{default:t(()=>e[20]||(e[20]=[d("禁用")])),_:1,__:[20]})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])])}}},ze=pe(xe,[["__scopeId","data-v-3f8d7d32"]]);export{ze as default};
