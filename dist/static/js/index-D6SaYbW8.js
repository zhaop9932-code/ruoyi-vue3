import{_ as te,r as c,u as ne,$ as I,h as se,aB as de,a as i,i as ie,c as h,o as N,b as l,j as z,w as a,U as $,f as r,a0 as A,t as g,F as re,n as ue,m as me,e as s,E as _,Q as pe}from"./index-DgigFOm-.js";import{l as be,z as ce,A as ge,B as ve}from"./bom-CjuVRwkz.js";const fe={class:"app-container"},_e={class:"bom-card-container"},ye={class:"bom-card-header"},Te={class:"bom-card-title"},Be={class:"bom-card-type"},Ve={class:"bom-card-content"},Ce={class:"bom-info-item"},Se={class:"info-value"},Me={class:"bom-info-item"},Ne={class:"info-value"},ke={class:"bom-info-item"},Oe={class:"info-value"},xe={class:"bom-info-item"},we={class:"info-value"},Ie={class:"bom-card-actions"},he={class:"dialog-footer"},ze={__name:"index",setup(Ee){const V=c(!0),C=c(!0),k=c(0),E=c([]),y=c([]),O=c({}),x=c(""),v=c(!1),w=c(null),K=c(null),L=ne(),t=I({bomId:null,bomCode:"",bomName:"",bomType:"template",bomRules:"",validationStrategy:"strict",configTemplate:"",ruleEngineType:"built-in"}),d=I({pageNum:1,pageSize:10,bomCode:"",bomName:"",bomType:""}),P=I({bomCode:[{required:!0,message:"BOM编码不能为空",trigger:"blur"}],bomName:[{required:!0,message:"BOM名称不能为空",trigger:"blur"}],bomType:[{required:!0,message:"BOM类型不能为空",trigger:"change"}],validationStrategy:[{required:!0,message:"验证策略不能为空",trigger:"change"}],ruleEngineType:[{required:!0,message:"规则引擎类型不能为空",trigger:"change"}]}),f=async()=>{V.value=!0;try{const n=await be(d);E.value=n.rows,k.value=n.total,V.value=!1}catch{V.value=!1,_.error("获取超级BOM列表失败")}},S=()=>{d.pageNum=1,f()},Q=()=>{d.bomCode="",d.bomName="",d.bomType="",S()},j=()=>{C.value=!C.value},J=n=>{if(O.value[n.bomId])y.value.push(n);else{const e=y.value.findIndex(p=>p.bomId===n.bomId);e>-1&&y.value.splice(e,1)}},G=()=>{t.bomId=null,t.bomCode="",t.bomName="",t.bomType="template",t.bomRules="",t.validationStrategy="strict",t.configTemplate="",t.ruleEngineType="built-in",x.value="新增超级BOM",v.value=!0},H=n=>{t.bomId=n.bomId,t.bomCode=n.bomCode,t.bomName=n.bomName,t.bomType=n.bomType,t.bomRules=n.bomRules,t.validationStrategy=n.validationStrategy,t.configTemplate=n.configTemplate,t.ruleEngineType=n.ruleEngineType,x.value="修改超级BOM",v.value=!0},U=async n=>{const e=n.bomId?[n.bomId]:y.value.map(p=>p.bomId);await pe.confirm("确定要删除选中的超级BOM吗？","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});try{await ce(e),_.success("删除成功"),f()}catch{_.error("删除失败")}},W=n=>{L.push({path:"/cpq/bom/manage",query:{bomId:n.bomId,bomName:n.bomName}})},X=async()=>{await w.value.validate();try{t.bomRules=JSON.stringify({validationStrategy:t.validationStrategy,ruleEngineType:t.ruleEngineType}),t.bomId?(await ge(t),_.success("修改成功")):(await ve(t),_.success("新增成功")),v.value=!1,f()}catch{_.error("操作失败")}},Y=()=>{var n;(n=w.value)==null||n.resetFields()},Z=()=>{v.value=!1,Y()};return se(()=>{f()}),de(()=>{f()}),(n,e)=>{const p=i("el-input"),b=i("el-form-item"),u=i("el-option"),M=i("el-select"),m=i("el-button"),q=i("el-form"),R=i("el-card"),T=i("el-col"),D=i("el-row"),ee=i("el-checkbox"),F=i("el-tag"),le=i("pagination"),oe=i("el-dialog"),ae=ie("loading");return N(),h("div",fe,[l(R,{shadow:"never",class:"search-card"},{default:a(()=>[z(l(q,{model:d,ref_key:"queryForm",ref:K,inline:!0,"label-width":"80px"},{default:a(()=>[l(b,{label:"BOM编码",prop:"bomCode"},{default:a(()=>[l(p,{modelValue:d.bomCode,"onUpdate:modelValue":e[0]||(e[0]=o=>d.bomCode=o),placeholder:"请输入BOM编码",clearable:"",size:"small",onKeyup:$(S,["enter"])},null,8,["modelValue"])]),_:1}),l(b,{label:"BOM名称",prop:"bomName"},{default:a(()=>[l(p,{modelValue:d.bomName,"onUpdate:modelValue":e[1]||(e[1]=o=>d.bomName=o),placeholder:"请输入BOM名称",clearable:"",size:"small",onKeyup:$(S,["enter"])},null,8,["modelValue"])]),_:1}),l(b,{label:"BOM类型",prop:"bomType"},{default:a(()=>[l(M,{modelValue:d.bomType,"onUpdate:modelValue":e[2]||(e[2]=o=>d.bomType=o),placeholder:"请选择BOM类型",clearable:"",size:"small"},{default:a(()=>[l(u,{label:"模板",value:"template"}),l(u,{label:"实例",value:"instance"}),l(u,{label:"版本",value:"version"})]),_:1},8,["modelValue"])]),_:1}),l(b,null,{default:a(()=>[l(m,{type:"primary",icon:"Search",size:"small",onClick:S},{default:a(()=>e[12]||(e[12]=[r("搜索")])),_:1,__:[12]}),l(m,{icon:"RefreshRight",size:"small",onClick:Q},{default:a(()=>e[13]||(e[13]=[r("重置")])),_:1,__:[13]})]),_:1})]),_:1},8,["model"]),[[A,C.value]])]),_:1}),l(D,{gutter:10,class:"mb8"},{default:a(()=>[l(T,{span:1.5},{default:a(()=>[l(m,{type:"primary",icon:"Plus",size:"small",onClick:G},{default:a(()=>e[14]||(e[14]=[r(" 新增 ")])),_:1,__:[14]})]),_:1}),l(T,{span:1.5},{default:a(()=>[l(m,{type:"danger",icon:"Delete",size:"small",disabled:y.value.length===0,onClick:U},{default:a(()=>e[15]||(e[15]=[r(" 批量删除 ")])),_:1,__:[15]},8,["disabled"])]),_:1}),l(T,{span:1.5},{default:a(()=>[l(m,{type:"warning",icon:"Download",size:"small",onClick:n.handleExport},{default:a(()=>e[16]||(e[16]=[r(" 导出 ")])),_:1,__:[16]},8,["onClick"])]),_:1}),l(T,{span:20.5},{default:a(()=>[l(m,{type:"info",icon:"Search",size:"small",onClick:j,style:{float:"right"}},{default:a(()=>[r(g(C.value?"收起":"展开")+"搜索 ",1)]),_:1})]),_:1})]),_:1}),z((N(),h("div",_e,[l(D,{gutter:20},{default:a(()=>[(N(!0),h(re,null,ue(E.value,(o,Ue)=>(N(),me(T,{xs:24,sm:12,md:12,lg:8,xl:6,key:o.bomId},{default:a(()=>[l(R,{shadow:"hover",class:"bom-card"},{header:a(()=>[s("div",ye,[s("div",Te,[s("h3",null,g(o.bomName),1),l(ee,{modelValue:O.value[o.bomId],"onUpdate:modelValue":B=>O.value[o.bomId]=B,onChange:B=>J(o)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),s("div",Be,[l(F,{type:o.bomType==="template"?"primary":o.bomType==="instance"?"success":"warning",size:"small"},{default:a(()=>[r(g(o.bomType==="template"?"模板":o.bomType==="instance"?"实例":"版本"),1)]),_:2},1032,["type"])])])]),default:a(()=>[s("div",Ve,[s("div",Ce,[e[17]||(e[17]=s("div",{class:"info-label"},"BOM编码:",-1)),s("div",Se,g(o.bomCode),1)]),s("div",Me,[e[18]||(e[18]=s("div",{class:"info-label"},"验证策略:",-1)),s("div",Ne,[l(F,{type:o.validationStrategy==="strict"?"danger":o.validationStrategy==="warning"?"warning":"success",size:"small"},{default:a(()=>[r(g(o.validationStrategy==="strict"?"严格验证":o.validationStrategy==="warning"?"警告验证":"无验证"),1)]),_:2},1032,["type"])])]),s("div",ke,[e[19]||(e[19]=s("div",{class:"info-label"},"规则引擎:",-1)),s("div",Oe,g(o.ruleEngineType),1)]),s("div",xe,[e[20]||(e[20]=s("div",{class:"info-label"},"创建时间:",-1)),s("div",we,g(o.createTime),1)])]),s("div",Ie,[l(m,{size:"small",type:"primary",icon:"Edit",onClick:B=>H(o)},{default:a(()=>e[21]||(e[21]=[r(" 修改 ")])),_:2,__:[21]},1032,["onClick"]),l(m,{size:"small",type:"danger",icon:"Delete",onClick:B=>U(o)},{default:a(()=>e[22]||(e[22]=[r(" 删除 ")])),_:2,__:[22]},1032,["onClick"]),l(m,{size:"small",type:"info",icon:"SetUp",onClick:B=>W(o)},{default:a(()=>e[23]||(e[23]=[r(" BOM管理 ")])),_:2,__:[23]},1032,["onClick"])])]),_:2},1024)]),_:2},1024))),128))]),_:1})])),[[ae,V.value]]),z(l(le,{total:k.value,page:d.pageNum,"onUpdate:page":e[3]||(e[3]=o=>d.pageNum=o),limit:d.pageSize,"onUpdate:limit":e[4]||(e[4]=o=>d.pageSize=o),onPagination:f},null,8,["total","page","limit"]),[[A,k.value>0]]),l(oe,{title:x.value,modelValue:v.value,"onUpdate:modelValue":e[11]||(e[11]=o=>v.value=o),width:"600px","append-to-body":""},{footer:a(()=>[s("span",he,[l(m,{onClick:Z},{default:a(()=>e[24]||(e[24]=[r("取消")])),_:1,__:[24]}),l(m,{type:"primary",onClick:X},{default:a(()=>e[25]||(e[25]=[r("确定")])),_:1,__:[25]})])]),default:a(()=>[l(q,{ref_key:"formRef",ref:w,model:t,rules:P,"label-width":"120px"},{default:a(()=>[l(b,{label:"BOM编码",prop:"bomCode"},{default:a(()=>[l(p,{modelValue:t.bomCode,"onUpdate:modelValue":e[5]||(e[5]=o=>t.bomCode=o),placeholder:"请输入BOM编码"},null,8,["modelValue"])]),_:1}),l(b,{label:"BOM名称",prop:"bomName"},{default:a(()=>[l(p,{modelValue:t.bomName,"onUpdate:modelValue":e[6]||(e[6]=o=>t.bomName=o),placeholder:"请输入BOM名称"},null,8,["modelValue"])]),_:1}),l(b,{label:"BOM类型",prop:"bomType"},{default:a(()=>[l(M,{modelValue:t.bomType,"onUpdate:modelValue":e[7]||(e[7]=o=>t.bomType=o),placeholder:"请选择BOM类型"},{default:a(()=>[l(u,{label:"模板",value:"template"}),l(u,{label:"实例",value:"instance"}),l(u,{label:"版本",value:"version"})]),_:1},8,["modelValue"])]),_:1}),l(b,{label:"验证策略",prop:"validationStrategy"},{default:a(()=>[l(M,{modelValue:t.validationStrategy,"onUpdate:modelValue":e[8]||(e[8]=o=>t.validationStrategy=o),placeholder:"请选择验证策略"},{default:a(()=>[l(u,{label:"严格验证",value:"strict"}),l(u,{label:"警告验证",value:"warning"}),l(u,{label:"无验证",value:"none"})]),_:1},8,["modelValue"])]),_:1}),l(b,{label:"规则引擎类型",prop:"ruleEngineType"},{default:a(()=>[l(M,{modelValue:t.ruleEngineType,"onUpdate:modelValue":e[9]||(e[9]=o=>t.ruleEngineType=o),placeholder:"请选择规则引擎类型"},{default:a(()=>[l(u,{label:"内置规则引擎",value:"built-in"}),l(u,{label:"Drools规则引擎",value:"drools"}),l(u,{label:"自定义规则引擎",value:"custom"})]),_:1},8,["modelValue"])]),_:1}),l(b,{label:"配置模板",prop:"configTemplate"},{default:a(()=>[l(p,{modelValue:t.configTemplate,"onUpdate:modelValue":e[10]||(e[10]=o=>t.configTemplate=o),type:"textarea",placeholder:"请输入配置模板",rows:3},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])])}}},De=te(ze,[["__scopeId","data-v-91e64a3b"]]);export{De as default};
