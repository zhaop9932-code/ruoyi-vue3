import{r as p,g as L,i as me,a as s,j as be,c as B,o as g,e as b,k as U,b as l,w as t,f as u,t as D,v as E,l as R,m as S,q as P,E as d,n as M}from"./index-kbfDsxmo.js";import{l as _e,d as T,u as fe,a as ge}from"./brand-huW--O-O.js";const ve={class:"cpq-container"},ye={class:"cpq-action-bar"},we={class:"cpq-actions"},Ce={class:"cpq-search-card"},he={class:"cpq-table"},Ve={key:1},xe={key:0,class:"el-form-item__help",style:{color:"#909399"}},ke={class:"dialog-footer"},Ue={__name:"index",setup(Ne){const v=p(!0),y=p(!0),x=p(0),q=p([]),w=p([]),k=p(""),_=p(!1),F=p("/prod-api/common/upload"),C=p([]),o=L({brandId:null,brandCode:"",brandName:"",brandLogo:"",status:"0",sortOrder:0}),i=L({pageNum:1,pageSize:10,brandCode:"",brandName:"",status:""}),G=L({brandName:[{required:!0,message:"品牌名称不能为空",trigger:"blur"},{min:2,max:128,message:"品牌名称长度在 2 到 128 个字符",trigger:"blur"}],status:[{required:!0,message:"品牌状态不能为空",trigger:"change"}]}),f=async()=>{v.value=!0;try{const a=await _e(i);q.value=a.rows,x.value=a.total,v.value=!1}catch{v.value=!1,d.error("获取品牌列表失败")}},h=()=>{i.pageNum=1,f()},K=()=>{i.brandCode="",i.brandName="",i.status="",h()},$=()=>{y.value=!y.value},A=a=>{w.value=a},J=()=>{o.brandId=null,o.brandCode="",o.brandName="",o.brandLogo="",o.status="0",o.sortOrder=0,C.value=[],k.value="新增品牌",_.value=!0},Q=a=>{o.brandId=a.brandId,o.brandCode=a.brandCode,o.brandName=a.brandName,o.brandLogo=a.brandLogo||"",o.status=a.status,o.sortOrder=a.sortOrder,C.value=[],k.value="修改品牌",_.value=!0},H=async a=>{await M.confirm("确定要删除该品牌吗？","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});try{await T(a.brandId),d.success("删除成功"),f()}catch{d.error("删除失败")}},W=async()=>{if(w.value.length===0){d.warning("请选择要删除的品牌");return}await M.confirm("确定要删除选中的品牌吗？","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});try{const a=w.value.map(e=>e.brandId).join(",");await T(a),d.success("删除成功"),f()}catch{d.error("删除失败")}},X=()=>{exportBrand(i).then(a=>{const e=new Blob([a],{type:"application/vnd.ms-excel"}),r=document.createElement("a");r.href=URL.createObjectURL(e),r.download="品牌列表.xlsx",document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(r.href),d.success("导出成功")}).catch(a=>{d.error("导出失败")})},Y=(a,e,r)=>{a.code===200?(o.brandLogo=a.data.url,r.value=r,d.success("上传成功")):d.error("上传失败："+a.msg)},Z=(a,e,r)=>{d.error("上传失败，请重试")},ee=a=>{const e=a.type==="image/jpeg"||a.type==="image/png",r=a.size/1024/1024<2;return e?r?!0:(d.error("上传图片大小不能超过 2MB!"),!1):(d.error("上传图片只能是 JPG/PNG 格式!"),!1)},le=async()=>{const a=N.value.form;a&&await a.validate().then(async()=>{try{o.brandId?(await fe(o),d.success("修改成功")):(await ge(o),d.success("新增成功")),_.value=!1,f()}catch{d.error("操作失败")}}).catch(()=>{d.error("表单验证失败，请检查填写内容")})},ae=()=>{_.value=!1;const a=N.value.form;a&&a.resetFields(),C.value=[]},N=p({form:null});return me(()=>{f()}),(a,e)=>{const r=s("el-button"),V=s("el-input"),c=s("el-form-item"),z=s("el-option"),te=s("el-select"),I=s("el-form"),m=s("el-table-column"),O=s("el-image"),oe=s("el-tag"),ne=s("el-table"),re=s("pagination"),de=s("el-upload"),j=s("el-radio"),se=s("el-radio-group"),ie=s("el-input-number"),ue=s("el-dialog"),pe=be("loading");return g(),B("div",ve,[e[21]||(e[21]=b("div",{class:"cpq-page-title"}," 品牌管理 ",-1)),b("div",ye,[b("div",we,[l(r,{type:"primary",icon:"Plus",onClick:J},{default:t(()=>e[8]||(e[8]=[u(" 新增品牌 ")])),_:1,__:[8]}),l(r,{type:"danger",icon:"Delete",disabled:w.value.length===0,onClick:W},{default:t(()=>e[9]||(e[9]=[u(" 批量删除 ")])),_:1,__:[9]},8,["disabled"]),l(r,{type:"warning",icon:"Download",onClick:X},{default:t(()=>e[10]||(e[10]=[u(" 导出 ")])),_:1,__:[10]})]),l(r,{type:"info",icon:"Search",onClick:$},{default:t(()=>[u(D(y.value?"收起":"展开")+"搜索 ",1)]),_:1})]),U(b("div",Ce,[l(I,{model:i,ref:"queryForm",inline:!0,"label-width":"80px"},{default:t(()=>[l(c,{label:"品牌编码",prop:"brandCode"},{default:t(()=>[l(V,{modelValue:i.brandCode,"onUpdate:modelValue":e[0]||(e[0]=n=>i.brandCode=n),placeholder:"请输入品牌编码",clearable:"",size:"small",onKeyup:R(h,["enter"])},null,8,["modelValue"])]),_:1}),l(c,{label:"品牌名称",prop:"brandName"},{default:t(()=>[l(V,{modelValue:i.brandName,"onUpdate:modelValue":e[1]||(e[1]=n=>i.brandName=n),placeholder:"请输入品牌名称",clearable:"",size:"small",onKeyup:R(h,["enter"])},null,8,["modelValue"])]),_:1}),l(c,{label:"品牌状态",prop:"status"},{default:t(()=>[l(te,{modelValue:i.status,"onUpdate:modelValue":e[2]||(e[2]=n=>i.status=n),placeholder:"请选择品牌状态",clearable:"",size:"small"},{default:t(()=>[l(z,{label:"启用",value:"0"}),l(z,{label:"禁用",value:"1"})]),_:1},8,["modelValue"])]),_:1}),l(c,null,{default:t(()=>[l(r,{type:"primary",icon:"Search",size:"small",onClick:h},{default:t(()=>e[11]||(e[11]=[u("搜索")])),_:1,__:[11]}),l(r,{icon:"RefreshRight",size:"small",onClick:K},{default:t(()=>e[12]||(e[12]=[u("重置")])),_:1,__:[12]})]),_:1})]),_:1},8,["model"])],512),[[E,y.value]]),b("div",he,[U((g(),S(ne,{data:q.value,onSelectionChange:A,border:""},{default:t(()=>[l(m,{type:"selection",width:"55",align:"center"}),l(m,{label:"品牌编码",align:"center",prop:"brandCode",width:"120"}),l(m,{label:"品牌名称",align:"center",prop:"brandName",width:"150","show-overflow-tooltip":!0}),l(m,{label:"品牌Logo",align:"center",width:"120"},{default:t(n=>[n.row.brandLogo?(g(),S(O,{key:0,src:n.row.brandLogo,fit:"cover",style:{width:"60px",height:"60px"}},null,8,["src"])):(g(),B("span",Ve,"-"))]),_:1}),l(m,{label:"品牌状态",align:"center",prop:"status",width:"100"},{default:t(n=>[l(oe,{type:n.row.status==="0"?"success":"danger",size:"small"},{default:t(()=>[u(D(n.row.status==="0"?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),l(m,{label:"排序",align:"center",prop:"sortOrder",width:"80"}),l(m,{label:"创建时间",align:"center",prop:"createTime",width:"180"}),l(m,{label:"操作",align:"center","class-name":"small-padding fixed-width",width:"180"},{default:t(n=>[l(r,{size:"small",type:"primary",icon:"Edit",onClick:ce=>Q(n.row)},{default:t(()=>e[13]||(e[13]=[u(" 修改 ")])),_:2,__:[13]},1032,["onClick"]),l(r,{size:"small",type:"danger",icon:"Delete",onClick:ce=>H(n.row)},{default:t(()=>e[14]||(e[14]=[u(" 删除 ")])),_:2,__:[14]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[pe,v.value]]),U(l(re,{total:x.value,page:i.pageNum,limit:i.pageSize,onPagination:f},null,8,["total","page","limit"]),[[E,x.value>0]]),l(ue,{title:k.value,modelValue:_.value,"onUpdate:modelValue":e[7]||(e[7]=n=>_.value=n),width:"600px","append-to-body":""},{footer:t(()=>[b("span",ke,[l(r,{onClick:ae},{default:t(()=>e[19]||(e[19]=[u("取消")])),_:1,__:[19]}),l(r,{type:"primary",onClick:le},{default:t(()=>e[20]||(e[20]=[u("确定")])),_:1,__:[20]})])]),default:t(()=>[l(I,{ref:n=>N.value.form=n,model:o,rules:G,"label-width":"100px"},{default:t(()=>[l(c,{label:"品牌编码",prop:"brandCode"},{default:t(()=>[l(V,{modelValue:o.brandCode,"onUpdate:modelValue":e[3]||(e[3]=n=>o.brandCode=n),placeholder:"由系统自动生成",readonly:!o.brandId,disabled:!o.brandId},null,8,["modelValue","readonly","disabled"]),o.brandId?P("",!0):(g(),B("div",xe," 品牌编码由系统自动生成，无需手动输入 "))]),_:1}),l(c,{label:"品牌名称",prop:"brandName"},{default:t(()=>[l(V,{modelValue:o.brandName,"onUpdate:modelValue":e[4]||(e[4]=n=>o.brandName=n),placeholder:"请输入品牌名称"},null,8,["modelValue"])]),_:1}),l(c,{label:"品牌Logo"},{default:t(()=>[l(de,{class:"upload-demo",action:F.value,"on-success":Y,"on-error":Z,"before-upload":ee,limit:1,"file-list":C.value,"auto-upload":!0,accept:".jpg,.jpeg,.png"},{tip:t(()=>e[16]||(e[16]=[b("div",{class:"el-upload__tip"}," 只能上传jpg/jpeg/png文件，且不超过2MB ",-1)])),default:t(()=>[l(r,{type:"primary",icon:"Plus"},{default:t(()=>e[15]||(e[15]=[u("点击上传")])),_:1,__:[15]})]),_:1},8,["action","file-list"]),o.brandLogo?(g(),S(O,{key:0,src:o.brandLogo,fit:"cover",style:{width:"100px",height:"100px","margin-top":"10px"}},null,8,["src"])):P("",!0)]),_:1}),l(c,{label:"品牌状态",prop:"status"},{default:t(()=>[l(se,{modelValue:o.status,"onUpdate:modelValue":e[5]||(e[5]=n=>o.status=n)},{default:t(()=>[l(j,{label:"0"},{default:t(()=>e[17]||(e[17]=[u("启用")])),_:1,__:[17]}),l(j,{label:"1"},{default:t(()=>e[18]||(e[18]=[u("禁用")])),_:1,__:[18]})]),_:1},8,["modelValue"])]),_:1}),l(c,{label:"排序",prop:"sortOrder"},{default:t(()=>[l(ie,{modelValue:o.sortOrder,"onUpdate:modelValue":e[6]||(e[6]=n=>o.sortOrder=n),min:0,placeholder:"请输入排序值"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])])])}}};export{Ue as default};
