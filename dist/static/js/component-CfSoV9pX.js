import{_ as ae,r as s,B as ue,$ as x,H as re,h as ie,a as u,i as de,c as E,o as V,b as t,j as U,w as o,U as F,f as i,a0 as R,t as b,m as L,F as se,n as pe,e as T,E as _,Q as ce}from"./index-DgigFOm-.js";import{a as me,d as fe,u as _e,b as ge}from"./solution-T2bvJFA1.js";import{listProduct as ve}from"./product-C-f__cve.js";const ye={class:"app-container"},be={class:"dialog-footer"},we={__name:"component",setup(Ie){const w=s(!0),I=s(!0),k=s(0),B=s([]),S=s([]),h=s(""),g=s(!1),v=s(null),M=ue(),r=x({pageNum:1,pageSize:10,componentCode:"",componentName:"",solutionId:M.query.solutionId||null}),n=x({componentId:null,solutionId:M.query.solutionId||null,productId:null,quantity:1,unitPrice:0,amount:0}),q=s([]),N=s(!1);s("");const K=x({productId:[{required:!0,message:"产品不能为空",trigger:"change"}],quantity:[{required:!0,message:"数量不能为空",trigger:"blur"}],unitPrice:[{required:!0,message:"单价不能为空",trigger:"blur"}]});re(()=>[n.quantity,n.unitPrice],([a,e])=>{n.amount=a*e});const Q=async(a="")=>{if(!a){q.value=[];return}N.value=!0;try{const e=await ve({productModel:a,pageNum:1,pageSize:10});q.value=e.rows.map(d=>({productId:d.productId,label:`${d.productCode} / ${d.productName} / ${d.productModel}`,value:d.productId}))}catch{_.error("获取产品列表失败")}finally{N.value=!1}},y=async()=>{w.value=!0;try{const a=await me(r);B.value=a.rows,k.value=a.total,w.value=!1}catch{w.value=!1,_.error("获取组件列表失败")}},C=()=>{r.pageNum=1,y()},j=()=>{r.componentCode="",r.componentName="",C()},A=()=>{I.value=!I.value},H=a=>{S.value=a},O=()=>{n.componentId=null,n.productId=null,n.quantity=1,n.unitPrice=0,n.amount=0,h.value="新增组件",g.value=!0},G=a=>{n.componentId=a.componentId,n.solutionId=a.solutionId,n.productId=a.productId,n.quantity=a.quantity,n.unitPrice=a.unitPrice,n.amount=a.amount,h.value="修改组件",g.value=!0},D=async a=>{const e=a.componentId?[a.componentId]:S.value.map(d=>d.componentId);await ce.confirm("确定要删除选中的组件吗？","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});try{await fe(e),_.success("删除成功"),y()}catch{_.error("删除失败")}},J=async()=>{if(v.value){await v.value.validate();try{n.componentId?(await _e(n),_.success("修改成功")):(await ge(n),_.success("新增成功")),g.value=!1,y()}catch(a){console.error("操作失败:",a),_.error("操作失败")}}},W=()=>{g.value=!1,v.value&&v.value.resetFields()};return ie(()=>{y()}),(a,e)=>{const d=u("el-input"),f=u("el-form-item"),m=u("el-button"),$=u("el-form"),X=u("el-card"),P=u("el-col"),Y=u("el-row"),p=u("el-table-column"),Z=u("el-table"),ee=u("pagination"),te=u("el-option"),le=u("el-select"),z=u("el-input-number"),oe=u("el-dialog"),ne=de("loading");return V(),E("div",ye,[t(X,{shadow:"never",class:"search-card"},{default:o(()=>[U(t($,{model:r,ref:"queryForm",inline:!0,"label-width":"80px"},{default:o(()=>[t(f,{label:"组件编码",prop:"componentCode"},{default:o(()=>[t(d,{modelValue:r.componentCode,"onUpdate:modelValue":e[0]||(e[0]=l=>r.componentCode=l),placeholder:"请输入组件编码",clearable:"",size:"small",onKeyup:F(C,["enter"])},null,8,["modelValue"])]),_:1}),t(f,{label:"组件名称",prop:"componentName"},{default:o(()=>[t(d,{modelValue:r.componentName,"onUpdate:modelValue":e[1]||(e[1]=l=>r.componentName=l),placeholder:"请输入组件名称",clearable:"",size:"small",onKeyup:F(C,["enter"])},null,8,["modelValue"])]),_:1}),t(f,null,{default:o(()=>[t(m,{type:"primary",icon:"Search",size:"small",onClick:C},{default:o(()=>e[9]||(e[9]=[i("搜索")])),_:1,__:[9]}),t(m,{icon:"RefreshRight",size:"small",onClick:j},{default:o(()=>e[10]||(e[10]=[i("重置")])),_:1,__:[10]})]),_:1})]),_:1},8,["model"]),[[R,I.value]])]),_:1}),t(Y,{gutter:10,class:"mb8"},{default:o(()=>[t(P,{span:1.5},{default:o(()=>[t(m,{type:"primary",icon:"Plus",size:"small",onClick:O},{default:o(()=>e[11]||(e[11]=[i(" 新增组件 ")])),_:1,__:[11]})]),_:1}),t(P,{span:1.5},{default:o(()=>[t(m,{type:"danger",icon:"Delete",size:"small",disabled:S.value.length===0,onClick:D},{default:o(()=>e[12]||(e[12]=[i(" 批量删除 ")])),_:1,__:[12]},8,["disabled"])]),_:1}),t(P,{span:21},{default:o(()=>[t(m,{type:"info",icon:"Search",size:"small",onClick:A,style:{float:"right"}},{default:o(()=>[i(b(I.value?"收起":"展开")+"搜索 ",1)]),_:1})]),_:1})]),_:1}),U((V(),L(Z,{data:B.value,onSelectionChange:H,fit:""},{default:o(()=>[t(p,{type:"selection",width:"55",align:"center"}),t(p,{label:"产品编码",align:"center","show-overflow-tooltip":!0},{default:o(l=>{var c;return[i(b(((c=l.row.product)==null?void 0:c.productCode)||l.row.componentCode),1)]}),_:1}),t(p,{label:"产品名称",align:"center","show-overflow-tooltip":!0},{default:o(l=>{var c;return[i(b(((c=l.row.product)==null?void 0:c.productName)||l.row.componentName),1)]}),_:1}),t(p,{label:"Model",align:"center","show-overflow-tooltip":!0},{default:o(l=>{var c;return[i(b(((c=l.row.product)==null?void 0:c.productModel)||"-"),1)]}),_:1}),t(p,{label:"数量",align:"center",prop:"quantity"}),t(p,{label:"单价",align:"center",prop:"unitPrice"}),t(p,{label:"金额",align:"center",prop:"amount"}),t(p,{label:"创建人",align:"center",prop:"createBy"}),t(p,{label:"创建时间",align:"center",prop:"createTime",width:"180"}),t(p,{label:"操作",align:"center","class-name":"small-padding fixed-width",width:"150"},{default:o(l=>[t(m,{size:"small",type:"primary",icon:"Edit",onClick:c=>G(l.row)},{default:o(()=>e[13]||(e[13]=[i(" 编辑 ")])),_:2,__:[13]},1032,["onClick"]),t(m,{size:"small",type:"danger",icon:"Delete",onClick:c=>D(l.row)},{default:o(()=>e[14]||(e[14]=[i(" 删除 ")])),_:2,__:[14]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[ne,w.value]]),U(t(ee,{total:k.value,page:r.pageNum,"onUpdate:page":e[2]||(e[2]=l=>r.pageNum=l),limit:r.pageSize,"onUpdate:limit":e[3]||(e[3]=l=>r.pageSize=l),onPagination:y},null,8,["total","page","limit"]),[[R,k.value>0]]),t(oe,{title:h.value,modelValue:g.value,"onUpdate:modelValue":e[8]||(e[8]=l=>g.value=l),width:"600px","append-to-body":""},{footer:o(()=>[T("span",be,[t(m,{onClick:W},{default:o(()=>e[15]||(e[15]=[i("取消")])),_:1,__:[15]}),t(m,{type:"primary",onClick:J},{default:o(()=>e[16]||(e[16]=[i("确定")])),_:1,__:[16]})])]),default:o(()=>[t($,{ref_key:"formRef",ref:v,model:n,rules:K,"label-width":"120px"},{default:o(()=>[t(f,{label:"型号选择",prop:"productId"},{default:o(()=>[t(le,{modelValue:n.productId,"onUpdate:modelValue":e[4]||(e[4]=l=>n.productId=l),placeholder:"请选择型号",filterable:"",remote:"","reserve-keyword":"","remote-method":Q,loading:N.value},{default:o(()=>[(V(!0),E(se,null,pe(q.value,l=>(V(),L(te,{key:l.productId,label:l.label,value:l.productId},{default:o(()=>[T("div",null,b(l.label),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1}),t(f,{label:"数量",prop:"quantity"},{default:o(()=>[t(z,{modelValue:n.quantity,"onUpdate:modelValue":e[5]||(e[5]=l=>n.quantity=l),min:.01,step:.01,placeholder:"请输入数量"},null,8,["modelValue"])]),_:1}),t(f,{label:"单价",prop:"unitPrice"},{default:o(()=>[t(z,{modelValue:n.unitPrice,"onUpdate:modelValue":e[6]||(e[6]=l=>n.unitPrice=l),min:.01,step:.01,placeholder:"请输入单价"},null,8,["modelValue"])]),_:1}),t(f,{label:"金额",prop:"amount"},{default:o(()=>[t(z,{modelValue:n.amount,"onUpdate:modelValue":e[7]||(e[7]=l=>n.amount=l),min:.01,step:.01,placeholder:"请输入金额",disabled:""},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])])}}},Se=ae(we,[["__scopeId","data-v-75fb69d1"]]);export{Se as default};
