import N from"./NodeSelector-DEupmx4h.js";import g from"./AttributeSelector-CyYPhvVA.js";import{i as le,T as b}from"./actionConfig-C-hhf0v-.js";import{a9 as J,_ as te,r as h,H as z,g as ae,a as E,c as f,o,m as n,k as V,l as c,F as C,b as T,w as O,n as P,E as M}from"./index-DgigFOm-.js";import{getSuperBomVariableByBomId as ue}from"./superBomVariable-_jqz_F6y.js";const re=a=>J({url:"/cpq/superBomRuleRelation/getByBomId",method:"post",data:typeof a=="object"?a:{bomId:a}}),ve=a=>J({url:"/cpq/superBomRuleRelation/edit",method:"post",data:a}),pe=a=>J({url:"/cpq/superBomRuleRelation/remove",method:"post",data:a}),oe={class:"target-object-selector"},de={__name:"TargetObjectSelector",props:{modelValue:{type:[String,Number,Array],default:""},actionType:{type:String,required:!0},targetType:{type:String,required:!0},bomId:{type:[String,Number],required:!0},structureId:{type:[String,Number],default:""},attributeId:{type:[String,Number],default:""},structure:{type:Object,default:null}},emits:["update:modelValue","change","update:structureId","update:attributeId"],setup(a,{emit:F}){const d=a,p=F,r=h(d.structureId||""),s=h(d.attributeId||""),m=h(null),x=h([]),Y=h([]),R=h(!1),U=h(!1),L=h(!1),u=h(d.modelValue),k=l=>{if(!l)return[];let e=[];return typeof l=="string"?l.includes(",")?e=l.split(",").map(i=>i.trim()):e=[l]:Array.isArray(l)?e=l:e=[String(l)],e.map(i=>{if(!i)return null;const y=Number(i);return isNaN(y)?null:y}).filter(i=>i!==null)};z(u,l=>{const e=k(l),i=k(d.modelValue);JSON.stringify(e)!==JSON.stringify(i)&&p("update:modelValue",l)}),z(()=>d.modelValue,l=>{const e=k(l),i=k(u.value);JSON.stringify(e)!==JSON.stringify(i)&&(u.value=l)});const I=ae(()=>le(d.actionType,d.targetType)),$=l=>{p("change",l),p("update:structureId",l)},A=l=>{r.value=l,s.value="",u.value="",p("update:structureId",l)},w=l=>{p("change",l),p("update:attributeId",l)},D=(l,e)=>{s.value=l,m.value=e,u.value="",p("update:attributeId",l)},S=l=>{p("change",l)},G=l=>{p("change",l)},H=l=>{p("change",l)},K=l=>{p("change",l)},Q=async()=>{if(d.bomId){if(R.value){console.log("规则列表正在加载中，跳过重复调用");return}R.value=!0;try{const l=await re(d.bomId);if(l.code===200&&l.data){if(x.value=l.data,d.targetType===b.RULE&&d.modelValue){const e=k(d.modelValue);u.value=e}}else M.error("加载规则列表失败")}catch(l){console.error("加载规则列表失败:",l),M.error("加载规则列表失败")}finally{R.value=!1,console.log("规则列表加载完成，重置loading状态")}}},W=l=>{if(I.value)return k(l);{if(!l)return"";if(Array.isArray(l))return l.length>0?l[0]:"";const e=Number(l);return isNaN(e)?l:e}},X=async()=>{if(d.bomId){if(U.value){console.log("变量列表正在加载中，跳过重复调用");return}U.value=!0;try{console.log("开始加载变量列表");const l=await ue(d.bomId);if(l.code===200&&l.data){if(Y.value=l.data,d.targetType===b.VARIABLE&&d.modelValue){const e=W(d.modelValue);JSON.stringify(u.value)!==JSON.stringify(e)&&(u.value=e)}}else M.error("加载变量列表失败")}catch(l){console.error("加载变量列表失败:",l),M.error("加载变量列表失败")}finally{U.value=!1,console.log("变量列表加载完成，重置loading状态")}}},Z=()=>{if(L.value){console.log("初始化过程中，跳过重复调用initTargetObject");return}L.value=!0;try{if(!d)return;const l=d.targetType||"",e=d.structureId||"",i=d.attributeId||"",y=d.modelValue||"";if(!l){r.value="",s.value="",m.value=null,u.value="";return}r.value!==e&&(r.value=e),s.value!==i&&(s.value=i),l!==b.VARIABLE?JSON.stringify(u.value)!==JSON.stringify(y)&&(u.value=y):!u.value&&y&&(u.value=y),[b.NODE_STATIC_ATTR_VALUE,b.NODE_DYNAMIC_ATTR_VALUE].includes(l)&&e&&i?console.log("需要加载属性详情:",{attributeId:i,structureId:e,targetType:l}):l===b.RULE?R.value||Q():l===b.VARIABLE&&(U.value||X())}finally{L.value=!1}};let j=null;return z(()=>[d.structureId,d.attributeId,d.modelValue,d.targetType,d.bomId],([l,e,i,y,q],[B,t,v,_,ee]=[])=>{j&&clearTimeout(j),j=setTimeout(()=>{(l!==B||e!==t||JSON.stringify(i)!==JSON.stringify(v)||y!==_||q!==ee)&&Z()},100)},{immediate:!0}),(l,e)=>{const i=E("el-input"),y=E("el-form-item"),q=E("el-option"),B=E("el-select");return o(),f("div",oe,[a.targetType===c(b).NODE?(o(),n(N,{key:0,modelValue:u.value,"onUpdate:modelValue":e[0]||(e[0]=t=>u.value=t),"bom-id":a.bomId,"target-type":a.targetType,label:"目标对象",placeholder:"请选择当前BOM下树状节点",multiple:!1,required:!0,onChange:$},null,8,["modelValue","bom-id","target-type"])):a.targetType===c(b).NODE_STATIC_ATTR?(o(),f(C,{key:1},[T(N,{modelValue:r.value,"onUpdate:modelValue":e[1]||(e[1]=t=>r.value=t),"bom-id":a.bomId,label:"节点",placeholder:"请选择当前BOM下树状节点",multiple:!1,required:!0,onChange:A},null,8,["modelValue","bom-id"]),r.value?(o(),n(g,{key:0,modelValue:u.value,"onUpdate:modelValue":e[2]||(e[2]=t=>u.value=t),"attribute-type":"static","bom-id":a.bomId,"node-id":r.value,label:"目标对象",placeholder:"请选择节点下静态属性",multiple:I.value,required:!0,onChange:w},null,8,["modelValue","bom-id","node-id","multiple"])):V("",!0)],64)):a.targetType===c(b).NODE_STATIC_ATTR_VALUE?(o(),f(C,{key:2},[T(N,{modelValue:r.value,"onUpdate:modelValue":e[3]||(e[3]=t=>r.value=t),"bom-id":a.bomId,"target-type":a.targetType,label:"节点",placeholder:"请选择当前BOM下树状节点",multiple:!1,required:!0,onChange:A},null,8,["modelValue","bom-id","target-type"]),r.value?(o(),n(g,{key:0,modelValue:s.value,"onUpdate:modelValue":e[4]||(e[4]=t=>s.value=t),"attribute-type":"static","bom-id":a.bomId,"node-id":r.value,label:"属性",placeholder:"请选择节点下静态属性",multiple:!1,required:!0,onChange:D},null,8,["modelValue","bom-id","node-id"])):V("",!0),s.value?(o(),n(y,{key:1,label:"目标对象",required:!0},{default:O(()=>{var t;return[m.value&&m.value.attributeType==="selector"?(o(),n(g,{key:0,modelValue:u.value,"onUpdate:modelValue":e[5]||(e[5]=v=>u.value=v),"attribute-type":"attributeValue","attribute-id":s.value,"structure-id":r.value,"attr-info":m.value,"dynamic-values":((t=m.value)==null?void 0:t.attributeValues)||[],label:"",placeholder:"请选择静态属性下属性值",multiple:I.value,required:!0,onChange:S},null,8,["modelValue","attribute-id","structure-id","attr-info","dynamic-values","multiple"])):m.value&&m.value.attributeType==="text"?(o(),n(i,{key:1,modelValue:u.value,"onUpdate:modelValue":e[6]||(e[6]=v=>u.value=v),placeholder:"请输入静态属性值",disabled:!1,style:{width:"100%"},onChange:S},null,8,["modelValue"])):(o(),n(i,{key:2,placeholder:"加载中...",disabled:"",style:{width:"100%"}}))]}),_:1})):V("",!0)],64)):a.targetType===c(b).NODE_DYNAMIC_ATTR?(o(),f(C,{key:3},[T(N,{modelValue:r.value,"onUpdate:modelValue":e[7]||(e[7]=t=>r.value=t),"bom-id":a.bomId,"target-type":a.targetType,label:"节点",placeholder:"请选择当前BOM下树状节点",multiple:!1,required:!0,onChange:A},null,8,["modelValue","bom-id","target-type"]),r.value?(o(),n(g,{key:0,modelValue:u.value,"onUpdate:modelValue":e[8]||(e[8]=t=>u.value=t),"attribute-type":"dynamic","bom-id":a.bomId,"node-id":r.value,label:"目标对象",placeholder:"请选择节点下动态属性",multiple:I.value,required:!0,onChange:w},null,8,["modelValue","bom-id","node-id","multiple"])):V("",!0)],64)):a.targetType===c(b).NODE_DYNAMIC_ATTR_VALUE?(o(),f(C,{key:4},[T(N,{modelValue:r.value,"onUpdate:modelValue":e[9]||(e[9]=t=>r.value=t),"bom-id":a.bomId,"target-type":a.targetType,label:"节点",placeholder:"请选择当前BOM下树状节点",multiple:!1,required:!0,onChange:A},null,8,["modelValue","bom-id","target-type"]),r.value?(o(),n(g,{key:0,modelValue:s.value,"onUpdate:modelValue":e[10]||(e[10]=t=>s.value=t),"attribute-type":"dynamic","bom-id":a.bomId,"node-id":r.value,label:"属性",placeholder:"请选择节点下动态属性",multiple:!1,required:!0,onChange:D},null,8,["modelValue","bom-id","node-id"])):V("",!0),s.value?(o(),n(y,{key:1,label:"目标对象",required:!0},{default:O(()=>{var t;return[m.value&&m.value.attributeType==="selector"?(o(),n(g,{key:0,modelValue:u.value,"onUpdate:modelValue":e[11]||(e[11]=v=>u.value=v),"attribute-type":"attributeValue","attribute-id":s.value,"structure-id":r.value,"attr-info":m.value,"dynamic-values":((t=m.value)==null?void 0:t.attributeValues)||[],label:"",placeholder:"请选择动态属性下属性值",multiple:I.value,required:!0,onChange:S},null,8,["modelValue","attribute-id","structure-id","attr-info","dynamic-values","multiple"])):m.value&&m.value.attributeType==="text"?(o(),n(i,{key:1,modelValue:u.value,"onUpdate:modelValue":e[12]||(e[12]=v=>u.value=v),placeholder:"请输入动态属性值",disabled:!1,style:{width:"100%"},onChange:S},null,8,["modelValue"])):(o(),n(i,{key:2,placeholder:"加载中...",disabled:"",style:{width:"100%"}}))]}),_:1})):V("",!0)],64)):a.targetType===c(b).NODE_PRODUCT?(o(),f(C,{key:5},[T(N,{modelValue:r.value,"onUpdate:modelValue":e[13]||(e[13]=t=>r.value=t),"bom-id":a.bomId,"target-type":a.targetType,label:"节点",placeholder:"请选择当前BOM下树状节点",multiple:!1,required:!0,onChange:A},null,8,["modelValue","bom-id","target-type"]),T(g,{modelValue:u.value,"onUpdate:modelValue":e[14]||(e[14]=t=>u.value=t),"attribute-type":"product","bom-id":a.bomId,"node-id":r.value,label:"目标对象",placeholder:"请选择节点下产品",multiple:I.value,required:!0,onChange:G},null,8,["modelValue","bom-id","node-id","multiple"])],64)):a.targetType===c(b).DYNAMIC_ATTR?(o(),f(C,{key:6},[T(N,{modelValue:r.value,"onUpdate:modelValue":e[15]||(e[15]=t=>r.value=t),"bom-id":a.bomId,"target-type":a.targetType,label:"节点",placeholder:"请选择当前BOM下树状节点",multiple:!1,required:!0,onChange:A},null,8,["modelValue","bom-id","target-type"]),r.value?(o(),n(g,{key:0,modelValue:u.value,"onUpdate:modelValue":e[16]||(e[16]=t=>u.value=t),"attribute-type":"dynamic","bom-id":a.bomId,"node-id":r.value,label:"目标对象",placeholder:"请选择节点下动态属性",multiple:I.value,required:!0,onChange:w},null,8,["modelValue","bom-id","node-id","multiple"])):V("",!0)],64)):a.targetType===c(b).DYNAMIC_ATTR_VALUE?(o(),f(C,{key:7},[T(N,{modelValue:r.value,"onUpdate:modelValue":e[17]||(e[17]=t=>r.value=t),"bom-id":a.bomId,"target-type":a.targetType,label:"节点",placeholder:"请选择当前BOM下树状节点",multiple:!1,required:!0,onChange:A},null,8,["modelValue","bom-id","target-type"]),r.value?(o(),n(g,{key:0,modelValue:s.value,"onUpdate:modelValue":e[18]||(e[18]=t=>s.value=t),"attribute-type":"dynamic","bom-id":a.bomId,"node-id":r.value,label:"属性",placeholder:"请选择节点下动态属性",multiple:!1,required:!0,onChange:D},null,8,["modelValue","bom-id","node-id"])):V("",!0),s.value?(o(),n(y,{key:1,label:"目标对象",required:!0},{default:O(()=>{var t;return[m.value&&m.value.attributeType==="selector"?(o(),n(g,{key:0,modelValue:u.value,"onUpdate:modelValue":e[19]||(e[19]=v=>u.value=v),"attribute-type":"attributeValue","attribute-id":s.value,"structure-id":r.value,"attr-info":m.value,"dynamic-values":((t=m.value)==null?void 0:t.attributeValues)||[],label:"",placeholder:"请选择动态属性下属性值",multiple:I.value,required:!0,onChange:S},null,8,["modelValue","attribute-id","structure-id","attr-info","dynamic-values","multiple"])):m.value&&m.value.attributeType==="text"?(o(),n(i,{key:1,modelValue:u.value,"onUpdate:modelValue":e[20]||(e[20]=v=>u.value=v),placeholder:"请输入动态属性值",disabled:!1,style:{width:"100%"},onChange:S},null,8,["modelValue"])):(o(),n(i,{key:2,placeholder:"加载中...",disabled:"",style:{width:"100%"}}))]}),_:1})):V("",!0)],64)):a.targetType===c(b).RULE?(o(),n(y,{key:8,label:"目标对象",required:""},{default:O(()=>[T(B,{modelValue:u.value,"onUpdate:modelValue":e[21]||(e[21]=t=>u.value=t),multiple:"",placeholder:"请选择当前BOM规则列表",clearable:"",filterable:"",style:{width:"100%"},onChange:H},{default:O(()=>[(o(!0),f(C,null,P(x.value,t=>(o(),n(q,{key:t.ruleId,label:t.ruleName,value:t.ruleId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):a.targetType===c(b).VARIABLE?(o(),n(y,{key:9,label:"目标对象",required:""},{default:O(()=>[T(B,{modelValue:u.value,"onUpdate:modelValue":e[22]||(e[22]=t=>u.value=t),multiple:I.value,placeholder:"请选择已定义的变量",clearable:"",filterable:"",style:{width:"100%"},onChange:K},{default:O(()=>[(o(!0),f(C,null,P(Y.value,t=>(o(),n(q,{key:t.variableId,label:t.variableName,value:t.variableId},null,8,["label","value"]))),128))]),_:1},8,["modelValue","multiple"])]),_:1})):V("",!0)])}}},ie=te(de,[["__scopeId","data-v-6761e0c1"]]),ge=Object.freeze(Object.defineProperty({__proto__:null,default:ie},Symbol.toStringTag,{value:"Module"}));export{ie as T,ge as a,pe as d,re as g,ve as u};
