import{r as c,a as Z,C as z,o as ee,h as s,G as le,d as te,e as M,i as e,H as x,k as o,p as oe,q as r,I as D,t as A,l as ae,j as ne,V as g,E as se}from"./index-CwdKQqOf.js";import{l as ue,c as ie,e as re,f as de}from"./solution-D52F0zTE.js";const me={class:"app-container"},pe={class:"dialog-footer"},ge={__name:"index",setup(ce){const y=c(!0),C=c(!0),N=c(0),B=c([]),I=c([]),w=c(""),_=c(!1),E=Z(),v=c(null),u=z({pageNum:1,pageSize:10,solutionName:"",status:""}),t=z({solutionId:null,solutionCode:"",solutionName:"",description:"",status:"0",bomId:"",customerId:null,customerName:"",totalAmount:0,currency:"CNY",ruleIds:[]}),O=z({solutionCode:[{required:!0,message:"方案编码不能为空",trigger:"blur"}],solutionName:[{required:!0,message:"方案名称不能为空",trigger:"blur"}],status:[{required:!0,message:"方案状态不能为空",trigger:"change"}]}),b=async()=>{y.value=!0;try{const n=await ue(u);B.value=n.rows,N.value=n.total,y.value=!1}catch{y.value=!1,g.error("获取解决方案列表失败")}},k=()=>{u.pageNum=1,b()},R=()=>{u.solutionName="",u.status="",k()},T=()=>{C.value=!C.value},F=n=>{I.value=n},P=()=>{t.solutionId=null,t.solutionCode="",t.solutionName="",t.description="",t.status="0",t.bomId="",t.customerId=null,t.customerName="",t.totalAmount=0,t.currency="CNY",w.value="新增解决方案",_.value=!0},$=n=>{t.solutionId=n.solutionId,t.solutionCode=n.solutionCode,t.solutionName=n.solutionName,t.description=n.description,t.status=n.status,t.bomId=n.bomId,t.customerId=n.customerId,t.customerName=n.customerName,t.totalAmount=n.totalAmount,t.currency=n.currency,w.value="修改解决方案",_.value=!0},U=async n=>{const l=n.solutionId?[n.solutionId]:I.value.map(f=>f.solutionId);await se.confirm("确定要删除选中的解决方案吗？","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});try{await ie(l),g.success("删除成功"),b()}catch{g.error("删除失败")}},K=n=>{E.push({path:"/cpq/solution/component",query:{solutionId:n.solutionId,solutionName:n.solutionName}})},L=async()=>{if(v.value){await v.value.validate();try{t.solutionId?(await re(t),g.success("修改成功")):(await de(t),g.success("新增成功")),_.value=!1,b()}catch(n){console.error("操作失败:",n),g.error("操作失败")}}},Q=()=>{_.value=!1,v.value&&v.value.resetFields()};return ee(()=>{b()}),(n,l)=>{const f=s("el-input"),m=s("el-form-item"),i=s("el-option"),V=s("el-select"),d=s("el-button"),h=s("el-form"),Y=s("el-card"),S=s("el-col"),j=s("el-row"),p=s("el-table-column"),G=s("el-tag"),H=s("el-table"),J=s("pagination"),W=s("el-dialog"),X=le("loading");return M(),te("div",me,[e(Y,{shadow:"never",class:"search-card"},{default:o(()=>[x(e(h,{model:u,ref:"queryForm",inline:!0,"label-width":"80px"},{default:o(()=>[e(m,{label:"方案名称",prop:"solutionName"},{default:o(()=>[e(f,{modelValue:u.solutionName,"onUpdate:modelValue":l[0]||(l[0]=a=>u.solutionName=a),placeholder:"请输入方案名称",clearable:"",size:"small",onKeyup:oe(k,["enter"])},null,8,["modelValue"])]),_:1}),e(m,{label:"方案状态",prop:"solutionStatus"},{default:o(()=>[e(V,{modelValue:u.status,"onUpdate:modelValue":l[1]||(l[1]=a=>u.status=a),placeholder:"请选择方案状态",clearable:"",size:"small"},{default:o(()=>[e(i,{label:"草稿",value:"0"}),e(i,{label:"生效",value:"1"}),e(i,{label:"失效",value:"2"})]),_:1},8,["modelValue"])]),_:1}),e(m,null,{default:o(()=>[e(d,{type:"primary",icon:"Search",size:"small",onClick:k},{default:o(()=>l[11]||(l[11]=[r("搜索")])),_:1,__:[11]}),e(d,{icon:"RefreshRight",size:"small",onClick:R},{default:o(()=>l[12]||(l[12]=[r("重置")])),_:1,__:[12]})]),_:1})]),_:1},8,["model"]),[[D,C.value]])]),_:1}),e(j,{gutter:10,class:"mb8"},{default:o(()=>[e(S,{span:1.5},{default:o(()=>[e(d,{type:"primary",icon:"Plus",size:"small",onClick:P},{default:o(()=>l[13]||(l[13]=[r(" 新增方案 ")])),_:1,__:[13]})]),_:1}),e(S,{span:1.5},{default:o(()=>[e(d,{type:"danger",icon:"Delete",size:"small",disabled:I.value.length===0,onClick:U},{default:o(()=>l[14]||(l[14]=[r(" 批量删除 ")])),_:1,__:[14]},8,["disabled"])]),_:1}),e(S,{span:21},{default:o(()=>[e(d,{type:"info",icon:"Search",size:"small",onClick:T,style:{float:"right"}},{default:o(()=>[r(A(C.value?"收起":"展开")+"搜索 ",1)]),_:1})]),_:1})]),_:1}),x((M(),ae(H,{data:B.value,onSelectionChange:F},{default:o(()=>[e(p,{type:"selection",width:"55",align:"center"}),e(p,{label:"方案编码",align:"center",prop:"solutionCode"}),e(p,{label:"方案名称",align:"center",prop:"solutionName","show-overflow-tooltip":!0}),e(p,{label:"方案状态",align:"center",prop:"status"},{default:o(a=>[e(G,{type:a.row.status==="0"?"info":a.row.status==="1"?"success":"danger",size:"small"},{default:o(()=>[r(A(a.row.status==="0"?"草稿":a.row.status==="1"?"生效":"失效"),1)]),_:2},1032,["type"])]),_:1}),e(p,{label:"BOM数量",align:"center",prop:"bomCount"}),e(p,{label:"创建人",align:"center",prop:"createBy"}),e(p,{label:"创建时间",align:"center",prop:"createTime",width:"180"}),e(p,{label:"操作",align:"center","class-name":"small-padding fixed-width",width:"250"},{default:o(a=>[e(d,{size:"small",type:"primary",icon:"Edit",onClick:q=>$(a.row)},{default:o(()=>l[15]||(l[15]=[r(" 编辑 ")])),_:2,__:[15]},1032,["onClick"]),e(d,{size:"small",type:"success",icon:"DocumentAdd",onClick:q=>K(a.row)},{default:o(()=>l[16]||(l[16]=[r(" 组件管理 ")])),_:2,__:[16]},1032,["onClick"]),e(d,{size:"small",type:"danger",icon:"Delete",onClick:q=>U(a.row)},{default:o(()=>l[17]||(l[17]=[r(" 删除 ")])),_:2,__:[17]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[X,y.value]]),x(e(J,{total:N.value,page:u.pageNum,"onUpdate:page":l[2]||(l[2]=a=>u.pageNum=a),limit:u.pageSize,"onUpdate:limit":l[3]||(l[3]=a=>u.pageSize=a),onPagination:b},null,8,["total","page","limit"]),[[D,N.value>0]]),e(W,{title:w.value,modelValue:_.value,"onUpdate:modelValue":l[10]||(l[10]=a=>_.value=a),width:"700px","append-to-body":""},{footer:o(()=>[ne("span",pe,[e(d,{onClick:Q},{default:o(()=>l[18]||(l[18]=[r("取消")])),_:1,__:[18]}),e(d,{type:"primary",onClick:L},{default:o(()=>l[19]||(l[19]=[r("确定")])),_:1,__:[19]})])]),default:o(()=>[e(h,{ref_key:"formRef",ref:v,model:t,rules:O,"label-width":"120px"},{default:o(()=>[e(m,{label:"方案编码",prop:"solutionCode"},{default:o(()=>[e(f,{modelValue:t.solutionCode,"onUpdate:modelValue":l[4]||(l[4]=a=>t.solutionCode=a),placeholder:"请输入方案编码"},null,8,["modelValue"])]),_:1}),e(m,{label:"方案名称",prop:"solutionName"},{default:o(()=>[e(f,{modelValue:t.solutionName,"onUpdate:modelValue":l[5]||(l[5]=a=>t.solutionName=a),placeholder:"请输入方案名称"},null,8,["modelValue"])]),_:1}),e(m,{label:"方案描述",prop:"description"},{default:o(()=>[e(f,{modelValue:t.description,"onUpdate:modelValue":l[6]||(l[6]=a=>t.description=a),type:"textarea",placeholder:"请输入方案描述",rows:3},null,8,["modelValue"])]),_:1}),e(m,{label:"方案状态",prop:"status"},{default:o(()=>[e(V,{modelValue:t.status,"onUpdate:modelValue":l[7]||(l[7]=a=>t.status=a),placeholder:"请选择方案状态"},{default:o(()=>[e(i,{label:"草稿",value:"0"}),e(i,{label:"生效",value:"1"}),e(i,{label:"失效",value:"2"})]),_:1},8,["modelValue"])]),_:1}),e(m,{label:"关联BOM",prop:"bomId"},{default:o(()=>[e(V,{modelValue:t.bomId,"onUpdate:modelValue":l[8]||(l[8]=a=>t.bomId=a),placeholder:"请选择关联的超级BOM"},{default:o(()=>[e(i,{label:"BOM-001",value:"1"}),e(i,{label:"BOM-002",value:"2"})]),_:1},8,["modelValue"])]),_:1}),e(m,{label:"关联规则",prop:"ruleIds"},{default:o(()=>[e(V,{modelValue:t.ruleIds,"onUpdate:modelValue":l[9]||(l[9]=a=>t.ruleIds=a),multiple:"",placeholder:"请选择关联的配置规则"},{default:o(()=>[e(i,{label:"规则-001",value:"1"}),e(i,{label:"规则-002",value:"2"}),e(i,{label:"规则-003",value:"3"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])])}}};export{ge as default};
