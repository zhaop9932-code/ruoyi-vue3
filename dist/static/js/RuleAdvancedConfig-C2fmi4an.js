import{g as q,b as O,s as j}from"./rule-nChVW3Ks.js";import{_ as E,r as y,z as J,w as x,o as z,h as u,d as L,e as I,i as l,k as o,j as p,t as F,K,L as Q,l as W,q as _,V as m}from"./index-CwdKQqOf.js";const X={class:"advanced-config"},Z={class:"card-header"},$={class:"header-actions"},h={class:"priority-value"},ee={__name:"RuleAdvancedConfig",props:{modelValue:{type:Object,default:()=>({})},ruleType:{type:String,default:"validation"},ruleId:{type:[String,Number],required:!0}},emits:["update:modelValue","save-success"],setup(U,{emit:G}){const d=U,k=G,g=y(!1),T=y(!1),n=y({triggerTiming:[],priority:5,validityPeriod:[],executionLimit:0,executionInterval:0,dependencies:[],ruleGroup:"",executionMode:"sync",errorHandling:"continue",remark:"",...d.modelValue}),r=J({get:()=>n.value,set:a=>{n.value=a}}),M=y([]),N=async()=>{T.value=!0;try{const a=await O({ruleType:d.ruleType});a.code===200?M.value=a.data:m.error(a.message||"获取可用规则列表失败")}catch(a){console.error("获取可用规则列表失败:",a),m.error("获取可用规则列表失败")}finally{T.value=!1}},H=async()=>{let a=d.ruleId;if(!a&&a!==0){console.warn("无效的ruleId，无法获取高级配置:",d.ruleId);return}if(a=Number(a),isNaN(a)||a<=0){console.warn("无效的ruleId，无法获取高级配置:",d.ruleId);return}g.value=!0;try{const e=await q(a);e.code===200?n.value={triggerTiming:[],priority:5,validityPeriod:[],executionLimit:0,executionInterval:0,dependencies:[],ruleGroup:"",executionMode:"sync",errorHandling:"continue",remark:"",...e.data}:m.error(e.message||"获取高级配置失败")}catch(e){console.error("获取高级配置失败:",e),m.error("获取高级配置失败")}finally{g.value=!1}},P=async()=>{let a=d.ruleId;if(console.log("ruleId:",a),console.log("ruleId:",d),!a&&a!==0){console.error("无效的ruleId，无法保存高级配置:",d.ruleId),m.error("无效的规则ID，无法保存高级配置");return}if(a=Number(a),isNaN(a)||a<=0){console.error("无效的ruleId，无法保存高级配置:",d.ruleId),m.error("无效的规则ID，无法保存高级配置");return}g.value=!0;try{const e={triggerTiming:n.value.triggerTiming,priority:n.value.priority,validityPeriod:n.value.validityPeriod,executionLimit:n.value.executionLimit,executionInterval:n.value.executionInterval,dependencies:n.value.dependencies,ruleGroup:n.value.ruleGroup,executionMode:n.value.executionMode,errorHandling:n.value.errorHandling,remark:n.value.remark},f=await j(a,e);f.code===200?(k("update:modelValue",n.value),k("save-success"),m.success("保存成功")):m.error(f.message||"保存失败")}catch(e){console.error("保存高级配置失败:",e),m.error("保存失败")}finally{g.value=!1}},Y=()=>{n.value={triggerTiming:[],priority:5,validityPeriod:[],executionLimit:0,executionInterval:0,dependencies:[],ruleGroup:"",executionMode:"sync",errorHandling:"continue",remark:"",...d.modelValue},m.info("已取消修改")};return x(()=>d.modelValue,a=>{a&&JSON.stringify(a)!==JSON.stringify(n.value)&&(n.value={triggerTiming:[],priority:5,validityPeriod:[],executionLimit:0,executionInterval:0,dependencies:[],ruleGroup:"",executionMode:"sync",errorHandling:"continue",remark:"",...a})},{deep:!0}),x(()=>d.ruleId,a=>{a&&H()},{immediate:!0}),x(()=>d.ruleType,a=>{N()},{immediate:!0}),z(()=>{N()}),(a,e)=>{const f=u("el-button"),v=u("el-option"),b=u("el-select"),i=u("el-form-item"),s=u("el-col"),A=u("el-slider"),c=u("el-row"),D=u("el-date-picker"),w=u("el-input-number"),C=u("el-input"),V=u("el-radio"),R=u("el-radio-group"),S=u("el-form"),B=u("el-card");return I(),L("div",X,[l(B,{shadow:"hover"},{header:o(()=>[p("div",Z,[e[12]||(e[12]=p("span",null,"高级配置",-1)),p("div",$,[l(f,{onClick:Y},{default:o(()=>e[10]||(e[10]=[_("取消")])),_:1,__:[10]}),l(f,{type:"primary",onClick:P},{default:o(()=>e[11]||(e[11]=[_("保存")])),_:1,__:[11]})])])]),default:o(()=>[l(S,{model:r.value,"label-position":"top","label-width":"120px"},{default:o(()=>[l(c,{gutter:20},{default:o(()=>[l(s,{span:12},{default:o(()=>[l(i,{label:"触发时机"},{default:o(()=>[l(b,{modelValue:r.value.triggerTiming,"onUpdate:modelValue":e[0]||(e[0]=t=>r.value.triggerTiming=t),placeholder:"请选择触发时机",multiple:"","collapse-tags":""},{default:o(()=>[l(v,{label:"配置时触发",value:"on_configure"}),l(v,{label:"定价时触发",value:"on_pricing"}),l(v,{label:"报价生成时触发",value:"on_quote_generate"}),l(v,{label:"订单提交时触发",value:"on_order_submit"}),l(v,{label:"订单变更时触发",value:"on_order_change"}),l(v,{label:"定时触发",value:"on_schedule"})]),_:1},8,["modelValue"]),e[13]||(e[13]=p("div",{class:"form-tip"},"可选择多个触发时机",-1))]),_:1,__:[13]})]),_:1}),l(s,{span:12},{default:o(()=>[l(i,{label:"触发优先级"},{default:o(()=>[l(A,{modelValue:r.value.priority,"onUpdate:modelValue":e[1]||(e[1]=t=>r.value.priority=t),min:1,max:10,marks:{1:"低",5:"中",10:"高"}},null,8,["modelValue"]),p("div",h,"当前优先级："+F(r.value.priority),1)]),_:1})]),_:1})]),_:1}),l(c,{gutter:20},{default:o(()=>[l(s,{span:24},{default:o(()=>[l(i,{label:"有效期"},{default:o(()=>[l(D,{modelValue:r.value.validityPeriod,"onUpdate:modelValue":e[2]||(e[2]=t=>r.value.validityPeriod=t),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"]),e[14]||(e[14]=p("div",{class:"form-tip"},"为空表示永久有效",-1))]),_:1,__:[14]})]),_:1})]),_:1}),l(c,{gutter:20},{default:o(()=>[l(s,{span:12},{default:o(()=>[l(i,{label:"执行次数限制"},{default:o(()=>[l(w,{modelValue:r.value.executionLimit,"onUpdate:modelValue":e[3]||(e[3]=t=>r.value.executionLimit=t),min:0,max:999999,step:1,placeholder:"请输入执行次数限制"},null,8,["modelValue"]),e[15]||(e[15]=p("div",{class:"form-tip"},"0表示无限制",-1))]),_:1,__:[15]})]),_:1}),l(s,{span:12},{default:o(()=>[l(i,{label:"执行间隔（秒）"},{default:o(()=>[l(w,{modelValue:r.value.executionInterval,"onUpdate:modelValue":e[4]||(e[4]=t=>r.value.executionInterval=t),min:0,max:86400,step:1,placeholder:"请输入执行间隔"},null,8,["modelValue"]),e[16]||(e[16]=p("div",{class:"form-tip"},"0表示无间隔限制",-1))]),_:1,__:[16]})]),_:1})]),_:1}),l(c,{gutter:20},{default:o(()=>[l(s,{span:24},{default:o(()=>[l(i,{label:"规则依赖"},{default:o(()=>[l(b,{modelValue:r.value.dependencies,"onUpdate:modelValue":e[5]||(e[5]=t=>r.value.dependencies=t),placeholder:"请选择依赖的规则",multiple:"","collapse-tags":""},{default:o(()=>[(I(!0),L(K,null,Q(M.value,t=>(I(),W(v,{key:t.ruleId,label:t.ruleName,value:t.ruleId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e[17]||(e[17]=p("div",{class:"form-tip"},"选择当前规则依赖的其他规则，依赖规则会先执行",-1))]),_:1,__:[17]})]),_:1})]),_:1}),l(c,{gutter:20},{default:o(()=>[l(s,{span:12},{default:o(()=>[l(i,{label:"规则分组"},{default:o(()=>[l(C,{modelValue:r.value.ruleGroup,"onUpdate:modelValue":e[6]||(e[6]=t=>r.value.ruleGroup=t),placeholder:"请输入规则分组"},null,8,["modelValue"]),e[18]||(e[18]=p("div",{class:"form-tip"},"用于规则的分类管理",-1))]),_:1,__:[18]})]),_:1}),l(s,{span:12},{default:o(()=>[l(i,{label:"执行模式"},{default:o(()=>[l(b,{modelValue:r.value.executionMode,"onUpdate:modelValue":e[7]||(e[7]=t=>r.value.executionMode=t),placeholder:"请选择执行模式"},{default:o(()=>[l(v,{label:"同步执行",value:"sync"}),l(v,{label:"异步执行",value:"async"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(c,{gutter:20},{default:o(()=>[l(s,{span:24},{default:o(()=>[l(i,{label:"错误处理策略"},{default:o(()=>[l(R,{modelValue:r.value.errorHandling,"onUpdate:modelValue":e[8]||(e[8]=t=>r.value.errorHandling=t)},{default:o(()=>[l(V,{label:"继续执行"},{default:o(()=>e[19]||(e[19]=[_("继续执行：忽略错误，继续执行后续规则")])),_:1,__:[19]}),l(V,{label:"终止执行"},{default:o(()=>e[20]||(e[20]=[_("终止执行：遇到错误立即终止所有规则执行")])),_:1,__:[20]}),l(V,{label:"回滚执行"},{default:o(()=>e[21]||(e[21]=[_("回滚执行：遇到错误回滚已执行的动作")])),_:1,__:[21]})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(c,{gutter:20},{default:o(()=>[l(s,{span:24},{default:o(()=>[l(i,{label:"备注"},{default:o(()=>[l(C,{modelValue:r.value.remark,"onUpdate:modelValue":e[9]||(e[9]=t=>r.value.remark=t),type:"textarea",placeholder:"请输入备注信息",rows:3},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})])}}},ae=E(ee,[["__scopeId","data-v-cdb2bb2c"]]);export{ae as default};
