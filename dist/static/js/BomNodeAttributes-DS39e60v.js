import{m as Ae,g as Ne,h as Te,n as De,o as qe,p as Re,q as Be}from"./bom-uPfK0qwF.js";import{_ as Oe,M as Fe,r as b,g as q,h as Le,i as $e,a as c,j as ze,c as I,o as v,e as f,k as Q,b as t,w as a,f as s,m as S,t as _,q as E,F as W,s as X,N as Y,E as d,n as M}from"./index-kbfDsxmo.js";const Ee={class:"bom-node-attributes"},Me={class:"management-header"},je={class:"header-buttons"},Pe={style:{"margin-bottom":"16px",padding:"10px","background-color":"#f5f7fa","border-radius":"4px"}},Ge={style:{"font-weight":"bold"}},Je={style:{"margin-left":"10px"}},He={class:"dialog-footer"},Ke={class:"attribute-value-container"},Qe={class:"attribute-value-header"},We={key:0,style:{display:"flex","align-items":"center"}},Xe={style:{flex:"1","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}},Ye={key:1,style:{color:"#909399"}},Ze={style:{"margin-top":"10px"}},et={class:"dialog-footer"},tt={__name:"BomNodeAttributes",props:{bomId:{type:[String,Number],required:!0},bomStructureId:{type:[String,Number],default:""},nodeName:{type:String,default:""}},setup(Z){const g=Z,{proxy:ee}=Fe(),{component_type:j,sys_normal_disable:te}=ee.useDict("component_type","sys_normal_disable"),k=b(!1),x=b([]),y=b(!1),R=b("新增属性"),B=b(null),w=b([]),O=b(!1),A=b(!1),h=b([]),F=b(null),U=b(!1),L=b("新增属性值"),$=b(null),le=q({valueCode:[],valueName:[{required:!0,message:"属性值名称不能为空",trigger:"blur"}],sortOrder:[{required:!0,message:"请输入排序号",trigger:"blur"},{type:"number",min:0,message:"排序号不能小于0",trigger:"blur"}],status:[{required:!0,message:"请选择状态",trigger:"change"}],isDefault:[{required:!0,message:"请选择是否默认",trigger:"change"}],imgUrl:[{type:"string",message:"图片URL必须是字符串",trigger:"blur"}]}),ae=b([]),n=q({id:null,attributeId:null,valueCode:"",valueName:"",sortOrder:0,status:"enabled",imgUrl:"",isDefault:"0"}),r=q({id:null,bomId:g.bomId,bomStructureId:g.bomStructureId,attributeCode:"",attributeName:"",componentType:"input",stepValue:"",minValue:"",maxValue:"",showTooltip:"0",isRequired:"0",defaultValue:"",sortOrder:0}),N=async()=>{k.value=!0;try{const l=await Ae({bomId:g.bomId,bomStructureId:g.bomStructureId});w.value=l.rows,console.log("response.data:",l.rows),console.log("attributeList:",w.value),k.value=!1}catch(l){console.error("加载属性列表失败:",l),d.error("加载属性列表失败"),k.value=!1}};Le(()=>g.bomStructureId,l=>{console.log("bomStructureId:",l),l!=null&&l!==""&&(r.bomStructureId=l,console.log("bomStructureId:",l),N())},{immediate:!0}),$e(()=>{N()});const re=q({attributeName:[{required:!0,message:"属性名称不能为空",trigger:"blur"}],componentType:[{required:!0,message:"请选择组件类型",trigger:"change"}],isRequired:[{required:!0,message:"请选择是否必填",trigger:"change"}],sortOrder:[{required:!0,message:"请输入排序号",trigger:"blur"},{type:"number",min:0,message:"排序号不能小于0",trigger:"blur"}]}),oe=l=>{const e=j.value.find(i=>i.value===l);return e?e.label:l},ue=l=>({input:"primary",select:"info",radio:"success",checkbox:"warning",date:"danger",datetime:"purple",number:"blue",slider:"green",switch:"orange",textarea:"cyan"})[l]||"default",ne=l=>{x.value=l},ie=()=>{ce(),R.value="新增属性",y.value=!0},de=l=>{const e={...l,attributeCode:l.attributeCode,attributeName:l.attributeName,isRequired:l.required!==void 0?l.required?"1":"0":l.isRequired||"0"};Object.assign(r,e),r.bomStructureId=g.bomStructureId,R.value="编辑属性",y.value=!0},se=async l=>{try{await M.confirm(`确定要删除属性 "${l.attributeName}" 吗？`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),w.value=w.value.filter(e=>e.id!==l.id),d.success("属性删除成功")}catch(e){e!=="cancel"&&(d.error("删除失败"),console.error("删除属性失败:",e))}},me=async()=>{if(x.value.length!==0)try{await M.confirm(`确定要删除选中的 ${x.value.length} 个属性吗？`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const l=x.value.map(e=>e.id);w.value=w.value.filter(e=>!l.includes(e.id)),x.value=[],d.success("批量删除成功")}catch(l){l!=="cancel"&&(d.error("批量删除失败"),console.error("批量删除属性失败:",l))}},pe=async()=>{try{await B.value.validate();let l=r.bomStructureId;if((l==null||l==="")&&(l=g.bomStructureId),l==null||l===""){d.error("请先选择节点");return}r.bomStructureId=l;const e={...r,id:r.id,isRequired:r.isRequired,description:void 0,attrCode:void 0,attrName:void 0};if(r.id)try{await Ne(r.bomStructureId,[e]),await N(),d.success("属性更新成功"),y.value=!1}catch(i){console.error("更新属性失败:",i),d.error("更新属性失败")}else try{await Te([e]),await N(),d.success("属性新增成功"),y.value=!1}catch(i){console.error("新增属性失败:",i),d.error("新增属性失败")}}catch(l){l!==!1&&(d.error("操作失败，请检查表单数据"),console.error("提交属性表单失败:",l))}},ce=()=>{var e;const l=r.bomStructureId||g.bomStructureId;(e=B.value)==null||e.resetFields(),r.id=null,r.attributeCode="",r.attributeName="",r.componentType="input",r.stepValue="",r.minValue="",r.maxValue="",r.showTooltip="0",r.isRequired="0",r.defaultValue="",r.sortOrder=0,r.bomStructureId=l},be=l=>{F.value=l,O.value=!0,fe(l.id)},fe=async l=>{A.value=!0;try{const e=await Be(g.bomStructureId,l);h.value=e.data,A.value=!1}catch(e){console.error("加载属性值列表失败:",e),d.error("加载属性值列表失败"),A.value=!1}},ge=()=>{var l,e;n.id=null,n.attributeId=(l=F.value)==null?void 0:l.id,n.valueCode="",n.valueName="",n.sortOrder=0,n.status="enabled",n.imgUrl="",n.isDefault="0",(e=$.value)==null||e.resetFields()},ve=()=>{ge(),L.value="新增属性值",U.value=!0},Ve=l=>{Object.assign(n,{...l}),L.value="编辑属性值",U.value=!0},_e=async l=>{try{await M.confirm(`确定要删除属性值 "${l.valueName}" 吗？`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await De(l.id),h.value=h.value.filter(e=>e.id!==l.id),d.success("属性值删除成功")}catch(e){e!=="cancel"&&(d.error("删除失败"),console.error("删除属性值失败:",e))}},ye=l=>{ae.value=l},we=async l=>{try{d.success("属性值状态更新成功")}catch(e){l.status=l.status==="enabled"?"disabled":"enabled",d.error("状态更新失败"),console.error("更新属性值状态失败:",e)}},he=()=>{d.info("图片上传功能开发中，当前使用模拟URL"),n.imgUrl=`https://example.com/image-${Date.now()}.jpg`},Ce=async()=>{try{await $.value.validate();const l={...n,bomStructureId:g.bomStructureId,attributeValue:n.valueCode||null};if(n.id)try{await qe(l);const e=h.value.findIndex(i=>i.id===n.id);e!==-1&&(h.value[e]={...n}),d.success("属性值更新成功")}catch(e){console.error("更新属性值失败:",e),d.error("更新属性值失败")}else try{const e=await Re(l),i={...n,id:e.id||Date.now()};h.value.push(i),d.success("属性值新增成功")}catch(e){console.error("新增属性值失败:",e),d.error("新增属性值失败")}U.value=!1}catch(l){l!==!1&&(d.error("操作失败，请检查表单数据"),console.error("提交属性值表单失败:",l))}};return(l,e)=>{const i=c("el-button"),m=c("el-table-column"),z=c("el-tag"),P=c("el-table"),V=c("el-input"),p=c("el-form-item"),C=c("el-option"),T=c("el-select"),Se=c("el-radio"),xe=c("el-radio-group"),G=c("el-input-number"),J=c("el-form"),H=c("el-dialog"),Ue=c("el-switch"),Ie=c("el-image"),ke=c("el-drawer"),K=ze("loading");return v(),I("div",Ee,[f("div",Me,[e[23]||(e[23]=f("h3",null,"属性信息管理",-1)),f("div",je,[t(i,{type:"primary",icon:"Plus",onClick:ie},{default:a(()=>e[21]||(e[21]=[s("新增属性")])),_:1,__:[21]}),t(i,{type:"danger",icon:"Delete",onClick:me,disabled:x.value.length===0},{default:a(()=>e[22]||(e[22]=[s("批量删除")])),_:1,__:[22]},8,["disabled"])])]),Q((v(),S(P,{data:w.value,stripe:"",style:{width:"100%"}},{default:a(()=>[t(m,{type:"selection",width:"55",align:"center",onSelectionChange:ne}),t(m,{label:"属性编码",align:"center",prop:"attributeCode","min-width":"150"}),t(m,{label:"属性名称",align:"center",prop:"attributeName","min-width":"150"}),t(m,{label:"组件类型",align:"center",prop:"componentType",width:"120"},{default:a(o=>[t(z,{type:ue(o.row.componentType)},{default:a(()=>[s(_(oe(o.row.componentType)),1)]),_:2},1032,["type"])]),_:1}),t(m,{label:"是否必填",align:"center",prop:"isRequired",width:"100"},{default:a(o=>[t(z,{type:o.row.isRequired==="1"?"success":"info"},{default:a(()=>[s(_(o.row.isRequired==="1"?"是":"否"),1)]),_:2},1032,["type"])]),_:1}),t(m,{label:"默认值",align:"center",prop:"defaultValue","min-width":"150","show-overflow-tooltip":""}),t(m,{label:"排序",align:"center",prop:"sortOrder",width:"80"}),t(m,{label:"操作",align:"center",width:"200",fixed:"right"},{default:a(o=>[t(i,{size:"small",type:"primary",icon:"Edit",onClick:u=>de(o.row)},{default:a(()=>e[24]||(e[24]=[s(" 编辑 ")])),_:2,__:[24]},1032,["onClick"]),t(i,{size:"small",type:"info",icon:"Setting",onClick:u=>be(o.row)},{default:a(()=>e[25]||(e[25]=[s(" 属性值 ")])),_:2,__:[25]},1032,["onClick"]),t(i,{size:"small",type:"danger",icon:"Delete",onClick:u=>se(o.row)},{default:a(()=>e[26]||(e[26]=[s(" 删除 ")])),_:2,__:[26]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[K,k.value]]),t(H,{title:R.value,modelValue:y.value,"onUpdate:modelValue":e[11]||(e[11]=o=>y.value=o),width:"600px","append-to-body":""},{footer:a(()=>[f("span",He,[t(i,{onClick:e[10]||(e[10]=o=>y.value=!1)},{default:a(()=>e[28]||(e[28]=[s("取消")])),_:1,__:[28]}),t(i,{type:"primary",onClick:pe},{default:a(()=>e[29]||(e[29]=[s("确定")])),_:1,__:[29]})])]),default:a(()=>[t(J,{ref_key:"attributeFormRef",ref:B,model:r,rules:re,"label-width":"120px"},{default:a(()=>[f("div",Pe,[e[27]||(e[27]=s(" 当前节点：")),f("span",Ge,_(g.nodeName||"未选择节点"),1),f("span",Je,"节点ID："+_(g.bomStructureId||"未选择节点"),1)]),t(p,{label:"属性编码",prop:"attributeCode"},{default:a(()=>[t(V,{modelValue:r.attributeCode,"onUpdate:modelValue":e[0]||(e[0]=o=>r.attributeCode=o),placeholder:"自动生成",disabled:""},null,8,["modelValue"])]),_:1}),t(p,{label:"属性名称",prop:"attributeName"},{default:a(()=>[t(V,{modelValue:r.attributeName,"onUpdate:modelValue":e[1]||(e[1]=o=>r.attributeName=o),placeholder:"请输入属性名称"},null,8,["modelValue"])]),_:1}),t(p,{label:"组件类型",prop:"componentType"},{default:a(()=>[t(T,{modelValue:r.componentType,"onUpdate:modelValue":e[2]||(e[2]=o=>r.componentType=o),placeholder:"请选择组件类型"},{default:a(()=>[(v(!0),I(W,null,X(Y(j),o=>(v(),S(C,{key:o.value,label:o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),r.componentType==="slider"||r.componentType==="number"?(v(),S(p,{key:0,label:"最小值",prop:"minValue"},{default:a(()=>[t(V,{modelValue:r.minValue,"onUpdate:modelValue":e[3]||(e[3]=o=>r.minValue=o),placeholder:"请输入最小值"},null,8,["modelValue"])]),_:1})):E("",!0),r.componentType==="slider"||r.componentType==="number"?(v(),S(p,{key:1,label:"最大值",prop:"maxValue"},{default:a(()=>[t(V,{modelValue:r.maxValue,"onUpdate:modelValue":e[4]||(e[4]=o=>r.maxValue=o),placeholder:"请输入最大值"},null,8,["modelValue"])]),_:1})):E("",!0),r.componentType==="slider"?(v(),S(p,{key:2,label:"步进值",prop:"stepValue"},{default:a(()=>[t(V,{modelValue:r.stepValue,"onUpdate:modelValue":e[5]||(e[5]=o=>r.stepValue=o),placeholder:"请输入步进值"},null,8,["modelValue"])]),_:1})):E("",!0),t(p,{label:"是否展示提示",prop:"showTooltip"},{default:a(()=>[t(xe,{modelValue:r.showTooltip,"onUpdate:modelValue":e[6]||(e[6]=o=>r.showTooltip=o)},{default:a(()=>[(v(!0),I(W,null,X(Y(te),o=>(v(),S(Se,{key:o.value,label:o.value},{default:a(()=>[s(_(o.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(p,{label:"是否必填",prop:"isRequired"},{default:a(()=>[t(T,{modelValue:r.isRequired,"onUpdate:modelValue":e[7]||(e[7]=o=>r.isRequired=o),placeholder:"请选择"},{default:a(()=>[t(C,{label:"是",value:"1"}),t(C,{label:"否",value:"0"})]),_:1},8,["modelValue"])]),_:1}),t(p,{label:"默认值",prop:"defaultValue"},{default:a(()=>[t(V,{modelValue:r.defaultValue,"onUpdate:modelValue":e[8]||(e[8]=o=>r.defaultValue=o),placeholder:"请输入默认值"},null,8,["modelValue"])]),_:1}),t(p,{label:"排序",prop:"sortOrder"},{default:a(()=>[t(G,{modelValue:r.sortOrder,"onUpdate:modelValue":e[9]||(e[9]=o=>r.sortOrder=o),min:0,step:1,placeholder:"请输入排序号"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"]),t(ke,{modelValue:O.value,"onUpdate:modelValue":e[20]||(e[20]=o=>O.value=o),title:"属性值管理",direction:"rtl",size:"50%","append-to-body":""},{default:a(()=>{var o;return[f("div",Ke,[f("div",Qe,[f("h4",null,_((o=F.value)==null?void 0:o.attributeName)+" - 属性值列表",1),t(i,{type:"primary",icon:"Plus",onClick:ve},{default:a(()=>e[30]||(e[30]=[s("新增属性值")])),_:1,__:[30]})]),Q((v(),S(P,{data:h.value,stripe:"",style:{width:"100%"}},{default:a(()=>[t(m,{type:"selection",width:"55",align:"center",onSelectionChange:ye}),t(m,{label:"属性值编码",align:"center",prop:"valueCode","min-width":"150"}),t(m,{label:"属性值名称",align:"center",prop:"valueName","min-width":"150"}),t(m,{label:"排序",align:"center",prop:"sortOrder",width:"80"}),t(m,{label:"状态",align:"center",prop:"status",width:"100"},{default:a(u=>[t(Ue,{modelValue:u.row.status,"onUpdate:modelValue":D=>u.row.status=D,"active-value":"enabled","inactive-value":"disabled",onChange:D=>we(u.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),t(m,{label:"是否默认",align:"center",prop:"isDefault",width:"100"},{default:a(u=>[t(z,{type:u.row.isDefault==="1"?"success":"info"},{default:a(()=>[s(_(u.row.isDefault==="1"?"是":"否"),1)]),_:2},1032,["type"])]),_:1}),t(m,{label:"图片URL",align:"center",prop:"imgUrl","min-width":"150"},{default:a(u=>[u.row.imgUrl?(v(),I("div",We,[t(Ie,{src:u.row.imgUrl,"preview-src-list":[u.row.imgUrl],style:{width:"30px",height:"30px","margin-right":"8px",cursor:"pointer"},fit:"cover"},null,8,["src","preview-src-list"]),f("span",Xe,_(u.row.imgUrl),1)])):(v(),I("span",Ye,"无"))]),_:1}),t(m,{label:"操作",align:"center",width:"150",fixed:"right"},{default:a(u=>[t(i,{size:"small",type:"primary",icon:"Edit",onClick:D=>Ve(u.row)},{default:a(()=>e[31]||(e[31]=[s(" 编辑 ")])),_:2,__:[31]},1032,["onClick"]),t(i,{size:"small",type:"danger",icon:"Delete",onClick:D=>_e(u.row)},{default:a(()=>e[32]||(e[32]=[s(" 删除 ")])),_:2,__:[32]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[K,A.value]]),t(H,{title:L.value,modelValue:U.value,"onUpdate:modelValue":e[19]||(e[19]=u=>U.value=u),width:"500px","append-to-body":""},{footer:a(()=>[f("span",et,[t(i,{onClick:e[18]||(e[18]=u=>U.value=!1)},{default:a(()=>e[35]||(e[35]=[s("取消")])),_:1,__:[35]}),t(i,{type:"primary",onClick:Ce},{default:a(()=>e[36]||(e[36]=[s("确定")])),_:1,__:[36]})])]),default:a(()=>[t(J,{ref_key:"attributeValueFormRef",ref:$,model:n,rules:le,"label-width":"100px"},{default:a(()=>[t(p,{label:"属性值编码",prop:"valueCode"},{default:a(()=>[t(V,{modelValue:n.valueCode,"onUpdate:modelValue":e[12]||(e[12]=u=>n.valueCode=u),placeholder:"自动生成",disabled:""},null,8,["modelValue"])]),_:1}),t(p,{label:"属性值名称",prop:"valueName"},{default:a(()=>[t(V,{modelValue:n.valueName,"onUpdate:modelValue":e[13]||(e[13]=u=>n.valueName=u),placeholder:"请输入属性值名称"},null,8,["modelValue"])]),_:1}),t(p,{label:"排序",prop:"sortOrder"},{default:a(()=>[t(G,{modelValue:n.sortOrder,"onUpdate:modelValue":e[14]||(e[14]=u=>n.sortOrder=u),min:0,step:1,placeholder:"请输入排序号"},null,8,["modelValue"])]),_:1}),t(p,{label:"状态",prop:"status"},{default:a(()=>[t(T,{modelValue:n.status,"onUpdate:modelValue":e[15]||(e[15]=u=>n.status=u),placeholder:"请选择"},{default:a(()=>[t(C,{label:"启用",value:"enabled"}),t(C,{label:"禁用",value:"disabled"})]),_:1},8,["modelValue"])]),_:1}),t(p,{label:"是否默认",prop:"isDefault"},{default:a(()=>[t(T,{modelValue:n.isDefault,"onUpdate:modelValue":e[16]||(e[16]=u=>n.isDefault=u),placeholder:"请选择"},{default:a(()=>[t(C,{label:"是",value:"1"}),t(C,{label:"否",value:"0"})]),_:1},8,["modelValue"])]),_:1}),t(p,{label:"图片URL",prop:"imgUrl"},{default:a(()=>[t(V,{modelValue:n.imgUrl,"onUpdate:modelValue":e[17]||(e[17]=u=>n.imgUrl=u),placeholder:"请输入图片URL"},null,8,["modelValue"]),f("div",Ze,[t(i,{type:"primary",size:"small",onClick:he},{default:a(()=>e[33]||(e[33]=[s("上传图片")])),_:1,__:[33]}),e[34]||(e[34]=f("span",{style:{"margin-left":"10px",color:"#909399","font-size":"12px"}}," 支持JPG、PNG格式，建议尺寸：100x100px ",-1))])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])])]}),_:1},8,["modelValue"])])}}},rt=Oe(tt,[["__scopeId","data-v-c30966db"]]);export{rt as default};
