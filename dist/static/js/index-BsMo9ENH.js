import{u as pe,r as d,g as x,h as ge,i as fe,a as c,j as be,c as ve,o as A,e as b,k as T,b as l,w as r,f as m,t as z,v as F,l as G,m as _e,E as s,n as ye}from"./index-a6CENfl-.js";import{listProduct as j,deleteProduct as Ue,updateProduct as Pe,autoIntegrateCatalogAttributes as K,addProduct as he,batchUpdateProductAttributeRelation as Ie}from"./product-D8MMQEHj.js";import{g as Ce}from"./brand-D7IqMYJu.js";import{g as Se,a as Le}from"./series-C_GNmXOR.js";import{l as Ve}from"./catalog-KEzIOAdT.js";import qe from"./ProductMainInfo-BdPmo7A_.js";import we from"./ProductPriceInfo-SdJPOwnn.js";import ke from"./ProductMaterialInfo-CF9ikpjN.js";import Ne from"./ProductBomInfo-BjfWT7Of.js";import Re from"./ProductParamsInfo-3-L_fdYX.js";import xe from"./ProductAttributesInfo-xuCVhCVZ.js";import"./attributeGroup-DNxjbwZp.js";import"./attributeGroupAttributeValue-BayMywbM.js";const Te={class:"cpq-container"},De={class:"cpq-action-bar"},Be={class:"cpq-actions"},Ee={class:"cpq-search-card"},Me={class:"cpq-pagination"},Ae={class:"cpq-dialog"},ze={class:"dialog-footer"},tt={__name:"index",setup(Fe){pe();const C=d(!0),S=d(!0),w=d(0),D=d([]),O=d([]),k=d(""),v=d(!1),y=d("main"),B=d([]),N=d([]),L=d([]),U=d([]),P=d([]),h=d(null),Y=t=>{t==="attributes"&&h.value&&h.value.refresh()},e=x({productId:null,productCode:"",productName:"",productDesc:"",productStatus:"1",productVersion:"V1.0",catalogId:"",basePrice:null,priceUnit:"CNY",mainImageUrl:"",imageUrls:"",detailPageUrl:"",model3DUrl:"",manualUrl:"",installationGuideUrl:"",videoUrl:"",brandId:null,seriesId:null,productModel:"",packagingUnit:"",weight:null,dimensions:"",warrantyPeriod:null,specification:"",technicalParams:"",materialType:null,costPrice:null,minSalesPrice:null,maxSalesPrice:null,suggestedRetailPrice:null,priceValidityPeriod:null}),u=x({pageNum:1,pageSize:10,productCode:"",productName:"",productStatus:""}),Q=x({productName:[{required:!0,message:"产品名称不能为空",trigger:"blur"}],productStatus:[{required:!0,message:"产品状态不能为空",trigger:"change"}],catalogId:[{required:!0,message:"所属目录不能为空",trigger:"change"}],productVersion:[{required:!0,message:"产品版本不能为空",trigger:"blur"}],basePrice:[{required:!1,message:"基准价格不能为空",trigger:"blur"},{type:"number",min:0,message:"基准价格必须大于等于0",trigger:"blur"}],priceUnit:[{required:!0,message:"价格单位不能为空",trigger:"change"}],mainImageUrl:[{required:!1,message:"请上传产品主图",trigger:"change"},{type:"url",message:"请输入有效的URL地址",trigger:"blur"}],detailPageUrl:[{type:"url",message:"请输入有效的URL地址",trigger:"blur"}],model3DUrl:[{type:"url",message:"请输入有效的URL地址",trigger:"blur"}],manualUrl:[{type:"url",message:"请输入有效的URL地址",trigger:"blur"}],installationGuideUrl:[{type:"url",message:"请输入有效的URL地址",trigger:"blur"}],videoUrl:[{type:"url",message:"请输入有效的URL地址",trigger:"blur"}],brandId:[{required:!1,message:"请选择所属品牌",trigger:"change"}],seriesId:[{required:!1,message:"请选择所属系列",trigger:"change"}],materialType:[{required:!0,message:"请选择物料类型",trigger:"change"}],productModel:[{required:!0,message:"请输入产品型号",trigger:"blur"}],packagingUnit:[{required:!1,message:"请输入包装单位",trigger:"blur"}],weight:[{required:!1,message:"请输入产品重量",trigger:"blur"},{type:"number",min:0,message:"产品重量必须大于等于0",trigger:"blur"}],dimensions:[{required:!1,message:"请输入产品尺寸",trigger:"blur"}],warrantyPeriod:[{type:"number",min:0,message:"保质期必须大于等于0",trigger:"blur"}]}),I=async()=>{C.value=!0;try{const t=await j(u);D.value=t.rows,w.value=t.total,C.value=!1}catch{C.value=!1,s.error("获取产品列表失败")}},V=()=>{u.pageNum=1,I()},$=()=>{u.productCode="",u.productName="",u.productStatus="",V()},H=()=>{S.value=!S.value},J=()=>{e.productId=null,e.productCode="",e.productName="",e.productDesc="",e.productStatus="1",e.productVersion="V1.0",e.catalogId="",e.basePrice=null,e.priceUnit="CNY",e.mainImageUrl="",e.imageUrls="",e.detailPageUrl="",e.model3DUrl="",e.manualUrl="",e.installationGuideUrl="",e.videoUrl="",e.brandId=null,e.seriesId=null,e.materialType=null,e.productModel="",e.packagingUnit="",e.weight=null,e.dimensions="",e.warrantyPeriod=null,e.specification="",e.technicalParams="",e.costPrice=null,e.minSalesPrice=null,e.maxSalesPrice=null,e.suggestedRetailPrice=null,e.priceValidityPeriod=null,imageList.value=[],mainImageFileList.value=[],imageListFileList.value=[],U.value=[],P.value=[],k.value="新增产品",y.value="main",v.value=!0},W=t=>{e.productId=t.productId,e.productCode=t.productCode,e.productName=t.productName,e.productDesc=t.productDesc||"",e.productStatus=t.productStatus,e.productVersion=t.productVersion||"V1.0",e.catalogId=t.catalogId,e.basePrice=t.basePrice,e.priceUnit=t.priceUnit||"CNY",e.mainImageUrl=t.mainImageUrl||"",e.imageUrls=t.imageUrls||"",e.detailPageUrl=t.detailPageUrl||"",e.model3DUrl=t.model3DUrl||"",e.manualUrl=t.manualUrl||"",e.installationGuideUrl=t.installationGuideUrl||"",e.videoUrl=t.videoUrl||"",e.brandId=t.brandId||null,e.seriesId=t.seriesId||null,e.materialType=t.materialType||null,e.productModel=t.productModel||"",e.packagingUnit=t.packagingUnit||"",e.weight=t.weight||null,e.dimensions=t.dimensions||"",e.warrantyPeriod=t.warrantyPeriod||null,e.specification=t.specification||"",e.technicalParams=t.technicalParams||"",e.costPrice=t.costPrice||null,e.minSalesPrice=t.minSalesPrice||null,e.maxSalesPrice=t.maxSalesPrice||null,e.suggestedRetailPrice=t.suggestedRetailPrice||null,e.priceValidityPeriod=t.priceValidityPeriod||null,U.value=t.bomList||[],P.value=t.paramList||[],k.value="修改产品",v.value=!0},X=async t=>{await ye.confirm("确定要删除该产品吗？","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});try{await Ue(t.productId),s.success("删除成功"),I()}catch{s.error("删除失败")}},Z=()=>{j(u).then(t=>{const a=new Blob([t],{type:"application/vnd.ms-excel"}),o=document.createElement("a");o.href=URL.createObjectURL(a),o.download="产品列表.xlsx",document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(o.href),s.success("导出成功")}).catch(t=>{s.error("导出失败")})},ee=async()=>{const t=q.value;if(!t){console.error("表单ref不存在");return}try{await t.validate();let a;e.productId?(a=await Pe(e),s.success("修改成功"),e.catalogId&&(await K(e.productId),y.value==="attributes"&&await E())):(a=await he(e),a.data&&(e.productId=a.data),s.success("新增成功"),e.catalogId&&e.productId&&(await K(e.productId),y.value==="attributes"&&productAttributes.value.length>0&&await E())),v.value=!1,I()}catch(a){console.error("操作失败:",a),a===!1?s.error("表单验证失败，请检查填写内容"):s.error("操作失败："+(a.message||"未知错误"))}},te=()=>{v.value=!1,q.value&&q.value.resetFields(),U.value=[],P.value=[]},ae=async()=>{try{const t=await Ce();B.value=t.data}catch{s.error("获取品牌列表失败")}},le=async(t=null)=>{try{let a;t?a=await Se(t):a=await Le(),N.value=a.data||[]}catch{s.error("获取系列列表失败"),N.value=[]}},re=t=>{const a=[],o={};t.forEach(n=>{o[n.catalogId]={...n,children:[]}}),t.forEach(n=>{const g=n.parentId||0;g===0?a.push(o[n.catalogId]):o[g]&&o[g].children.push(o[n.catalogId])});const p=n=>{n.children&&n.children.length>0&&(n.children.sort((g,R)=>(g.catalogSort||0)-(R.catalogSort||0)),n.children.forEach(g=>p(g)))};return a.forEach(n=>p(n)),a},oe=async()=>{try{const t=await Ve();t&&t.code===200&&t.rows?L.value=re(t.rows):L.value=[]}catch(t){console.error("获取目录树失败:",t),L.value=[],s.error("获取目录树失败: "+(t.message||"未知错误"))}},E=async()=>{if(!e.productId){s.warning("请先保存产品基本信息");return}if(!h.value){s.warning("产品属性组件未加载完成");return}const t=h.value.getProductAttributes();if(t.length===0){s.warning("没有需要保存的产品属性");return}try{const a=t.map(p=>({relationId:p.relationId,productId:e.productId,attributeId:p.attribute.attributeId,catalogRelationId:p.relationId,attributeValue:p.attributeValue})),o=await Ie(a);o.code===200?s.success("产品属性保存成功"):s.error("产品属性保存失败："+o.msg)}catch(a){console.error("保存产品属性失败:",a),s.error("产品属性保存失败："+(a.message||"未知错误"))}},q=d(null);return ge(()=>e.brandId,(t,a)=>{t!==a&&(e.seriesId=null,le(t))}),fe(async()=>{await Promise.all([ae(),oe()]),I()}),(t,a)=>{const o=c("el-button"),p=c("el-input"),n=c("el-form-item"),g=c("el-option"),R=c("el-select"),M=c("el-form"),f=c("el-table-column"),ie=c("el-tag"),ne=c("el-table"),se=c("pagination"),_=c("el-tab-pane"),ue=c("el-tabs"),de=c("el-dialog"),ce=be("loading");return A(),ve("div",Te,[a[19]||(a[19]=b("div",{class:"cpq-page-title"}," 产品管理 ",-1)),b("div",De,[b("div",Be,[l(o,{type:"primary",icon:"Plus",onClick:J},{default:r(()=>a[10]||(a[10]=[m(" 新增产品 ")])),_:1,__:[10]}),l(o,{type:"danger",icon:"Delete",disabled:O.value},{default:r(()=>a[11]||(a[11]=[m(" 批量删除 ")])),_:1,__:[11]},8,["disabled"]),l(o,{type:"warning",icon:"Download",onClick:Z},{default:r(()=>a[12]||(a[12]=[m(" 导出 ")])),_:1,__:[12]})]),l(o,{type:"info",icon:"Search",onClick:H},{default:r(()=>[m(z(S.value?"收起":"展开")+"搜索 ",1)]),_:1})]),T(b("div",Ee,[l(M,{model:u,ref:"queryForm",inline:!0,"label-width":"80px"},{default:r(()=>[l(n,{label:"产品编码",prop:"productCode"},{default:r(()=>[l(p,{modelValue:u.productCode,"onUpdate:modelValue":a[0]||(a[0]=i=>u.productCode=i),placeholder:"请输入产品编码",clearable:"",onKeyup:G(V,["enter"])},null,8,["modelValue"])]),_:1}),l(n,{label:"产品名称",prop:"productName"},{default:r(()=>[l(p,{modelValue:u.productName,"onUpdate:modelValue":a[1]||(a[1]=i=>u.productName=i),placeholder:"请输入产品名称",clearable:"",onKeyup:G(V,["enter"])},null,8,["modelValue"])]),_:1}),l(n,{label:"产品状态",prop:"productStatus"},{default:r(()=>[l(R,{modelValue:u.productStatus,"onUpdate:modelValue":a[2]||(a[2]=i=>u.productStatus=i),placeholder:"请选择产品状态",clearable:""},{default:r(()=>[l(g,{label:"启用",value:"1"}),l(g,{label:"禁用",value:"0"})]),_:1},8,["modelValue"])]),_:1}),l(n,null,{default:r(()=>[l(o,{type:"primary",icon:"Search",onClick:V},{default:r(()=>a[13]||(a[13]=[m("搜索")])),_:1,__:[13]}),l(o,{icon:"RefreshRight",onClick:$},{default:r(()=>a[14]||(a[14]=[m("重置")])),_:1,__:[14]})]),_:1})]),_:1},8,["model"])],512),[[F,S.value]]),T((A(),_e(ne,{data:D.value,onSelectionChange:t.handleSelectionChange,border:""},{default:r(()=>[l(f,{type:"selection",width:"55",align:"center"}),l(f,{label:"产品编码",align:"center",prop:"productCode","min-width":"120"}),l(f,{label:"产品名称",align:"left",prop:"productName","show-overflow-tooltip":!0,"min-width":"200"}),l(f,{label:"产品状态",align:"center",prop:"productStatus"},{default:r(i=>[l(ie,{class:"cpq-status-tag",type:i.row.productStatus==="1"?"success":"danger",size:"small"},{default:r(()=>[m(z(i.row.productStatus==="1"?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),l(f,{label:"产品版本",align:"center",prop:"productVersion","min-width":"100"}),l(f,{label:"创建时间",align:"center",prop:"createTime",width:"180"}),l(f,{label:"操作",align:"center",width:"220",fixed:"right"},{default:r(i=>[l(o,{size:"small",type:"primary",icon:"Edit",onClick:me=>W(i.row)},{default:r(()=>a[15]||(a[15]=[m(" 修改 ")])),_:2,__:[15]},1032,["onClick"]),l(o,{size:"small",type:"danger",icon:"Delete",onClick:me=>X(i.row)},{default:r(()=>a[16]||(a[16]=[m(" 删除 ")])),_:2,__:[16]},1032,["onClick"])]),_:1})]),_:1},8,["data","onSelectionChange"])),[[ce,C.value]]),b("div",Me,[T(l(se,{total:w.value,page:u.pageNum,limit:u.pageSize,onPagination:I},null,8,["total","page","limit"]),[[F,w.value>0]])]),b("div",Ae,[l(de,{title:k.value,modelValue:v.value,"onUpdate:modelValue":a[9]||(a[9]=i=>v.value=i),width:"900px","append-to-body":""},{footer:r(()=>[b("span",ze,[l(o,{onClick:te},{default:r(()=>a[17]||(a[17]=[m("取消")])),_:1,__:[17]}),l(o,{type:"primary",onClick:ee},{default:r(()=>a[18]||(a[18]=[m("确定")])),_:1,__:[18]})])]),default:r(()=>[l(M,{ref_key:"formRef",ref:q,model:e,rules:Q,"label-width":"100px",class:"cpq-form"},{default:r(()=>[l(ue,{modelValue:y.value,"onUpdate:modelValue":a[8]||(a[8]=i=>y.value=i),class:"cpq-tabs",onTabChange:Y},{default:r(()=>[l(_,{label:"主要信息",name:"main"},{default:r(()=>[l(qe,{form:e,"onUpdate:form":a[3]||(a[3]=i=>e=i),brandList:B.value,seriesList:N.value,catalogTree:L.value},null,8,["form","brandList","seriesList","catalogTree"])]),_:1}),l(_,{label:"价格信息",name:"price"},{default:r(()=>[l(we,{form:e,"onUpdate:form":a[4]||(a[4]=i=>e=i)},null,8,["form"])]),_:1}),l(_,{label:"资料信息",name:"material"},{default:r(()=>[l(ke,{form:e,"onUpdate:form":a[5]||(a[5]=i=>e=i)},null,8,["form"])]),_:1}),l(_,{label:"BOM组成",name:"bom"},{default:r(()=>[l(Ne,{bomList:U.value,"onUpdate:bomList":a[6]||(a[6]=i=>U.value=i)},null,8,["bomList"])]),_:1}),l(_,{label:"特性参数",name:"params"},{default:r(()=>[l(Re,{paramList:P.value,"onUpdate:paramList":a[7]||(a[7]=i=>P.value=i)},null,8,["paramList"])]),_:1}),l(_,{label:"产品属性",name:"attributes"},{default:r(()=>[l(xe,{ref_key:"attributesRef",ref:h,form:e},null,8,["form"])]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])])])}}};export{tt as default};
