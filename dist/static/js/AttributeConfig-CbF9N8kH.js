import{_ as ke,r as A,g as F,h as $e,ad as le,H as xe,a as h,c as f,o as n,b,w as c,l as X,A as je,ae as Oe,k as D,F as N,n as S,e as p,t as g,m as v,a4 as me,af as M,f as y,a7 as be,a3 as ze,x as ae,E as Z}from"./index-DgigFOm-.js";import{u as De}from"./configurator-DfpJCp-f.js";import{c as Me}from"./bom-CjuVRwkz.js";import{g as Te}from"./superBomProductRelation-c5nmns4w.js";import{g as Ue}from"./superBomDynamicAttribute-6n4Uab6m.js";const Qe={class:"attribute-config"},Ee={key:0,class:"empty-state"},Ye={key:1,class:"loading-state"},Re={key:2,class:"config-content"},qe={class:"section-header"},Be={key:0,class:"section-desc"},Le={key:2,class:"attr-error"},He={key:0,class:"form-section unified-attribute-section"},Fe={key:2,class:"attr-error"},Ge={key:1,class:"form-section product-selection"},Je={key:0,class:"product-card-container"},We=["onClick"],Xe={class:"card-header"},Ze={class:"product-title"},Ke={class:"product-meta"},et={class:"brand-tag"},tt={class:"series-tag"},lt={class:"card-body"},at={class:"product-info"},ot={class:"info-item"},ut={class:"info-value"},rt={class:"info-item"},st={class:"info-value"},nt={class:"card-footer"},dt={class:"selection-control"},ct={key:1,class:"product-table-container"},it={__name:"AttributeConfig",props:{currentNode:{type:Object,default:null},bomId:{type:[String,Number],required:!0}},emits:["config-confirm"],setup(fe,{emit:mt}){const i=fe,Q=De(),ge=A(),u=A({selectedProductId:null,selectedProductIds:[],productQuantities:{},attrs:{},dynamicAttrs:{}}),G=A({}),T=A({}),U=A([]),I=A([]),E=A([]);A(!1);const q=A(""),B=A(""),P=A({productModel:"",brand:"",series:""}),L=F(()=>{let t=[...I.value];if(P.value.productModel){const r=P.value.productModel.toLowerCase();t=t.filter(o=>{var s,m,_;return((m=(s=o.productInfo)==null?void 0:s.productModel)==null?void 0:m.toLowerCase().includes(r))||((_=o.relationObjectName)==null?void 0:_.toLowerCase().includes(r))})}P.value.brand&&(t=t.filter(r=>{var o;return((o=r.brandInfo)==null?void 0:o.brandName)===P.value.brand})),P.value.series&&(t=t.filter(r=>{var o;return((o=r.seriesInfo)==null?void 0:o.seriesName)===P.value.series}));const e=u.value.dynamicAttrs;return e&&typeof e=="object"&&Object.entries(e).forEach(([r,o])=>{o!=null&&o!==""&&(console.log(`应用动态参数筛选: ${r} = ${o}`),console.log(`筛选前产品数量: ${t.length}`),t=t.filter(s=>{if(!s.productInfo)return console.log(`产品${s.relationObjectId}没有productInfo`),!1;if(Array.isArray(s.productInfo.attributes)){const m=String(r),_=s.productInfo.attributes.find(x=>String(x.attributeId)===m);if(!_)return console.log(`产品${s.relationObjectId}没有找到属性${m}`),!1;const z=_.attributeValue;console.log(`产品${s.relationObjectId}的属性${m}值:`,z);const V=String(z).trim(),k=String(o).trim();console.log(`比较属性值: 产品值="${V}", 选中值="${k}"`);let $=!1;return Array.isArray(o)?$=o.some(x=>{const H=String(x).trim();return V===H}):$=V===k,console.log(`产品${s.relationObjectId}是否匹配:`,$,`产品值: "${V}", 选中值: "${k}"`),$}else return console.log(`产品${s.relationObjectId}的productInfo结构不支持:`,s.productInfo),!1}),console.log(`筛选后产品数量: ${t.length}`))}),t}),ve=F(()=>{const t=new Set;return I.value.forEach(e=>{var r;(r=e.brandInfo)!=null&&r.brandName&&t.add(e.brandInfo.brandName)}),Array.from(t).sort()}),pe=F(()=>{const t=new Set;return I.value.forEach(e=>{var r;(r=e.seriesInfo)!=null&&r.seriesName&&t.add(e.seriesInfo.seriesName)}),Array.from(t).sort()}),w=A({currentPage:1,pageSize:10});F(()=>{const t=(w.value.currentPage-1)*w.value.pageSize,e=t+w.value.pageSize;return I.value.slice(t,e)});const oe=F(()=>{const t=(w.value.currentPage-1)*w.value.pageSize,e=t+w.value.pageSize;return L.value.slice(t,e)}),K=()=>{w.value.currentPage=1},ee=async t=>{if(i.currentNode.selectionType==="multiple"){const e=u.value.selectedProductIds.indexOf(t.relationObjectId);e>-1?u.value.selectedProductIds.splice(e,1):u.value.selectedProductIds.push(t.relationObjectId)}else u.value.selectedProductId=t.relationObjectId,u.value.selectedProductIds=[t.relationObjectId];await te(t.relationObjectId)},Ie=(t,e)=>{i.currentNode.selectionType==="single"&&e.length>1&&(e=[e[0]],u.value.selectedProductId=e[0]),u.value.selectedProductIds=e},ue=()=>{i.currentNode.selectionType==="multiple"?u.value.selectedProductIds=[]:u.value.selectedProductId=null},Y=t=>{const e={input:"el-input","input-number":"el-input-number",select:"el-select",radio:"el-radio-group",checkbox:"el-checkbox-group","date-picker":"el-date-picker",slider:"el-slider",switch:"el-switch","color-picker":"el-color-picker"},r=t.componentType;return e[r]||"el-input"},re=()=>{const t=new Map;return console.log("过滤后的产品数量:",L.value.length),L.value.forEach((e,r)=>{console.log(`产品${r+1}:`,{productId:e.relationObjectId,productName:e.relationObjectName,hasProductInfo:!!e.productInfo,productInfo:e.productInfo}),e.productInfo&&typeof e.productInfo=="object"?Array.isArray(e.productInfo.attributes)?(console.log(`产品${r+1}的attributes数组长度:`,e.productInfo.attributes.length),e.productInfo.attributes.forEach((o,s)=>{if(console.log(`产品${r+1}的属性${s+1}:`,o),o.attributeId&&o.attributeValue&&o.attributeValue!==null&&o.attributeValue!==void 0&&o.attributeValue!==""&&(typeof o.attributeValue=="string"||typeof o.attributeValue=="number")){const m=String(o.attributeId),_=String(o.attributeValue);t.has(m)||t.set(m,new Set),t.get(m).add(_),console.log(`收集到属性值: ${o.attributeValue} (属性ID: ${o.attributeId})`)}})):console.log(`产品${r+1}的productInfo没有attributes数组，忽略`):console.log(`产品${r+1}没有productInfo或不是对象`)}),console.log("最终收集到的属性值集合:",Object.fromEntries(t)),t},R=(t,e)=>{if(!e)return console.log(`属性${t.attributeName}没有attributeValues，返回空数组`),[];let r=[];if(typeof e=="string"){console.log(`属性${t.attributeName}的attributeValues是字符串:`,e);try{const o=JSON.parse(e);Array.isArray(o)?(console.log(`属性${t.attributeName}的attributeValues解析为数组:`,o),r=o.map(s=>typeof s=="object"&&s!==null?s:{valueCode:s,valueName:s})):(console.log(`属性${t.attributeName}的attributeValues解析后不是数组，尝试直接使用该值作为单一项`),r=[{valueCode:e,valueName:e}])}catch(o){console.log(`属性${t.attributeName}的attributeValues JSON解析失败，尝试以逗号分隔解析:`,o);try{const s=e.split(",").map(m=>m.trim()).filter(Boolean);console.log(`属性${t.attributeName}的attributeValues以逗号分隔解析为数组:`,s),r=s.map(m=>({valueCode:m,valueName:m}))}catch(s){console.log(`属性${t.attributeName}的attributeValues以逗号分隔解析也失败，尝试直接使用该值作为单一项:`,s),r=[{valueCode:e,valueName:e}]}}}else Array.isArray(e)?(console.log(`属性${t.attributeName}的attributeValues是数组:`,e),r=e.map(o=>typeof o=="object"&&o!==null?o:{valueCode:o,valueName:o})):(console.log(`属性${t.attributeName}的attributeValues是其他类型:`,typeof e),r=[{valueCode:String(e),valueName:String(e)}]);if(console.log("动态属性基本信息:",{attributeName:t.attributeName,attributeCode:t.attributeCode,attributeId:t.attributeId,parsedValuesLength:r.length}),["select","multi","radio","checkbox"].includes(t.componentType)){const o=re();console.log("可用属性值集合:",Object.fromEntries(o));const s=r.filter(m=>{const _=String(m.valueName||m.label||m.valueCode||m.code||m.value||m);console.log(`检查属性值${_}是否在可用值集合中`);const z=String(t.attributeId),V=o.get(z);if(!V)return console.log(`属性${z}没有可用值集合，跳过过滤`),!0;const k=V.has(_);return console.log(`属性值${_}是否可用:`,k),k});return console.log("属性值过滤前后数量:",{before:r.length,after:s.length}),console.log("过滤前的值:",r.map(m=>m.valueCode||m.code||m.value)),console.log("过滤后的值:",s.map(m=>m.valueCode||m.code||m.value)),s}else return console.log(`属性${t.attributeName}是非选择类型，跳过过滤`),r},O=t=>{const e={placeholder:t.attributePlaceholder||`请输入${t.attributeName}`,disabled:t.isReadonly==="0",clearable:!0};switch(t.componentType){case"input-number":return{...e,min:t.minValue?Number(t.minValue):void 0,max:t.maxValue?Number(t.maxValue):void 0,step:t.step?Number(t.step):1,controls:!0};case"radio":return{...e};case"checkbox":return{...e};case"select":return{...e,filterable:!0};case"multi":return{...e,multiple:!0,filterable:!0,"collapse-tags":!0};case"date-picker":return{...e,type:"date",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"};case"datetime-picker":return{...e,type:"datetime",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss"};case"slider":return{...e,min:t.minValue?Number(t.minValue):0,max:t.maxValue?Number(t.maxValue):100,step:t.step?Number(t.step):1,"show-input":!0};case"switch":return{...e};case"color-picker":return{...e};case"textarea":return{...e,type:"textarea",rows:4,maxlength:t.maxLength?Number(t.maxLength):void 0,"show-word-limit":!0};default:return e}},ye=async()=>{var t;if(!(!i.currentNode||!i.bomId)){console.log("loadStaticAttributes: 开始加载节点静态属性"),console.log("loadStaticAttributes: bomId:",i.bomId),console.log("loadStaticAttributes: bomStructureId:",i.currentNode.bomStructureId);try{const e=await Me(i.bomId,i.currentNode.bomStructureId);console.log("loadStaticAttributes: API返回:",e);const r=((t=e.data)==null?void 0:t.rows)||e.rows||[];console.log("loadStaticAttributes: 静态属性数量:",r.length);const o=new Map;r.forEach(s=>{const m=s.attributeGroupId||0,_=s.attributeGroupName||"基本属性";o.has(m)||o.set(m,{groupId:m,groupName:_,groupDesc:s.attributeGroupDesc||"",attributes:[]}),o.get(m).attributes.push(s),u.value.attrs[s.attributeCode]=s.defaultValue||null,s.isRequired==="1"&&(G.value[`attrs.${s.attributeCode}`]=[{required:!0,message:`${s.attributeName}不能为空`,trigger:"blur"}])}),U.value=Array.from(o.values()),console.log("loadStaticAttributes: 属性组数量:",U.value.length)}catch(e){console.error("加载静态属性配置失败:",e),Z.error("加载静态属性配置失败: "+(e.message||e)),U.value=[]}}},_e=async()=>{var t;if(i.currentNode){console.log("loadDynamicAttributes: 开始加载节点动态属性"),console.log("loadDynamicAttributes: bomStructureId:",i.currentNode.bomStructureId);try{const e=await Ue(i.currentNode.bomStructureId);console.log("loadDynamicAttributes: API返回:",e);const r=((t=e.data)==null?void 0:t.rows)||e.rows||e.data||[];console.log("loadDynamicAttributes: 动态属性数量:",r.length),E.value=r,r.forEach((o,s)=>{console.log(`动态属性${s+1}:`,{attributeName:o.attributeName,attributeCode:o.attributeCode,attributeId:o.attributeId,componentType:o.componentType,attributeValues:o.attributeValues,parsedValues:typeof o.attributeValues=="string"?JSON.parse(o.attributeValues):o.attributeValues})}),r.forEach(o=>{u.value.dynamicAttrs[o.attributeId]=o.defaultValue||null,o.isRequired==="1"&&(G.value[`dynamicAttrs.${o.attributeId}`]=[{required:!0,message:`${o.attributeName}不能为空`,trigger:"blur"}])})}catch(e){console.error("加载动态属性配置失败:",e),Z.error("加载动态属性配置失败: "+(e.message||e)),E.value=[]}}},he=async()=>{await Promise.all([ye(),_e()])},se=()=>{if(!i.currentNode||!I.value.length)return;console.log("initializeSelectedState: 开始初始化选中状态"),console.log("initializeSelectedState: 节点配置:",i.currentNode.configuration);const t=i.currentNode.configuration||{},e=t.selectedProductId,r=t.selectedProductIds||[],o=t.productQuantities||{};console.log("initializeSelectedState: 配置中的选中信息:",{selectedId:e,selectedIds:r,savedQuantities:o}),i.currentNode.selectionType==="multiple"?(u.value.selectedProductIds=r,Array.isArray(u.value.selectedProductIds)||(u.value.selectedProductIds=[]),console.log("initializeSelectedState: 多选模式，设置selectedProductIds:",u.value.selectedProductIds)):(u.value.selectedProductId=e,u.value.selectedProductIds=e?[e]:[],console.log("initializeSelectedState: 单选模式，设置selectedProductId:",u.value.selectedProductId)),I.value.forEach(s=>{const m=s.relationObjectId;u.value.productQuantities[m]=o[m]!==void 0?o[m]:i.currentNode.defaultQuantity||1}),console.log("initializeSelectedState: 初始化完成",{selectedProductId:u.value.selectedProductId,selectedProductIds:u.value.selectedProductIds,productQuantities:u.value.productQuantities}),ne()},Ne=async()=>{var t;if(!(!i.currentNode||!i.bomId)){console.log("loadRelatedProducts: 开始加载关联产品"),console.log("loadRelatedProducts: bomId:",i.bomId),console.log("loadRelatedProducts: structureId:",i.currentNode.bomStructureId);try{const e=await Te({bomId:i.bomId,structureId:i.currentNode.bomStructureId});console.log("loadRelatedProducts: API返回:",e);const r=((t=e.data)==null?void 0:t.rows)||e.data||[];console.log("loadRelatedProducts: 关联产品数量:",r.length),r.length>0&&(console.log("第一个产品的完整结构:",r[0]),console.log("第一个产品的productInfo:",r[0].productInfo)),r.forEach(o=>{u.value.productQuantities[o.relationObjectId]=i.currentNode.defaultQuantity||1}),I.value=r,await le(),se()}catch(e){console.error("加载关联产品失败:",e),Z.error("加载关联产品失败: "+(e.message||e)),I.value=[]}}},J=async t=>{delete T.value[t.attributeCode],await Q.validateAttribute(i.currentNode.bomStructureId,t.attributeCode,u.value.attrs[t.attributeCode])},W=async t=>{delete T.value[t.attributeId];const e=u.value.dynamicAttrs[t.attributeId];if(e!=null){const r=re();if(r.has(t.attributeId)&&["select","multi","radio","checkbox"].includes(t.componentType)){const o=r.get(t.attributeId);if(o&&o.size>0){const s=String(e),m=o.has(s);console.log(`
=== 动态属性值验证结果 ===`),m?console.log(`✓ 验证通过：属性ID ${t.attributeId} 的值 "${s}" 是有效的`):(console.log(`✗ 验证失败：属性ID ${t.attributeId} 的值 "${s}" 无效`),console.log(`  有效取值范围：[${Array.from(o).join(", ")}]`)),console.log(`=== 验证完成 ===
`)}}}await Q.validateAttribute(i.currentNode.bomStructureId,t.attributeId,u.value.dynamicAttrs[t.attributeId])},Ce=async(t,e)=>{u.value.productQuantities[t]=e,(i.currentNode.selectionType==="single"?u.value.selectedProductId===t:u.value.selectedProductIds.includes(t))&&await Q.updateProductQuantity(i.currentNode.bomStructureId,t,e)},Pe=()=>{const t=i.currentNode.selectionType==="multiple"?u.value.selectedProductIds:u.value.selectedProductId?[u.value.selectedProductId]:[],e={};return t.forEach(r=>{var s;const o=I.value.find(m=>m.relationObjectId===r);o&&(e[r]={name:o.relationObjectName,model:((s=o.productInfo)==null?void 0:s.productModel)||""})}),e},te=async t=>{u.value.productQuantities[t]||(u.value.productQuantities[t]=i.currentNode.defaultQuantity||1),i.currentNode.selectionType==="multiple"?await Q.selectNodeProducts(i.currentNode.bomStructureId,[...u.value.selectedProductIds]):await Q.selectNodeProduct(i.currentNode.bomStructureId,t),await Q.saveNodeConfiguration(i.currentNode.bomStructureId,{quantity:u.value.productQuantities[t],productQuantities:u.value.productQuantities,...i.currentNode.selectionType==="multiple"?{selectedProductIds:u.value.selectedProductIds}:{selectedProductId:u.value.selectedProductId},productDetails:Pe(),...u.value.attrs,...u.value.dynamicAttrs}),ne()},ne=(t=!1)=>{i.currentNode.isRequired==="1"?(i.currentNode.selectionType==="multiple"?u.value.selectedProductIds.length>0:!!u.value.selectedProductId)?(q.value="success",B.value=""):t?(q.value="error",B.value="请选择产品"):(q.value="",B.value=""):(q.value="",B.value="")};return $e(async()=>{i.currentNode&&(console.log("AttributeConfig: 组件挂载，初始化选中状态"),await le(),i.currentNode.selectionType==="multiple"?u.value.selectedProductIds&&!Array.isArray(u.value.selectedProductIds)&&(u.value.selectedProductIds=[]):u.value.selectedProductIds&&u.value.selectedProductIds.length>0&&(u.value.selectedProductId=u.value.selectedProductIds[0]))}),xe(()=>{var t;return(t=i.currentNode)==null?void 0:t.bomStructureId},async(t,e)=>{if(console.log("AttributeConfig: bomStructureId变化:",t,e),t&&t!==e){const r=i.currentNode;if(r){u.value={selectedProductId:null,selectedProductIds:[],productQuantities:{},attrs:{},dynamicAttrs:{}},G.value={},T.value={},U.value=[],I.value=[],E.value=[],console.log("AttributeConfig: 开始加载节点数据");try{await Promise.all([he(),Ne()]),console.log("AttributeConfig: 节点数据加载完成"),r.configuration&&(Object.assign(u.value,r.configuration),await le(),se()),console.log("AttributeConfig: 表单数据:",u.value),console.log("AttributeConfig: 属性组:",U.value),console.log("AttributeConfig: 关联产品:",I.value),console.log("AttributeConfig: 动态属性:",E.value)}catch(o){console.error("AttributeConfig: 加载节点数据失败:",o),Z.error("加载节点数据失败")}}}},{immediate:!0}),(t,e)=>{const r=h("el-icon"),o=h("el-empty"),s=h("el-radio"),m=h("el-radio-group"),_=h("el-checkbox"),z=h("el-checkbox-group"),V=h("el-option"),k=h("el-select"),$=h("el-form-item"),x=h("el-col"),H=h("el-row"),Ve=h("el-input"),Ae=h("el-input-number"),C=h("el-table-column"),de=h("el-table"),Se=h("el-pagination"),we=h("el-form");return n(),f("div",Qe,[i.currentNode?U.value.length===0&&I.value.length===0?(n(),f("div",Ye,[b(o,{description:"加载中..."},{image:c(()=>[b(r,{class:"loading-icon",size:48,color:"#409eff"},{default:c(()=>[b(X(Oe))]),_:1})]),_:1})])):(n(),f("div",Re,[b(we,{ref_key:"formRef",ref:ge,model:u.value,rules:G.value,"label-position":"top",class:"attribute-form"},{default:c(()=>[(n(!0),f(N,null,S(U.value,a=>(n(),f("div",{key:a.groupId,class:"form-section attribute-group"},[p("div",qe,[p("h3",null,g(a.groupName),1),a.groupDesc?(n(),f("span",Be,g(a.groupDesc),1)):D("",!0)]),b(H,{gutter:20},{default:c(()=>[(n(!0),f(N,null,S(a.attributes,l=>(n(),v(x,{key:l.attributeId,xs:24,sm:12,md:8,lg:6},{default:c(()=>[b($,{label:l.attributeName,prop:`attrs.${l.attributeCode}`,required:l.isRequired==="1",class:"attribute-item"},{default:c(()=>[["select","multi","radio","checkbox"].includes(l.componentType)?(n(),f(N,{key:1},[Y(l)==="el-radio-group"?(n(),v(m,M({key:0,modelValue:u.value.attrs[l.attributeCode],"onUpdate:modelValue":d=>u.value.attrs[l.attributeCode]=d},{ref_for:!0},O(l),{onChange:d=>J(l),size:"large"}),{default:c(()=>[(n(!0),f(N,null,S(R(l,l.attributeValues),d=>(n(),v(s,{key:d.valueId||d.id||d.valueCode||d.code,label:d.valueCode||d.code||d.value},{default:c(()=>[y(g(d.valueName||d.name||d.label),1)]),_:2},1032,["label"]))),128))]),_:2},1040,["modelValue","onUpdate:modelValue","onChange"])):Y(l)==="el-checkbox-group"?(n(),v(z,M({key:1,modelValue:u.value.attrs[l.attributeCode],"onUpdate:modelValue":d=>u.value.attrs[l.attributeCode]=d},{ref_for:!0},O(l),{onChange:d=>J(l),size:"large"}),{default:c(()=>[(n(!0),f(N,null,S(R(l,l.attributeValues),d=>(n(),v(_,{key:d.valueId||d.id||d.valueCode||d.code,label:d.valueCode||d.code||d.value},{default:c(()=>[y(g(d.valueName||d.name||d.label),1)]),_:2},1032,["label"]))),128))]),_:2},1040,["modelValue","onUpdate:modelValue","onChange"])):(n(),v(k,M({key:2,modelValue:u.value.attrs[l.attributeCode],"onUpdate:modelValue":d=>u.value.attrs[l.attributeCode]=d},{ref_for:!0},O(l),{onChange:d=>J(l),size:"large"}),{default:c(()=>[(n(!0),f(N,null,S(R(l,l.attributeValues),d=>(n(),v(V,{key:d.valueId||d.id||d.valueCode||d.code,label:d.valueName||d.name||d.label,value:d.valueCode||d.code||d.value},{default:c(()=>[y(g(d.valueName||d.name||d.label),1)]),_:2},1032,["label","value"]))),128))]),_:2},1040,["modelValue","onUpdate:modelValue","onChange"]))],64)):(n(),v(me(Y(l)),M({key:0,modelValue:u.value.attrs[l.attributeCode],"onUpdate:modelValue":d=>u.value.attrs[l.attributeCode]=d},{ref_for:!0},O(l),{onChange:d=>J(l),size:"large"}),null,16,["modelValue","onUpdate:modelValue","onChange"])),T.value[l.attributeId]?(n(),f("div",Le,[b(r,null,{default:c(()=>[b(X(be))]),_:1}),p("span",null,g(T.value[l.attributeId]),1)])):D("",!0)]),_:2},1032,["label","prop","required"])]),_:2},1024))),128))]),_:2},1024)]))),128)),I.value.length>0||E.value.length>0?(n(),f("div",He,[e[10]||(e[10]=p("div",{class:"section-header"},[p("h3",null,"配置属性"),p("span",{class:"section-desc"},"根据需求配置产品属性")],-1)),b(H,{gutter:20},{default:c(()=>[I.value.length>0?(n(),v(x,{key:0,xs:24,sm:12,md:8,lg:6},{default:c(()=>[b($,{label:"产品型号",class:"attribute-item"},{default:c(()=>[b(Ve,{modelValue:P.value.productModel,"onUpdate:modelValue":e[0]||(e[0]=a=>P.value.productModel=a),placeholder:"输入产品型号",clearable:"",onInput:K,size:"large"},null,8,["modelValue"])]),_:1})]),_:1})):D("",!0),I.value.length>0?(n(),v(x,{key:1,xs:24,sm:12,md:8,lg:6},{default:c(()=>[b($,{label:"品牌",class:"attribute-item"},{default:c(()=>[b(k,{modelValue:P.value.brand,"onUpdate:modelValue":e[1]||(e[1]=a=>P.value.brand=a),placeholder:"选择品牌",clearable:"",onChange:K,size:"large"},{default:c(()=>[(n(!0),f(N,null,S(ve.value,a=>(n(),v(V,{key:a,label:a,value:a},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})):D("",!0),I.value.length>0?(n(),v(x,{key:2,xs:24,sm:12,md:8,lg:6},{default:c(()=>[b($,{label:"系列",class:"attribute-item"},{default:c(()=>[b(k,{modelValue:P.value.series,"onUpdate:modelValue":e[2]||(e[2]=a=>P.value.series=a),placeholder:"选择系列",clearable:"",onChange:K,size:"large"},{default:c(()=>[(n(!0),f(N,null,S(pe.value,a=>(n(),v(V,{key:a,label:a,value:a},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})):D("",!0),(n(!0),f(N,null,S(E.value,a=>(n(),v(x,{key:a.attributeId,xs:24,sm:12,md:8,lg:6},{default:c(()=>[b($,{label:a.attributeName,prop:`dynamicAttrs.${a.attributeId}`,required:a.isRequired==="1",class:"attribute-item"},{default:c(()=>[["select","multi","radio","checkbox"].includes(a.componentType)?(n(),f(N,{key:1},[Y(a)==="el-radio-group"?(n(),v(m,M({key:0,modelValue:u.value.dynamicAttrs[a.attributeId],"onUpdate:modelValue":l=>u.value.dynamicAttrs[a.attributeId]=l},{ref_for:!0},O(a),{onChange:l=>W(a),size:"large"}),{default:c(()=>[(n(!0),f(N,null,S(R(a,a.attributeValues),l=>(n(),v(s,{key:l.valueId||l.id||l.valueCode||l.code,label:l.valueCode||l.code||l.value},{default:c(()=>[y(g(l.valueName||l.name||l.label),1)]),_:2},1032,["label"]))),128))]),_:2},1040,["modelValue","onUpdate:modelValue","onChange"])):Y(a)==="el-checkbox-group"?(n(),v(z,M({key:1,modelValue:u.value.dynamicAttrs[a.attributeId],"onUpdate:modelValue":l=>u.value.dynamicAttrs[a.attributeId]=l},{ref_for:!0},O(a),{onChange:l=>W(a),size:"large"}),{default:c(()=>[(n(!0),f(N,null,S(R(a,a.attributeValues),l=>(n(),v(_,{key:l.valueId||l.id||l.valueCode||l.code,label:l.valueCode||l.code||l.value},{default:c(()=>[y(g(l.valueName||l.name||l.label),1)]),_:2},1032,["label"]))),128))]),_:2},1040,["modelValue","onUpdate:modelValue","onChange"])):(n(),v(k,M({key:2,modelValue:u.value.dynamicAttrs[a.attributeId],"onUpdate:modelValue":l=>u.value.dynamicAttrs[a.attributeId]=l},{ref_for:!0},O(a),{onChange:l=>W(a),size:"large"}),{default:c(()=>[(n(!0),f(N,null,S(R(a,a.attributeValues),l=>(n(),v(V,{key:l.valueId||l.id||l.valueCode||l.code,label:l.valueName||l.name||l.label,value:l.valueCode||l.code||l.value},{default:c(()=>[y(g(l.valueName||l.name||l.label),1)]),_:2},1032,["label","value"]))),128))]),_:2},1040,["modelValue","onUpdate:modelValue","onChange"]))],64)):(n(),v(me(Y(a)),M({key:0,modelValue:u.value.dynamicAttrs[a.attributeId],"onUpdate:modelValue":l=>u.value.dynamicAttrs[a.attributeId]=l},{ref_for:!0},O(a),{onChange:l=>W(a),size:"large"}),null,16,["modelValue","onUpdate:modelValue","onChange"])),T.value[a.attributeId]?(n(),f("div",Fe,[b(r,null,{default:c(()=>[b(X(be))]),_:1}),p("span",null,g(T.value[a.attributeId]),1)])):D("",!0)]),_:2},1032,["label","prop","required"])]),_:2},1024))),128))]),_:1})])):D("",!0),I.value.length>0?(n(),f("div",Ge,[b(H,{gutter:20},{default:c(()=>[b(x,{xs:24,sm:24,md:24},{default:c(()=>[b($,{label:"选择产品","validate-status":q.value,error:B.value},{default:c(()=>[L.value.length<=6?(n(),f("div",Je,[(n(!0),f(N,null,S(L.value,a=>{var l,d,ce,ie;return n(),f("div",{key:a.relationObjectId,class:ze(["product-card",{selected:i.currentNode.selectionType==="multiple"?u.value.selectedProductIds.includes(a.relationObjectId):u.value.selectedProductId===a.relationObjectId}]),onClick:j=>ee(a)},[p("div",Xe,[p("div",Ze,g(a.relationObjectName),1),p("div",Ke,[p("span",et,g(((l=a.brandInfo)==null?void 0:l.brandName)||"未知品牌"),1),p("span",tt,g(((d=a.seriesInfo)==null?void 0:d.seriesName)||"未知系列"),1)])]),p("div",lt,[p("div",at,[p("div",ot,[e[11]||(e[11]=p("span",{class:"info-label"},"型号：",-1)),p("span",ut,g(((ce=a.productInfo)==null?void 0:ce.productModel)||"无型号"),1)]),p("div",rt,[e[12]||(e[12]=p("span",{class:"info-label"},"分类：",-1)),p("span",st,g(((ie=a.catalogInfo)==null?void 0:ie.catalogName)||"未知分类"),1)])])]),p("div",nt,[b(Ae,{modelValue:u.value.productQuantities[a.relationObjectId],"onUpdate:modelValue":j=>u.value.productQuantities[a.relationObjectId]=j,min:i.currentNode.minQuantity||1,max:i.currentNode.maxQuantity||9999,step:1,onChange:j=>Ce(a.relationObjectId,j),size:"small",onClick:e[3]||(e[3]=ae(()=>{},["stop"])),style:{"margin-right":"12px"}},null,8,["modelValue","onUpdate:modelValue","min","max","onChange"]),p("div",dt,[i.currentNode.selectionType==="single"?(n(),v(s,{key:0,modelValue:u.value.selectedProductId,"onUpdate:modelValue":e[4]||(e[4]=j=>u.value.selectedProductId=j),label:a.relationObjectId,onChange:j=>te(a.relationObjectId),onClick:e[5]||(e[5]=ae(()=>{},["stop"])),size:"small"},{default:c(()=>e[13]||(e[13]=[y(" 选择 ")])),_:2,__:[13]},1032,["modelValue","label","onChange"])):(n(),v(_,{key:1,modelValue:u.value.selectedProductIds,"onUpdate:modelValue":e[6]||(e[6]=j=>u.value.selectedProductIds=j),label:a.relationObjectId,onChange:j=>te(a.relationObjectId),onClick:e[7]||(e[7]=ae(()=>{},["stop"])),size:"small"},{default:c(()=>e[14]||(e[14]=[y(" 选择 ")])),_:2,__:[14]},1032,["modelValue","label","onChange"]))])])],10,We)}),128))])):(n(),f("div",ct,[i.currentNode.selectionType==="multiple"?(n(),v(de,{key:0,data:oe.value,"row-class-name":({row:a})=>u.value.selectedProductIds.includes(a.relationObjectId)?"selected-row":"","row-selection":{selectedRowKeys:u.value.selectedProductIds,onChange:Ie},size:"small",style:{width:"100%","margin-bottom":"12px"},onRowClick:ee},{default:c(()=>[b(C,{type:"selection",width:"55"}),b(C,{prop:"relationObjectName",label:"产品名称",width:"200"}),b(C,{label:"品牌",width:"120"},{default:c(a=>{var l;return[y(g(((l=a.row.brandInfo)==null?void 0:l.brandName)||"未知品牌"),1)]}),_:1}),b(C,{label:"系列",width:"120"},{default:c(a=>{var l;return[y(g(((l=a.row.seriesInfo)==null?void 0:l.seriesName)||"未知系列"),1)]}),_:1}),b(C,{label:"型号",width:"180"},{default:c(a=>{var l;return[y(g(((l=a.row.productInfo)==null?void 0:l.productModel)||"无型号"),1)]}),_:1}),b(C,{label:"产品代码",width:"180"},{default:c(a=>{var l;return[y(g(((l=a.row.productInfo)==null?void 0:l.productCode)||"无代码"),1)]}),_:1}),b(C,{label:"分类",width:"120"},{default:c(a=>{var l;return[y(g(((l=a.row.catalogInfo)==null?void 0:l.catalogName)||"未知分类"),1)]}),_:1})]),_:1},8,["data","row-class-name","row-selection"])):(n(),v(de,{key:1,data:oe.value,"row-class-name":({row:a})=>a.relationObjectId===u.value.selectedProductId?"selected-row":"",size:"small",style:{width:"100%","margin-bottom":"12px"},onRowClick:ee},{default:c(()=>[b(C,{prop:"relationObjectName",label:"产品名称",width:"200"}),b(C,{label:"品牌",width:"120"},{default:c(a=>{var l;return[y(g(((l=a.row.brandInfo)==null?void 0:l.brandName)||"未知品牌"),1)]}),_:1}),b(C,{label:"系列",width:"120"},{default:c(a=>{var l;return[y(g(((l=a.row.seriesInfo)==null?void 0:l.seriesName)||"未知系列"),1)]}),_:1}),b(C,{label:"型号",width:"180"},{default:c(a=>{var l;return[y(g(((l=a.row.productInfo)==null?void 0:l.productModel)||"无型号"),1)]}),_:1}),b(C,{label:"产品代码",width:"180"},{default:c(a=>{var l;return[y(g(((l=a.row.productInfo)==null?void 0:l.productCode)||"无代码"),1)]}),_:1}),b(C,{label:"分类",width:"120"},{default:c(a=>{var l;return[y(g(((l=a.row.catalogInfo)==null?void 0:l.catalogName)||"未知分类"),1)]}),_:1})]),_:1},8,["data","row-class-name"])),b(Se,{"current-page":w.value.currentPage,"onUpdate:currentPage":e[8]||(e[8]=a=>w.value.currentPage=a),"page-size":w.value.pageSize,"onUpdate:pageSize":e[9]||(e[9]=a=>w.value.pageSize=a),"page-sizes":[10,20],layout:"total, prev, pager, next",total:I.value.length,onSizeChange:ue,onCurrentChange:ue,size:"small",style:{"margin-top":"8px","text-align":"right"}},null,8,["current-page","page-size","total"])]))]),_:1},8,["validate-status","error"])]),_:1})]),_:1})])):D("",!0)]),_:1},8,["model","rules"])])):(n(),f("div",Ee,[b(o,{description:"请在左侧选择要配置的节点"},{image:c(()=>[b(r,{size:48,color:"#c0c4cc"},{default:c(()=>[b(X(je))]),_:1})]),_:1})]))])}}},It=ke(it,[["__scopeId","data-v-adcd53f4"]]);export{It as default};
