import{_ as ge,r as p,g as D,i as fe,a as i,j as _e,c as V,o as g,e as _,k as L,b as l,w as s,f as m,t as F,v as j,l as K,F as O,s as T,m as S,q as be,E as u,n as M}from"./index-a6CENfl-.js";import{l as ve,b as ye,d as P,u as he,c as Ie,e as we}from"./series-C_GNmXOR.js";import{l as Ve}from"./catalog-KEzIOAdT.js";const Ce={class:"series-management"},Ne={class:"header-wrapper"},ke={class:"action-bar"},xe={class:"primary-actions"},ze={class:"search-section"},Se={class:"table-container"},Ue={class:"pagination-container"},Be={key:0,class:"el-form-item__help",style:{color:"#909399"}},Ee={class:"dialog-footer"},De={__name:"index",setup(Le){const C=p(!0),N=p(!0),U=p(0),R=p([]),k=p([]),v=p([]),Q=p([]),x=p([]),B=p(""),y=p(!1),w=p(),o=D({seriesId:null,seriesCode:"",seriesName:"",brandId:null,catalogId:null,status:"0",sortOrder:0}),d=D({pageNum:1,pageSize:10,seriesCode:"",seriesName:"",brandId:"",catalogId:"",status:""}),$=D({seriesName:[{required:!0,message:"系列名称不能为空",trigger:"blur"},{min:2,max:128,message:"系列名称长度在 2 到 128 个字符",trigger:"blur"}],brandId:[{required:!0,message:"请选择所属品牌",trigger:"change"}],catalogId:[{required:!0,message:"请选择归属产品目录",trigger:"change"}],status:[{required:!0,message:"系列状态不能为空",trigger:"change"}]}),h=async()=>{C.value=!0;try{const t=await ye(d);R.value=t.rows,U.value=t.total,C.value=!1}catch{C.value=!1,u.error("获取系列列表失败")}},E=async()=>{try{const t=await Ve();if(t&&(t.rows||Array.isArray(t))){const e=t.rows||t;v.value=G(e)}else v.value=[]}catch(t){console.error("获取目录树失败:",t),v.value=[],u.error("获取目录树失败: "+(t.message||"未知错误"))}},G=t=>{const e=[],n={};t.forEach(r=>{n[r.catalogId]={...r,children:[]}}),t.forEach(r=>{const c=r.parentId||0;c===0?e.push(n[r.catalogId]):n[c]&&n[c].children.push(n[r.catalogId])});const b=r=>{r.children&&r.children.length>0&&(r.children.sort((c,I)=>(c.catalogSort||0)-(I.catalogSort||0)),r.children.forEach(c=>b(c)))};return e.forEach(r=>b(r)),e},H=async()=>{try{const t=await ve(),e=t.code===200?t.data:[];k.value=Array.isArray(e)?e:[]}catch{k.value=[],u.error("获取品牌列表失败")}},z=()=>{d.pageNum=1,h()},J=()=>{d.seriesCode="",d.seriesName="",d.brandId="",d.catalogId="",d.status="",z()},W=()=>{N.value=!N.value},X=t=>{x.value=t},Y=async()=>{o.seriesId=null,o.seriesCode="",o.seriesName="",o.brandId=null,o.catalogId=null,o.status="0",o.sortOrder=0,B.value="新增系列",v.value.length===0&&(console.log("目录数据为空，重新加载目录数据..."),await E()),y.value=!0},Z=async t=>{o.seriesId=t.seriesId,o.seriesCode=t.seriesCode,o.seriesName=t.seriesName,o.brandId=t.brandId,o.catalogId=t.catalogId,o.status=t.status,o.sortOrder=t.sortOrder,v.value.length===0&&(console.log("目录数据为空，重新加载目录数据..."),await E()),B.value="修改系列",y.value=!0},ee=async t=>{await M.confirm("确定要删除该系列吗？","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});try{await P(t.seriesId),u.success("删除成功"),h()}catch{u.error("删除失败")}},le=async()=>{if(x.value.length===0){u.warning("请选择要删除的系列");return}await M.confirm("确定要删除选中的系列吗？","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});try{const t=x.value.map(e=>e.seriesId).join(",");await P(t),u.success("删除成功"),h()}catch{u.error("删除失败")}},ae=()=>{we(d).then(t=>{const e=new Blob([t],{type:"application/vnd.ms-excel"}),n=document.createElement("a");n.href=URL.createObjectURL(e),n.download="系列列表.xlsx",document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(n.href),u.success("导出成功")}).catch(t=>{u.error("导出失败")})},te=async()=>{w.value&&await w.value.validate().then(async()=>{try{o.seriesId?(await he(o),u.success("修改成功")):(await Ie(o),u.success("新增成功")),y.value=!1,h()}catch(t){u.error("操作失败: "+(t.message||"未知错误"))}}).catch(()=>{u.error("表单验证失败，请检查填写内容")})},se=()=>{y.value=!1,w.value&&w.value.resetFields()};return p({form:null}),fe(async()=>{console.log("组件挂载，开始加载初始数据..."),await H(),await E(),h(),console.log("初始数据加载完成")}),(t,e)=>{const n=i("el-button"),b=i("el-input"),r=i("el-form-item"),c=i("el-option"),I=i("el-select"),q=i("el-form"),f=i("el-table-column"),oe=i("el-tag"),re=i("el-table"),ne=i("pagination"),de=i("el-tree-select"),A=i("el-radio"),ie=i("el-radio-group"),ue=i("el-input-number"),ce=i("el-dialog"),me=_e("loading");return g(),V("div",Ce,[_("div",Ne,[e[15]||(e[15]=_("h2",{class:"page-title"},"系列管理",-1)),_("div",ke,[_("div",xe,[l(n,{type:"primary",size:"default",icon:"Plus",onClick:Y},{default:s(()=>e[12]||(e[12]=[m(" 新增系列 ")])),_:1,__:[12]}),l(n,{type:"danger",size:"default",icon:"Delete",disabled:x.value.length===0,onClick:le},{default:s(()=>e[13]||(e[13]=[m(" 批量删除 ")])),_:1,__:[13]},8,["disabled"]),l(n,{type:"warning",size:"default",icon:"Download",onClick:ae},{default:s(()=>e[14]||(e[14]=[m(" 导出 ")])),_:1,__:[14]}),l(n,{type:"info",size:"default",icon:"Search",onClick:W},{default:s(()=>[m(F(N.value?"收起":"展开")+"搜索 ",1)]),_:1})])])]),L(_("div",ze,[l(q,{model:d,ref:"queryForm",inline:!0,"label-width":"80px",class:"search-form"},{default:s(()=>[l(r,{label:"系列编码",prop:"seriesCode"},{default:s(()=>[l(b,{modelValue:d.seriesCode,"onUpdate:modelValue":e[0]||(e[0]=a=>d.seriesCode=a),placeholder:"请输入系列编码",clearable:"",size:"small",onKeyup:K(z,["enter"])},null,8,["modelValue"])]),_:1}),l(r,{label:"系列名称",prop:"seriesName"},{default:s(()=>[l(b,{modelValue:d.seriesName,"onUpdate:modelValue":e[1]||(e[1]=a=>d.seriesName=a),placeholder:"请输入系列名称",clearable:"",size:"small",onKeyup:K(z,["enter"])},null,8,["modelValue"])]),_:1}),l(r,{label:"所属品牌",prop:"brandId"},{default:s(()=>[l(I,{modelValue:d.brandId,"onUpdate:modelValue":e[2]||(e[2]=a=>d.brandId=a),placeholder:"请选择所属品牌",clearable:"",size:"small"},{default:s(()=>[(g(!0),V(O,null,T(k.value,a=>(g(),S(c,{key:a.brandId,label:a.brandName,value:a.brandId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(r,{label:"归属产品目录",prop:"catalogId"},{default:s(()=>[l(I,{modelValue:d.catalogId,"onUpdate:modelValue":e[3]||(e[3]=a=>d.catalogId=a),placeholder:"请选择归属产品目录",clearable:"",size:"small"},{default:s(()=>[(g(!0),V(O,null,T(Q.value,a=>(g(),S(c,{key:a.catalogId,label:"─".repeat(a.level)+a.catalogName,value:a.catalogId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(r,{label:"系列状态",prop:"status"},{default:s(()=>[l(I,{modelValue:d.status,"onUpdate:modelValue":e[4]||(e[4]=a=>d.status=a),placeholder:"请选择系列状态",clearable:"",size:"small"},{default:s(()=>[l(c,{label:"启用",value:"0"}),l(c,{label:"禁用",value:"1"})]),_:1},8,["modelValue"])]),_:1}),l(r,{class:"search-buttons"},{default:s(()=>[l(n,{type:"primary",icon:"Search",size:"small",onClick:z},{default:s(()=>e[16]||(e[16]=[m("搜索")])),_:1,__:[16]}),l(n,{icon:"RefreshRight",size:"small",onClick:J},{default:s(()=>e[17]||(e[17]=[m("重置")])),_:1,__:[17]})]),_:1})]),_:1},8,["model"])],512),[[j,N.value]]),_("div",Se,[L((g(),S(re,{data:R.value,onSelectionChange:X,border:"",style:{width:"100%"}},{default:s(()=>[l(f,{type:"selection",width:"50",align:"center"}),l(f,{label:"系列编码",align:"center",prop:"seriesCode",width:"110"}),l(f,{label:"系列名称",align:"center",prop:"seriesName",width:"140","show-overflow-tooltip":!0}),l(f,{label:"所属品牌",align:"center",prop:"brandName",width:"110"}),l(f,{label:"系列状态",align:"center",prop:"status",width:"90"},{default:s(a=>[l(oe,{type:a.row.status==="0"?"success":"danger",size:"small"},{default:s(()=>[m(F(a.row.status==="0"?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),l(f,{label:"排序",align:"center",prop:"sortOrder",width:"70"}),l(f,{label:"创建时间",align:"center",prop:"createTime",width:"150"}),l(f,{label:"操作",align:"center","class-name":"small-padding fixed-width",width:"150"},{default:s(a=>[l(n,{size:"small",type:"primary",icon:"Edit",onClick:pe=>Z(a.row),style:{"margin-right":"5px"}},{default:s(()=>e[18]||(e[18]=[m(" 修改 ")])),_:2,__:[18]},1032,["onClick"]),l(n,{size:"small",type:"danger",icon:"Delete",onClick:pe=>ee(a.row)},{default:s(()=>e[19]||(e[19]=[m(" 删除 ")])),_:2,__:[19]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[me,C.value]]),_("div",Ue,[L(l(ne,{total:U.value,page:d.pageNum,limit:d.pageSize,onPagination:h},null,8,["total","page","limit"]),[[j,U.value>0]])])]),l(ce,{title:B.value,modelValue:y.value,"onUpdate:modelValue":e[11]||(e[11]=a=>y.value=a),width:"600px","append-to-body":"",class:"dialog-wrapper"},{footer:s(()=>[_("span",Ee,[l(n,{size:"default",onClick:se},{default:s(()=>e[22]||(e[22]=[m("取消")])),_:1,__:[22]}),l(n,{size:"default",type:"primary",onClick:te},{default:s(()=>e[23]||(e[23]=[m("确定")])),_:1,__:[23]})])]),default:s(()=>[l(q,{ref_key:"formRef",ref:w,model:o,rules:$,"label-width":"100px",class:"dialog-form"},{default:s(()=>[l(r,{label:"系列编码",prop:"seriesCode"},{default:s(()=>[l(b,{modelValue:o.seriesCode,"onUpdate:modelValue":e[5]||(e[5]=a=>o.seriesCode=a),placeholder:"由系统自动生成",readonly:!o.seriesId,disabled:!o.seriesId,size:"default"},null,8,["modelValue","readonly","disabled"]),o.seriesId?be("",!0):(g(),V("div",Be," 系列编码由系统自动生成，无需手动输入 "))]),_:1}),l(r,{label:"系列名称",prop:"seriesName"},{default:s(()=>[l(b,{modelValue:o.seriesName,"onUpdate:modelValue":e[6]||(e[6]=a=>o.seriesName=a),placeholder:"请输入系列名称",size:"default"},null,8,["modelValue"])]),_:1}),l(r,{label:"品牌",prop:"brandId"},{default:s(()=>[l(I,{modelValue:o.brandId,"onUpdate:modelValue":e[7]||(e[7]=a=>o.brandId=a),placeholder:"请选择品牌",size:"default"},{default:s(()=>[(g(!0),V(O,null,T(k.value,a=>(g(),S(c,{key:a.brandId,label:a.brandName,value:a.brandId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(r,{label:"归属产品目录",prop:"catalogId"},{default:s(()=>[l(de,{modelValue:o.catalogId,"onUpdate:modelValue":e[8]||(e[8]=a=>o.catalogId=a),data:v.value,props:{value:"catalogId",label:"catalogName",children:"children"},placeholder:"请选择归属产品目录",clearable:"",style:{width:"100%"},size:"default"},null,8,["modelValue","data"])]),_:1}),l(r,{label:"系列状态",prop:"status"},{default:s(()=>[l(ie,{modelValue:o.status,"onUpdate:modelValue":e[9]||(e[9]=a=>o.status=a)},{default:s(()=>[l(A,{label:"0"},{default:s(()=>e[20]||(e[20]=[m("启用")])),_:1,__:[20]}),l(A,{label:"1"},{default:s(()=>e[21]||(e[21]=[m("禁用")])),_:1,__:[21]})]),_:1},8,["modelValue"])]),_:1}),l(r,{label:"排序",prop:"sortOrder"},{default:s(()=>[l(ue,{modelValue:o.sortOrder,"onUpdate:modelValue":e[10]||(e[10]=a=>o.sortOrder=a),min:0,placeholder:"请输入排序值",size:"default"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])])}}},qe=ge(De,[["__scopeId","data-v-9da39c22"]]);export{qe as default};
