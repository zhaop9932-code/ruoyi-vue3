import{a9 as Y,_ as Pe,r as w,H as q,E as A,h as Re,a as C,c as V,o as v,b as o,w as r,k as $,l as S,e as b,a3 as Me,at as he,t as B,f as j,F as T,n as N,x as H,K as Ve,m,L as Le,D as Fe,au as ze,Q as Je}from"./index-DgigFOm-.js";import{d as Ae}from"./vuedraggable.umd-B409vRHe.js";import{l as qe}from"./superBomStructure-C2O6seWy.js";import{c as He,q as Ke}from"./bom-CjuVRwkz.js";import{getSuperBomVariableByBomId as Qe}from"./superBomVariable-_jqz_F6y.js";import{g as Ge}from"./superBomDynamicAttribute-6n4Uab6m.js";import{g as We}from"./superBomProductRelation-c5nmns4w.js";import"./sortable.esm-CAlIhjx7.js";function Xe(U){return Y({url:"/cpq/ruleCondition",method:"post",data:U})}function Ye(U){return Y({url:`/cpq/ruleCondition/listByRuleId/${U}`,method:"get"})}function Ze(U){return Y({url:"/cpq/ruleCondition",method:"put",data:U})}function Ee(U){return Y({url:`/cpq/ruleCondition/${U}`,method:"delete"})}const ea={class:"condition-config"},aa={class:"card-header"},la={class:"header-actions"},ta={class:"condition-count"},oa={class:"condition-config-type-buttons"},na={key:0,class:"empty-conditions"},ra=["onClick"],sa={class:"condition-item-header"},ua={class:"condition-index"},da={class:"condition-config-type-tag"},ia={key:0,class:"condition-type-selector"},ca={key:1,class:"complex-condition-actions"},pa={key:0,class:"condition-item-content"},va={key:1,class:"complex-condition-content"},fa={class:"complex-condition-header"},ya={class:"nested-conditions"},ga={class:"nested-condition-item"},ba={class:"condition-item-header"},ma={class:"condition-index"},_a={class:"condition-type-selector"},ha={class:"condition-item-content"},Va={class:"ai-assist-content"},Aa={key:0,class:"ai-suggestion"},Ca={class:"preview-content"},Ia={key:0},ka={__name:"RuleConditionConfig",props:{modelValue:{type:Array,default:()=>[]},ruleType:{type:String,default:"validation"},bomId:{type:[String,Number],default:null},ruleId:{type:[String,Number],default:null}},emits:["update:modelValue","update:conditions"],setup(U,{emit:Ce}){const f=U,de=Ce,y=w([...f.modelValue]),Z=w(!1),ie=w("number"),E=w(null),F=w(""),ee=[{label:"数值条件",value:"number"},{label:"文本条件",value:"text"},{label:"选择条件",value:"select"},{label:"布尔条件",value:"boolean"}],Ie=[{label:"简单条件",value:"simple"},{label:"复杂条件",value:"complex"}],ae=[{label:"变量",value:"variable"},{label:"节点静态属性",value:"nodeStaticAttr"},{label:"节点动态属性",value:"nodeDynamicAttr"},{label:"节点产品",value:"nodeProduct"}],K=w([]),z=w([]),x=w([]),Q=w(!1),ce={value:"bomStructureId",label:"nodeName",children:"children",multiple:!1,checkStrictly:!1,emitPath:!1},le=async()=>{if(!f.bomId){console.warn("BOM ID为空，无法加载节点");return}Q.value=!0;try{console.log("开始加载BOM节点，bomId:",f.bomId);const e=await qe(f.bomId);console.log("API响应:",e);let a=[];if(Array.isArray(e))a=e;else if(e.data&&Array.isArray(e.data))a=e.data;else if(e.rows&&Array.isArray(e.rows))a=e.rows;else{console.warn("未知的响应格式:",e),A.warning("BOM节点数据格式错误");return}console.log("处理后的数据:",a),z.value=ke(a),console.log("树形结构:",z.value);const n=(u,t="")=>{let c=[];return u.forEach(d=>{const p=t?`${t} > ${d.nodeName}`:d.nodeName;console.log("处理节点:",d,"标签:",p),c.push({label:p,value:d.bomStructureId}),d.children&&d.children.length>0&&(c=c.concat(n(d.children,p)))}),c};K.value=n(z.value),x.value=z.value,console.log("下拉选项:",K.value),console.log("级联选项:",x.value),K.value.length===0&&(console.warn("没有找到BOM节点数据"),A.info("当前BOM没有节点数据"))}catch(e){console.error("加载BOM节点失败:",e),A.error("加载BOM节点失败")}finally{Q.value=!1}},ke=e=>{if(!Array.isArray(e)||e.length===0)return[];const a=[],n=new Map;return e.forEach(u=>{const t=String(u.bomStructureId);n.set(t,{...u,bomStructureId:t,children:[]})}),e.forEach(u=>{const t=String(u.bomStructureId),c=n.get(t),d=u.parentNodeId||0,p=String(d);d===0||!n.has(p)?a.push(c):n.get(p).children.push(c)}),a};q(()=>f.bomId,async e=>{e?(await Promise.all([le(),ve()]),f.ruleId&&await G(f.ruleId)):(K.value=[],z.value=[],D.value=[],y.value=[...f.modelValue])}),q(()=>f.ruleId,async e=>{e?(f.bomId&&x.value.length===0&&await le(),await G(e)):y.value=[...f.modelValue]}),q(x,async e=>{e.length>0&&y.value.length>0&&await te(y.value)});const te=async e=>{for(const a of e)a.configType==="simple"?(a.node&&typeof a.node!="string"&&(a.node=String(a.node)),a.judgeType!=="variable"&&a.node&&(await W(a.judgeType,a.node),a.type==="select"&&a.field&&await ge(a))):a.children&&a.children.length>0&&await te(a.children)},G=async e=>{if(e)try{const a=await Ye(e);a.code===200?(y.value=a.data||[],await te(y.value)):A.error("加载条件失败："+a.message)}catch(a){console.error("加载条件失败:",a),A.error("加载条件失败")}},pe=e=>{console.log("节点选择变化:",e.node),e.field="",e.value="",e.node&&(_.value.staticAttrs.delete(e.node),_.value.dynamicAttrs.delete(e.node),_.value.products.delete(e.node)),e.judgeType!=="variable"&&e.node&&W(e.judgeType,e.node)},W=async(e,a,n)=>{if(a){X.value=!0;try{switch(e){case"nodeStaticAttr":await we(a);break;case"nodeDynamicAttr":await Te(a);break;case"nodeProduct":await Ne(a);break}}catch(u){console.error("加载字段数据失败:",u),A.error("加载字段数据失败")}finally{X.value=!1,console.log("字段数据加载完成，当前节点字段数:",ne(e,a).length)}}},we=async e=>{if(!_.value.staticAttrs.has(e))try{const a=await He(f.bomId,e);let n=[];Array.isArray(a)?n=a:a.data&&(Array.isArray(a.data)?n=a.data:a.data.rows&&Array.isArray(a.data.rows)&&(n=a.data.rows)),console.log("加载静态属性成功，数量:",n.length);const u=n.map(t=>({label:t.attributeName,value:t.attributeCode||t.attributeName,...t}));_.value.staticAttrs.set(e,u)}catch(a){console.error("加载静态属性失败:",a),_.value.staticAttrs.set(e,[])}},Te=async e=>{if(!_.value.dynamicAttrs.has(e))try{const a=await Ge(e);let n=[];Array.isArray(a)?n=a:a.data&&(Array.isArray(a.data)?n=a.data:a.data.rows&&Array.isArray(a.data.rows)&&(n=a.data.rows)),console.log("加载动态属性成功，数量:",n.length);const u=n.map(t=>({label:t.attributeName,value:t.attributeCode||t.attributeName,...t}));_.value.dynamicAttrs.set(e,u)}catch(a){console.error("加载动态属性失败:",a),_.value.dynamicAttrs.set(e,[])}},Ne=async e=>{if(!_.value.products.has(e))try{const a=await We({bomId:f.bomId,bomStructureId:e});let n=[];Array.isArray(a)?n=a:a.data&&(Array.isArray(a.data)?n=a.data:a.data.rows&&Array.isArray(a.data.rows)&&(n=a.data.rows)),console.log("加载产品字段成功，数量:",n.length);const u=[];n.forEach(t=>{u.push({label:t.relationObjectName,value:t.relationObjectId})}),_.value.products.set(e,u)}catch(a){console.error("加载产品字段失败:",a),_.value.products.set(e,[])}};Re(async()=>{f.bomId&&await Promise.all([le(),ve()]),f.ruleId&&await G(f.ruleId)});const _=w({staticAttrs:new Map,dynamicAttrs:new Map,products:new Map}),X=w(!1),D=w([]),ve=async()=>{if(!f.bomId){D.value=[];return}try{const e=await Qe(f.bomId);e.data&&Array.isArray(e.data)?D.value=e.data.map(a=>({label:a.variableName,value:a.variableCode})):D.value=[]}catch(e){console.error("加载变量列表失败:",e),D.value=[],A.error("加载变量列表失败")}},oe=e=>({number:[{label:"等于",value:"="},{label:"不等于",value:"!="},{label:"大于",value:">"},{label:"大于等于",value:">="},{label:"小于",value:"<"},{label:"小于等于",value:"<="},{label:"为空",value:"is_empty"},{label:"不为空",value:"is_not_empty"}],text:[{label:"等于",value:"="},{label:"不等于",value:"!="},{label:"包含",value:"contains"},{label:"不包含",value:"not_contains"},{label:"为空",value:"is_empty"},{label:"不为空",value:"is_not_empty"},{label:"开始于",value:"starts_with"},{label:"结束于",value:"ends_with"}],select:[{label:"等于",value:"="},{label:"不等于",value:"!="},{label:"在列表中",value:"in"},{label:"不在列表中",value:"not_in"}],date:[{label:"等于",value:"="},{label:"不等于",value:"!="},{label:"大于",value:">"},{label:"小于",value:"<"}],boolean:[{label:"等于",value:"="},{label:"不等于",value:"!="}]})[e]||[],fe=e=>{e.judgeType!=="variable"&&e.node&&!e.field&&W(e.judgeType,e.node)},ye=e=>{e.field="",e.value="",e.judgeType!=="variable"&&e.node&&W(e.judgeType,e.node)},ge=async e=>{if(e.type==="select"&&e.node&&e.field&&(console.log("字段选择变化:",e.field),e.judgeType==="nodeStaticAttr")){const n=(_.value.staticAttrs.get(e.node)||[]).find(u=>u.value===e.field);if(n){const u=n.attributeId||n.id;if(u)try{const t=await Ke(e.node,u);n.attributeValueList=t.data||[],console.log("属性值加载成功:",n.attributeValueList)}catch(t){console.error("加载属性值失败:",t),A.error("加载属性值失败")}}}},be=e=>{(e.operator==="is_empty"||e.operator==="is_not_empty")&&(e.value="")},ne=(e,a)=>{switch(e){case"variable":return D.value;case"nodeStaticAttr":return a?_.value.staticAttrs.get(a)||[]:[];case"nodeDynamicAttr":return a?_.value.dynamicAttrs.get(a)||[]:[];case"nodeProduct":return a?_.value.products.get(a)||[]:[];default:return[]}},re=e=>{if(e.type!=="select"||!e.node)return[];if(e.judgeType==="nodeProduct")return _.value.products.get(e.node)||[];if(!e.field)return[];let a=[];e.judgeType==="nodeStaticAttr"?a=_.value.staticAttrs.get(e.node)||[]:e.judgeType==="nodeDynamicAttr"&&(a=_.value.dynamicAttrs.get(e.node)||[]);const n=a.find(t=>t.value===e.field);if(!n)return[];let u=[];if(e.judgeType==="nodeStaticAttr"?u=n.attributeValueList||n.attributeValues||n.values||[]:u=n.attributeValues||[],typeof u=="string")try{u=JSON.parse(u)}catch(t){return console.error("解析属性值失败:",t),[]}return Array.isArray(u)?u.map(t=>typeof t=="object"&&t!==null?{label:t.valueName||t.label||t.attributeValue||t.value||"",value:t.valueCode||t.code||t.attributeValue||t.value||""}:{label:String(t),value:String(t)}):[]},Ue=(e,a)=>{E.value=e,ie.value=a.type},Se=(e,a)=>{y.value[e].type=a,E.value=e},Be=(e=null,a=null)=>{const n=e||y.value,u={conditionId:null,ruleId:f.ruleId,configType:"simple",type:ie.value,judgeType:"variable",node:"",field:"",operator:"",value:"",logic:n.length>0?"AND":"",parentConditionId:null,children:[]};e?(u.parentConditionId=e.conditionId,e.children.push(u)):n.push(u),O()},$e=()=>{const e={conditionId:null,ruleId:f.ruleId,configType:"complex",logic:y.value.length>0?"AND":"",parentConditionId:null,children:[{conditionId:null,ruleId:f.ruleId,configType:"simple",type:"number",judgeType:"variable",node:"",field:"",operator:"",value:"",logic:"",parentConditionId:null}]};y.value.push(e),O()},je=e=>{e.children||(e.children=[]);const a={conditionId:null,ruleId:f.ruleId,configType:"simple",type:"number",judgeType:"variable",node:"",field:"",operator:"",value:"",logic:e.children.length>0?"AND":"",parentConditionId:e.conditionId};e.children.push(a),O()},me=async(e,a=null)=>{var c,d;const n=a||y.value,u=n[e];if(await Je.confirm("确定要删除这个条件吗？","删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(()=>!1))try{u.conditionId&&u.conditionId!==null&&u.conditionId!==""&&(await Ee(u.conditionId),A.success("条件删除成功")),n.splice(e,1),n.length>0&&(n[0].logic=""),O()}catch(p){console.error("删除条件失败:",p),A.error("删除条件失败："+(((d=(c=p.response)==null?void 0:c.data)==null?void 0:d.message)||p.message||"未知错误"))}},xe=async()=>{var e,a;try{if(!f.ruleId){A.warning("规则ID不能为空，无法保存条件。请先选择或创建规则，再配置条件。");return}const n=(t,c=null)=>t.map(d=>{const p={...d,ruleId:f.ruleId,parentConditionId:c};return p.children&&p.children.length>0&&(p.children=n(p.children,p.conditionId)),p}),u=n(y.value);for(const t of u)if(t.conditionId)await Ze(t);else{const c=await Xe(t);if(t.conditionId=c.data.conditionId,t.children&&t.children.length>0){const d=(p,h)=>{p.forEach(g=>{g.parentConditionId=h,g.children&&g.children.length>0&&d(g.children,h)})};d(t.children,t.conditionId)}}O(),A.success("条件保存成功")}catch(n){console.error("保存条件失败:",n),A.error("保存条件失败："+(((a=(e=n.response)==null?void 0:e.data)==null?void 0:a.message)||n.message||"未知错误"))}},_e=()=>{const e=(t,c)=>{for(const d of t){if(d.bomStructureId===c||d.bomStructureId===Number(c))return d.nodeName;if(d.children&&d.children.length>0){const p=e(d.children,c);if(p)return p}}return null},a=t=>{if(!t.field)return"field";switch(t.judgeType){case"variable":const c=D.value.find(k=>k.value===t.field);return c?c.label:t.field;case"nodeStaticAttr":const p=(_.value.staticAttrs.get(t.node)||[]).find(k=>k.value===t.field);return p?p.label:t.field;case"nodeDynamicAttr":const g=(_.value.dynamicAttrs.get(t.node)||[]).find(k=>k.value===t.field);return g?g.label:t.field;case"nodeProduct":const I=(_.value.products.get(t.node)||[]).find(k=>k.value===t.field);return I?I.label:t.field;default:return t.field}},n=t=>{if(t.value===void 0||t.value===null||t.value==="")return"";if(t.type==="select"){const d=re(t).find(p=>p.value===t.value);if(d)return typeof d.label=="string"?`"${d.label}"`:d.label}return typeof t.value=="string"?`"${t.value}"`:t.value},u=t=>!t||t.length===0?"":t.map(c=>{var p,h;const d=c.logic?`${c.logic} `:"";if(c.configType==="complex"){const g=u(c.children);return`${d}(${g})`}else{const g=((p=ae.find(M=>M.value===c.judgeType))==null?void 0:p.label)||c.judgeType,J=((h=oe(c.type).find(M=>M.value===c.operator))==null?void 0:h.label)||c.operator;c.operator;let I="",k=a(c),P=n(c);c.judgeType!=="variable"&&c.node&&(I=e(x.value,c.node)||c.node);let R="";return c.judgeType!=="variable"?R=`${g}[${I}].${k}`:R=`${g}[${k}]`,`${d}${R} ${J} ${P}`}}).join(" ");return u(y.value)},De=async()=>{var e;if(y.value.length===0){F.value="请先添加条件，然后使用AI辅助配置";return}try{const a=_e();await new Promise(n=>setTimeout(n,1e3)),F.value=`
# DeepSeek智能建议

## 当前条件分析
- 条件数量：${y.value.length}
- 条件表达式：${a}

## 优化建议
1. **字段选择优化**：建议根据业务需求选择更精确的字段
2. **操作符优化**：对于数值类型，建议使用更精确的操作符
3. **值范围优化**：建议设置合理的值范围
4. **逻辑关系优化**：建议优化逻辑关系，提高条件执行效率

## 推荐配置
- 推荐使用：${(e=ee.find(n=>n.value===y.value[0].type))==null?void 0:e.label}
- 推荐字段：根据业务需求选择
- 推荐操作符：根据条件类型选择
- 推荐值：根据业务规则设置
    `}catch(a){console.error("DeepSeek API调用失败:",a),F.value="DeepSeek API调用失败，请稍后重试"}},Oe=async()=>{var e,a;if(!f.ruleId){A.warning("规则ID不能为空，无法刷新条件。请先选择或创建规则。");return}try{Z.value=!0,await G(f.ruleId),A.success("条件列表刷新成功")}catch(n){console.error("刷新条件失败:",n),A.error("刷新条件失败："+(((a=(e=n.response)==null?void 0:e.data)==null?void 0:a.message)||n.message||"未知错误"))}finally{Z.value=!1}},O=()=>{console.log("更新父组件条件:",y.value),de("update:modelValue",y.value),de("update:conditions",y.value)};return q(y,()=>{O()},{deep:!0}),q(()=>f.modelValue,e=>{JSON.stringify(e)!==JSON.stringify(y.value)&&(y.value=[...e])},{deep:!0}),(e,a)=>{const n=C("el-icon"),u=C("el-button"),t=C("el-empty"),c=C("el-tag"),d=C("el-option"),p=C("el-select"),h=C("el-form-item"),g=C("el-col"),J=C("el-cascader"),I=C("el-row"),k=C("el-input-number"),P=C("el-input"),R=C("el-date-picker"),M=C("el-form"),se=C("el-card");return v(),V("div",ea,[o(se,{class:"condition-list",shadow:"hover"},{header:r(()=>[b("div",aa,[a[3]||(a[3]=b("span",null,"条件列表",-1)),b("div",la,[b("span",ta,B(y.value.length)+" 个条件",1),b("div",oa,[(v(),V(T,null,N(Ie,s=>o(u,{key:s.value,type:s.value==="simple"?"primary":"default",onClick:L=>s.value==="simple"?Be():$e(),size:"small"},{default:r(()=>[o(n,null,{default:r(()=>[o(S(Ve))]),_:1}),j(" "+B(s.label),1)]),_:2},1032,["type","onClick"])),64))]),o(u,{type:"info",size:"small",onClick:Oe,loading:Z.value},{default:r(()=>[o(n,null,{default:r(()=>[o(S(Le))]),_:1}),a[1]||(a[1]=j(" 刷新条件 "))]),_:1,__:[1]},8,["loading"]),o(u,{type:"primary",size:"small",onClick:xe},{default:r(()=>[o(n,null,{default:r(()=>[o(S(Fe))]),_:1}),a[2]||(a[2]=j(" 保存条件 "))]),_:1,__:[2]})])])]),default:r(()=>[y.value.length===0?(v(),V("div",na,[o(t,{description:"暂无条件"})])):$("",!0),o(S(Ae),{modelValue:y.value,"onUpdate:modelValue":a[0]||(a[0]=s=>y.value=s),"item-key":"conditionId",handle:".drag-handle","ghost-class":"ghost"},{item:r(({element:s,index:L})=>[b("div",{class:Me(["condition-item",{"condition-item-selected":E.value===L,"complex-condition":s.configType==="complex"}]),onClick:l=>Ue(L,s)},[b("div",sa,[o(n,{class:"drag-handle"},{default:r(()=>[o(S(he))]),_:1}),b("span",ua,B(L+1),1),b("div",da,[o(c,{type:s.configType==="complex"?"warning":"success"},{default:r(()=>[j(B(s.configType==="complex"?"复杂条件":"简单条件"),1)]),_:2},1032,["type"])]),s.configType==="simple"?(v(),V("div",ia,[(v(),V(T,null,N(ee,l=>o(u,{key:l.value,type:s.type===l.value?"primary":"default",onClick:H(ue=>Se(L,l.value),["stop"]),size:"small"},{default:r(()=>[j(B(l.label),1)]),_:2},1032,["type","onClick"])),64))])):(v(),V("div",ca,[o(u,{type:"success",size:"small",onClick:H(l=>je(s),["stop"])},{default:r(()=>[o(n,null,{default:r(()=>[o(S(Ve))]),_:1}),a[4]||(a[4]=j(" 添加子条件 "))]),_:2,__:[4]},1032,["onClick"])])),o(u,{type:"danger",size:"small",icon:"Delete",onClick:H(l=>me(L),["stop"])},null,8,["onClick"])]),s.configType==="simple"?(v(),V("div",pa,[o(M,{model:s,"label-position":"top","label-width":"100px"},{default:r(()=>[o(I,{gutter:20},{default:r(()=>[o(g,{span:12},{default:r(()=>[o(h,{label:"判断类型"},{default:r(()=>[o(p,{modelValue:s.judgeType,"onUpdate:modelValue":l=>s.judgeType=l,placeholder:"请选择判断类型",onChange:l=>ye(s)},{default:r(()=>[(v(),V(T,null,N(ae,l=>o(d,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1024)]),_:2},1024),s.judgeType!=="variable"?(v(),m(g,{key:0,span:12},{default:r(()=>[o(h,{label:"节点"},{default:r(()=>[o(J,{modelValue:s.node,"onUpdate:modelValue":l=>s.node=l,options:x.value,props:ce,placeholder:"请选择节点",loading:Q.value,filterable:"",clearable:"",onChange:l=>pe(s),"collapse-tags":!0},null,8,["modelValue","onUpdate:modelValue","options","loading","onChange"])]),_:2},1024)]),_:2},1024)):$("",!0)]),_:2},1024),o(I,{gutter:20},{default:r(()=>[s.judgeType!=="nodeProduct"?(v(),m(g,{key:0,span:12},{default:r(()=>[o(h,{label:"字段"},{default:r(()=>[o(p,{modelValue:s.field,"onUpdate:modelValue":l=>s.field=l,placeholder:"请选择字段",loading:X.value,onVisibleChange:l=>fe(s),onChange:l=>ge(s)},{default:r(()=>[(v(!0),V(T,null,N(ne(s.judgeType,s.node),l=>(v(),m(d,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","loading","onVisibleChange","onChange"])]),_:2},1024)]),_:2},1024)):$("",!0),o(g,{span:12},{default:r(()=>[o(h,{label:"操作符"},{default:r(()=>[o(p,{modelValue:s.operator,"onUpdate:modelValue":l=>s.operator=l,placeholder:"请选择操作符",onChange:l=>be(s)},{default:r(()=>[(v(!0),V(T,null,N(oe(s.type),l=>(v(),m(d,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1024)]),_:2},1024)]),_:2},1024),s.operator&&s.operator!=="is_empty"&&s.operator!=="is_not_empty"?(v(),m(I,{key:0,gutter:20},{default:r(()=>[o(g,{span:24},{default:r(()=>[o(h,{label:"值"},{default:r(()=>[s.type==="number"?(v(),m(k,{key:0,modelValue:s.value,"onUpdate:modelValue":l=>s.value=l,min:0,max:999999,step:1,placeholder:"请输入数值"},null,8,["modelValue","onUpdate:modelValue"])):s.type==="text"?(v(),m(P,{key:1,modelValue:s.value,"onUpdate:modelValue":l=>s.value=l,placeholder:"请输入文本"},null,8,["modelValue","onUpdate:modelValue"])):s.type==="select"?(v(),m(p,{key:2,modelValue:s.value,"onUpdate:modelValue":l=>s.value=l,placeholder:"请选择值"},{default:r(()=>[(v(!0),V(T,null,N(re(s),l=>(v(),m(d,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):s.type==="date"?(v(),m(R,{key:3,modelValue:s.value,"onUpdate:modelValue":l=>s.value=l,type:"datetime",placeholder:"选择日期时间"},null,8,["modelValue","onUpdate:modelValue"])):(v(),m(P,{key:4,modelValue:s.value,"onUpdate:modelValue":l=>s.value=l,placeholder:"请输入值"},null,8,["modelValue","onUpdate:modelValue"]))]),_:2},1024)]),_:2},1024)]),_:2},1024)):$("",!0),o(I,{gutter:20},{default:r(()=>[o(g,{span:24},{default:r(()=>[o(h,{label:"逻辑关系"},{default:r(()=>[o(p,{modelValue:s.logic,"onUpdate:modelValue":l=>s.logic=l,placeholder:"请选择逻辑关系"},{default:r(()=>[o(d,{label:"并且 (AND)",value:"AND"}),o(d,{label:"或者 (OR)",value:"OR"})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["model"])])):(v(),V("div",va,[b("div",fa,[a[5]||(a[5]=b("span",{class:"complex-condition-title"},"嵌套条件组",-1)),o(h,{label:"组逻辑关系",inline:""},{default:r(()=>[o(p,{modelValue:s.logic,"onUpdate:modelValue":l=>s.logic=l,placeholder:"请选择逻辑关系"},{default:r(()=>[o(d,{label:"并且 (AND)",value:"AND"}),o(d,{label:"或者 (OR)",value:"OR"})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),b("div",ya,[o(S(Ae),{modelValue:s.children,"onUpdate:modelValue":l=>s.children=l,"item-key":"conditionId",handle:".drag-handle","ghost-class":"ghost"},{item:r(({element:l,index:ue})=>[b("div",ga,[b("div",ba,[o(n,{class:"drag-handle"},{default:r(()=>[o(S(he))]),_:1}),b("span",ma,B(ue+1),1),b("div",_a,[(v(),V(T,null,N(ee,i=>o(u,{key:i.value,type:l.type===i.value?"primary":"default",onClick:H(wa=>l.type=i.value,["stop"]),size:"small"},{default:r(()=>[j(B(i.label),1)]),_:2},1032,["type","onClick"])),64))]),o(u,{type:"danger",size:"small",icon:"Delete",onClick:H(i=>me(ue,s.children),["stop"])},null,8,["onClick"])]),b("div",ha,[o(M,{model:l,"label-position":"top","label-width":"100px"},{default:r(()=>[o(I,{gutter:20},{default:r(()=>[o(g,{span:12},{default:r(()=>[o(h,{label:"判断类型"},{default:r(()=>[o(p,{modelValue:l.judgeType,"onUpdate:modelValue":i=>l.judgeType=i,placeholder:"请选择判断类型",onChange:i=>ye(l)},{default:r(()=>[(v(),V(T,null,N(ae,i=>o(d,{key:i.value,label:i.label,value:i.value},null,8,["label","value"])),64))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1024)]),_:2},1024),l.judgeType!=="variable"?(v(),m(g,{key:0,span:12},{default:r(()=>[o(h,{label:"节点"},{default:r(()=>[o(J,{modelValue:l.node,"onUpdate:modelValue":i=>l.node=i,options:x.value,props:ce,placeholder:"请选择节点",loading:Q.value,filterable:"",clearable:"",onChange:i=>pe(l),"collapse-tags":!0},null,8,["modelValue","onUpdate:modelValue","options","loading","onChange"])]),_:2},1024)]),_:2},1024)):$("",!0)]),_:2},1024),o(I,{gutter:20},{default:r(()=>[l.judgeType!=="nodeProduct"?(v(),m(g,{key:0,span:12},{default:r(()=>[o(h,{label:"字段"},{default:r(()=>[o(p,{modelValue:l.field,"onUpdate:modelValue":i=>l.field=i,placeholder:"请选择字段",loading:X.value,onVisibleChange:i=>fe(l)},{default:r(()=>[(v(!0),V(T,null,N(ne(l.judgeType,l.node),i=>(v(),m(d,{key:i.value,label:i.label,value:i.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","loading","onVisibleChange"])]),_:2},1024)]),_:2},1024)):$("",!0),o(g,{span:12},{default:r(()=>[o(h,{label:"操作符"},{default:r(()=>[o(p,{modelValue:l.operator,"onUpdate:modelValue":i=>l.operator=i,placeholder:"请选择操作符",onChange:i=>be(l)},{default:r(()=>[(v(!0),V(T,null,N(oe(l.type),i=>(v(),m(d,{key:i.value,label:i.label,value:i.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1024)]),_:2},1024)]),_:2},1024),l.operator&&l.operator!=="is_empty"&&l.operator!=="is_not_empty"?(v(),m(I,{key:0,gutter:20},{default:r(()=>[o(g,{span:24},{default:r(()=>[o(h,{label:"值"},{default:r(()=>[l.type==="number"?(v(),m(k,{key:0,modelValue:l.value,"onUpdate:modelValue":i=>l.value=i,min:0,max:999999,step:1,placeholder:"请输入数值"},null,8,["modelValue","onUpdate:modelValue"])):l.type==="text"?(v(),m(P,{key:1,modelValue:l.value,"onUpdate:modelValue":i=>l.value=i,placeholder:"请输入文本"},null,8,["modelValue","onUpdate:modelValue"])):l.type==="select"?(v(),m(p,{key:2,modelValue:l.value,"onUpdate:modelValue":i=>l.value=i,placeholder:"请选择值"},{default:r(()=>[(v(!0),V(T,null,N(re(l),i=>(v(),m(d,{key:i.value,label:i.label,value:i.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):l.type==="date"?(v(),m(R,{key:3,modelValue:l.value,"onUpdate:modelValue":i=>l.value=i,type:"datetime",placeholder:"选择日期时间"},null,8,["modelValue","onUpdate:modelValue"])):(v(),m(P,{key:4,modelValue:l.value,"onUpdate:modelValue":i=>l.value=i,placeholder:"请输入值"},null,8,["modelValue","onUpdate:modelValue"]))]),_:2},1024)]),_:2},1024)]),_:2},1024)):$("",!0),o(I,{gutter:20},{default:r(()=>[o(g,{span:24},{default:r(()=>[o(h,{label:"逻辑关系"},{default:r(()=>[o(p,{modelValue:l.logic,"onUpdate:modelValue":i=>l.logic=i,placeholder:"请选择逻辑关系"},{default:r(()=>[o(d,{label:"并且 (AND)",value:"AND"}),o(d,{label:"或者 (OR)",value:"OR"})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["model"])])])]),_:2},1032,["modelValue","onUpdate:modelValue"])])]))],10,ra)]),_:1},8,["modelValue"])]),_:1}),o(se,{class:"ai-assist",shadow:"hover"},{header:r(()=>a[6]||(a[6]=[b("div",{class:"card-header"},[b("span",null,"AI辅助配置")],-1)])),default:r(()=>[b("div",Va,[o(u,{type:"primary",size:"small",onClick:De},{default:r(()=>[o(n,null,{default:r(()=>[o(S(ze))]),_:1}),a[7]||(a[7]=j(" 使用DeepSeek智能调整条件 "))]),_:1,__:[7]}),F.value?(v(),V("div",Aa,[a[8]||(a[8]=b("h4",null,"DeepSeek建议：",-1)),b("pre",null,B(F.value),1)])):$("",!0)])]),_:1}),o(se,{class:"condition-preview",shadow:"hover"},{header:r(()=>a[9]||(a[9]=[b("div",{class:"card-header"},[b("span",null,"条件预览")],-1)])),default:r(()=>[b("div",Ca,[y.value.length>0?(v(),V("pre",Ia,B(_e()),1)):(v(),m(t,{key:1,description:"暂无条件预览"}))])]),_:1})])}}},Da=Pe(ka,[["__scopeId","data-v-88df3cca"]]);export{Da as default};
