import{x as C,r as _,g as x,i as Z,a as u,j as ee,c as le,o as E,b as e,k as z,w as o,l as oe,f as d,v as O,t as T,m as te,e as ae,E as g}from"./index-a6CENfl-.js";function ne(m){return C({url:"/cpq/solution/list",method:"get",params:m})}function ue(m){return C({url:"/cpq/solution",method:"post",data:m})}function se(m){return C({url:"/cpq/solution",method:"put",data:m})}function ie(m){return C({url:`/cpq/solution/${m}`,method:"delete"})}const de={class:"app-container"},re={class:"dialog-footer"},me={__name:"index",setup(m){const y=_(!0),S=_(!0),w=_(0),B=_([]),I=_([]),N=_(""),b=_(!1),s=x({pageNum:1,pageSize:10,solutionName:"",solutionStatus:""}),t=x({solutionId:null,solutionCode:"",solutionName:"",description:"",solutionStatus:"draft",bomId:"",ruleIds:[]}),q=x({solutionCode:[{required:!0,message:"方案编码不能为空",trigger:"blur"}],solutionName:[{required:!0,message:"方案名称不能为空",trigger:"blur"}],solutionStatus:[{required:!0,message:"方案状态不能为空",trigger:"change"}]}),v=async()=>{y.value=!0;try{const n=await ne(s);B.value=n.rows,w.value=n.total,y.value=!1}catch{y.value=!1,g.error("获取解决方案列表失败")}},h=()=>{s.pageNum=1,v()},$=()=>{s.solutionName="",s.solutionStatus="",h()},F=()=>{S.value=!S.value},P=n=>{I.value=n},A=()=>{t.solutionId=null,t.solutionCode="",t.solutionName="",t.description="",t.solutionStatus="draft",t.bomId="",t.ruleIds=[],N.value="新增解决方案",b.value=!0},K=n=>{t.solutionId=n.solutionId,t.solutionCode=n.solutionCode,t.solutionName=n.solutionName,t.description=n.description,t.solutionStatus=n.solutionStatus,t.bomId=n.bomId,t.ruleIds=n.ruleIds,N.value="修改解决方案",b.value=!0},U=async n=>{const l=n.solutionId?[n.solutionId]:I.value.map(f=>f.solutionId);await ElMessageBox.confirm("确定要删除选中的解决方案吗？","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});try{await ie(l),g.success("删除成功"),v()}catch{g.error("删除失败")}},L=n=>{router.push({path:"/cpq/solution/component",query:{solutionId:n.solutionId,solutionName:n.solutionName}})},Q=async()=>{await validate(t,q);try{t.solutionId?(await se(t),g.success("修改成功")):(await ue(t),g.success("新增成功")),b.value=!1,v()}catch{g.error("操作失败")}},R=()=>{b.value=!1,resetForm()};return Z(()=>{v()}),(n,l)=>{const f=u("el-input"),p=u("el-form-item"),i=u("el-option"),V=u("el-select"),r=u("el-button"),M=u("el-form"),j=u("el-card"),k=u("el-col"),G=u("el-row"),c=u("el-table-column"),H=u("el-tag"),J=u("el-table"),W=u("pagination"),X=u("el-dialog"),Y=ee("loading");return E(),le("div",de,[e(j,{shadow:"never",class:"search-card"},{default:o(()=>[z(e(M,{model:s,ref:"queryForm",inline:!0,"label-width":"80px"},{default:o(()=>[e(p,{label:"方案名称",prop:"solutionName"},{default:o(()=>[e(f,{modelValue:s.solutionName,"onUpdate:modelValue":l[0]||(l[0]=a=>s.solutionName=a),placeholder:"请输入方案名称",clearable:"",size:"small",onKeyup:oe(h,["enter"])},null,8,["modelValue"])]),_:1}),e(p,{label:"方案状态",prop:"solutionStatus"},{default:o(()=>[e(V,{modelValue:s.solutionStatus,"onUpdate:modelValue":l[1]||(l[1]=a=>s.solutionStatus=a),placeholder:"请选择方案状态",clearable:"",size:"small"},{default:o(()=>[e(i,{label:"草稿",value:"draft"}),e(i,{label:"已发布",value:"published"}),e(i,{label:"已失效",value:"expired"})]),_:1},8,["modelValue"])]),_:1}),e(p,null,{default:o(()=>[e(r,{type:"primary",icon:"Search",size:"small",onClick:h},{default:o(()=>l[9]||(l[9]=[d("搜索")])),_:1,__:[9]}),e(r,{icon:"RefreshRight",size:"small",onClick:$},{default:o(()=>l[10]||(l[10]=[d("重置")])),_:1,__:[10]})]),_:1})]),_:1},8,["model"]),[[O,S.value]])]),_:1}),e(G,{gutter:10,class:"mb8"},{default:o(()=>[e(k,{span:1.5},{default:o(()=>[e(r,{type:"primary",icon:"Plus",size:"small",onClick:A},{default:o(()=>l[11]||(l[11]=[d(" 新增方案 ")])),_:1,__:[11]})]),_:1}),e(k,{span:1.5},{default:o(()=>[e(r,{type:"danger",icon:"Delete",size:"small",disabled:I.value.length===0,onClick:U},{default:o(()=>l[12]||(l[12]=[d(" 批量删除 ")])),_:1,__:[12]},8,["disabled"])]),_:1}),e(k,{span:21},{default:o(()=>[e(r,{type:"info",icon:"Search",size:"small",onClick:F,style:{float:"right"}},{default:o(()=>[d(T(S.value?"收起":"展开")+"搜索 ",1)]),_:1})]),_:1})]),_:1}),z((E(),te(J,{data:B.value,onSelectionChange:P},{default:o(()=>[e(c,{type:"selection",width:"55",align:"center"}),e(c,{label:"方案编码",align:"center",prop:"solutionCode"}),e(c,{label:"方案名称",align:"center",prop:"solutionName","show-overflow-tooltip":!0}),e(c,{label:"方案状态",align:"center",prop:"solutionStatus"},{default:o(a=>[e(H,{type:a.row.solutionStatus==="draft"?"info":a.row.solutionStatus==="published"?"success":"danger",size:"small"},{default:o(()=>[d(T(a.row.solutionStatus==="draft"?"草稿":a.row.solutionStatus==="published"?"已发布":"已失效"),1)]),_:2},1032,["type"])]),_:1}),e(c,{label:"BOM数量",align:"center",prop:"bomCount"}),e(c,{label:"创建人",align:"center",prop:"createBy"}),e(c,{label:"创建时间",align:"center",prop:"createTime",width:"180"}),e(c,{label:"操作",align:"center","class-name":"small-padding fixed-width",width:"250"},{default:o(a=>[e(r,{size:"small",type:"primary",icon:"Edit",onClick:D=>K(a.row)},{default:o(()=>l[13]||(l[13]=[d(" 编辑 ")])),_:2,__:[13]},1032,["onClick"]),e(r,{size:"small",type:"success",icon:"DocumentAdd",onClick:D=>L(a.row)},{default:o(()=>l[14]||(l[14]=[d(" 组件管理 ")])),_:2,__:[14]},1032,["onClick"]),e(r,{size:"small",type:"danger",icon:"Delete",onClick:D=>U(a.row)},{default:o(()=>l[15]||(l[15]=[d(" 删除 ")])),_:2,__:[15]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[Y,y.value]]),z(e(W,{total:w.value,page:s.pageNum,limit:s.pageSize,onPagination:v},null,8,["total","page","limit"]),[[O,w.value>0]]),e(X,{title:N.value,modelValue:b.value,"onUpdate:modelValue":l[8]||(l[8]=a=>b.value=a),width:"700px","append-to-body":""},{footer:o(()=>[ae("span",re,[e(r,{onClick:R},{default:o(()=>l[16]||(l[16]=[d("取消")])),_:1,__:[16]}),e(r,{type:"primary",onClick:Q},{default:o(()=>l[17]||(l[17]=[d("确定")])),_:1,__:[17]})])]),default:o(()=>[e(M,{ref:"form",model:t,rules:q,"label-width":"120px"},{default:o(()=>[e(p,{label:"方案编码",prop:"solutionCode"},{default:o(()=>[e(f,{modelValue:t.solutionCode,"onUpdate:modelValue":l[2]||(l[2]=a=>t.solutionCode=a),placeholder:"请输入方案编码"},null,8,["modelValue"])]),_:1}),e(p,{label:"方案名称",prop:"solutionName"},{default:o(()=>[e(f,{modelValue:t.solutionName,"onUpdate:modelValue":l[3]||(l[3]=a=>t.solutionName=a),placeholder:"请输入方案名称"},null,8,["modelValue"])]),_:1}),e(p,{label:"方案描述",prop:"description"},{default:o(()=>[e(f,{modelValue:t.description,"onUpdate:modelValue":l[4]||(l[4]=a=>t.description=a),type:"textarea",placeholder:"请输入方案描述",rows:3},null,8,["modelValue"])]),_:1}),e(p,{label:"方案状态",prop:"solutionStatus"},{default:o(()=>[e(V,{modelValue:t.solutionStatus,"onUpdate:modelValue":l[5]||(l[5]=a=>t.solutionStatus=a),placeholder:"请选择方案状态"},{default:o(()=>[e(i,{label:"草稿",value:"draft"}),e(i,{label:"已发布",value:"published"}),e(i,{label:"已失效",value:"expired"})]),_:1},8,["modelValue"])]),_:1}),e(p,{label:"关联BOM",prop:"bomId"},{default:o(()=>[e(V,{modelValue:t.bomId,"onUpdate:modelValue":l[6]||(l[6]=a=>t.bomId=a),placeholder:"请选择关联的超级BOM"},{default:o(()=>[e(i,{label:"BOM-001",value:"1"}),e(i,{label:"BOM-002",value:"2"})]),_:1},8,["modelValue"])]),_:1}),e(p,{label:"关联规则",prop:"ruleIds"},{default:o(()=>[e(V,{modelValue:t.ruleIds,"onUpdate:modelValue":l[7]||(l[7]=a=>t.ruleIds=a),multiple:"",placeholder:"请选择关联的配置规则"},{default:o(()=>[e(i,{label:"规则-001",value:"1"}),e(i,{label:"规则-002",value:"2"}),e(i,{label:"规则-003",value:"3"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])])}}};export{me as default};
