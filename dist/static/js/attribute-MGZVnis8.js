import{_ as Te,u as Ce,f as Ue,r as b,C as I,o as xe,b as Ie,h as p,G as Ne,d as N,e as _,j as m,i as t,k as a,q as s,t as A,H as F,I as H,l as h,m as O,p as J,K as W,L as X,n as he,at as qe,V as f,E as Se}from"./index-CwdKQqOf.js";import{listAttribute as Ge,deleteAttribute as ze,getAttribute as Ae,updateAttribute as Fe,addAttribute as Le}from"./product-CtyH2BmW.js";import{listAttributeGroup as De}from"./attributeGroup-DT63RTG0.js";const Re={class:"cpq-page-container"},Be={class:"cpq-card"},Me={class:"cpq-card-header"},Ee={class:"cpq-card-actions"},$e={class:"cpq-card-body"},Ke={class:"cpq-card-title"},Pe={key:0,class:"cpq-catalog-name"},Qe={class:"cpq-pagination"},je={class:"cpq-dialog-footer"},He={class:"el-upload__tip text-center"},Oe={class:"el-upload__tip"},Je={class:"dialog-footer"},We={__name:"attribute",setup(Xe){const L=Ce(),{proxy:D}=Ue(),q=b(L.query.catalogId||""),R=b(L.query.catalogName||""),T=b(!0),C=b(!0),S=b(0),B=b([]),G=b([]),z=b(""),w=b(!1),M=b([]),E=b(!1),d=I({open:!1,title:"导入产品属性",url:"/prod-api/cpq/product/importAttribute",headers:{Authorization:"Bearer "+localStorage.getItem("token")},isUploading:!1,isUpdateSupport:0,updateSupport:0,fileList:[],successMsg:""}),U=b(),$=async()=>{E.value=!0;try{const u=await De({pageNum:1,pageSize:100});M.value=u.rows||[]}catch{f.error("加载属性组列表失败")}finally{E.value=!1}},n=I({pageNum:1,pageSize:10,attributeCode:"",attributeName:"",attributeType:"",catalogId:""}),o=I({attributeId:null,attributeCode:"",attributeName:"",attributeType:"text",componentType:"input",iconUrl:"",defaultValue:"",tooltip:"",attributeGroupId:"",attributeGroupName:""}),Y=I({attributeName:[{required:!0,message:"属性名称不能为空",trigger:"blur"}],attributeType:[{required:!0,message:"属性类型不能为空",trigger:"change"}],componentType:[{required:!0,message:"组件类型不能为空",trigger:"change"}]}),V=async()=>{T.value=!0;try{const u=await Ge(n);B.value=u.rows,S.value=u.total,T.value=!1}catch{T.value=!1,f.error("获取属性列表失败")}},x=()=>{n.pageNum=1,V()},Z=()=>{n.attributeCode="",n.attributeName="",n.attributeType="",x()},ee=()=>{C.value=!C.value},te=u=>{G.value=u},le=()=>{o.attributeId=null,o.attributeCode="",o.attributeName="",o.attributeType="text",o.componentType="input",o.iconUrl="",o.defaultValue="",o.tooltip="",o.attributeGroupId="",o.attributeGroupName="",z.value="新增属性",$(),w.value=!0},ae=async u=>{try{const r=(await Ae(u.attributeId)).data;o.attributeId=r.attributeId,o.attributeCode=r.attributeCode,o.attributeName=r.attributeName;const g={1:"text",2:"number",3:"date",4:"enum",5:"boolean",text:"text",number:"number",date:"date",enum:"enum",boolean:"boolean"},c=String(r.attributeType).toLowerCase();o.attributeType=g[c]||"text";const i={1:"input",2:"select",3:"radio",4:"checkbox",5:"slider",6:"switch",7:"date-picker",input:"input",select:"select",radio:"radio",checkbox:"checkbox",slider:"slider",switch:"switch","date-picker":"date-picker"},y=String(r.componentType).toLowerCase();o.componentType=i[y]||"input",o.iconUrl=r.iconUrl,o.defaultValue=r.defaultValue,o.tooltip=r.tooltip,o.attributeGroupId=r.attributeGroupId||"",o.attributeGroupName=r.attributeGroupName||"",z.value="修改属性",$(),w.value=!0}catch{f.error("获取属性详情失败")}},K=async u=>{const e=u.attributeId?[u.attributeId]:G.value.map(r=>r.attributeId);await Se.confirm("确定要删除选中的属性吗？","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});try{await ze(e),f.success("删除成功"),V()}catch{f.error("删除失败")}},k=b(null),oe=async()=>{k.value&&await k.value.validate().then(async()=>{try{o.attributeId?(await Fe(o),f.success("修改成功")):(await Le(o),f.success("新增成功")),w.value=!1,V()}catch{f.error("操作失败")}}).catch(()=>{f.error("表单验证失败，请检查填写内容")})},ue=()=>{w.value=!1,k.value&&k.value.resetFields()},re=()=>{D.download("cpq/product/exportAttribute",{...n},`attribute_${new Date().getTime()}.xlsx`)},ie=()=>{D.download("cpq/product/downloadAttributeImportTemplate",{},`attribute_import_template_${new Date().getTime()}.xlsx`)},ne=()=>{d.title="导入产品属性",d.open=!0},de=()=>{U.value&&U.value.uploadFiles.length>0?U.value.submit():f.warning("请选择要上传的文件")},se=(u,e,r)=>{d.isUploading=!0},pe=(u,e,r)=>{d.isUploading=!1,u.code===200?(d.successMsg=u.msg,f.success(u.msg),d.open=!1,V()):f.error(u.msg)},ce=(u,e)=>{d.updateSupport=e.length>0},me=(u,e)=>{d.updateSupport=e.length>0};return xe(()=>{Ie(),q.value&&(n.catalogId=q.value),V()}),(u,e)=>{const r=p("el-button"),g=p("el-input"),c=p("el-form-item"),i=p("el-option"),y=p("el-select"),P=p("el-form"),Q=p("el-card"),v=p("el-table-column"),be=p("el-tag"),fe=p("el-table"),ge=p("pagination"),j=p("el-dialog"),ve=p("el-icon"),_e=p("el-checkbox"),ye=p("el-link"),we=p("el-upload"),Ve=Ne("loading");return _(),N("div",Re,[m("div",Be,[m("div",Me,[e[21]||(e[21]=m("div",{class:"cpq-card-title"},"产品属性管理",-1)),m("div",Ee,[t(r,{type:"primary",onClick:le,icon:u.Plus},{default:a(()=>e[17]||(e[17]=[s("新增属性")])),_:1,__:[17]},8,["icon"]),t(r,{type:"danger",onClick:K,disabled:G.value.length===0,icon:u.Delete},{default:a(()=>e[18]||(e[18]=[s("批量删除")])),_:1,__:[18]},8,["disabled","icon"]),t(r,{type:"warning",onClick:re,icon:u.Download},{default:a(()=>e[19]||(e[19]=[s("导出")])),_:1,__:[19]},8,["icon"]),t(r,{type:"success",onClick:ne,icon:u.Upload},{default:a(()=>e[20]||(e[20]=[s("导入")])),_:1,__:[20]},8,["icon"]),t(r,{type:"info",onClick:ee,icon:u.Search},{default:a(()=>[s(A(C.value?"收起":"展开")+"搜索 ",1)]),_:1},8,["icon"])])]),m("div",$e,[F(t(Q,{shadow:"never",class:"cpq-search-card"},{default:a(()=>[t(P,{model:n,ref:"queryForm",inline:!0,"label-width":"80px"},{default:a(()=>[t(c,{label:"属性编码",prop:"attributeCode"},{default:a(()=>[t(g,{modelValue:n.attributeCode,"onUpdate:modelValue":e[0]||(e[0]=l=>n.attributeCode=l),placeholder:"请输入属性编码",clearable:"",size:"small",onKeyup:J(x,["enter"])},null,8,["modelValue"])]),_:1}),t(c,{label:"属性名称",prop:"attributeName"},{default:a(()=>[t(g,{modelValue:n.attributeName,"onUpdate:modelValue":e[1]||(e[1]=l=>n.attributeName=l),placeholder:"请输入属性名称",clearable:"",size:"small",onKeyup:J(x,["enter"])},null,8,["modelValue"])]),_:1}),t(c,{label:"属性类型",prop:"attributeType"},{default:a(()=>[t(y,{modelValue:n.attributeType,"onUpdate:modelValue":e[2]||(e[2]=l=>n.attributeType=l),placeholder:"请选择属性类型",clearable:"",size:"small"},{default:a(()=>[t(i,{label:"文本",value:"text"}),t(i,{label:"数字",value:"number"}),t(i,{label:"日期",value:"date"}),t(i,{label:"枚举",value:"enum"}),t(i,{label:"布尔",value:"boolean"})]),_:1},8,["modelValue"])]),_:1}),q.value?O("",!0):(_(),h(c,{key:0},{default:a(()=>[t(y,{modelValue:n.catalogId,"onUpdate:modelValue":e[3]||(e[3]=l=>n.catalogId=l),placeholder:"请选择目录",clearable:"",size:"small"},{default:a(()=>[(_(!0),N(W,null,X(u.catalogList,l=>(_(),h(i,{key:l.catalogId,label:l.catalogName,value:l.catalogId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})),t(c,null,{default:a(()=>[t(r,{type:"primary",size:"small",onClick:x,icon:u.Search},{default:a(()=>e[22]||(e[22]=[s("搜索")])),_:1,__:[22]},8,["icon"]),t(r,{size:"small",onClick:Z,icon:u.Refresh},{default:a(()=>e[23]||(e[23]=[s("重置")])),_:1,__:[23]},8,["icon"])]),_:1})]),_:1},8,["model"])]),_:1},512),[[H,C.value]]),t(Q,{shadow:"never",class:"cpq-sub-card"},{header:a(()=>[m("div",Ke,[e[24]||(e[24]=s(" 属性列表 ")),R.value?(_(),N("span",Pe,"(目录："+A(R.value)+")",1)):O("",!0)])]),default:a(()=>[F((_(),h(fe,{data:B.value,onSelectionChange:te,stripe:"",fit:"",style:{width:"100%"},class:"cpq-table"},{default:a(()=>[t(v,{type:"selection",width:"55",align:"center"}),t(v,{label:"属性编码",align:"left",prop:"attributeCode","min-width":"150"}),t(v,{label:"属性名称",align:"left",prop:"attributeName","show-overflow-tooltip":!0,"min-width":"200"}),t(v,{label:"属性类型",align:"center",prop:"attributeType",width:"120"},{default:a(l=>[t(be,{size:"small"},{default:a(()=>[s(A(l.row.attributeType==="text"?"文本":l.row.attributeType==="number"?"数字":l.row.attributeType==="date"?"日期":l.row.attributeType==="enum"?"枚举":"布尔"),1)]),_:2},1024)]),_:1}),t(v,{label:"组件类型",align:"center",prop:"componentType",width:"120"}),t(v,{label:"默认值",align:"left",prop:"defaultValue","show-overflow-tooltip":!0,"min-width":"150"}),t(v,{label:"创建时间",align:"center",prop:"createTime",width:"180"}),t(v,{label:"操作",align:"center","class-name":"cpq-table-action",width:"150"},{default:a(l=>[t(r,{size:"small",type:"primary",icon:u.Edit,onClick:ke=>ae(l.row)},{default:a(()=>e[25]||(e[25]=[s(" 修改 ")])),_:2,__:[25]},1032,["icon","onClick"]),t(r,{size:"small",type:"danger",icon:u.Delete,onClick:ke=>K(l.row)},{default:a(()=>e[26]||(e[26]=[s(" 删除 ")])),_:2,__:[26]},1032,["icon","onClick"])]),_:1})]),_:1},8,["data"])),[[Ve,T.value]]),m("div",Qe,[F(t(ge,{total:S.value,page:n.pageNum,"onUpdate:page":e[4]||(e[4]=l=>n.pageNum=l),limit:n.pageSize,"onUpdate:limit":e[5]||(e[5]=l=>n.pageSize=l),onPagination:V},null,8,["total","page","limit"]),[[H,S.value>0]])])]),_:1})])]),t(j,{title:z.value,modelValue:w.value,"onUpdate:modelValue":e[13]||(e[13]=l=>w.value=l),width:"600px","append-to-body":"","close-on-click-modal":!1},{footer:a(()=>[m("div",je,[t(r,{onClick:ue},{default:a(()=>e[27]||(e[27]=[s("取消")])),_:1,__:[27]}),t(r,{type:"primary",onClick:oe},{default:a(()=>e[28]||(e[28]=[s("确定")])),_:1,__:[28]})])]),default:a(()=>[t(P,{ref:l=>k.value=l,model:o,rules:Y,"label-width":"100px",class:"cpq-form"},{default:a(()=>[t(c,{label:"属性名称",prop:"attributeName"},{default:a(()=>[t(g,{modelValue:o.attributeName,"onUpdate:modelValue":e[6]||(e[6]=l=>o.attributeName=l),placeholder:"请输入属性名称"},null,8,["modelValue"])]),_:1}),t(c,{label:"属性类型",prop:"attributeType"},{default:a(()=>[t(y,{modelValue:o.attributeType,"onUpdate:modelValue":e[7]||(e[7]=l=>o.attributeType=l),placeholder:"请选择属性类型"},{default:a(()=>[t(i,{label:"文本",value:"text"}),t(i,{label:"数字",value:"number"}),t(i,{label:"日期",value:"date"}),t(i,{label:"枚举",value:"enum"}),t(i,{label:"布尔",value:"boolean"})]),_:1},8,["modelValue"])]),_:1}),t(c,{label:"组件类型",prop:"componentType"},{default:a(()=>[t(y,{modelValue:o.componentType,"onUpdate:modelValue":e[8]||(e[8]=l=>o.componentType=l),placeholder:"请选择组件类型"},{default:a(()=>[t(i,{label:"输入框",value:"input"}),t(i,{label:"下拉框",value:"select"}),t(i,{label:"单选框",value:"radio"}),t(i,{label:"复选框",value:"checkbox"}),t(i,{label:"滑块",value:"slider"}),t(i,{label:"开关",value:"switch"}),t(i,{label:"日期选择器",value:"date-picker"})]),_:1},8,["modelValue"])]),_:1}),t(c,{label:"默认值",prop:"defaultValue"},{default:a(()=>[t(g,{modelValue:o.defaultValue,"onUpdate:modelValue":e[9]||(e[9]=l=>o.defaultValue=l),placeholder:"请输入默认值"},null,8,["modelValue"])]),_:1}),t(c,{label:"图标URL",prop:"iconUrl"},{default:a(()=>[t(g,{modelValue:o.iconUrl,"onUpdate:modelValue":e[10]||(e[10]=l=>o.iconUrl=l),placeholder:"请输入图标URL"},null,8,["modelValue"])]),_:1}),t(c,{label:"提示信息",prop:"tooltip"},{default:a(()=>[t(g,{modelValue:o.tooltip,"onUpdate:modelValue":e[11]||(e[11]=l=>o.tooltip=l),type:"textarea",placeholder:"请输入提示信息",rows:2},null,8,["modelValue"])]),_:1}),t(c,{label:"属性组",prop:"attributeGroupId"},{default:a(()=>[t(y,{modelValue:o.attributeGroupId,"onUpdate:modelValue":e[12]||(e[12]=l=>o.attributeGroupId=l),placeholder:"请选择属性组",clearable:"",filterable:"","allow-create":"","default-first-option":"",style:{width:"100%"}},{default:a(()=>[(_(!0),N(W,null,X(M.value,l=>(_(),h(i,{key:l.attributeGroupId,label:l.attributeGroupName,value:l.attributeGroupId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"]),t(j,{title:d.title,modelValue:d.open,"onUpdate:modelValue":e[16]||(e[16]=l=>d.open=l),width:"400px","append-to-body":""},{footer:a(()=>[m("div",Je,[t(r,{type:"primary",loading:d.isUploading,onClick:de},{default:a(()=>e[33]||(e[33]=[s("确 定")])),_:1,__:[33]},8,["loading"]),t(r,{onClick:e[15]||(e[15]=l=>d.open=!1)},{default:a(()=>e[34]||(e[34]=[s("取 消")])),_:1,__:[34]})])]),default:a(()=>[t(we,{ref_key:"uploadRef",ref:U,limit:1,accept:".xlsx, .xls",headers:d.headers,action:d.url+"?updateSupport="+d.updateSupport,disabled:d.isUploading,"on-progress":se,"on-success":pe,"on-change":ce,"on-remove":me,"auto-upload":!1,drag:""},{tip:a(()=>[m("div",He,[m("div",Oe,[t(_e,{modelValue:d.updateSupport,"onUpdate:modelValue":e[14]||(e[14]=l=>d.updateSupport=l)},null,8,["modelValue"]),e[29]||(e[29]=s("是否更新已经存在的属性数据 "))]),e[31]||(e[31]=m("span",null,"仅允许导入xls、xlsx格式文件。",-1)),t(ye,{type:"primary",underline:!1,style:{"font-size":"12px","vertical-align":"baseline"},onClick:ie},{default:a(()=>e[30]||(e[30]=[s("下载模板")])),_:1,__:[30]})])]),default:a(()=>[t(ve,{class:"el-icon--upload"},{default:a(()=>[t(he(qe))]),_:1}),e[32]||(e[32]=m("div",{class:"el-upload__text"},[s("将文件拖到此处，或"),m("em",null,"点击上传")],-1))]),_:1,__:[32]},8,["headers","action","disabled"])]),_:1},8,["title","modelValue"])])}}},tt=Te(We,[["__scopeId","data-v-9b3e8231"]]);export{tt as default};
