import{_ as ce,u as me,r as d,g as I,B as R,i as be,E as p,a as u,j as T,c as ge,o as b,e as c,b as t,k as g,m as v,w as r,f as s,l as F,t as _e,v as fe,n as P}from"./index-a6CENfl-.js";import{checkAttributeGroupCodeUnique as ve,listAttributeGroup as $,delAttributeGroup as we,updateAttributeGroup as Ge,addAttributeGroup as ye,delAttributeGroupBatch as he}from"./attributeGroup-DNxjbwZp.js";const Ce={class:"app-container"},xe={class:"head-container"},Ve={class:"title-container"},ke={class:"button-container"},Ne={class:"search-form"},ze={class:"pagination-container"},qe={class:"dialog-footer"},Ie={__name:"index",setup(Se){const S=me(),V=d(!1),k=d(!0),B=d(0),A=d([]),w=d([]),j=d(),h=d(),C=d(!1),z=d(!1),l=I({attributeGroupId:null,attributeGroupCode:"",attributeGroupName:"",description:"",sortOrder:0}),n=I({pageNum:1,pageSize:10,attributeGroupCode:"",attributeGroupName:""}),K=I({attributeGroupCode:[{required:!0,message:"属性组编码不能为空",trigger:"blur"},{validator:async(o,e,G)=>{if(!e){G(new Error("属性组编码不能为空"));return}try{(await ve(e,l.attributeGroupId)).data.unique?G():G(new Error("属性组编码已存在"))}catch{G(new Error("验证失败"))}},trigger:"blur"}],attributeGroupName:[{required:!0,message:"属性组名称不能为空",trigger:"blur"}],sortOrder:[{required:!0,message:"排序不能为空",trigger:"blur"},{type:"number",message:"请输入数字",trigger:"blur"}]}),M=R(()=>l.attributeGroupId?"修改属性组":"新增属性组"),U=R(()=>!!l.attributeGroupId);be(()=>{_()});const _=async()=>{V.value=!0;try{const o=await $(n);A.value=o.rows,B.value=o.total,V.value=!1}catch{V.value=!1,p.error("获取属性组列表失败")}},N=()=>{n.pageNum=1,_()},L=()=>{n.attributeGroupCode="",n.attributeGroupName="",N()},Q=()=>{k.value=!k.value},H=o=>{n.pageSize=o,_()},J=o=>{n.pageNum=o,_()},W=o=>{w.value=o},X=o=>{},Y=()=>{S.back()},Z=()=>{q(),C.value=!0},ee=async o=>{q();try{const e=await $({attributeGroupId:o.attributeGroupId});e.rows&&e.rows.length>0&&(Object.assign(l,e.rows[0]),C.value=!0)}catch{p.error("获取属性组详情失败")}},te=async o=>{try{await P.confirm("确定要删除该属性组吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await we(o.attributeGroupId),p.success("删除成功"),_()}catch{}},re=async()=>{if(w.value.length===0){p.warning("请选择要删除的属性组");return}try{await P.confirm(`确定要删除选中的 ${w.value.length} 个属性组吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const o=w.value.map(e=>e.attributeGroupId);await he(o),p.success("删除成功"),_(),w.value=[]}catch{}},oe=()=>{p.success("导出功能待实现")},ae=o=>{S.push({path:"/cpq/attributeGroupAttribute",query:{attributeGroupId:o.attributeGroupId,attributeGroupName:o.attributeGroupName}})},q=()=>{l.attributeGroupId=null,l.attributeGroupCode="",l.attributeGroupName="",l.description="",l.sortOrder=0,h.value&&h.value.resetFields()},E=()=>{C.value=!1,q()},le=async()=>{h.value&&await h.value.validate(async o=>{if(o){z.value=!0;try{U.value?(await Ge(l),p.success("修改成功")):(await ye(l),p.success("新增成功")),E(),_()}catch{p.error(U.value?"修改失败":"新增失败")}finally{z.value=!1}}})};return(o,e)=>{const G=u("el-page-header"),i=u("el-button"),x=u("el-input"),f=u("el-form-item"),D=u("el-form"),ne=u("el-collapse-transition"),m=u("el-table-column"),ie=u("el-table"),ue=u("el-pagination"),se=u("el-input-number"),de=u("el-dialog"),y=T("hasPermi"),pe=T("loading");return b(),ge("div",Ce,[c("div",xe,[c("div",Ve,[t(G,{onBack:Y,content:"属性组管理"})]),c("div",ke,[g((b(),v(i,{type:"primary",plain:"",onClick:Z},{default:r(()=>e[9]||(e[9]=[c("i",{class:"el-icon-plus"},null,-1),s(" 新增 ")])),_:1,__:[9]})),[[y,["cpq:attributeGroup:add"]]]),g((b(),v(i,{type:"danger",plain:"",onClick:re,disabled:w.value.length===0},{default:r(()=>e[10]||(e[10]=[c("i",{class:"el-icon-delete"},null,-1),s(" 批量删除 ")])),_:1,__:[10]},8,["disabled"])),[[y,["cpq:attributeGroup:delete"]]]),g((b(),v(i,{type:"warning",plain:"",onClick:oe},{default:r(()=>e[11]||(e[11]=[c("i",{class:"el-icon-download"},null,-1),s(" 导出 ")])),_:1,__:[11]})),[[y,["cpq:attributeGroup:export"]]])])]),t(ne,null,{default:r(()=>[g(c("div",Ne,[t(D,{inline:!0,model:n,ref_key:"queryFormRef",ref:j,"label-width":"68px"},{default:r(()=>[t(f,{label:"属性组编码",prop:"attributeGroupCode"},{default:r(()=>[t(x,{modelValue:n.attributeGroupCode,"onUpdate:modelValue":e[0]||(e[0]=a=>n.attributeGroupCode=a),placeholder:"请输入属性组编码",clearable:"",size:"small",style:{width:"200px"},onKeyup:F(N,["enter"])},null,8,["modelValue"])]),_:1}),t(f,{label:"属性组名称",prop:"attributeGroupName"},{default:r(()=>[t(x,{modelValue:n.attributeGroupName,"onUpdate:modelValue":e[1]||(e[1]=a=>n.attributeGroupName=a),placeholder:"请输入属性组名称",clearable:"",size:"small",style:{width:"200px"},onKeyup:F(N,["enter"])},null,8,["modelValue"])]),_:1}),t(f,null,{default:r(()=>[t(i,{type:"primary",size:"small",icon:"el-icon-search",onClick:N},{default:r(()=>e[12]||(e[12]=[s(" 搜索 ")])),_:1,__:[12]}),t(i,{size:"small",icon:"el-icon-refresh",onClick:L},{default:r(()=>e[13]||(e[13]=[s(" 重置 ")])),_:1,__:[13]}),t(i,{size:"small",onClick:Q},{default:r(()=>[s(_e(k.value?"收起":"展开"),1)]),_:1})]),_:1})]),_:1},8,["model"])],512),[[fe,k.value]])]),_:1}),g((b(),v(ie,{data:A.value,onSelectionChange:W,border:"",stripe:"",style:{width:"100%"},onRowClick:X},{default:r(()=>[t(m,{type:"selection",width:"55",align:"center"}),t(m,{label:"属性组ID",prop:"attributeGroupId",width:"80",align:"center"}),t(m,{label:"属性组编码",prop:"attributeGroupCode","min-width":"120"}),t(m,{label:"属性组名称",prop:"attributeGroupName","min-width":"150"}),t(m,{label:"描述",prop:"description","min-width":"200"}),t(m,{label:"排序",prop:"sortOrder",width:"80",align:"center"}),t(m,{label:"创建时间",prop:"createTime",width:"180",align:"center"}),t(m,{label:"操作",width:"180",align:"center",fixed:"right"},{default:r(a=>[g((b(),v(i,{size:"small",type:"primary",onClick:O=>ee(a.row)},{default:r(()=>e[14]||(e[14]=[s(" 修改 ")])),_:2,__:[14]},1032,["onClick"])),[[y,["cpq:attributeGroup:edit"]]]),g((b(),v(i,{size:"small",type:"info",onClick:O=>ae(a.row)},{default:r(()=>e[15]||(e[15]=[s(" 关联属性 ")])),_:2,__:[15]},1032,["onClick"])),[[y,["cpq:attributeGroupAttribute:add"]]]),g((b(),v(i,{size:"small",type:"danger",onClick:O=>te(a.row)},{default:r(()=>e[16]||(e[16]=[s(" 删除 ")])),_:2,__:[16]},1032,["onClick"])),[[y,["cpq:attributeGroup:delete"]]])]),_:1})]),_:1},8,["data"])),[[pe,V.value]]),c("div",ze,[t(ue,{"current-page":n.pageNum,"onUpdate:currentPage":e[2]||(e[2]=a=>n.pageNum=a),"page-size":n.pageSize,"onUpdate:pageSize":e[3]||(e[3]=a=>n.pageSize=a),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:B.value,onSizeChange:H,onCurrentChange:J},null,8,["current-page","page-size","total"])]),t(de,{modelValue:C.value,"onUpdate:modelValue":e[8]||(e[8]=a=>C.value=a),title:M.value,width:"500px","append-to-body":""},{footer:r(()=>[c("span",qe,[t(i,{onClick:E},{default:r(()=>e[17]||(e[17]=[s("取消")])),_:1,__:[17]}),t(i,{type:"primary",loading:z.value,onClick:le},{default:r(()=>e[18]||(e[18]=[s(" 确定 ")])),_:1,__:[18]},8,["loading"])])]),default:r(()=>[t(D,{ref_key:"formRef",ref:h,model:l,rules:K,"label-width":"100px"},{default:r(()=>[t(f,{label:"属性组编码",prop:"attributeGroupCode"},{default:r(()=>[t(x,{modelValue:l.attributeGroupCode,"onUpdate:modelValue":e[4]||(e[4]=a=>l.attributeGroupCode=a),placeholder:"请输入属性组编码",clearable:"",maxlength:"50","show-word-limit":""},null,8,["modelValue"])]),_:1}),t(f,{label:"属性组名称",prop:"attributeGroupName"},{default:r(()=>[t(x,{modelValue:l.attributeGroupName,"onUpdate:modelValue":e[5]||(e[5]=a=>l.attributeGroupName=a),placeholder:"请输入属性组名称",clearable:"",maxlength:"100","show-word-limit":""},null,8,["modelValue"])]),_:1}),t(f,{label:"描述",prop:"description"},{default:r(()=>[t(x,{modelValue:l.description,"onUpdate:modelValue":e[6]||(e[6]=a=>l.description=a),type:"textarea",rows:3,placeholder:"请输入描述",maxlength:"500","show-word-limit":""},null,8,["modelValue"])]),_:1}),t(f,{label:"排序",prop:"sortOrder"},{default:r(()=>[t(se,{modelValue:l.sortOrder,"onUpdate:modelValue":e[7]||(e[7]=a=>l.sortOrder=a),min:0,max:9999,step:1},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}},Ue=ce(Ie,[["__scopeId","data-v-dce16525"]]);export{Ue as default};
