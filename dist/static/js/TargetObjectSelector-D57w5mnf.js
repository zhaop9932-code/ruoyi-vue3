import N from"./NodeSelector-Ct-lJUlq.js";import g from"./AttributeSelector-D3T3OJek.js";import{i as ee,T as b}from"./actionConfig-C-hhf0v-.js";import{g as le}from"./superBomRuleRelation-Cz_bCmLL.js";import{getSuperBomVariableByBomId as te}from"./superBomVariable-gMrvMuGl.js";import{_ as ae,r as h,w as J,z as ue,h as B,d as V,e as d,l as n,m as f,n as c,K as C,i as T,k,L as Y,V as L}from"./index-CwdKQqOf.js";import"./superBomStructure-BzSqI57Q.js";import"./bom-DdrUuB8x.js";import"./superBomDynamicAttribute-BGTx_QxK.js";import"./superBomProductRelation-e2EKVMIZ.js";const re={class:"target-object-selector"},de={__name:"TargetObjectSelector",props:{modelValue:{type:[String,Number,Array],default:""},actionType:{type:String,required:!0},targetType:{type:String,required:!0},bomId:{type:[String,Number],required:!0},structureId:{type:[String,Number],default:""},attributeId:{type:[String,Number],default:""},structure:{type:Object,default:null}},emits:["update:modelValue","change","update:structureId","update:attributeId"],setup(r,{emit:P}){const o=r,p=P,u=h(o.structureId||""),s=h(o.attributeId||""),m=h(null),x=h([]),j=h([]),S=h(!1),q=h(!1),M=h(!1),a=h(o.modelValue),O=l=>{if(!l)return[];let e=[];return typeof l=="string"?l.includes(",")?e=l.split(",").map(i=>i.trim()):e=[l]:Array.isArray(l)?e=l:e=[String(l)],e.map(i=>{if(!i)return null;const y=Number(i);return isNaN(y)?null:y}).filter(i=>i!==null)};J(a,l=>{const e=O(l),i=O(o.modelValue);JSON.stringify(e)!==JSON.stringify(i)&&p("update:modelValue",l)}),J(()=>o.modelValue,l=>{const e=O(l),i=O(a.value);JSON.stringify(e)!==JSON.stringify(i)&&(a.value=l)});const I=ue(()=>ee(o.actionType,o.targetType)),F=l=>{p("change",l),p("update:structureId",l)},A=l=>{u.value=l,s.value="",a.value="",p("update:structureId",l)},w=l=>{p("change",l),p("update:attributeId",l)},D=(l,e)=>{s.value=l,m.value=e,a.value="",p("update:attributeId",l)},U=l=>{p("change",l)},G=l=>{p("change",l)},K=l=>{p("change",l)},$=l=>{p("change",l)},H=async()=>{if(o.bomId){if(S.value){console.log("规则列表正在加载中，跳过重复调用");return}S.value=!0;try{const l=await le(o.bomId);if(l.code===200&&l.data){if(x.value=l.data,o.targetType===b.RULE&&o.modelValue){const e=O(o.modelValue);a.value=e}}else L.error("加载规则列表失败")}catch(l){console.error("加载规则列表失败:",l),L.error("加载规则列表失败")}finally{S.value=!1,console.log("规则列表加载完成，重置loading状态")}}},Q=l=>{if(I.value)return O(l);{if(!l)return"";if(Array.isArray(l))return l.length>0?l[0]:"";const e=Number(l);return isNaN(e)?l:e}},W=async()=>{if(o.bomId){if(q.value){console.log("变量列表正在加载中，跳过重复调用");return}q.value=!0;try{console.log("开始加载变量列表");const l=await te(o.bomId);if(l.code===200&&l.data){if(j.value=l.data,o.targetType===b.VARIABLE&&o.modelValue){const e=Q(o.modelValue);JSON.stringify(a.value)!==JSON.stringify(e)&&(a.value=e)}}else L.error("加载变量列表失败")}catch(l){console.error("加载变量列表失败:",l),L.error("加载变量列表失败")}finally{q.value=!1,console.log("变量列表加载完成，重置loading状态")}}},X=()=>{if(M.value){console.log("初始化过程中，跳过重复调用initTargetObject");return}M.value=!0;try{if(!o)return;const l=o.targetType||"",e=o.structureId||"",i=o.attributeId||"",y=o.modelValue||"";if(!l){u.value="",s.value="",m.value=null,a.value="";return}u.value!==e&&(u.value=e),s.value!==i&&(s.value=i),l!==b.VARIABLE?JSON.stringify(a.value)!==JSON.stringify(y)&&(a.value=y):!a.value&&y&&(a.value=y),[b.NODE_STATIC_ATTR_VALUE,b.NODE_DYNAMIC_ATTR_VALUE].includes(l)&&e&&i?console.log("需要加载属性详情:",{attributeId:i,structureId:e,targetType:l}):l===b.RULE?S.value||H():l===b.VARIABLE&&(q.value||W())}finally{M.value=!1}};let z=null;return J(()=>[o.structureId,o.attributeId,o.modelValue,o.targetType,o.bomId],([l,e,i,y,E],[R,t,v,Z,_]=[])=>{z&&clearTimeout(z),z=setTimeout(()=>{(l!==R||e!==t||JSON.stringify(i)!==JSON.stringify(v)||y!==Z||E!==_)&&X()},100)},{immediate:!0}),(l,e)=>{const i=B("el-input"),y=B("el-form-item"),E=B("el-option"),R=B("el-select");return d(),V("div",re,[r.targetType===c(b).NODE?(d(),n(N,{key:0,modelValue:a.value,"onUpdate:modelValue":e[0]||(e[0]=t=>a.value=t),"bom-id":r.bomId,"target-type":r.targetType,label:"目标对象",placeholder:"请选择当前BOM下树状节点",multiple:!1,required:!0,onChange:F},null,8,["modelValue","bom-id","target-type"])):r.targetType===c(b).NODE_STATIC_ATTR?(d(),V(C,{key:1},[T(N,{modelValue:u.value,"onUpdate:modelValue":e[1]||(e[1]=t=>u.value=t),"bom-id":r.bomId,label:"节点",placeholder:"请选择当前BOM下树状节点",multiple:!1,required:!0,onChange:A},null,8,["modelValue","bom-id"]),u.value?(d(),n(g,{key:0,modelValue:a.value,"onUpdate:modelValue":e[2]||(e[2]=t=>a.value=t),"attribute-type":"static","bom-id":r.bomId,"node-id":u.value,label:"目标对象",placeholder:"请选择节点下静态属性",multiple:I.value,required:!0,onChange:w},null,8,["modelValue","bom-id","node-id","multiple"])):f("",!0)],64)):r.targetType===c(b).NODE_STATIC_ATTR_VALUE?(d(),V(C,{key:2},[T(N,{modelValue:u.value,"onUpdate:modelValue":e[3]||(e[3]=t=>u.value=t),"bom-id":r.bomId,"target-type":r.targetType,label:"节点",placeholder:"请选择当前BOM下树状节点",multiple:!1,required:!0,onChange:A},null,8,["modelValue","bom-id","target-type"]),u.value?(d(),n(g,{key:0,modelValue:s.value,"onUpdate:modelValue":e[4]||(e[4]=t=>s.value=t),"attribute-type":"static","bom-id":r.bomId,"node-id":u.value,label:"属性",placeholder:"请选择节点下静态属性",multiple:!1,required:!0,onChange:D},null,8,["modelValue","bom-id","node-id"])):f("",!0),s.value?(d(),n(y,{key:1,label:"目标对象",required:!0},{default:k(()=>{var t;return[m.value&&m.value.attributeType==="selector"?(d(),n(g,{key:0,modelValue:a.value,"onUpdate:modelValue":e[5]||(e[5]=v=>a.value=v),"attribute-type":"attributeValue","attribute-id":s.value,"structure-id":u.value,"attr-info":m.value,"dynamic-values":((t=m.value)==null?void 0:t.attributeValues)||[],label:"",placeholder:"请选择静态属性下属性值",multiple:I.value,required:!0,onChange:U},null,8,["modelValue","attribute-id","structure-id","attr-info","dynamic-values","multiple"])):m.value&&m.value.attributeType==="text"?(d(),n(i,{key:1,modelValue:a.value,"onUpdate:modelValue":e[6]||(e[6]=v=>a.value=v),placeholder:"请输入静态属性值",disabled:!1,style:{width:"100%"},onChange:U},null,8,["modelValue"])):(d(),n(i,{key:2,placeholder:"加载中...",disabled:"",style:{width:"100%"}}))]}),_:1})):f("",!0)],64)):r.targetType===c(b).NODE_DYNAMIC_ATTR?(d(),V(C,{key:3},[T(N,{modelValue:u.value,"onUpdate:modelValue":e[7]||(e[7]=t=>u.value=t),"bom-id":r.bomId,"target-type":r.targetType,label:"节点",placeholder:"请选择当前BOM下树状节点",multiple:!1,required:!0,onChange:A},null,8,["modelValue","bom-id","target-type"]),u.value?(d(),n(g,{key:0,modelValue:a.value,"onUpdate:modelValue":e[8]||(e[8]=t=>a.value=t),"attribute-type":"dynamic","bom-id":r.bomId,"node-id":u.value,label:"目标对象",placeholder:"请选择节点下动态属性",multiple:I.value,required:!0,onChange:w},null,8,["modelValue","bom-id","node-id","multiple"])):f("",!0)],64)):r.targetType===c(b).NODE_DYNAMIC_ATTR_VALUE?(d(),V(C,{key:4},[T(N,{modelValue:u.value,"onUpdate:modelValue":e[9]||(e[9]=t=>u.value=t),"bom-id":r.bomId,"target-type":r.targetType,label:"节点",placeholder:"请选择当前BOM下树状节点",multiple:!1,required:!0,onChange:A},null,8,["modelValue","bom-id","target-type"]),u.value?(d(),n(g,{key:0,modelValue:s.value,"onUpdate:modelValue":e[10]||(e[10]=t=>s.value=t),"attribute-type":"dynamic","bom-id":r.bomId,"node-id":u.value,label:"属性",placeholder:"请选择节点下动态属性",multiple:!1,required:!0,onChange:D},null,8,["modelValue","bom-id","node-id"])):f("",!0),s.value?(d(),n(y,{key:1,label:"目标对象",required:!0},{default:k(()=>{var t;return[m.value&&m.value.attributeType==="selector"?(d(),n(g,{key:0,modelValue:a.value,"onUpdate:modelValue":e[11]||(e[11]=v=>a.value=v),"attribute-type":"attributeValue","attribute-id":s.value,"structure-id":u.value,"attr-info":m.value,"dynamic-values":((t=m.value)==null?void 0:t.attributeValues)||[],label:"",placeholder:"请选择动态属性下属性值",multiple:I.value,required:!0,onChange:U},null,8,["modelValue","attribute-id","structure-id","attr-info","dynamic-values","multiple"])):m.value&&m.value.attributeType==="text"?(d(),n(i,{key:1,modelValue:a.value,"onUpdate:modelValue":e[12]||(e[12]=v=>a.value=v),placeholder:"请输入动态属性值",disabled:!1,style:{width:"100%"},onChange:U},null,8,["modelValue"])):(d(),n(i,{key:2,placeholder:"加载中...",disabled:"",style:{width:"100%"}}))]}),_:1})):f("",!0)],64)):r.targetType===c(b).NODE_PRODUCT?(d(),V(C,{key:5},[T(N,{modelValue:u.value,"onUpdate:modelValue":e[13]||(e[13]=t=>u.value=t),"bom-id":r.bomId,"target-type":r.targetType,label:"节点",placeholder:"请选择当前BOM下树状节点",multiple:!1,required:!0,onChange:A},null,8,["modelValue","bom-id","target-type"]),T(g,{modelValue:a.value,"onUpdate:modelValue":e[14]||(e[14]=t=>a.value=t),"attribute-type":"product","bom-id":r.bomId,"node-id":u.value,label:"目标对象",placeholder:"请选择节点下产品",multiple:I.value,required:!0,onChange:G},null,8,["modelValue","bom-id","node-id","multiple"])],64)):r.targetType===c(b).DYNAMIC_ATTR?(d(),V(C,{key:6},[T(N,{modelValue:u.value,"onUpdate:modelValue":e[15]||(e[15]=t=>u.value=t),"bom-id":r.bomId,"target-type":r.targetType,label:"节点",placeholder:"请选择当前BOM下树状节点",multiple:!1,required:!0,onChange:A},null,8,["modelValue","bom-id","target-type"]),u.value?(d(),n(g,{key:0,modelValue:a.value,"onUpdate:modelValue":e[16]||(e[16]=t=>a.value=t),"attribute-type":"dynamic","bom-id":r.bomId,"node-id":u.value,label:"目标对象",placeholder:"请选择节点下动态属性",multiple:I.value,required:!0,onChange:w},null,8,["modelValue","bom-id","node-id","multiple"])):f("",!0)],64)):r.targetType===c(b).DYNAMIC_ATTR_VALUE?(d(),V(C,{key:7},[T(N,{modelValue:u.value,"onUpdate:modelValue":e[17]||(e[17]=t=>u.value=t),"bom-id":r.bomId,"target-type":r.targetType,label:"节点",placeholder:"请选择当前BOM下树状节点",multiple:!1,required:!0,onChange:A},null,8,["modelValue","bom-id","target-type"]),u.value?(d(),n(g,{key:0,modelValue:s.value,"onUpdate:modelValue":e[18]||(e[18]=t=>s.value=t),"attribute-type":"dynamic","bom-id":r.bomId,"node-id":u.value,label:"属性",placeholder:"请选择节点下动态属性",multiple:!1,required:!0,onChange:D},null,8,["modelValue","bom-id","node-id"])):f("",!0),s.value?(d(),n(y,{key:1,label:"目标对象",required:!0},{default:k(()=>{var t;return[m.value&&m.value.attributeType==="selector"?(d(),n(g,{key:0,modelValue:a.value,"onUpdate:modelValue":e[19]||(e[19]=v=>a.value=v),"attribute-type":"attributeValue","attribute-id":s.value,"structure-id":u.value,"attr-info":m.value,"dynamic-values":((t=m.value)==null?void 0:t.attributeValues)||[],label:"",placeholder:"请选择动态属性下属性值",multiple:I.value,required:!0,onChange:U},null,8,["modelValue","attribute-id","structure-id","attr-info","dynamic-values","multiple"])):m.value&&m.value.attributeType==="text"?(d(),n(i,{key:1,modelValue:a.value,"onUpdate:modelValue":e[20]||(e[20]=v=>a.value=v),placeholder:"请输入动态属性值",disabled:!1,style:{width:"100%"},onChange:U},null,8,["modelValue"])):(d(),n(i,{key:2,placeholder:"加载中...",disabled:"",style:{width:"100%"}}))]}),_:1})):f("",!0)],64)):r.targetType===c(b).RULE?(d(),n(y,{key:8,label:"目标对象",required:""},{default:k(()=>[T(R,{modelValue:a.value,"onUpdate:modelValue":e[21]||(e[21]=t=>a.value=t),multiple:"",placeholder:"请选择当前BOM规则列表",clearable:"",filterable:"",style:{width:"100%"},onChange:K},{default:k(()=>[(d(!0),V(C,null,Y(x.value,t=>(d(),n(E,{key:t.ruleId,label:t.ruleName,value:t.ruleId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):r.targetType===c(b).VARIABLE?(d(),n(y,{key:9,label:"目标对象",required:""},{default:k(()=>[T(R,{modelValue:a.value,"onUpdate:modelValue":e[22]||(e[22]=t=>a.value=t),multiple:I.value,placeholder:"请选择已定义的变量",clearable:"",filterable:"",style:{width:"100%"},onChange:$},{default:k(()=>[(d(!0),V(C,null,Y(j.value,t=>(d(),n(E,{key:t.variableId,label:t.variableName,value:t.variableId},null,8,["label","value"]))),128))]),_:1},8,["modelValue","multiple"])]),_:1})):f("",!0)])}}},Ve=ae(de,[["__scopeId","data-v-6761e0c1"]]);export{Ve as default};
