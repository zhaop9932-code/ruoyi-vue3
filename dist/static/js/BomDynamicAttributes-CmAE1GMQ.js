import{_ as te,r as V,$ as A,h as le,a as n,i as ae,c as U,o as u,e as I,j as re,b as a,w as o,f,m as d,t as oe,k as ne,F as O,n as B,Q as D,E as y}from"./index-DgigFOm-.js";const ue={class:"bom-dynamic-attributes"},se={class:"management-header"},de={class:"header-buttons"},ie={class:"dialog-footer"},pe={__name:"BomDynamicAttributes",props:{bomId:{type:[String,Number],required:!0}},setup($){const v=$,C=V(!1),g=V([]),_=V(!1),h=V("新增属性"),k=V(null),i=V([]),m=V(""),e=A({attrId:null,bomId:v.bomId,attrCode:"",attrName:"",attrType:"string",attrValue:"",required:!1,sortOrder:100,description:"",options:[]}),F=A({attrCode:[{required:!0,message:"属性编码不能为空",trigger:"blur"},{pattern:/^[a-zA-Z0-9_]+$/,message:"属性编码只能包含字母、数字和下划线",trigger:"blur"}],attrName:[{required:!0,message:"属性名称不能为空",trigger:"blur"}],attrType:[{required:!0,message:"请选择属性类型",trigger:"change"}]}),M=r=>({input:"单行文本输入框",textarea:"多行文本输入框",select:"下拉单选","multiple-select":"下拉多选",slider:"滑块",switch:"开关",string:"单行文本输入框",number:"单行文本输入框",boolean:"开关",date:"单行文本输入框"})[r]||r,E=r=>({input:"primary",textarea:"success",select:"warning","multiple-select":"info",slider:"danger",switch:"primary",string:"primary",number:"success",boolean:"warning",date:"info"})[r]||"default",S=()=>{C.value=!0,setTimeout(()=>{i.value=[{attrId:1,bomId:v.bomId,attrCode:"color",attrName:"颜色",attrType:"select",attrValue:"red",required:!0,sortOrder:1,description:"产品颜色",options:[{value:"red",label:"红色"},{value:"blue",label:"蓝色"},{value:"green",label:"绿色"}]},{attrId:2,bomId:v.bomId,attrCode:"weight",attrName:"重量",attrType:"number",attrValue:100,required:!1,sortOrder:2,description:"产品重量（g）"},{attrId:3,bomId:v.bomId,attrCode:"is_active",attrName:"是否激活",attrType:"boolean",attrValue:!0,required:!1,sortOrder:3,description:"产品是否激活"},{attrId:4,bomId:v.bomId,attrCode:"release_date",attrName:"发布日期",attrType:"date",attrValue:"2023-01-01",required:!0,sortOrder:4,description:"产品发布日期"},{attrId:5,bomId:v.bomId,attrCode:"description",attrName:"产品描述",attrType:"string",attrValue:"这是一个测试产品",required:!1,sortOrder:5,description:"产品详细描述"}],C.value=!1},500)},z=()=>{switch(e.options=[],m.value="",e.attrType){case"switch":e.attrValue=!1;break;case"multiple-select":e.attrValue=[];break;case"slider":e.attrValue=0;break;case"textarea":case"input":case"select":default:e.attrValue="";break}},j=()=>{if(!m.value){e.options=[];return}const r=m.value.split(`
`).map(t=>t.trim()).filter(t=>t).map(t=>{const s=t.split("=");return s.length===2?{value:s[0].trim(),label:s[1].trim()}:{value:t,label:t}});e.options=r},L=r=>{g.value=r},R=()=>{H(),h.value="新增属性",_.value=!0},P=r=>{Object.assign(e,{...r}),r.attrType==="switch"&&(e.attrValue=!!r.attrValue),r.attrType==="select"&&r.options&&r.options.length>0?m.value=r.options.map(t=>`${t.value}=${t.label}`).join(`
`):m.value="",h.value="编辑属性",_.value=!0},Q=async r=>{try{await D.confirm(`确定要删除属性 "${r.attrName}" 吗？`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),i.value=i.value.filter(t=>t.attrId!==r.attrId),y.success("属性删除成功")}catch(t){t!=="cancel"&&(y.error("删除失败"),console.error("删除属性失败:",t))}},Z=async()=>{if(g.value.length!==0)try{await D.confirm(`确定要删除选中的 ${g.value.length} 个属性吗？`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const r=g.value.map(t=>t.attrId);i.value=i.value.filter(t=>!r.includes(t.attrId)),g.value=[],y.success("批量删除成功")}catch(r){r!=="cancel"&&(y.error("批量删除失败"),console.error("批量删除属性失败:",r))}},G=async()=>{try{if(["select","multiple-select"].includes(e.attrType)&&j(),e.attrType==="multiple-select"&&!Array.isArray(e.attrValue)&&(e.attrValue=e.attrValue?[e.attrValue]:[]),e.attrType==="switch"&&(e.attrValue=!!e.attrValue),await k.value.validate(),e.attrId){const r=i.value.findIndex(t=>t.attrId===e.attrId);r!==-1&&(i.value[r]={...e}),y.success("组件更新成功")}else{const r={...e,attrId:Date.now()};i.value.push(r),y.success("组件新增成功")}_.value=!1}catch(r){r!==!1&&(y.error("操作失败，请检查表单数据"),console.error("提交组件表单失败:",r))}},H=()=>{var r;e.attrId=null,e.attrCode="",e.attrName="",e.attrType="input",e.attrValue="",e.required=!1,e.sortOrder=100,e.description="",e.options=[],m.value="",e.attrType==="switch"&&(e.attrValue=!1),(r=k.value)==null||r.resetFields()};return le(()=>{S()}),(r,t)=>{const s=n("el-button"),p=n("el-table-column"),J=n("el-tag"),x=n("el-switch"),q=n("el-input-number"),K=n("el-table"),w=n("el-input"),c=n("el-form-item"),b=n("el-option"),N=n("el-select"),W=n("el-slider"),X=n("el-form"),Y=n("el-dialog"),ee=ae("loading");return u(),U("div",ue,[I("div",se,[t[17]||(t[17]=I("h3",null,"动态属性管理",-1)),I("div",de,[a(s,{type:"primary",icon:"Plus",onClick:R},{default:o(()=>t[15]||(t[15]=[f("新增属性")])),_:1,__:[15]}),a(s,{type:"danger",icon:"Delete",onClick:Z,disabled:g.value.length===0},{default:o(()=>t[16]||(t[16]=[f("批量删除")])),_:1,__:[16]},8,["disabled"])])]),re((u(),d(K,{data:i.value,stripe:"",style:{width:"100%"}},{default:o(()=>[a(p,{type:"selection",width:"55",align:"center",onSelectionChange:L}),a(p,{label:"属性编码",align:"center",prop:"attrCode","min-width":"150"}),a(p,{label:"属性名称",align:"center",prop:"attrName","min-width":"150"}),a(p,{label:"属性类型",align:"center",prop:"attrType",width:"120"},{default:o(l=>[a(J,{type:E(l.row.attrType)},{default:o(()=>[f(oe(M(l.row.attrType)),1)]),_:2},1032,["type"])]),_:1}),a(p,{label:"属性值",align:"center",prop:"attrValue","min-width":"150"}),a(p,{label:"是否必填",align:"center",prop:"required",width:"100"},{default:o(l=>[a(x,{modelValue:l.row.required,"onUpdate:modelValue":T=>l.row.required=T,disabled:""},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(p,{label:"排序",align:"center",prop:"sortOrder",width:"80"},{default:o(l=>[a(q,{modelValue:l.row.sortOrder,"onUpdate:modelValue":T=>l.row.sortOrder=T,min:0,step:1,disabled:!0,size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(p,{label:"描述",align:"center",prop:"description","min-width":"200","show-overflow-tooltip":""}),a(p,{label:"操作",align:"center",width:"150",fixed:"right"},{default:o(l=>[a(s,{size:"small",type:"primary",icon:"Edit",onClick:T=>P(l.row)},{default:o(()=>t[18]||(t[18]=[f(" 编辑 ")])),_:2,__:[18]},1032,["onClick"]),a(s,{size:"small",type:"danger",icon:"Delete",onClick:T=>Q(l.row)},{default:o(()=>t[19]||(t[19]=[f(" 删除 ")])),_:2,__:[19]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[ee,C.value]]),a(Y,{title:h.value,modelValue:_.value,"onUpdate:modelValue":t[14]||(t[14]=l=>_.value=l),width:"600px","append-to-body":""},{footer:o(()=>[I("span",ie,[a(s,{onClick:t[13]||(t[13]=l=>_.value=!1)},{default:o(()=>t[21]||(t[21]=[f("取消")])),_:1,__:[21]}),a(s,{type:"primary",onClick:G},{default:o(()=>t[22]||(t[22]=[f("确定")])),_:1,__:[22]})])]),default:o(()=>[a(X,{ref_key:"attributeFormRef",ref:k,model:e,rules:F,"label-width":"120px"},{default:o(()=>[a(c,{label:"属性编码",prop:"attrCode"},{default:o(()=>[a(w,{modelValue:e.attrCode,"onUpdate:modelValue":t[0]||(t[0]=l=>e.attrCode=l),placeholder:"请输入属性编码"},null,8,["modelValue"])]),_:1}),a(c,{label:"属性名称",prop:"attrName"},{default:o(()=>[a(w,{modelValue:e.attrName,"onUpdate:modelValue":t[1]||(t[1]=l=>e.attrName=l),placeholder:"请输入属性名称"},null,8,["modelValue"])]),_:1}),a(c,{label:"组件类型",prop:"attrType"},{default:o(()=>[a(N,{modelValue:e.attrType,"onUpdate:modelValue":t[2]||(t[2]=l=>e.attrType=l),placeholder:"请选择组件类型",onChange:z},{default:o(()=>[a(b,{label:"单行文本输入框",value:"input"}),a(b,{label:"多行文本输入框",value:"textarea"}),a(b,{label:"下拉单选",value:"select"}),a(b,{label:"下拉多选",value:"multiple-select"}),a(b,{label:"滑块",value:"slider"}),a(b,{label:"开关",value:"switch"})]),_:1},8,["modelValue"])]),_:1}),["select","multiple-select"].includes(e.attrType)?(u(),d(c,{key:0,label:"选项列表",prop:"options"},{default:o(()=>[a(w,{modelValue:m.value,"onUpdate:modelValue":t[3]||(t[3]=l=>m.value=l),type:"textarea",placeholder:"请输入选项，每行一个，格式：值=显示文本",rows:4},null,8,["modelValue"]),t[20]||(t[20]=I("div",{class:"form-tip"},"示例：red=红色 blue=蓝色 green=绿色",-1))]),_:1,__:[20]})):ne("",!0),a(c,{label:"默认值",prop:"attrValue"},{default:o(()=>[e.attrType==="switch"?(u(),d(x,{key:0,modelValue:e.attrValue,"onUpdate:modelValue":t[4]||(t[4]=l=>e.attrValue=l)},null,8,["modelValue"])):e.attrType==="select"&&e.options&&e.options.length>0?(u(),d(N,{key:1,modelValue:e.attrValue,"onUpdate:modelValue":t[5]||(t[5]=l=>e.attrValue=l),placeholder:"请选择属性值"},{default:o(()=>[(u(!0),U(O,null,B(e.options,l=>(u(),d(b,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):e.attrType==="multiple-select"&&e.options&&e.options.length>0?(u(),d(N,{key:2,modelValue:e.attrValue,"onUpdate:modelValue":t[6]||(t[6]=l=>e.attrValue=l),placeholder:"请选择属性值",multiple:"","collapse-tags":""},{default:o(()=>[(u(!0),U(O,null,B(e.options,l=>(u(),d(b,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):e.attrType==="slider"?(u(),d(W,{key:3,modelValue:e.attrValue,"onUpdate:modelValue":t[7]||(t[7]=l=>e.attrValue=l),min:0,max:100,step:1,"show-input":""},null,8,["modelValue"])):e.attrType==="textarea"?(u(),d(w,{key:4,modelValue:e.attrValue,"onUpdate:modelValue":t[8]||(t[8]=l=>e.attrValue=l),type:"textarea",placeholder:"请输入属性值",rows:3},null,8,["modelValue"])):(u(),d(w,{key:5,modelValue:e.attrValue,"onUpdate:modelValue":t[9]||(t[9]=l=>e.attrValue=l),placeholder:"请输入属性值"},null,8,["modelValue"]))]),_:1}),a(c,{label:"是否必填",prop:"required"},{default:o(()=>[a(x,{modelValue:e.required,"onUpdate:modelValue":t[10]||(t[10]=l=>e.required=l)},null,8,["modelValue"])]),_:1}),a(c,{label:"排序",prop:"sortOrder"},{default:o(()=>[a(q,{modelValue:e.sortOrder,"onUpdate:modelValue":t[11]||(t[11]=l=>e.sortOrder=l),min:0,step:1,placeholder:"请输入排序号"},null,8,["modelValue"])]),_:1}),a(c,{label:"描述",prop:"description"},{default:o(()=>[a(w,{modelValue:e.description,"onUpdate:modelValue":t[12]||(t[12]=l=>e.description=l),type:"textarea",placeholder:"请输入属性描述",rows:3},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])])}}},ce=te(pe,[["__scopeId","data-v-236ccefa"]]);export{ce as default};
